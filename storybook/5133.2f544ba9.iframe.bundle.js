"use strict";(self.webpackChunkocap=self.webpackChunkocap||[]).push([[5133],{"./packages/core/src/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{mK7:()=>AbstractDataSource,Idx:()=>AbstractEntityService,VQ4:()=>AdvancedSlicerOperator,dJT:()=>types_AgentStatusEnum,buO:()=>types_AgentType,YB8:()=>AggregationOperation,uFO:()=>property_AggregationRole,St3:()=>AnalyticsBusinessService,QPo:()=>types_C_MEASURES,og:()=>C_MEASURES_CAPTION,eNW:()=>calculated_CalculationType,gFA:()=>ChartBusinessService,cVA:()=>ChartDataZoomType,s3z:()=>ChartDimensionRoleType,rRL:()=>ChartMeasureRoleType,lST:()=>ChartOrient,rux:()=>CompareToEnum,eNP:()=>DSCacheService,Q$V:()=>DSCoreService,Dbq:()=>DimensionMemberRecursiveHierarchy,U8c:()=>DimensionType,CXV:()=>DisplayBehaviour,GDu:()=>Drill,CwT:()=>EntitySemantics,bl9:()=>FILTER_OPERATOR_DESC,pgc:()=>types_FilterOperator,ucB:()=>FilterSelectionType,vLo:()=>FilteringLogic,Aac:()=>IndicatorType,bcM:()=>IntrinsicMemberProperties,y3c:()=>MemberSource,uM:()=>OffSetDirection,N9t:()=>OrderDirection,WTi:()=>ParameterControlEnum,OmR:()=>PieVariant,CEQ:()=>PresentationEnum,Bjo:()=>ReferenceLineType,Vfs:()=>ReferenceLineValueType,ZRQ:()=>semantics_Semantics,HTq:()=>SmartChartEngine,QXJ:()=>SmartFilterBarService,Ryo:()=>SmartFilterService,GYg:()=>Syntax,AYn:()=>TimeGranularity,D4M:()=>time_TimeRangeType,OrP:()=>TreeSelectionMode,Bgl:()=>_getPropertyCaption,p6j:()=>advancedSlicerAsString,f0i:()=>assign_assign,kg4:()=>assignDeepOmitBlank,bvY:()=>time_calcRange,XhB:()=>cloneDeep,oA$:()=>compact,lOq:()=>convertDimensionToSlicer,VFc:()=>countBy,NSM:()=>displayByBehaviour,NOJ:()=>filterTreeNodes,$kk:()=>findTreeNode,xHg:()=>flatten,Ar6:()=>flattenDeep,elK:()=>formatRangeCurrentPeriod,nt_:()=>formatting,e6_:()=>getChartCategory,rlo:()=>getChartCategory2,HLD:()=>getChartSeries,L$q:()=>getChartTrellis,gyH:()=>helper_getDefaultHierarchy,Xpx:()=>getDimensionDisplayBehaviour,Imp:()=>getDimensionMemberCaption,GSp:()=>getEntityCalculations,l2r:()=>getEntityCalendarHierarchy,Fuv:()=>getEntityDefaultMeasure,UiI:()=>getEntityDimensionAndHierarchies,n6Q:()=>helper_getEntityDimensions,jEU:()=>helper_getEntityHierarchy,uZv:()=>getEntityLevel,wqS:()=>getEntityMeasures,fOg:()=>getEntityParameters,ZBB:()=>helper_getEntityProperty,TpC:()=>getEntityProperty2,Nps:()=>getMeasurePropertyUnit,H_E:()=>getMemberFromRow,Ex7:()=>getPropertyHierarchy,e_i:()=>getPropertyMeasure,HpB:()=>getPropertyName,M0K:()=>getPropertyUnitName,LC:()=>hierarchize,wMY:()=>isAdvancedFilter,ieb:()=>isAdvancedSlicer,Ryb:()=>isAggregationProperty,kJL:()=>isArray_isArray,reL:()=>isCalculatedProperty,ewE:()=>isCalculationProperty,nsn:()=>isChartMapType,xbD:()=>isEmpty_isEmpty,D_c:()=>isEntitySet,OCY:()=>isEntityType,Xyp:()=>isEqual,sT:()=>calculated_isIndicatorMeasureProperty,kb1:()=>isMeasure,UE_:()=>isMeasureControlProperty,kKJ:()=>isNil_isNil,hj$:()=>isNumber,RZT:()=>isParameterProperty,in1:()=>isPropertyDimension,mKs:()=>isPropertyMeasure,BJr:()=>isRestrictedMeasureProperty,IaF:()=>isSemanticCalendar,oHo:()=>isSlicer,HD0:()=>isString_isString,yNm:()=>isTimeRangesSlicer,pn4:()=>isVisible,DJ1:()=>isWrapBrackets,fpA:()=>mapIndicatorToMeasures,BsR:()=>mapTimeGranularitySemantic,JHz:()=>mergeOptions,tkI:()=>negate,vJr:()=>nonNullable,CEd:()=>omit,ezT:()=>omitBlank,L0i:()=>parameterFormatter,rUp:()=>parseDimension,eiS:()=>pick,KsU:()=>putFilter,eD2:()=>serializeUniqueName,J4Q:()=>slicerAsString,kwV:()=>stringifyProperty,P45:()=>timeRangesSlicerAsString,mNm:()=>uniqBy,Mlb:()=>unwrapBrackets,VjN:()=>uuid,KbT:()=>wrapBrackets,qZt:()=>wrapHierarchyValue});var Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),internal_BehaviorSubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js"),operators_filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),observable_combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),operators_map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),observable_of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js");function assign_assign(source,...params){return Object.assign(source??{},...params.map((item=>item??{})))}function isArray_isArray(value){return Array.isArray(value)}function isNil_isNil(value){return null==value}function nonNullable(value){return null!=value}function isPlainObject(value){if(!function isObjectLike(value){return"object"==typeof value&&null!==value}(value)||"[object Object]"!=function getTag(value){const toString=Object.prototype.toString;return null==value?void 0===value?"[object Undefined]":"[object Null]":toString.call(value)}(value))return!1;if(null===Object.getPrototypeOf(value))return!0;let proto=value;for(;null!==Object.getPrototypeOf(proto);)proto=Object.getPrototypeOf(proto);return Object.getPrototypeOf(value)===proto}function isString_isString(str){return!isNil_isNil(str)&&"string"==typeof str.valueOf()}function isBlank(value){return isNil_isNil(value)||isString_isString(value)&&!value.trim()}function mergeOptions(obj1,...objs){return assign_assign(obj1,...objs.map((item=>omitBlank(item))))}function assignDeepOmitBlank(source,target,dpth=1){if(isPlainObject(target))return dpth>0?Object.entries(target).filter((([key,value])=>!isBlank(value))).reduce(((obj,[key,value])=>(obj[key]=assignDeepOmitBlank(source?.[key],target[key],dpth-1),obj)),{...source??{}}):assign_assign(source,omitBlank(target));if(isArray_isArray(target)&&isArray_isArray(source)){const result=[];for(let index=0;index<Math.max(target.length,source.length);index++)result.push(assignDeepOmitBlank(source?.[index],target[index],dpth-1));return result}return isBlank(target)?source:target}function omitBlank(obj){return Array.isArray(obj)?obj.map((value=>omitBlank(value))):isPlainObject(obj)?Object.entries(obj).filter((([,v])=>!isBlank(v))).reduce(((r,[key,value])=>({...r,[key]:omitBlank(value)})),{}):obj}function isEmpty_isEmpty(obj){return[Object,Array].includes((obj||{}).constructor)&&!Object.entries(obj||{}).length}function flatten(arr){return arr?.reduce(((prev,curr)=>(prev.push(...Array.isArray(curr)?curr:[curr]),prev)),[])}var fast_deep_equal=__webpack_require__("./node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal);function isEqual(a,b){return fast_deep_equal_default()(a,b)}function negate(callbackFn){return(...params)=>!callbackFn(...params)}function omitBy_omitBy(obj,callbackFun){return function pickBy(object,predicate=(v=>v)){return Object.assign({},...Object.entries(object).filter((([,v])=>predicate(v))).map((([k,v])=>({[k]:v}))))}(obj,negate(callbackFun))}function omit(obj,...keys){return keys.reduce(((obj,key)=>{const{[key]:omitted,...rest}=obj;return rest}),obj??{})}function pick(object,...keys){return object&&(keys?.reduce(((obj,key)=>(object&&Object.prototype.hasOwnProperty.call(object,key)&&(obj[key]=object[key]),obj)),{})??{})}function uniqBy(arr,fn){return"string"==typeof fn?arr.filter(((element,index)=>arr.findIndex((step=>element[fn]===step[fn]))===index)):arr.filter(((element,index)=>arr.findIndex((step=>fn(element,step)))===index))}function compact(arr){return arr?.filter(Boolean)}function isNumber(value){return"number"==typeof value&&isFinite(value)}function countBy(arr,key){return arr?.reduce(((prev,curr)=>(prev[curr[key]]=prev[curr[key]]??0,prev[curr[key]]++,prev)),{})??{}}function flattenDeep(arr){return Array.isArray(arr)?arr.reduce(((a,b)=>a.concat(flattenDeep(b))),[]):arr?[arr]:[]}function cloneDeep(obj){return JSON.parse(JSON.stringify(obj))}const DEFAULT_DIGIT_INFO="0.2",FORMAT_LOCALE_DATA={en:{lang:"en-US",shortNumberFactor:3,shortNumberUnits:"K,M,B,T,Q"},"zh-Hans":{lang:"zh-Hans",shortNumberFactor:4,shortNumberUnits:"万,亿,万亿"}};function formatNumber(n,locale,digitsInfo){let[,fractionDigits]=(digitsInfo??DEFAULT_DIGIT_INFO).split(".");return fractionDigits=fractionDigits.split("-")[1]??fractionDigits,Number(n.toFixed(Number(fractionDigits))).toLocaleString(locale??"en")}function strToNumber(value){if("string"==typeof value&&!isNaN(Number(value)-parseFloat(value)))return Number(value);if("number"!=typeof value)throw new Error(`${value} is not a number`);return value}var ChartDimensionRoleType,ChartMeasureRoleType,ReferenceLineType,ReferenceLineValueType,ReferenceLineAggregation,ChartPattern,ChartOrient,BarVariant,WaterfallVariant,PieVariant,ScatterVariant,TreeVariant,HeatmapVariant;!function(ChartDimensionRoleType){ChartDimensionRoleType.Time="Time",ChartDimensionRoleType.Category="Category",ChartDimensionRoleType.Category2="Category2",ChartDimensionRoleType.Color="Color",ChartDimensionRoleType.Group="Group",ChartDimensionRoleType.Stacked="Stacked",ChartDimensionRoleType.Trellis="Trellis",ChartDimensionRoleType.Lat="Lat",ChartDimensionRoleType.Long="Long"}(ChartDimensionRoleType||(ChartDimensionRoleType={})),function(ChartMeasureRoleType){ChartMeasureRoleType.Axis1="Axis1",ChartMeasureRoleType.Axis2="Axis2",ChartMeasureRoleType.Axis3="Axis3",ChartMeasureRoleType.Size="Size",ChartMeasureRoleType.Lightness="Lightness",ChartMeasureRoleType.SizeLightness="SizeLightness",ChartMeasureRoleType.Tooltip="Tooltip"}(ChartMeasureRoleType||(ChartMeasureRoleType={})),function(ReferenceLineType){ReferenceLineType.markPoint="markPoint",ReferenceLineType.markLine="markLine"}(ReferenceLineType||(ReferenceLineType={})),function(ReferenceLineValueType){ReferenceLineValueType.fixed="fixed",ReferenceLineValueType.dynamic="dynamic"}(ReferenceLineValueType||(ReferenceLineValueType={})),function(ReferenceLineAggregation){ReferenceLineAggregation.min="min",ReferenceLineAggregation.max="max",ReferenceLineAggregation.average="average",ReferenceLineAggregation.median="median"}(ReferenceLineAggregation||(ReferenceLineAggregation={})),function(ChartPattern){ChartPattern[ChartPattern.a=0]="a",ChartPattern[ChartPattern.b=1]="b",ChartPattern[ChartPattern.c=2]="c",ChartPattern[ChartPattern.d=3]="d",ChartPattern[ChartPattern.e=4]="e",ChartPattern[ChartPattern.f=5]="f",ChartPattern[ChartPattern.g=6]="g",ChartPattern[ChartPattern.h=7]="h"}(ChartPattern||(ChartPattern={})),function(ChartOrient){ChartOrient.horizontal="horizontal",ChartOrient.vertical="vertical"}(ChartOrient||(ChartOrient={})),function(BarVariant){BarVariant.None="none",BarVariant.Polar="polar",BarVariant.Stacked="stacked"}(BarVariant||(BarVariant={})),function(WaterfallVariant){WaterfallVariant.None="none",WaterfallVariant.Polar="polar"}(WaterfallVariant||(WaterfallVariant={})),function(PieVariant){PieVariant.None="none",PieVariant.Doughnut="doughnut",PieVariant.Nightingale="nightingale"}(PieVariant||(PieVariant={})),function(ScatterVariant){ScatterVariant.None="none",ScatterVariant.Polar="polar"}(ScatterVariant||(ScatterVariant={})),function(TreeVariant){TreeVariant.None="none",TreeVariant.Reverse="reverse",TreeVariant.Radial="radial"}(TreeVariant||(TreeVariant={})),function(HeatmapVariant){HeatmapVariant.None="none",HeatmapVariant.Calendar="calendar"}(HeatmapVariant||(HeatmapVariant={}));const isChartMapType=toBe=>"GeoMap"===toBe?.type;function getChartTrellis(chartAnnotation){return chartAnnotation.dimensions.find((item=>item?.role===ChartDimensionRoleType.Trellis))}function getChartCategory(chartAnnotation){return chartAnnotation?.dimensions.find((dimension=>dimension?.role===ChartDimensionRoleType.Category||dimension?.role===ChartDimensionRoleType.Time))||chartAnnotation?.dimensions.find((dimension=>isNil_isNil(dimension?.role)))}function getChartCategory2(chartAnnotation){return chartAnnotation?.dimensions.find((dimension=>dimension?.role===ChartDimensionRoleType.Category2))}function getChartSeries(chartAnnotation){return chartAnnotation.dimensions.find((item=>item?.role===ChartDimensionRoleType.Color||item?.role===ChartDimensionRoleType.Group||item?.role===ChartDimensionRoleType.Stacked||item?.role===ChartDimensionRoleType.Category2))||["color","group","stacked"].includes(chartAnnotation.chartType.variant)&&chartAnnotation.dimensions[1]}var CriticalityType,TrendType,VisualizationType,ImprovementDirectionType,PeriodFunctions,semantics_Semantics,OperationGroupingType,CriticalityRepresentationType;function hierarchize(items,recursiveHierarchy,options){const root=[],results={};if(items?.forEach((item=>{const itemKey=item[recursiveHierarchy.valueProperty]+(options?.compositeKeys?.map((key=>item[key])).join("/")??"");results[itemKey]||(results[itemKey]={children:[]}),assign_assign(results[itemKey],options?.memberCaption?{key:itemKey,[options?.memberCaption??"label"]:item[recursiveHierarchy.labelProperty],caption:item[recursiveHierarchy.labelProperty],raw:item}:{key:itemKey,label:item[recursiveHierarchy.labelProperty],title:item[recursiveHierarchy.labelProperty],name:item[recursiveHierarchy.labelProperty],caption:item[recursiveHierarchy.labelProperty],raw:item}),options?.valueProperty&&(results[itemKey].value=item[options.valueProperty]);const parentKey=item[recursiveHierarchy.parentNodeProperty]+(options?.compositeKeys?.map((key=>item[key])).join("/")??"");parentKey?results[parentKey]?results[parentKey].children.push(results[itemKey]):results[parentKey]={children:[results[itemKey]]}:(results[itemKey].level=0,root.push(results[itemKey]))})),Object.values(results).forEach((node=>{isEmpty_isEmpty(node.children)?(node.isLeaf=!0,node.children=null):node.raw||root.push(...node.children)})),options?.onlyLeaves)return Object.values(results).filter((node=>node.isLeaf));if(root.forEach((item=>setLevel(item,0))),options?.startLevel>0){const items=[];return root.map((item=>{items.push(...getTreeLevel(item,options.startLevel))})),items}return root}function setLevel(item,level){item.level=level,item.children&&item.children.forEach((item=>setLevel(item,level+1)))}function getTreeLevel(item,level){if(item.level===level-1)return item.children??[];const items=[];return item.children?.map((item=>{items.push(...getTreeLevel(item,level))})),items}function filterTreeNodes(array,text,options){text=text?.toLowerCase();const getNodes=(result,object)=>{const contains=object.label?.toLowerCase().includes(text)||options?.considerKey&&`${object.key}`?.toLowerCase().includes(text),children=object.children?.reduce(getNodes,[]);return children?.length?result.push({...object,children}):contains&&result.push(omit(object,"children")),result};return text?array.reduce(getNodes,[]):array}function findTreeNode(array,key){const getNodes=(result,object)=>result||(object?.key===key?object:object.children?.reduce(getNodes,null));return array?.reduce(getNodes,null)}!function(CriticalityType){CriticalityType.VeryNegative="VeryNegative",CriticalityType.Neutral="Neutral",CriticalityType.Negative="Negative",CriticalityType.Critical="Critical",CriticalityType.Positive="Positive",CriticalityType.VeryPositive="VeryPositive"}(CriticalityType||(CriticalityType={})),function(TrendType){TrendType.StrongUp="StrongUp",TrendType.Up="Up",TrendType.Sideways="Sideways",TrendType.Down="Down",TrendType.StrongDown="StrongDown"}(TrendType||(TrendType={})),function(VisualizationType){VisualizationType.Number="Number",VisualizationType.BulletChart="BulletChart",VisualizationType.Progress="Progress",VisualizationType.Rating="Rating",VisualizationType.Donut="Donut",VisualizationType.DeltaBulletChart="DeltaBulletChart"}(VisualizationType||(VisualizationType={})),function(ImprovementDirectionType){ImprovementDirectionType.Minimize="Minimize",ImprovementDirectionType.Target="Target",ImprovementDirectionType.Maximize="Maximize"}(ImprovementDirectionType||(ImprovementDirectionType={})),function(PeriodFunctions){PeriodFunctions.CURRENT="CURRENT",PeriodFunctions.YTD="YTD",PeriodFunctions.QTD="QTD",PeriodFunctions.WTD="WTD",PeriodFunctions.MTD="MTD",PeriodFunctions.PYYTD="PYYTD",PeriodFunctions.YOY="YOY",PeriodFunctions.YOYGAP="YOYGAP",PeriodFunctions.MOM="MOM",PeriodFunctions.MOMGAP="MOMGAP",PeriodFunctions.YTDOM="YTDOM",PeriodFunctions.YTDOY="YTDOY",PeriodFunctions.YTDOYGAP="YTDOYGAP",PeriodFunctions.MPM="MPM",PeriodFunctions.MPMYOY="MPMYOY",PeriodFunctions.PYSM="PYSM",PeriodFunctions.PYSMYOY="PYSMYOY"}(PeriodFunctions||(PeriodFunctions={})),function(Semantics){Semantics.Account="Account",Semantics["Address.Street"]="Address.Street",Semantics["Address.PostBox"]="Address.PostBox",Semantics["Address.ZipCode"]="Address.ZipCode",Semantics["Address.City"]="Address.City",Semantics["Address.Country"]="Address.Country",Semantics["Address.SubRegion"]="Address.SubRegion",Semantics["Address.Region"]="Address.Region",Semantics["Amount.CurrencyCode"]="Amount.CurrencyCode",Semantics["BusinessDate.At"]="BusinessDate.At",Semantics["BusinessDate.From"]="BusinessDate.From",Semantics["BusinessDate.To"]="BusinessDate.To",Semantics.Calendar="Calendar",Semantics["Calendar.Year"]="Calendar.Year",Semantics["Calendar.Quarter"]="Calendar.Quarter",Semantics["Calendar.Month"]="Calendar.Month",Semantics["Calendar.Week"]="Calendar.Week",Semantics["Calendar.Day"]="Calendar.Day",Semantics.CurrencyCode="CurrencyCode",Semantics.Language="Language",Semantics.Geography="Geography",Semantics["GeoLocation.Latitude"]="GeoLocation.Latitude",Semantics["GeoLocation.Longitude"]="GeoLocation.Longitude",Semantics["Quantity.UnitOfMeasure"]="Quantity.UnitOfMeasure",Semantics.Text="Text",Semantics.UnitOfMeasure="UnitOfMeasure"}(semantics_Semantics||(semantics_Semantics={})),function(OperationGroupingType){OperationGroupingType[OperationGroupingType.Isolated=0]="Isolated",OperationGroupingType[OperationGroupingType.ChangeSet=1]="ChangeSet"}(OperationGroupingType||(OperationGroupingType={})),function(CriticalityRepresentationType){CriticalityRepresentationType[CriticalityRepresentationType.WithIcon=0]="WithIcon",CriticalityRepresentationType[CriticalityRepresentationType.WithoutIcon=1]="WithoutIcon",CriticalityRepresentationType[CriticalityRepresentationType.OnlyIcon=2]="OnlyIcon"}(CriticalityRepresentationType||(CriticalityRepresentationType={}));var ValueListParameterType;!function(ValueListParameterType){ValueListParameterType.InOut="InOut",ValueListParameterType.DisplayOnly="DisplayOnly"}(ValueListParameterType||(ValueListParameterType={}));var v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");const types_C_MEASURES="Measures",C_MEASURES_CAPTION=`[${types_C_MEASURES}]_Text`;var Syntax,DisplayBehaviour,AnnotationTerm,Drill,types_FilterOperator,FilteringLogic,AdvancedSlicerOperator;!function(Syntax){Syntax.SQL="SQL",Syntax.JSON="JSON",Syntax.MDX="MDX"}(Syntax||(Syntax={})),function(DisplayBehaviour){DisplayBehaviour.descriptionAndId="descriptionAndId",DisplayBehaviour.descriptionOnly="descriptionOnly",DisplayBehaviour.idAndDescription="idAndDescription",DisplayBehaviour.idOnly="idOnly",DisplayBehaviour.auto=""}(DisplayBehaviour||(DisplayBehaviour={})),function(AnnotationTerm){AnnotationTerm.RelatedRecursiveHierarchy="RelatedRecursiveHierarchy",AnnotationTerm.ValueList="ValueList",AnnotationTerm.SelectionFields="SelectionFields"}(AnnotationTerm||(AnnotationTerm={})),function(Drill){Drill[Drill.Children=0]="Children",Drill[Drill.SelfAndChildren=1]="SelfAndChildren",Drill[Drill.Descendants=2]="Descendants",Drill[Drill.SelfAndDescendants=3]="SelfAndDescendants",Drill[Drill.Siblings=4]="Siblings",Drill[Drill.Leaves=5]="Leaves",Drill[Drill.Ancestor=6]="Ancestor"}(Drill||(Drill={})),function(FilterOperator){FilterOperator.BT="BT",FilterOperator.EQ="EQ",FilterOperator.GE="GE",FilterOperator.GT="GT",FilterOperator.LE="LE",FilterOperator.LT="LT",FilterOperator.NE="NE",FilterOperator.Contains="Contains",FilterOperator.EndsWith="EndsWith",FilterOperator.StartsWith="StartsWith"}(types_FilterOperator||(types_FilterOperator={})),function(FilteringLogic){FilteringLogic[FilteringLogic.And=0]="And",FilteringLogic[FilteringLogic.Or=1]="Or"}(FilteringLogic||(FilteringLogic={})),function(AdvancedSlicerOperator){AdvancedSlicerOperator.Equal="Equal",AdvancedSlicerOperator.NotEqual="NotEqual",AdvancedSlicerOperator.LessThan="LessThan",AdvancedSlicerOperator.GreaterThan="GreaterThan",AdvancedSlicerOperator.LessEqual="LessEqual",AdvancedSlicerOperator.GreaterEqual="GreaterEqual",AdvancedSlicerOperator.Between="Between",AdvancedSlicerOperator.NotBetween="NotBetween",AdvancedSlicerOperator.TopCount="TopCount",AdvancedSlicerOperator.BottomCount="BottomCount",AdvancedSlicerOperator.TopPercent="TopPercent",AdvancedSlicerOperator.BottomPercent="BottomPercent",AdvancedSlicerOperator.TopSum="TopSum",AdvancedSlicerOperator.BottomSum="BottomSum"}(AdvancedSlicerOperator||(AdvancedSlicerOperator={}));const isBaseProperty=toBe=>!isNil_isNil(toBe?.dimension),types_isDimension=toBe=>!isNil_isNil(toBe?.dimension)&&toBe.dimension!==types_C_MEASURES,isMeasure=toBe=>toBe?.dimension===types_C_MEASURES,isSlicer=toBe=>!isNil_isNil(toBe?.dimension)&&!isNil_isNil(toBe?.members),isFilter=toBe=>!(isNil_isNil(toBe?.dimension)&&isNil_isNil(toBe?.dimension)||isNil_isNil(toBe?.operator)),isAdvancedFilter=toBe=>!isNil_isNil(toBe?.filteringLogic),isAdvancedSlicer=toBe=>!isNil_isNil(AdvancedSlicerOperator[toBe?.operator]);function getPropertyName(path){return isString_isString(path)?path:types_isDimension(path)?path?.dimension:path?.measure}function getPropertyHierarchy(path){return isString_isString(path)?path:types_isDimension(path)?path?.hierarchy||path?.dimension:null}function getPropertyMeasure(path){return isString_isString(path)?path:path?.measure}function uuid(){return(0,v4.Z)()}function displayByBehaviour(option,behaviour){switch(behaviour){case DisplayBehaviour.descriptionAndId:return`${option.caption||option.label||""} (#${option.key||option.value})`;case DisplayBehaviour.descriptionOnly:return`${option.caption||option.label||""}`;case DisplayBehaviour.idAndDescription:return`#${option.key||option.value} (${option.caption||option.label||""})`;case DisplayBehaviour.idOnly:return`${option.key||option.value}`;default:return`${option.caption||option.label||option.key||option.value}`}}function formatting(value,formatting,locale){let num="";try{value=strToNumber(value)}catch(err){return"NaN"}if("%"===formatting?.unit&&(value*=100),formatting?.shortNumber){const[n,unit]=function formatShortNumber(value,locale="en",factor,shortUnits){try{const num=strToNumber(value),localeData=FORMAT_LOCALE_DATA[locale];factor=factor||localeData?.shortNumberFactor;let resultValue=num,resultName="";const units=(shortUnits=shortUnits||localeData?.shortNumberUnits).split(",").reverse();return units.every(((unitName,i)=>{const rounder=Math.pow(10,(units.length-i)*factor);return!(Math.abs(num)>=rounder&&(resultValue=num/rounder,resultName=unitName,1))})),[Number(resultValue),resultName]}catch(error){throw new Error("Invalid Short Number Argument")}}(value,locale,formatting?.decimal);num=formatNumber(n,locale,formatting?.digitsInfo)+unit}else num=formatNumber(value,locale,formatting?.digitsInfo);return"%"===formatting?.unit&&(num+="%"),num}var calculated_CalculationType,AggregationOperation,CompareToEnum,ParameterControlEnum;!function(CalculationType){CalculationType.Restricted="Restricted",CalculationType.Calculated="Calculated",CalculationType.Aggregation="Aggregation",CalculationType.Variance="Variance",CalculationType.D2Measure="D2Measure",CalculationType.MeasureControl="MeasureControl",CalculationType.Parameter="Parameter",CalculationType.Indicator="Indicator"}(calculated_CalculationType||(calculated_CalculationType={})),function(AggregationOperation){AggregationOperation.SUM="SUM",AggregationOperation.COUNT="COUNT",AggregationOperation.MIN="MIN",AggregationOperation.MAX="MAX",AggregationOperation.AVERAGE="AVERAGE",AggregationOperation.STDEV="STDEV",AggregationOperation.STDEVP="STDEVP",AggregationOperation.MEDIAN="MEDIAN",AggregationOperation.TOP_PERCENT="TOP_PERCENT",AggregationOperation.TOP_COUNT="TOP_COUNT"}(AggregationOperation||(AggregationOperation={})),function(CompareToEnum){CompareToEnum.CurrentMember="CurrentMember",CompareToEnum.SelectedMember="SelectedMember",CompareToEnum.Lag="Lag",CompareToEnum.Lead="Lead",CompareToEnum.Parallel="Parallel",CompareToEnum.Ancestor="Ancestor"}(CompareToEnum||(CompareToEnum={})),function(ParameterControlEnum){ParameterControlEnum[ParameterControlEnum.Input=0]="Input",ParameterControlEnum[ParameterControlEnum.Select=1]="Select",ParameterControlEnum[ParameterControlEnum.Dimensions=2]="Dimensions"}(ParameterControlEnum||(ParameterControlEnum={}));const isCalculationProperty=toBe=>!isNil_isNil(toBe?.calculationType),isCalculatedProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Calculated,isAggregationProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Aggregation,isRestrictedMeasureProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Restricted,isVarianceMeasureProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Variance,isMeasureControlProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.MeasureControl,calculated_isIndicatorMeasureProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Indicator,isParameterProperty=toBe=>!isNil_isNil(toBe?.paramType);function getMeasurePropertyUnit(property){return isVarianceMeasureProperty(property)&&property.asPercentage?"%":property?.formatting?.unit}function parameterFormatter(name){return`[@${name}]`}var MemberType;!function(MemberType){MemberType[MemberType.MDMEMBER_TYPE_REGULAR=1]="MDMEMBER_TYPE_REGULAR",MemberType[MemberType.MDMEMBER_TYPE_ALL=2]="MDMEMBER_TYPE_ALL",MemberType[MemberType.MDMEMBER_TYPE_FORMULA=3]="MDMEMBER_TYPE_FORMULA",MemberType[MemberType.MDMEMBER_TYPE_MEASURE=4]="MDMEMBER_TYPE_MEASURE",MemberType[MemberType.MDMEMBER_TYPE_UNKNOWN=5]="MDMEMBER_TYPE_UNKNOWN"}(MemberType||(MemberType={}));const DimensionMemberRecursiveHierarchy={parentNodeProperty:"parentKey",externalKeyProperty:"memberUniqueName",valueProperty:"memberKey",labelProperty:"memberCaption",levelProperty:"levelNumber",descendantCountProperty:"childrenCardinality",memberTypeProperty:"memberType"};var IntrinsicMemberProperties,property_AggregationRole,DataType;function serializeUniqueName(dimension,hierarchy,level,intrinsic){const name=hierarchy&&dimension!==hierarchy?`[${dimension}.${hierarchy}]`:`[${dimension}]`;return intrinsic?`${name}.[${level}].[${intrinsic}]`:level?`${name}.[${level}]`:name}function helper_getEntityProperty(entityType,path){return entityType?.properties[getPropertyName(path)]??entityType?.parameters?.[getPropertyName(path)]}function getEntityProperty2(entityType,path){return isString_isString(path)?Object.values(entityType?.properties??{}).reduce(((prev,dimension)=>prev??(dimension.name===path?dimension:dimension.hierarchies?.reduce(((prev,hierarchy)=>prev??(hierarchy.name===path?hierarchy:hierarchy.levels?.reduce(((prev,level)=>prev??(level.name===path?level:null)),null))),null))),null)??entityType?.parameters?.[path]:isMeasure(path)?entityType?.properties[path.measure]:Object.values(entityType?.properties??{}).reduce(((prev,dimension)=>prev??(dimension.name===path.dimension?path.hierarchy?dimension.hierarchies?.reduce(((prev,hierarchy)=>prev??(hierarchy.name===path.hierarchy?path.level?hierarchy.levels?.reduce(((prev,level)=>prev??(level.name===path.level?level:null)),null):hierarchy:null)),null):dimension:null)),null)??entityType?.parameters?.[path.dimension]}function helper_getEntityDimensions(entityType){return isNil_isNil(entityType?.properties)?[]:Object.values(entityType?.properties).filter((item=>item.role===property_AggregationRole.dimension&&isVisible(item)))}function getEntityDimensionAndHierarchies(entityType){const results=[];return isNil_isNil(entityType?.properties)?[]:(Object.values(entityType.properties).forEach((property=>{property.role===property_AggregationRole.dimension&&(results.push(property),property.hierarchies?.forEach((hierarchy=>{results.push(hierarchy)})))})),results)}function getEntityMeasures(entityType){return isNil_isNil(entityType?.properties)?[]:Object.values(entityType.properties).filter((property=>property.role===property_AggregationRole.measure&&(isNil_isNil(property.visible)||property.visible)))}function getEntityDefaultMeasure(entityType){return entityType.defaultMeasure?entityType.properties[entityType.defaultMeasure]:getEntityMeasures(entityType)[0]}function helper_getEntityHierarchy(entityType,params){if(isNil_isNil(entityType?.properties)||isNil_isNil(params))return null;const{dimension,hierarchy}=isString_isString(params)?{dimension:null,hierarchy:params}:params;return Object.values(entityType.properties).reduce(((prev,item)=>prev??(dimension&&item.name!==dimension?null:item.hierarchies?.find((hier=>hier.name===(hierarchy||dimension))))),null)}function getEntityLevel(entityType,dimension){return entityType?.properties&&dimension&&Object.values(entityType.properties).find((item=>item.name===dimension.dimension))?.hierarchies?.find((item=>item.name===(dimension.hierarchy||dimension.dimension)))?.levels?.find((item=>item.name===dimension.level))}function getEntityCalculations(entityType){return isNil_isNil(entityType?.properties)?[]:Object.values(entityType.properties).filter((property=>isCalculationProperty(property)))}function getEntityParameters(entityType){return isNil_isNil(entityType?.parameters)?[]:Object.values(entityType.parameters)}function _getPropertyCaption(property){return property?.caption}function getDimensionMemberCaption(dimension,entityType){if(isNil_isNil(dimension))return null;if(dimension.memberCaption)return IntrinsicMemberProperties[dimension.memberCaption]?`${getPropertyHierarchy(dimension)}.[${dimension.memberCaption}]`:dimension.memberCaption;if(entityType){const property=helper_getEntityProperty(entityType,dimension);return property?.memberCaption}return null}function getDimensionDisplayBehaviour(dimension){return types_isDimension(dimension)?dimension.displayBehaviour:null}function getPropertyUnitName(property){return isString_isString(property?.unit)?property.unit:property?.unit?.name}!function(IntrinsicMemberProperties){IntrinsicMemberProperties.Unkown="Unkown",IntrinsicMemberProperties.CATALOG_NAME="CATALOG_NAME",IntrinsicMemberProperties.DESCRIPTION="DESCRIPTION",IntrinsicMemberProperties.PARENT_UNIQUE_NAME="PARENT_UNIQUE_NAME",IntrinsicMemberProperties.MEMBER_UNIQUE_NAME="MEMBER_UNIQUE_NAME",IntrinsicMemberProperties.MEMBER_CAPTION="MEMBER_CAPTION",IntrinsicMemberProperties.MEMBER_TYPE="MEMBER_TYPE",IntrinsicMemberProperties.LEVEL_NUMBER="LEVEL_NUMBER",IntrinsicMemberProperties.CHILDREN_CARDINALITY="CHILDREN_CARDINALITY"}(IntrinsicMemberProperties||(IntrinsicMemberProperties={})),function(AggregationRole){AggregationRole.dimension="dimension",AggregationRole.hierarchy="hierarchy",AggregationRole.level="level",AggregationRole.measure="measure",AggregationRole.text="text"}(property_AggregationRole||(property_AggregationRole={})),function(DataType){DataType.Unknown="Unknown",DataType.Numeric="Numeric",DataType.Integer="Integer",DataType.String="String",DataType.Boolean="Boolean",DataType.Date="Date",DataType.Datetime="Datetime",DataType.Time="Time",DataType.Timestamp="Timestamp"}(DataType||(DataType={}));function isSemanticCalendar(property){return property?.semantics?.semantic&&semantics_Semantics[property.semantics.semantic]?.startsWith("Calendar")}function stringifyProperty(path){return isString_isString(path)?path:types_isDimension(path)?`${path.level||path.hierarchy||path.dimension}`:path.measure}function parseDimension(name,entityType){const d={};return isNil_isNil(entityType?.properties)?null:(Object.values(entityType.properties).find((dimension=>dimension.name===name?(d.dimension=name,!0):dimension.hierarchies?.find((hierarchy=>hierarchy.name===name?(d.dimension=dimension.name,d.hierarchy=name,!0):hierarchy.levels?.find((level=>level.name===name&&(d.dimension=dimension.name,d.hierarchy=hierarchy.name,d.level=name,!0))))))),d)}function isVisible(property){return property.visible||isNil_isNil(property.visible)}function getEntityCalendarHierarchy(entityType,{dimension,hierarchy}){const dProperty=helper_getEntityProperty(entityType,dimension);if(hierarchy)return dProperty.hierarchies?.find((item=>item.name===hierarchy));const defaultHierarchy=dProperty.hierarchies?.find((item=>item.name===dProperty.defaultHierarchy));return defaultHierarchy??dProperty.hierarchies?.[0]}function mergeEntityType(a,b){return assignDeepOmitBlank(a,b,5)}function convertSlicerToDimension(slicer){return slicer?.dimension?{...slicer.dimension,members:slicer.members,exclude:slicer.exclude}:null}function convertDimensionToSlicer(dimension){return{dimension:omit(dimension,"members","exclude"),members:dimension.members,exclude:dimension.exclude}}function getMemberFromRow(row,dimension,entityType){const caption=getDimensionMemberCaption(dimension,entityType);return{key:row[dimension.hierarchy||dimension.dimension],value:row[dimension.hierarchy||dimension.dimension],label:caption?row[caption]:null,caption:caption?row[caption]:null}}function helper_getDefaultHierarchy(property){return property?.hierarchies?.find((hierarchy=>hierarchy.name===property.defaultHierarchy))||property?.hierarchies?.[0]}function isWrapBrackets(name){return name?.match(/\[.*\]/g)}function wrapBrackets(name){return name&&!isWrapBrackets(name)?`[${name}]`:name}function unwrapBrackets(name){const m=name?.match(/\[(.*)\]/);return m?m[1]:name}function wrapHierarchyValue(hierarchy,value){return value.startsWith(hierarchy)?value:`${hierarchy}.${wrapBrackets(value)}`}const isPropertyDimension=toBe=>toBe?.role===property_AggregationRole.dimension,isPropertyMeasure=toBe=>toBe?.role===property_AggregationRole.measure,isEntityType=toBe=>!(toBe instanceof Error||isNil_isNil(toBe?.name)),isEntitySet=toBe=>!(toBe instanceof Error||isNil_isNil(toBe?.name));var EntitySemantics,DimensionType,IndicatorType,FilterSelectionType,TreeSelectionMode,PresentationEnum;!function(EntitySemantics){EntitySemantics.aggregate="aggregate",EntitySemantics.parameters="parameters",EntitySemantics.table="table",EntitySemantics.view="view"}(EntitySemantics||(EntitySemantics={})),function(DimensionType){DimensionType.StandardDimension="StandardDimension",DimensionType.TimeDimension="TimeDimension",DimensionType.MeasuresDimension="MeasuresDimension"}(DimensionType||(DimensionType={})),function(IndicatorType){IndicatorType.BASIC="BASIC",IndicatorType.DERIVE="DERIVE"}(IndicatorType||(IndicatorType={})),function(FilterSelectionType){FilterSelectionType.Multiple="Multiple",FilterSelectionType.Single="Single",FilterSelectionType.SingleInterval="SingleInterval",FilterSelectionType.SingleRange="SingleRange"}(FilterSelectionType||(FilterSelectionType={})),function(TreeSelectionMode){TreeSelectionMode.Individual="Individual",TreeSelectionMode.SelfDescendants="SelfDescendants",TreeSelectionMode.DescendantsOnly="DescendantsOnly",TreeSelectionMode.SelfChildren="SelfChildren",TreeSelectionMode.ChildrenOnly="ChildrenOnly"}(TreeSelectionMode||(TreeSelectionMode={})),function(PresentationEnum){PresentationEnum[PresentationEnum.Flat=0]="Flat",PresentationEnum[PresentationEnum.Hierarchy=1]="Hierarchy"}(PresentationEnum||(PresentationEnum={}));var TimeGranularity,time_TimeRangeType,OffSetDirection,format=__webpack_require__("./node_modules/date-fns/format.mjs"),subYears=__webpack_require__("./node_modules/date-fns/subYears.mjs"),addYears=__webpack_require__("./node_modules/date-fns/addYears.mjs"),subQuarters=__webpack_require__("./node_modules/date-fns/subQuarters.mjs"),addQuarters=__webpack_require__("./node_modules/date-fns/addQuarters.mjs"),subMonths=__webpack_require__("./node_modules/date-fns/subMonths.mjs"),addMonths=__webpack_require__("./node_modules/date-fns/addMonths.mjs"),subWeeks=__webpack_require__("./node_modules/date-fns/subWeeks.mjs"),addWeeks=__webpack_require__("./node_modules/date-fns/addWeeks.mjs"),subDays=__webpack_require__("./node_modules/date-fns/subDays.mjs"),addDays=__webpack_require__("./node_modules/date-fns/addDays.mjs");!function(TimeGranularity){TimeGranularity.Year="Year",TimeGranularity.Quarter="Quarter",TimeGranularity.Month="Month",TimeGranularity.Week="Week",TimeGranularity.Day="Day"}(TimeGranularity||(TimeGranularity={})),function(TimeRangeType){TimeRangeType.Standard="Standard",TimeRangeType.Offset="Offset"}(time_TimeRangeType||(time_TimeRangeType={})),function(OffSetDirection){OffSetDirection.LookBack="LookBack",OffSetDirection.LookAhead="LookAhead"}(OffSetDirection||(OffSetDirection={}));const isTimeRangesSlicer=toBe=>!isNil_isNil(toBe?.ranges)&&!isNil_isNil(toBe?.currentDate);function mapTimeGranularitySemantic(granularity){switch(granularity){case TimeGranularity.Year:return semantics_Semantics["Calendar.Year"];case TimeGranularity.Quarter:return semantics_Semantics["Calendar.Quarter"];case TimeGranularity.Month:return semantics_Semantics["Calendar.Month"];case TimeGranularity.Day:return semantics_Semantics["Calendar.Day"];default:throw new Error(`Can't found semantics for granularity ${granularity}`)}}function formatCurrentPeriod(current,granularity,formatter){if(null===granularity||null===current)return null;let _format="yyyMMdd";switch(granularity){case TimeGranularity.Year:_format="yyyy";break;case TimeGranularity.Quarter:_format="yyyy'Q'Q";break;case TimeGranularity.Month:_format="yyyyMM";break;case TimeGranularity.Day:_format="yyyyMMdd"}return(0,format.WU)(current,formatter||_format)}function calcOffset(currentDate,{direction,granularity,amount}){switch(amount=amount||0,granularity){case TimeGranularity.Year:return direction===OffSetDirection.LookBack?(0,subYears.e)(currentDate,amount):(0,addYears.B)(currentDate,amount);case TimeGranularity.Quarter:return direction===OffSetDirection.LookBack?(0,subQuarters.Y)(currentDate,amount):(0,addQuarters.P)(currentDate,amount);case TimeGranularity.Month:return direction===OffSetDirection.LookBack?(0,subMonths.W)(currentDate,amount):(0,addMonths.z)(currentDate,amount);case TimeGranularity.Week:return direction===OffSetDirection.LookBack?(0,subWeeks.t)(currentDate,amount):(0,addWeeks.j)(currentDate,amount);case TimeGranularity.Day:return direction===OffSetDirection.LookBack?(0,subDays.k)(currentDate,amount):(0,addDays.E)(currentDate,amount);default:return currentDate}}function formatRangeCurrentPeriod(current,range){return range.type===time_TimeRangeType.Offset&&(current=calcOffset(current,{...range.current,granularity:range.granularity})),formatCurrentPeriod(current,range.granularity,range.formatter)}function time_calcRange(current,range){return range.type===time_TimeRangeType.Offset&&(current=calcOffset(current,{...range.current,granularity:range.granularity})),[formatCurrentPeriod(calcOffset(current,{direction:OffSetDirection.LookBack,granularity:range.granularity,amount:range.lookBack||0}),range.granularity,range.formatter),formatCurrentPeriod(calcOffset(current,{direction:OffSetDirection.LookAhead,granularity:range.granularity,amount:range.lookAhead||0}),range.granularity,range.formatter)]}function timeRangesSlicerAsString(slicer,i18nTimeRanges){return`${i18nTimeRanges??"Time Ranges"}: ${slicer.ranges.map((range=>`${range.type}|${range.granularity}${range.type===time_TimeRangeType.Offset?`(${range.current.direction}:${range.current.amount})`:""}:[${range.lookBack??0}, ${range.lookAhead??0}]`)).join(" & ")}`}class AbstractEntityService{get entityType(){return this._entityType$.value}constructor(dataSource,entitySet){this.dataSource=dataSource,this.entitySet=entitySet,this.destroySubject$=new Subject.x,this.destroy$=this.destroySubject$.asObservable(),this.registerMeasures$=new internal_BehaviorSubject.X({}),this._entityType$=new internal_BehaviorSubject.X(null),this.entityType$=this._entityType$.pipe((0,operators_filter.h)((entityType=>!!entityType))),this.__id__=uuid(),(0,observable_combineLatest.a)([this.dataSource.selectEntityType(this.entitySet),this.registerMeasures$]).pipe((0,operators_map.U)((([entityType,registerMeasures])=>isEntityType(entityType)?{...entityType,properties:{...entityType.properties,...registerMeasures}}:(console.error(entityType),entityType))),(0,operators_filter.h)(isEntityType),(0,takeUntil.R)(this.destroy$)).subscribe((entityType=>{this._entityType$.next(entityType)}))}getMembers(property){return this.dataSource.getMembers(this.entitySet,property)}selectMembers(property){return this.dataSource.selectMembers(this.entitySet,property)}selectEntityType(){return this.entityType$}getAnnotation(term,qualifier){return(0,observable_of.of)(null)}getIndicator(id){return this.dataSource.getIndicator(id,this.entitySet)}registerMeasure(name,property){const registerMeasures=this.registerMeasures$.value;this.registerMeasures$.next({...registerMeasures,[name]:property})}onDestroy(){this.destroySubject$.next(),this.destroySubject$.complete()}}var types_AgentType,types_AgentStatusEnum;!function(AgentType){AgentType.Local="local",AgentType.Browser="browser",AgentType.Server="server",AgentType.Wasm="wasm"}(types_AgentType||(types_AgentType={})),function(AgentStatusEnum){AgentStatusEnum.Initializing="Initializing",AgentStatusEnum.OFFLINE="offline",AgentStatusEnum.ONLINE="online",AgentStatusEnum.LOADING="loading",AgentStatusEnum.ERROR="error"}(types_AgentStatusEnum||(types_AgentStatusEnum={}));var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),dist=(__webpack_require__("./node_modules/money-clip/dist/money-clip.m.js"),__webpack_require__("./node_modules/idb-keyval/dist/index.js"));const CACHE_OPTIONS={level:3};class DSCacheService{clearAllCache(){(0,dist.ZH)()}changeCacheLevel(level){CACHE_OPTIONS.level=level}getCacheLevel(){return CACHE_OPTIONS.level}keys(customStore){return(0,asyncToGenerator.Z)((function*(){return(0,dist.XP)(customStore)}))()}clear(key,customStore){return(0,asyncToGenerator.Z)((function*(){return(0,dist.IV)(key,customStore)}))()}}var AuthenticationMethod,ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),shareReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js"),empty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/empty.js");!function(AuthenticationMethod){AuthenticationMethod.none="none",AuthenticationMethod.basic="basic",AuthenticationMethod.saml="saml",AuthenticationMethod.independent="independent"}(AuthenticationMethod||(AuthenticationMethod={}));class AbstractDataSource{get options(){return this.options$.value}constructor(options,agent,cacheService){this.agent=agent,this.cacheService=cacheService,this.destroySubject$=new ReplaySubject.t(1),this.destroy$=this.destroySubject$.asObservable(),this.options$=new internal_BehaviorSubject.X(null),this._entitySets={},this.options$.next(options)}setSchema(schema){this.options$.next({...this.options$.value,schema})}updateCube(cube){const schema=this.options.schema??{},cubes=schema.cubes?[...schema.cubes]:[],index=cubes.findIndex((item=>item.__id__===cube.__id__));index>-1?cubes.splice(index,1,cube):cubes.push(cube),this.options$.next({...this.options$.value,schema:{...schema,cubes}})}selectSchema(){return this.options$.pipe((0,distinctUntilChanged.x)(),(0,operators_map.U)((options=>options?.schema)),(0,distinctUntilChanged.x)(isEqual))}setEntityType(entityType){const schema=this.options.schema??{},entitySets=schema.entitySets??{};entitySets[entityType.name]=entitySets[entityType.name]??{name:entityType.name},entitySets[entityType.name].entityType=entityType,this.options$.next({...this.options,schema:{...schema,entitySets}})}selectEntitySet(entity){return this._entitySets[entity]||(this._entitySets[entity]=this.getEntityType(entity).pipe((0,switchMap.w)((rtEntityType=>isEntityType(rtEntityType)?this.selectSchema().pipe((0,distinctUntilChanged.x)(),(0,operators_map.U)((schema=>{const indicators=schema?.indicators?.filter((indicator=>indicator.entity===entity));indicators?.forEach((indicator=>{mapIndicatorToMeasures(indicator).forEach((measure=>{rtEntityType.properties[measure.name]={...measure,role:property_AggregationRole.measure}}))}));const customEntityType=schema?.entitySets?.[entity]?.entityType;let entityType=rtEntityType;return isNil_isNil(customEntityType)||(entityType=mergeEntityType(assign_assign({},rtEntityType),customEntityType)),entityType&&(entityType.dialect=this.options.dialect,entityType.syntax=this.options.syntax),{name:entityType.name,caption:entityType.caption,entityType,indicators}}))):(0,observable_of.of)(rtEntityType))),(0,takeUntil.R)(this.destroy$),(0,shareReplay.d)(1))),this._entitySets[entity]}selectEntityType(entity){return entity?this.selectEntitySet(entity).pipe((0,operators_map.U)((entitySet=>isEntitySet(entitySet)?entitySet.entityType:entitySet))):empty.E}selectIndicators(entity){return this.selectEntitySet(entity).pipe((0,operators_filter.h)(isEntitySet),(0,operators_map.U)((entitySet=>entitySet.indicators)),(0,distinctUntilChanged.x)())}getIndicator(id,entity){return this.options.schema?.indicators?.find((indicator=>(indicator.id===id||indicator.code===id)&&indicator.entity===entity))}clearCache(key=""){var _this=this;return(0,asyncToGenerator.Z)((function*(){return yield _this.cacheService.clear(key)}))()}onDestroy(){this.destroySubject$.next(),this.destroySubject$.complete()}}function mapIndicatorToMeasures(indicator){const measures=[],name=indicator.code||indicator.name,measureName=function indicator_getIndicatorMeasureName(indicator){const name=indicator.code||indicator.name;return indicator.formula?name+"_formula":indicator.measure}(indicator);return indicator.formula&&measures.push({name:measureName,caption:indicator.name,dataType:"number",role:property_AggregationRole.measure,calculationType:calculated_CalculationType.Calculated,formula:indicator.formula,aggregator:indicator.aggregator,hidden:!0,visible:!1}),measures.push({name,caption:indicator.name,dataType:"number",role:property_AggregationRole.measure,calculationType:calculated_CalculationType.Indicator,measure:measureName,dimensions:indicator.filters?.map(convertSlicerToDimension),slicers:indicator.filters,enableConstantSelection:!0,formatting:{unit:indicator.unit},aggregator:indicator.aggregator,visible:indicator.visible}),measures}var src=__webpack_require__("./packages/store/src/index.ts");class DSCoreService extends src.m1{constructor(agents,dataSources,factories,cacheService){super({dataSources}),this.agents=agents,this.factories=factories,this.cacheService=cacheService,this.timeGranularity$=this.select((state=>state.timeGranularity)),this.currentTime$=(0,observable_combineLatest.a)([this.select((state=>state.today)),this.timeGranularity$]).pipe((0,operators_map.U)((([today,timeGranularity])=>({today,timeGranularity})))),this._dataSources=new Map,this.registerModel=this.updater(((state,model)=>{model.useLocalAgent&&(model.agentType=model.agentType??types_AgentType.Local),state.dataSources=state.dataSources??[];const index=state.dataSources.findIndex((item=>item.name===model.name));index>-1?state.dataSources.splice(index,1,model):state.dataSources.push(model)}))}getDataSource(name){var _this=this;return this._dataSources.get(name)||this._dataSources.set(name,this.select((state=>state.dataSources?.find((item=>item.key===name||item.name===name)))).pipe((0,operators_filter.h)((value=>!!value)),(0,switchMap.w)(function(){var _ref=(0,asyncToGenerator.Z)((function*(options){const provider=_this.factories.find((({type})=>type===options?.type));if(!provider)throw new Error(`Can't found provider for dataSource type: '${options.type}'`);const agent=_this.agents.find((item=>item.type===options.agentType));if(!agent)throw new Error(`Can't found Agent for type '${options.agentType}'`);return new(yield provider.factory())(options,agent,_this.cacheService)}));return function(_x){return _ref.apply(this,arguments)}}()),(0,shareReplay.d)(1))),this._dataSources.get(name)}getEntityService(dataSource,entitySet){return this.getDataSource(dataSource).pipe((0,operators_map.U)((dataSource=>dataSource.createEntityService(entitySet))))}getEntitySet(dataSource,entity){return this.selectEntitySet(dataSource,entity)}selectEntitySet(dataSource,entity){return this.getDataSource(dataSource).pipe((0,switchMap.w)((dataSource=>dataSource.selectEntitySet(entity).pipe((0,operators_filter.h)(isEntitySet)))))}setTimeGranularity(timeGranularity){this.patchState({timeGranularity})}setToday(today){this.patchState({today})}getToday(){return this.get((state=>({today:state.today,timeGranularity:state.timeGranularity})))}}var isDate=__webpack_require__("./node_modules/date-fns/isDate.mjs");const HTML5_FMT_DATE="yyyy-MM-dd";var FilterMergeMode;function putFilter(filters,value,mode){if(isArray_isArray(value))return value.forEach((item=>{filters=putFilter(filters,item,mode)})),filters;let existed=!1;const ftrs=(filters||[]).map((item=>existed?item:item.dimension&&getPropertyHierarchy(item.dimension)===getPropertyHierarchy(value.dimension)?(existed=!0,item.dimension.name===value.dimension.name?value:mode===FilterMergeMode.ignore?item:(FilterMergeMode.merge,value)):isAdvancedSlicer(value)&&isAdvancedSlicer(item)?(existed=!0,value):item));return existed||ftrs.push(value),ftrs}function slicerAsString(slicer){if(isAdvancedFilter(slicer))return`[${slicer.children.map((item=>slicerAsString(item))).join(slicer.filteringLogic===FilteringLogic.And?" & ":", ")}]`;if(isFilter(slicer)){const value=getValueString(slicer.members[0]?.value);switch(slicer.operator){case types_FilterOperator.BT:return`${slicer.members[0]?.value}...${slicer.members[1]?.value}`;case types_FilterOperator.EQ:return slicer.members.map((member=>`${member.caption||member.label||getValueString(member.value)}`)).join(", ");case types_FilterOperator.NE:return`≠${value}`;case types_FilterOperator.LT:return`<${value}`;case types_FilterOperator.LE:return`≤${value}`;case types_FilterOperator.GT:return`>${value}`;case types_FilterOperator.GE:return`≥${value}`;case types_FilterOperator.Contains:return`*${value}*`;case types_FilterOperator.EndsWith:return`*${value}`;case types_FilterOperator.StartsWith:return`${value}*`;default:return""}}return slicer.members?.map((member=>`${member.caption||member.label||getValueString(member.value)}`)).join(", ")}function getValueString(value){return(0,isDate.J)(value)?(0,format.WU)(value,HTML5_FMT_DATE):isString_isString(value)?value?value.startsWith("datetime")?value:`'${value}'`:"":`${value}`}!function(FilterMergeMode){FilterMergeMode[FilterMergeMode.ignore=0]="ignore",FilterMergeMode[FilterMergeMode.replace=1]="replace",FilterMergeMode[FilterMergeMode.merge=2]="merge"}(FilterMergeMode||(FilterMergeMode={}));const FILTER_OPERATOR_DESC={All:"空",BT:"介于",EQ:"等于",GE:"大于等于",GT:"大于",LE:"小于等于",LT:"小于",NE:"不等于",Contains:"包含",StartsWith:"开始于",EndsWith:"结束于"};function advancedSlicerAsString(slicer,i18nOnContext){return`${slicer.operator}(${isArray_isArray(slicer.value)?compact(slicer.value):slicer.value},${slicer.measure}) ${i18nOnContext??"on context"}:(${slicer.context.map((({dimension})=>dimension))})`}var OrderDirection;!function(OrderDirection){OrderDirection.ASC="ASC",OrderDirection.DESC="DESC"}(OrderDirection||(OrderDirection={}));var catchError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),tap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js"),delayWhen=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/delayWhen.js"),debounce=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounce.js"),interval=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/interval.js"),firstValueFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");class EntityBusinessService extends src.m1{get dataSettings(){return this.get((state=>state.dataSettings))}set dataSettings(value){const state=omitBy_omitBy({dataSettings:value,selectionVariant:value.selectionVariant,presentationVariant:value.presentationVariant},isNil_isNil);this.patchState(state)}get selectionVariant(){return this.get((state=>state.selectionVariant))}set selectionVariant(value){this.patchState({selectionVariant:value})}get presentationVariant(){return this.get((state=>state.presentationVariant))}set presentationVariant(value){this.patchState({presentationVariant:value})}get slicers(){return this.selectionVariant?.selectOptions}set slicers(value){this.selectionVariant={...this.selectionVariant??{},selectOptions:value}}get entityService(){return this.entityService$.value}constructor(dsCoreService){var _this;super({}),_this=this,this.dsCoreService=dsCoreService,this.dataSettings$=this.select((state=>state.dataSettings)),this._dataSource$=this.dataSettings$.pipe((0,operators_map.U)((dataSettings=>dataSettings?.dataSource)),(0,distinctUntilChanged.x)()),this.entitySet$=this.dataSettings$.pipe((0,operators_map.U)((dataSettings=>dataSettings?.entitySet)),(0,distinctUntilChanged.x)()),this.presentationVariant$=this.select((state=>state.presentationVariant)),this._initialise$=new internal_BehaviorSubject.X(null),this.initialise$=this._initialise$.asObservable().pipe((0,operators_filter.h)((initialised=>initialised))),this.loading$=new internal_BehaviorSubject.X(null),this.result$=new internal_BehaviorSubject.X(null),this.dataSource$=this._dataSource$.pipe((0,operators_filter.h)(Boolean),(0,switchMap.w)((name=>this.dsCoreService.getDataSource(name))),(0,tap.b)((dataSource=>{this.patchState({dataSourceOptions:dataSource.options})})),(0,shareReplay.d)(1)),this.entityService$=new internal_BehaviorSubject.X(null),this.internalError$=new ReplaySubject.t,this.refresh$=new ReplaySubject.t,this.__id__=uuid(),this.refresh$.pipe((0,delayWhen.j)((()=>this.initialise$)),(0,debounce.D)((()=>(0,interval.F)(100))),(0,tap.b)((()=>this.loading$.next(!0))),(0,switchMap.w)((force=>{try{return this.selectQuery({force}).pipe((0,tap.b)((result=>{result.error&&this.internalError$.next(result.error)})),(0,catchError.K)((err=>(console.error(err),this.internalError$.next(err.message),(0,observable_of.of)({error:err.message})))))}catch(err){return console.error(err),this.internalError$.next(err.message),(0,observable_of.of)({error:err.message})}})),(0,tap.b)((()=>{this.loading$.next(!1)})),(0,takeUntil.R)(this.destroySubject$)).subscribe(this.result$),this.entitySet$.pipe((0,operators_filter.h)((entity=>!!entity)),(0,switchMap.w)((entity=>this.dataSource$.pipe((0,operators_filter.h)((value=>!!value)),(0,operators_map.U)((dataSource=>dataSource.createEntityService(entity)))))),(0,takeUntil.R)(this.destroySubject$)).subscribe(function(){var _ref=(0,asyncToGenerator.Z)((function*(entityService){_this.entityService?.onDestroy(),_this.entityService$.next(entityService),_this._initialise$.next(!1);try{_this.entityType=yield(0,firstValueFrom.z)(entityService.selectEntityType()),_this._initialise$.next(!0)}catch(err){_this._initialise$.next(!1)}}));return function(_x){return _ref.apply(this,arguments)}}())}getEntityType(){var _this2=this;return(0,asyncToGenerator.Z)((function*(){return yield(0,firstValueFrom.z)(_this2.selectEntityType())}))()}getProperty(name){var _this3=this;return(0,asyncToGenerator.Z)((function*(){return helper_getEntityProperty(yield _this3.getEntityType(),name)}))()}selectEntityType(){return this.entityService$.pipe((0,operators_filter.h)((value=>!!value)),(0,switchMap.w)((entityService=>entityService.selectEntityType())))}query(options){return this.selectQuery(options)}selectQuery(options){if(!this.entityService)throw new Error("Should provide attribute 'dataSettings' to create entity service");options=options??{};const presentationVariant=this.presentationVariant;return presentationVariant?.requestAtLeast&&(options.selects=options.selects||[],options.selects.push(...presentationVariant.requestAtLeast)),presentationVariant?.sortOrder&&(options.orderbys=options.orderbys||[],options.orderbys.push(...presentationVariant.sortOrder.filter(nonNullable))),isNil_isNil(presentationVariant?.maxItems)||(options.paging=options.paging||{},options.paging.top=presentationVariant.maxItems),isNil_isNil(presentationVariant?.skip)||(options.paging=options.paging||{},options.paging.skip=presentationVariant.skip),options=this.calculateFilters(options),this.entityService.selectQuery(options)}refresh(force){this.refresh$.next(force)}selectResult(){return this.result$.pipe((0,operators_filter.h)(nonNullable))}calculateFilters(queryOptions){return queryOptions}getAnnotation(term,qualifier){return this.entityService.getAnnotation(term,qualifier)}getCalculatedMember(measure,type,calendar){return this.entityService.getCalculatedMember(measure,type,calendar)}getIndicator(id){return this.entityService.getIndicator(id)}}class smart_business_service_SmartBusinessService extends EntityBusinessService{constructor(dsCoreService,smartFilterBar){super(dsCoreService),this.smartFilterBar=smartFilterBar,this.serviceInit$=this.initialise$.pipe((0,switchMap.w)((()=>this.onInit().pipe((0,catchError.K)(((err,caught)=>(console.error(err),empty.E)))))),(0,shareReplay.d)(1)),this.smartFilterBar?.onGo().subscribe((()=>{this.refresh()}))}onInit(){return this.dataSettings$.pipe((0,operators_filter.h)(nonNullable),(0,distinctUntilChanged.x)(isEqual))}onAfterServiceInit(){return this.serviceInit$}selectQuery(options){let _filters=options?.filters??[];return this.smartFilterBar?.slicers?.forEach((ftr=>{_filters=putFilter(_filters,ftr,FilterMergeMode.ignore)})),super.selectQuery({...options??{},filters:_filters})}calculateFilters(queryOptions){const entityType=this.entityType;let _filters=queryOptions?.filters||[];const selectionVariant=this.selectionVariant;if(selectionVariant?.selectOptions){const filterString=[];selectionVariant.selectOptions.forEach((v=>{if(isString_isString(v))filterString.push(v);else if(isTimeRangesSlicer(v)){const{today}=this.dsCoreService.getToday(),ranges=function workOutTimeRangeSlicers(currentDate,timeSlicer,entityType){const property=getEntityCalendarHierarchy(entityType,timeSlicer.dimension);return timeSlicer.ranges.map((range=>{const calendarSemantic=mapTimeGranularitySemantic(range.granularity),calendarLevel=property?.levels?.find((level=>level.semantics?.semantic===calendarSemantic)),results=time_calcRange(currentDate||new Date,{...range,formatter:range.formatter||calendarLevel?.semantics?.formatter});return results[0]===results[1]?{dimension:timeSlicer.dimension,members:[{key:results[0],value:results[0]}]}:{dimension:timeSlicer.dimension,members:results.map((key=>({key,value:key}))),operator:types_FilterOperator.BT}}))}(today,v,entityType);_filters=putFilter(_filters,ranges.length>1?{filteringLogic:FilteringLogic.And,children:ranges}:ranges[0])}else isSlicer(v)&&isEmpty_isEmpty(v.members),_filters.push(v)})),isEmpty_isEmpty(filterString)||(queryOptions.filterString=queryOptions.filterString?`${queryOptions.filterString} ${filterString.join(" ")}`:filterString.join(" "))}return this.get((state=>state.dataSourceOptions?.settings?.ignoreUnknownProperty))&&(_filters=_filters.filter((f=>!f.dimension||(isAdvancedSlicer(f)?!!helper_getEntityProperty(entityType,f.context[0]):!!helper_getEntityProperty(entityType,f.dimension))))),queryOptions.filters=_filters,queryOptions}}class ChartBusinessService extends smart_business_service_SmartBusinessService{constructor(){super(...arguments),this.chartAnnotation$=this.dataSettings$.pipe((0,operators_map.U)((dataSettings=>dataSettings?.chartAnnotation)),(0,distinctUntilChanged.x)())}get chartAnnotation(){return this.get((state=>state.dataSettings?.chartAnnotation))}onInit(){return this.dataSettings$.pipe((0,operators_filter.h)((dataSettings=>!!dataSettings?.chartAnnotation?.measures?.length)),(0,distinctUntilChanged.x)(((a,b)=>isEqual({...a,chartAnnotation:pick(a.chartAnnotation,"dimensions","measures")},{...b,chartAnnotation:pick(b.chartAnnotation,"dimensions","measures")}))))}selectQuery(options){return(options=options??{}).rows=this.chartAnnotation.dimensions,options.columns=this.chartAnnotation.measures,super.selectQuery(options)}}var combineLatestWith=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/combineLatestWith.js");class AnalyticsBusinessService extends smart_business_service_SmartBusinessService{constructor(){super(...arguments),this.analyticsAnnotation$=this.dataSettings$.pipe((0,operators_map.U)((dataSettings=>dataSettings?.analytics)),(0,distinctUntilChanged.x)()),this.analytics$=this.analyticsAnnotation$.pipe((0,operators_filter.h)(nonNullable),(0,combineLatestWith.V)(this.selectEntityType()),(0,operators_map.U)((([analyticsAnnotation,entityType])=>({rows:analyticsAnnotation.rows?.filter(isBaseProperty).map((item=>({...item,property:isMeasure(item)?helper_getEntityProperty(entityType,item):helper_getEntityHierarchy(entityType,item)}))),columns:analyticsAnnotation.columns?.filter(isBaseProperty).map((item=>({...item,property:isMeasure(item)?helper_getEntityProperty(entityType,item):helper_getEntityHierarchy(entityType,item)})))}))))}get analyticsAnnotation(){return this.get((state=>state.dataSettings?.analytics))}onInit(){return super.onInit().pipe((0,operators_map.U)((dataSettings=>dataSettings.analytics)),(0,operators_filter.h)((analytics=>this.isMeetRequired(analytics))))}selectQuery(options){const analyticsAnnotation={...this.analyticsAnnotation,rows:this.analyticsAnnotation?.rows?.filter(isBaseProperty),columns:this.analyticsAnnotation?.columns?.filter(isBaseProperty)};if(!this.isMeetRequired(analyticsAnnotation))throw new Error("Analytics rows or columns is required");return(options=options??{}).rows=analyticsAnnotation.rows,options.columns=analyticsAnnotation.columns,super.selectQuery(options)}isMeetRequired(analytics){return!isEmpty_isEmpty(analytics?.rows?.filter(isBaseProperty))||!isEmpty_isEmpty(analytics?.columns?.filter(isBaseProperty))}}var TypeAheadType,MemberSource,ChartDataZoomType,operators_withLatestFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js");class SmartFilterBarService extends src.m1{get slicers(){return this._model$.value}constructor(_parent){super({}),this._parent=_parent,this._filters$=new internal_BehaviorSubject.X([]),this.slicers$=this._filters$.asObservable(),this._model$=new internal_BehaviorSubject.X(null),this._go$=new Subject.x,this._goWithDistinct$=new Subject.x,this._parent?.onGo().pipe((0,takeUntil.R)(this.destroy$)).subscribe(this._go$),this._go$.pipe((0,operators_withLatestFrom.M)(this._filters$,this._parent?.slicers$??(0,observable_of.of)(null)),(0,operators_map.U)((([,slicers,pSlicers])=>(pSlicers?.forEach((item=>slicers=putFilter(slicers,item))),slicers))),(0,takeUntil.R)(this.destroy$)).subscribe(this._model$),this._goWithDistinct$.pipe((0,operators_withLatestFrom.M)(this._filters$,this._parent?.slicers$??(0,observable_of.of)(null)),(0,operators_map.U)((([,slicers,pSlicers])=>(pSlicers?.forEach((item=>slicers=putFilter(slicers,item))),slicers))),(0,distinctUntilChanged.x)(isEqual),(0,takeUntil.R)(this.destroy$)).subscribe(this._model$)}go(){this._go$.next()}distinctGo(){this._goWithDistinct$.next()}onGo(){return this._go$}change(ftrs){this._filters$.next(ftrs)}onChange(){return this._model$.pipe((0,operators_filter.h)(nonNullable))}getFilters(){return this._model$.getValue()}put(...value){const slicers=this._model$.value??[];this.change(value.reduce(((slicers,item)=>putFilter(slicers,item)),slicers))}remove(value){this.change(function removeFilter(filters,value){return isFilter(value)?filters.filter(((item,i)=>item.dimension.dimension!==value.dimension.dimension)):filters.filter((item=>item.dimension.dimension!==value))}(this._model$.getValue()??[],value))}}!function(TypeAheadType){TypeAheadType.Local="Local",TypeAheadType.Remote="Remote"}(TypeAheadType||(TypeAheadType={})),function(MemberSource){MemberSource.CUBE="CUBE",MemberSource.DIMENSION="DIMENSION"}(MemberSource||(MemberSource={}));class SmartFilterService extends smart_business_service_SmartBusinessService{set options(value){this.patchState({options:value})}get options(){return this.get((state=>state.options))}get dimension(){return this.options?.dimension}constructor(dsCoreService){super(dsCoreService),this.dimension$=this.select((state=>state.options?.dimension)),this.showAllMember$=this.select((state=>state.options?.showAllMember)),this.membersWithSchema$=(0,observable_combineLatest.a)([this.selectResult().pipe((0,operators_filter.h)((({data})=>!isNil_isNil(data)))),this.showAllMember$]).pipe((0,operators_withLatestFrom.M)(this.selectEntityType()),(0,operators_map.U)((([[{data,schema},showAllMember],entityType])=>{const hierarchy=helper_getEntityHierarchy(entityType,this.dimension);let members=data;return!showAllMember&&hierarchy?.allMember&&(members=data.filter((item=>item.memberKey!==hierarchy.allMember))),{members,schema}}))),this.selectOptions$=this.membersWithSchema$.pipe((0,operators_map.U)((({members})=>members.map((item=>({key:item.memberKey,value:item.memberKey,caption:item.memberCaption})))))),this.membersTree$=this.membersWithSchema$.pipe((0,operators_map.U)((({members,schema})=>schema?.recursiveHierarchy?hierarchize(members,schema?.recursiveHierarchy):null)))}onInit(){return super.onInit().pipe((0,switchMap.w)((()=>this.dimension$.pipe((0,operators_filter.h)((dimension=>!!dimension)),(0,operators_map.U)((dimension=>({dimension:dimension.dimension,hierarchy:dimension.hierarchy,level:dimension.level}))),(0,distinctUntilChanged.x)(isEqual)))))}selectQuery(options){const memberSource=this.options?.memberSource;if(memberSource!==MemberSource.CUBE&&!this.dimension.level)return this.entityService.selectMembers(this.dimension).pipe((0,operators_map.U)((data=>({data,schema:{columns:[{name:"memberKey",label:"Member Key",type:"string"},{name:"memberCaption",label:"Member Caption",type:"string"},{name:"parentKey",label:"Parent Key",type:"string"}],recursiveHierarchy:DimensionMemberRecursiveHierarchy}}))));const hProperty=helper_getEntityHierarchy(this.entityType,this.dimension),dimension={...this.dimension,dimension:this.dimension.dimension,hierarchy:hProperty?.name,level:this.dimension.level??hProperty?.levels?.[hProperty.levels.length-1]?.name,displayHierarchy:!this.dimension.level},measure=getEntityDefaultMeasure(this.entityType);(options=options??{}).rows=[dimension],options.columns=[{dimension:types_C_MEASURES,measure:measure.name}],options.filters=[];const propertyName=getPropertyHierarchy(dimension);return super.selectQuery(options).pipe((0,operators_map.U)((result=>{const valueProperty=dimension.hierarchy||dimension.dimension,captionProperty=dimension.memberCaption||hProperty?.memberCaption;return{data:result.data.map((item=>({dimension:dimension.dimension,hierarchy:dimension.hierarchy||dimension.dimension,memberKey:item[valueProperty],memberCaption:item[captionProperty],parentKey:item[`${propertyName}.[PARENT_UNIQUE_NAME]`]}))),schema:{columns:[{name:"memberKey",label:"Member Key",type:"string"},{name:"memberCaption",label:"Member Caption",type:"string"},{name:"parentKey",label:"Parent Key",type:"string"}],recursiveHierarchy:DimensionMemberRecursiveHierarchy}}})))}}!function(ChartDataZoomType){ChartDataZoomType.inside="inside",ChartDataZoomType.slider="slider",ChartDataZoomType.inside_slider="inside&slider"}(ChartDataZoomType||(ChartDataZoomType={}));class SmartChartEngine extends src.m1{constructor(){super(...arguments),this.chartAnnotation$=this.select((state=>state.chartAnnotation)),this.entityType$=this.select((state=>state.entityType)),this.data$=this.select((state=>state.data)),this.settings$=this.select((state=>state.settings)),this.options$=this.select((state=>state.options))}get chartAnnotation(){return this.get((state=>state.chartAnnotation))}set chartAnnotation(value){this.patchState({chartAnnotation:value})}get entityType(){return this.get((state=>state.entityType))}set entityType(value){this.patchState({entityType:value})}get data(){return this.get((state=>state.data))}set data(value){this.patchState({data:value})}get setttings(){return this.get((state=>state.settings))}set settings(value){this.patchState({settings:value})}get options(){return this.get((state=>state.options))}set options(value){this.patchState({options:value})}selectChartOptions(items){throw new Error("Method not implemented.")}changeData(data){throw new Error("Method not implemented.")}processData(data){throw new Error("Method not implemented.")}onChartOptions(){throw new Error("Method not implemented.")}onDestroy(){super.onDestroy()}}},"./packages/store/src/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m1:()=>ComponentStore});var ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),isObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isObservable.js"),observable_of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),scheduled=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduled/scheduled.js"),queue=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/queue.js"),throwError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),concatMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/concatMap.js"),withLatestFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js"),takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),operators_map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),operators_distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),shareReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js"),Observable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),Subscription=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subscription.js"),asap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/asap.js");function debounceSync(){return source=>new Observable.y((observer=>{let actionSubscription,actionValue;const rootSubscription=new Subscription.w0;return rootSubscription.add(source.subscribe({complete:()=>{actionSubscription&&observer.next(actionValue),observer.complete()},error:error=>{observer.error(error)},next:value=>{actionValue=value,actionSubscription||(actionSubscription=asap.E.schedule((()=>{observer.next(actionValue),actionSubscription=void 0})),rootSubscription.add(actionSubscription))}})),rootSubscription}))}var immer=__webpack_require__("./node_modules/immer/dist/immer.mjs");function isEmpty(obj){return[Object,Array].includes((obj||{}).constructor)&&!Object.entries(obj||{}).length}function utils_pick(object,keys){return keys.reduce(((obj,key)=>(object&&Object.prototype.hasOwnProperty.call(object,key)&&(obj[key]=object[key]),obj)),{})}class ComponentStore{constructor(defaultState){this.destroySubject$=new ReplaySubject.t(1),this.destroy$=this.destroySubject$.asObservable(),this.stateSubject$=new ReplaySubject.t(1),this.isInitialized=!1,this.notInitializedErrorMessage=`${this.constructor.name} has not been initialized yet. Please make sure it is initialized before updating/getting.`,this.state$=this.select((s=>s)),defaultState&&this.initState(defaultState)}onDestroy(){this.stateSubject$.complete(),this.destroySubject$.next()}updater(updaterFn){return observableOrValue=>{let initializationError;const subscription=((0,isObservable.b)(observableOrValue)?observableOrValue:(0,observable_of.of)(observableOrValue)).pipe((0,concatMap.b)((value=>this.isInitialized?(0,scheduled.x)([value],queue.N).pipe((0,withLatestFrom.M)(this.stateSubject$)):(0,throwError._)((()=>new Error(this.notInitializedErrorMessage))))),(0,takeUntil.R)(this.destroy$)).subscribe({next:([value,currentState])=>{this.stateSubject$.next(function immerReducer(callback){return(state,next)=>(0,immer.Uy)(state,(draft=>callback(draft,next)))}(updaterFn)(currentState,value))},error:error=>{initializationError=error,this.stateSubject$.error(error)}});if(initializationError)throw initializationError;return subscription}}initState(state){this.isInitialized=!0,this.stateSubject$.next(state)}setState(stateOrUpdaterFn){"function"!=typeof stateOrUpdaterFn?this.initState(stateOrUpdaterFn):this.updater(stateOrUpdaterFn)()}patchState(partialStateOrUpdaterFn){const patchedState="function"==typeof partialStateOrUpdaterFn?partialStateOrUpdaterFn(this.get()):partialStateOrUpdaterFn;this.updater(((state,partialState)=>({...state,...partialState})))(patchedState)}get(projector){if(!this.isInitialized)throw new Error(this.notInitializedErrorMessage);let value;return this.stateSubject$.pipe((0,take.q)(1)).subscribe((state=>{value=projector?projector(state):state})),value}select(...args){const{observables,projector,config}=function processSelectorArgs(args){const selectorArgs=Array.from(args);let projector,config={debounce:!1};const projectorOrConfig=selectorArgs.pop();"function"!=typeof projectorOrConfig?(config={...config,...projectorOrConfig},projector=selectorArgs.pop()):projector=projectorOrConfig;const observables=selectorArgs;return{observables,projector,config}}(args);let observable$;return observable$=0===observables.length?this.stateSubject$.pipe(config.debounce?debounceSync():source$=>source$,(0,operators_map.U)(projector)):(0,combineLatest.a)(observables).pipe(config.debounce?debounceSync():source$=>source$,(0,operators_map.U)((projectorArgs=>projector(...projectorArgs)))),observable$.pipe((0,operators_distinctUntilChanged.x)(),(0,shareReplay.d)({refCount:!0,bufferSize:1}),(0,takeUntil.R)(this.destroy$))}effect(generator){const origin$=new Subject.x;return generator(origin$).pipe((0,takeUntil.R)(this.destroy$)).subscribe(),observableOrValue=>((0,isObservable.b)(observableOrValue)?observableOrValue:(0,observable_of.of)(observableOrValue)).pipe((0,takeUntil.R)(this.destroy$)).subscribe((value=>{origin$.next(value)}))}sync(source,options){source.select((state=>isEmpty(options?.watchProperty)?state:utils_pick(state,options?.watchProperty))).pipe((0,take.q)(1)).subscribe((state=>{this.patchState(state)})),this.select((state=>isEmpty(options?.watchProperty)?state:utils_pick(state,options?.watchProperty))).subscribe((state=>{source.setState(state)}))}}}}]);