(self.webpackChunkocap=self.webpackChunkocap||[]).push([[6931],{"./packages/angular/parameter/parameter/parameter.component.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ParameterInput:()=>ParameterInput,ParameterInputNumber:()=>ParameterInputNumber,ParameterInputString:()=>ParameterInputString,ParameterSelect:()=>ParameterSelect,ParameterSelectDensity:()=>ParameterSelectDensity,ParameterSelectMultiple:()=>ParameterSelectMultiple,Primary:()=>Primary,PrimaryCompact:()=>PrimaryCompact,PrimaryMultiple:()=>PrimaryMultiple,Slider:()=>Slider,SliderVertical:()=>SliderVertical,default:()=>parameter_component_stories});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),animations=__webpack_require__("./node_modules/@angular/platform-browser/fesm2022/animations.mjs"),core_module=__webpack_require__("./packages/angular/core/core.module.ts"),missing_tanslation=__webpack_require__("./packages/angular/core/i18n/missing-tanslation.ts"),core_service=__webpack_require__("./packages/angular/core/core.service.ts"),types=__webpack_require__("./packages/angular/core/types.ts"),displayDensity=__webpack_require__("./packages/angular/core/directives/displayDensity.ts"),src=__webpack_require__("./packages/core/src/index.ts"),ngx_translate_core=__webpack_require__("./node_modules/@ngx-translate/core/fesm2020/ngx-translate-core.mjs"),dist=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs"),agent_mock_service=__webpack_require__("./packages/angular/mock/agent-mock.service.ts"),tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.js");var _class,parameter_componentngResource=__webpack_require__("./packages/angular/parameter/parameter/parameter.component.scss?ngResource"),parameter_componentngResource_default=__webpack_require__.n(parameter_componentngResource),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs_interop=__webpack_require__("./node_modules/@angular/core/fesm2022/rxjs-interop.mjs"),fesm2022_forms=__webpack_require__("./node_modules/@angular/forms/fesm2022/forms.mjs"),form_field=__webpack_require__("./node_modules/@angular/material/fesm2022/form-field.mjs"),input=__webpack_require__("./node_modules/@angular/material/fesm2022/input.mjs"),list=__webpack_require__("./node_modules/@angular/material/fesm2022/list.mjs"),fesm2022_radio=__webpack_require__("./node_modules/@angular/material/fesm2022/radio.mjs"),slider=__webpack_require__("./node_modules/@angular/material/fesm2022/slider.mjs"),common_module=__webpack_require__("./packages/angular/common/common.module.ts"),controls_module=__webpack_require__("./packages/angular/controls/controls.module.ts"),BehaviorSubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),combineLatestWith=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/combineLatestWith.js"),of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),debounceTime=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js");let NgmParameterComponent=((_class=class NgmParameterComponent{constructor(){this.ParameterControlEnum=src.WTi,this.dsCoreService=(0,core.inject)(core_service.q),this.dataSettings$=new BehaviorSubject.X(null),this.parameter$=new BehaviorSubject.X(null),this.parameterChange=new core.EventEmitter,this.dataSource$=this.dataSettings$.pipe((0,map.U)((dataSettings=>dataSettings?.dataSource)),(0,filter.h)((value=>!!value)),(0,distinctUntilChanged.x)(),(0,switchMap.w)((dataSource=>this.dsCoreService.getDataSource(dataSource)))),this.dimension$=this.parameter$.pipe((0,filter.h)((value=>!!value?.dimension)),(0,map.U)((parameter=>(0,src.eiS)(parameter,"dimension","hierarchy"))),(0,distinctUntilChanged.x)(src.Xyp)),this.members$=this.dimension$.pipe((0,combineLatestWith.V)(this.dataSettings$.pipe((0,map.U)((dataSettings=>dataSettings?.entitySet)),(0,filter.h)((value=>!!value)),(0,distinctUntilChanged.x)()),this.dataSource$),(0,switchMap.w)((([parameter,entity,dataSource])=>dataSource.discoverMDMembers(entity,parameter))),(0,map.U)((members=>members?.map((item=>({key:item.memberKey,value:item.memberKey,caption:item.memberCaption})))))),this.availableMembers$=this.parameter$.pipe((0,map.U)((parameter=>parameter?.availableMembers)),(0,distinctUntilChanged.x)(),(0,switchMap.w)((availableMembers=>availableMembers?.length?(0,of.of)(availableMembers):this.members$))),this.slicer={},this.parameterValue=null,this.changeParameter$=new Subject.x,this.changeSub=this.changeParameter$.pipe((0,debounceTime.b)(500),(0,rxjs_interop.sL)()).subscribe((()=>this.parameterChange.emit(this.parameter)))}get dataSettings(){return this.dataSettings$.value}set dataSettings(value){this.dataSettings$.next(value)}get parameter(){return this.parameter$.value}set parameter(value){this.parameter$.next(value)}get multiple(){return this.options?.selectionType===src.ucB.Multiple}get paramType(){return this.parameter?.paramType}get availableMembers(){return this.parameter?.availableMembers??[]}get members(){return this.parameter.members}set members(members){(0,src.Xyp)(members,this.parameter.members)||(this.parameter={...this.parameter,members},this.changeParameter())}ngOnChanges({parameter}){parameter&&(this.parameterValue=parameter.currentValue?.value)}compareWith(a,b){return a.value===b.value}updateParameterValue(event){this.parameter={...this.parameter,value:event},this.changeParameter()}changeParameter(){this.changeParameter$.next()}onSlicerChange(slicer){this.updateParameterValue(slicer.members)}onSlicerEnd(event){this.updateParameterValue(event.value)}onBlur(event){this.updateParameterValue(event.target.value)}}).propDecorators={dataSettings:[{type:core.Input}],parameter:[{type:core.Input}],displayBehaviour:[{type:core.Input}],options:[{type:core.Input}],appearance:[{type:core.Input}],parameterChange:[{type:core.Output}]},_class);NgmParameterComponent=(0,tslib_es6.gn)([(0,core.Component)({standalone:!0,imports:[common.CommonModule,fesm2022_forms.u5,fesm2022_forms.UX,form_field.lN,input.c,fesm2022_radio.Fk,list.ie,slider.KP,core_module.A,common_module.N,controls_module.E],changeDetection:core.ChangeDetectionStrategy.OnPush,selector:"ngm-parameter",template:'<ng-container *ngIf="paramType === ParameterControlEnum.Input">\n    <mat-slider *ngIf="options?.slider; else input" class="w-full"\n        [step]="options?.sliderStep || 1"\n        [min]="options?.sliderMin || 0"\n        [max]="options?.sliderMax || 100"\n        [discrete]="options?.showThumbLabel"\n        [showTickMarks]="options?.showTickMarks"\n        [color]="options?.sliderColor"\n        >\n        <input matSliderThumb [(ngModel)]="parameterValue" (dragEnd)="onSlicerEnd($event)">\n    </mat-slider>\n\n    <ng-template #input>\n        <ngm-input class="block w-full px-2" [(ngModel)]="parameterValue" [type]="parameter.dataType ?? \'string\'"\n            (blur)="onBlur($event)"\n        >\n        </ngm-input>\n    </ng-template>\n</ng-container>\n\n\n<mat-radio-group *ngIf="paramType === ParameterControlEnum.Select" class="flex-1 flex flex-col justify-start items-start"\n    [displayDensity]="appearance?.displayDensity"\n    [ngModel]="$any(parameter.members?.[0])?.value"\n    (ngModelChange)="updateParameterValue($event)"\n>\n    <mat-radio-button *ngFor="let option of parameter.availableMembers"\n        [value]="option.value">{{ option.label }}</mat-radio-button>\n</mat-radio-group>\n\n\x3c!-- 暂时先用简易版:平铺展示维度成员 --\x3e\n<ng-container *ngIf="paramType === ParameterControlEnum.Dimensions">\n    <mat-selection-list *ngIf="multiple" class="flex-1"\n        [multiple]="true"\n        [displayDensity]="appearance?.displayDensity"\n        [compareWith]="compareWith"\n        [(ngModel)]="members"\n    >\n        <mat-list-option *ngFor="let availableMember of availableMembers$ | async" [value]="availableMember">\n            <ngm-display-behaviour [option]="availableMember" [displayBehaviour]="displayBehaviour"></ngm-display-behaviour>\n        </mat-list-option>\n    </mat-selection-list>\n\n    <mat-selection-list *ngIf="!multiple" class="flex-1"\n        [multiple]="false"\n        [displayDensity]="appearance?.displayDensity"\n        [compareWith]="compareWith"\n        [(ngModel)]="members"\n    >\n        <mat-list-option *ngFor="let availableMember of availableMembers$ | async" [value]="availableMember">\n            <ngm-display-behaviour [option]="availableMember" [displayBehaviour]="displayBehaviour"></ngm-display-behaviour>\n        </mat-list-option>\n    </mat-selection-list>\n</ng-container>\n\n<ngm-member-tree class="flex-1" *ngIf="parameter?.referenceDimension"\n    [dataSettings]="dataSettings"\n    [dimension]="dimension$ | async"\n    [options]="options"\n    [ngModel]="slicer"\n    (ngModelChange)="onSlicerChange($event)"\n></ngm-member-tree>\n',host:{class:"ngm-parameter"},styles:[parameter_componentngResource_default()]})],NgmParameterComponent);const parameter_component_stories={title:"ParameterComponent",component:NgmParameterComponent,decorators:[(0,dist.moduleMetadata)({imports:[animations.BrowserAnimationsModule,NgmParameterComponent,core_module.A.forRoot(),ngx_translate_core.aw.forRoot({missingTranslationHandler:{provide:ngx_translate_core.gC,useClass:missing_tanslation.l}})],providers:[core_service.q,{provide:types.fH,useClass:agent_mock_service.c,multi:!0},{provide:types.OF,useValue:{type:"SQL",factory:(_ref=(0,asyncToGenerator.Z)((function*(){const{SQLDataSource}=yield __webpack_require__.e(9593).then(__webpack_require__.bind(__webpack_require__,"./packages/sql/src/index.ts"));return SQLDataSource})),function factory(){return _ref.apply(this,arguments)})},multi:!0},{provide:types.ET,useValue:{name:"Sales",type:"SQL",agentType:src.buO.Browser,settings:{ignoreUnknownProperty:!0},schema:{cubes:[agent_mock_service.n]}},multi:!0}]})]};var _ref;const AVAILABLE_MEMBERS=[{value:1,label:"Department A"},{value:2,label:"Department B"},{value:3,label:"Department C"}],Primary={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentSelector",paramType:src.WTi.Dimensions,dimension:"[Department]",availableMembers:AVAILABLE_MEMBERS}}},PrimaryCompact={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentSelector",paramType:src.WTi.Dimensions,dimension:"[Department]"},appearance:{displayDensity:displayDensity.A.compact}}},PrimaryMultiple={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentSelector",paramType:src.WTi.Dimensions,dimension:"[Department]"},appearance:{displayDensity:displayDensity.A.compact},options:{selectionType:src.ucB.Multiple}}},ParameterInput={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentInput",paramType:src.WTi.Input}}},ParameterInputNumber={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentInput",paramType:src.WTi.Input,dataType:"number"}}},ParameterInputString={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentInput",paramType:src.WTi.Input,dataType:"string"}}},ParameterSelect={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentSelect",paramType:src.WTi.Select,availableMembers:AVAILABLE_MEMBERS}}},ParameterSelectDensity={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentSelect",paramType:src.WTi.Select,availableMembers:AVAILABLE_MEMBERS},appearance:{displayDensity:displayDensity.A.compact}}},ParameterSelectMultiple={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"DepartmentSelect",paramType:src.WTi.Select,availableMembers:AVAILABLE_MEMBERS},appearance:{displayDensity:displayDensity.A.compact},options:{selectionType:src.ucB.Multiple}}},Slider={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"SliderParam",paramType:src.WTi.Input,dataType:"number",value:6},options:{slider:!0,sliderMax:10,sliderStep:2,sliderInvert:!0}}},SliderVertical={args:{dataSettings:{dataSource:"Sales",entitySet:"SalesOrder"},parameter:{name:"SliderParam",paramType:src.WTi.Input,dataType:"number",value:6},options:{slider:!0,sliderMax:10,sliderStep:2,sliderVertical:!0}}}},"./packages/angular/parameter/parameter/parameter.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,":host {\n  overflow: hidden;\n}\n\n.mat-mdc-radio-group .mat-mdc-radio-button {\n  margin: 0.5rem 0;\n}\n.mat-mdc-radio-group.ngm-density__cosy .mat-mdc-radio-button {\n  margin: 0.3rem 0;\n}\n.mat-mdc-radio-group.ngm-density__compact .mat-mdc-radio-button {\n  margin: 0;\n}\n\n.mat-mdc-slider {\n  width: calc(100% - 30px);\n  margin-left: auto;\n  margin-right: auto;\n  margin-top: 2rem;\n  display: block;\n}\n\n.mat-mdc-slider-thumb-label-showing.mat-mdc-slider-horizontal {\n  margin-top: 1rem;\n  margin-left: 1rem;\n  margin-right: 1rem;\n}\n.mat-mdc-slider-thumb-label-showing.mat-mdc-slider-vertical {\n  margin-left: 1rem;\n  margin-top: 1rem;\n  margin-bottom: 1rem;\n}\n\n.mat-mdc-radio-group {\n  margin-left: 1rem;\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()}}]);