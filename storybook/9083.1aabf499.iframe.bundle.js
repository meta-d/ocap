/*! For license information please see 9083.1aabf499.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkocap=self.webpackChunkocap||[]).push([[9083],{"./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/OverloadYield.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _OverloadYield(t,e){this.v=t,this.k=e}__webpack_require__.d(__webpack_exports__,{Z:()=>_OverloadYield})},"./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncGeneratorDelegate.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>_asyncGeneratorDelegate});var _OverloadYield_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/OverloadYield.js");function _asyncGeneratorDelegate(t){var e={},n=!1;function pump(e,r){return n=!0,r=new Promise((function(n){n(t[e](r))})),{done:!1,value:new _OverloadYield_js__WEBPACK_IMPORTED_MODULE_0__.Z(r,1)}}return e["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},e.next=function(t){return n?(n=!1,t):pump("next",t)},"function"==typeof t.throw&&(e.throw=function(t){if(n)throw n=!1,t;return pump("throw",t)}),"function"==typeof t.return&&(e.return=function(t){return n?(n=!1,t):pump("return",t)}),e}},"./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _asyncIterator(r){var n,t,o,e=2;for("undefined"!=typeof Symbol&&(t=Symbol.asyncIterator,o=Symbol.iterator);e--;){if(t&&null!=(n=r[t]))return n.call(r);if(o&&null!=(n=r[o]))return new AsyncFromSyncIterator(n.call(r));t="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(r){function AsyncFromSyncIteratorContinuation(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var n=r.done;return Promise.resolve(r.value).then((function(r){return{value:r,done:n}}))}return AsyncFromSyncIterator=function AsyncFromSyncIterator(r){this.s=r,this.n=r.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function next(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments))},return:function _return(r){var n=this.s.return;return void 0===n?Promise.resolve({value:r,done:!0}):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments))},throw:function _throw(r){var n=this.s.return;return void 0===n?Promise.reject(r):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments))}},new AsyncFromSyncIterator(r)}__webpack_require__.d(__webpack_exports__,{Z:()=>_asyncIterator})},"./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>_awaitAsyncGenerator});var _OverloadYield_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/OverloadYield.js");function _awaitAsyncGenerator(e){return new _OverloadYield_js__WEBPACK_IMPORTED_MODULE_0__.Z(e,0)}},"./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>_wrapAsyncGenerator});var OverloadYield=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/OverloadYield.js");function AsyncGenerator(e){var r,t;function resume(r,t){try{var n=e[r](t),o=n.value,u=o instanceof OverloadYield.Z;Promise.resolve(u?o.v:o).then((function(t){if(u){var i="return"===r?"return":"next";if(!o.k||t.done)return resume(i,t);t=e[i](t).value}settle(n.done?"return":"normal",t)}),(function(e){resume("throw",e)}))}catch(e){settle("throw",e)}}function settle(e,n){switch(e){case"return":r.resolve({value:n,done:!0});break;case"throw":r.reject(n);break;default:r.resolve({value:n,done:!1})}(r=r.next)?resume(r.key,r.arg):t=null}this._invoke=function(e,n){return new Promise((function(o,u){var i={key:e,arg:n,resolve:o,reject:u,next:null};t?t=t.next=i:(r=t=i,resume(e,n))}))},"function"!=typeof e.return&&(this.return=void 0)}function _wrapAsyncGenerator(fn){return function(){return new AsyncGenerator(fn.apply(this,arguments))}}AsyncGenerator.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)}},"./node_modules/@angular/cdk/fesm2022/clipboard.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Iq:()=>ClipboardModule,TU:()=>Clipboard});var _Clipboard,_CdkCopyToClipboard,_ClipboardModule,_angular_common__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");class PendingCopy{constructor(text,_document){this._document=_document;const textarea=this._textarea=this._document.createElement("textarea"),styles=textarea.style;styles.position="fixed",styles.top=styles.opacity="0",styles.left="-999em",textarea.setAttribute("aria-hidden","true"),textarea.value=text,textarea.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(textarea)}copy(){const textarea=this._textarea;let successful=!1;try{if(textarea){const currentFocus=this._document.activeElement;textarea.select(),textarea.setSelectionRange(0,textarea.value.length),successful=this._document.execCommand("copy"),currentFocus&&currentFocus.focus()}}catch{}return successful}destroy(){const textarea=this._textarea;textarea&&(textarea.remove(),this._textarea=void 0)}}class Clipboard{constructor(document){this._document=document}copy(text){const pendingCopy=this.beginCopy(text),successful=pendingCopy.copy();return pendingCopy.destroy(),successful}beginCopy(text){return new PendingCopy(text,this._document)}}(_Clipboard=Clipboard).ɵfac=function _Clipboard_Factory(t){return new(t||_Clipboard)(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵinject"](_angular_common__WEBPACK_IMPORTED_MODULE_1__.DOCUMENT))},_Clipboard.ɵprov=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineInjectable"]({token:_Clipboard,factory:_Clipboard.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](Clipboard,[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Injectable,args:[{providedIn:"root"}]}],(()=>[{type:void 0,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Inject,args:[_angular_common__WEBPACK_IMPORTED_MODULE_1__.DOCUMENT]}]}]),null);const CDK_COPY_TO_CLIPBOARD_CONFIG=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.InjectionToken("CDK_COPY_TO_CLIPBOARD_CONFIG");class CdkCopyToClipboard{constructor(_clipboard,_ngZone,config){this._clipboard=_clipboard,this._ngZone=_ngZone,this.text="",this.attempts=1,this.copied=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.EventEmitter,this._pending=new Set,config&&null!=config.attempts&&(this.attempts=config.attempts)}copy(attempts=this.attempts){if(attempts>1){let remainingAttempts=attempts;const pending=this._clipboard.beginCopy(this.text);this._pending.add(pending);const attempt=()=>{const successful=pending.copy();successful||! --remainingAttempts||this._destroyed?(this._currentTimeout=null,this._pending.delete(pending),pending.destroy(),this.copied.emit(successful)):this._currentTimeout=this._ngZone.runOutsideAngular((()=>setTimeout(attempt,1)))};attempt()}else this.copied.emit(this._clipboard.copy(this.text))}ngOnDestroy(){this._currentTimeout&&clearTimeout(this._currentTimeout),this._pending.forEach((copy=>copy.destroy())),this._pending.clear(),this._destroyed=!0}}(_CdkCopyToClipboard=CdkCopyToClipboard).ɵfac=function _CdkCopyToClipboard_Factory(t){return new(t||_CdkCopyToClipboard)(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](Clipboard),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](_angular_core__WEBPACK_IMPORTED_MODULE_0__.NgZone),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](CDK_COPY_TO_CLIPBOARD_CONFIG,8))},_CdkCopyToClipboard.ɵdir=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineDirective"]({type:_CdkCopyToClipboard,selectors:[["","cdkCopyToClipboard",""]],hostBindings:function _CdkCopyToClipboard_HostBindings(rf,ctx){1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵlistener"]("click",(function _CdkCopyToClipboard_click_HostBindingHandler(){return ctx.copy()}))},inputs:{text:[_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵInputFlags"].None,"cdkCopyToClipboard","text"],attempts:[_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵInputFlags"].None,"cdkCopyToClipboardAttempts","attempts"]},outputs:{copied:"cdkCopyToClipboardCopied"},standalone:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](CdkCopyToClipboard,[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Directive,args:[{selector:"[cdkCopyToClipboard]",host:{"(click)":"copy()"},standalone:!0}]}],(()=>[{type:Clipboard},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.NgZone},{type:void 0,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Optional},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Inject,args:[CDK_COPY_TO_CLIPBOARD_CONFIG]}]}]),{text:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input,args:["cdkCopyToClipboard"]}],attempts:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input,args:["cdkCopyToClipboardAttempts"]}],copied:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Output,args:["cdkCopyToClipboardCopied"]}]});class ClipboardModule{}(_ClipboardModule=ClipboardModule).ɵfac=function _ClipboardModule_Factory(t){return new(t||_ClipboardModule)},_ClipboardModule.ɵmod=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineNgModule"]({type:_ClipboardModule,imports:[CdkCopyToClipboard],exports:[CdkCopyToClipboard]}),_ClipboardModule.ɵinj=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineInjector"]({}),("undefined"==typeof ngDevMode||ngDevMode)&&_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](ClipboardModule,[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.NgModule,args:[{imports:[CdkCopyToClipboard],exports:[CdkCopyToClipboard]}]}],null,null)},"./node_modules/@angular/material/fesm2022/progress-bar.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Cv:()=>MatProgressBarModule});var _MatProgressBar,_MatProgressBarModule,_angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),_angular_common__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),_angular_material_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular/material/fesm2022/core.mjs");const MAT_PROGRESS_BAR_DEFAULT_OPTIONS=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.InjectionToken("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");new _angular_core__WEBPACK_IMPORTED_MODULE_0__.InjectionToken("mat-progress-bar-location",{providedIn:"root",factory:function MAT_PROGRESS_BAR_LOCATION_FACTORY(){const _document=(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.inject)(_angular_common__WEBPACK_IMPORTED_MODULE_1__.DOCUMENT),_location=_document?_document.location:null;return{getPathname:()=>_location?_location.pathname+_location.search:""}}});class MatProgressBar{constructor(_elementRef,_ngZone,_changeDetectorRef,_animationMode,defaults){this._elementRef=_elementRef,this._ngZone=_ngZone,this._changeDetectorRef=_changeDetectorRef,this._animationMode=_animationMode,this._isNoopAnimation=!1,this._defaultColor="primary",this._value=0,this._bufferValue=0,this.animationEnd=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.EventEmitter,this._mode="determinate",this._transitionendHandler=event=>{0!==this.animationEnd.observers.length&&event.target&&event.target.classList.contains("mdc-linear-progress__primary-bar")&&("determinate"!==this.mode&&"buffer"!==this.mode||this._ngZone.run((()=>this.animationEnd.next({value:this.value}))))},this._isNoopAnimation="NoopAnimations"===_animationMode,defaults&&(defaults.color&&(this.color=this._defaultColor=defaults.color),this.mode=defaults.mode||this.mode)}get color(){return this._color||this._defaultColor}set color(value){this._color=value}get value(){return this._value}set value(v){this._value=clamp(v||0),this._changeDetectorRef.markForCheck()}get bufferValue(){return this._bufferValue||0}set bufferValue(v){this._bufferValue=clamp(v||0),this._changeDetectorRef.markForCheck()}get mode(){return this._mode}set mode(value){this._mode=value,this._changeDetectorRef.markForCheck()}ngAfterViewInit(){this._ngZone.runOutsideAngular((()=>{this._elementRef.nativeElement.addEventListener("transitionend",this._transitionendHandler)}))}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._transitionendHandler)}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${"buffer"===this.mode?this.bufferValue:100}%`}_isIndeterminate(){return"indeterminate"===this.mode||"query"===this.mode}}function clamp(v,min=0,max=100){return Math.max(min,Math.min(max,v))}(_MatProgressBar=MatProgressBar).ɵfac=function _MatProgressBar_Factory(t){return new(t||_MatProgressBar)(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](_angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](_angular_core__WEBPACK_IMPORTED_MODULE_0__.NgZone),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](_angular_core__WEBPACK_IMPORTED_MODULE_0__.ChangeDetectorRef),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](_angular_core__WEBPACK_IMPORTED_MODULE_0__.ANIMATION_MODULE_TYPE,8),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdirectiveInject"](MAT_PROGRESS_BAR_DEFAULT_OPTIONS,8))},_MatProgressBar.ɵcmp=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineComponent"]({type:_MatProgressBar,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function _MatProgressBar_HostBindings(rf,ctx){2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵattribute"]("aria-valuenow",ctx._isIndeterminate()?null:ctx.value)("mode",ctx.mode),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵclassMap"]("mat-"+ctx.color),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵclassProp"]("_mat-animation-noopable",ctx._isNoopAnimation)("mdc-linear-progress--animation-ready",!ctx._isNoopAnimation)("mdc-linear-progress--indeterminate",ctx._isIndeterminate()))},inputs:{color:"color",value:[_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵInputFlags"].HasDecoratorInputTransform,"value","value",_angular_core__WEBPACK_IMPORTED_MODULE_0__.numberAttribute],bufferValue:[_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵInputFlags"].HasDecoratorInputTransform,"bufferValue","bufferValue",_angular_core__WEBPACK_IMPORTED_MODULE_0__.numberAttribute],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],standalone:!0,features:[_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵInputTransformsFeature"],_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵStandaloneFeature"]],decls:7,vars:4,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function _MatProgressBar_Template(rf,ctx){1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelementStart"](0,"div",0),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelement"](1,"div",1)(2,"div",2),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelementEnd"](),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelementStart"](3,"div",3),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelement"](4,"span",4),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelementEnd"](),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelementStart"](5,"div",5),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelement"](6,"span",4),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵelementEnd"]()),2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵadvance"](),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵstyleProp"]("flex-basis",ctx._getBufferBarFlexBasis()),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵadvance"](2),_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵstyleProp"]("transform",ctx._getPrimaryBarTransform()))},styles:["@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half))}100%{transform:translateX(var(--mdc-linear-progress-primary-full))}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full))}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-primary-full-neg))}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter-neg))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full-neg))}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}@media screen and (forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden}.mdc-linear-progress__buffer-dots{background-repeat:repeat-x;flex:auto;transform:rotate(180deg);-webkit-mask-image:url(\"data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E\");mask-image:url(\"data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E\");animation:mdc-linear-progress-buffering 250ms infinite linear}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__bar{right:0;-webkit-transform-origin:center right;transform-origin:center right}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__buffer-dots,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}.mdc-linear-progress--closed{opacity:0}.mdc-linear-progress--closed-animation-off .mdc-linear-progress__buffer-dots{animation:none}.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar,.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar .mdc-linear-progress__bar-inner{animation:none}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height) * -2.5))}}.mdc-linear-progress__bar-inner{border-color:var(--mdc-linear-progress-active-indicator-color)}.mdc-linear-progress__buffer-dots{background-color:var(--mdc-linear-progress-track-color)}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-color:rgba(0,0,0,0);background-image:url(\"data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='none slice'%3E%3Ccircle cx='1' cy='1' r='1' fill='rgba(244, 67, 54, 0.25)'/%3E%3C/svg%3E\")}}.mdc-linear-progress__buffer-bar{background-color:var(--mdc-linear-progress-track-color)}.mdc-linear-progress{height:max(var(--mdc-linear-progress-track-height), var(--mdc-linear-progress-active-indicator-height))}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress{height:4px}}.mdc-linear-progress__bar{height:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__bar-inner{border-top-width:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__buffer{height:var(--mdc-linear-progress-track-height)}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-size:10px var(--mdc-linear-progress-track-height)}}.mdc-linear-progress__buffer{border-radius:var(--mdc-linear-progress-track-shape)}.mat-mdc-progress-bar{display:block;text-align:start;--mdc-linear-progress-primary-half: 83.67142%;--mdc-linear-progress-primary-full: 200.611057%;--mdc-linear-progress-secondary-quarter: 37.651913%;--mdc-linear-progress-secondary-half: 84.386165%;--mdc-linear-progress-secondary-full: 160.277782%;--mdc-linear-progress-primary-half-neg: -83.67142%;--mdc-linear-progress-primary-full-neg: -200.611057%;--mdc-linear-progress-secondary-quarter-neg: -37.651913%;--mdc-linear-progress-secondary-half-neg: -84.386165%;--mdc-linear-progress-secondary-full-neg: -160.277782%}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}"],encapsulation:2,changeDetection:0}),("undefined"==typeof ngDevMode||ngDevMode)&&_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](MatProgressBar,[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Component,args:[{selector:"mat-progress-bar",exportAs:"matProgressBar",host:{role:"progressbar","aria-valuemin":"0","aria-valuemax":"100",tabindex:"-1","[attr.aria-valuenow]":"_isIndeterminate() ? null : value","[attr.mode]":"mode",class:"mat-mdc-progress-bar mdc-linear-progress","[class]":'"mat-" + color',"[class._mat-animation-noopable]":"_isNoopAnimation","[class.mdc-linear-progress--animation-ready]":"!_isNoopAnimation","[class.mdc-linear-progress--indeterminate]":"_isIndeterminate()"},changeDetection:_angular_core__WEBPACK_IMPORTED_MODULE_0__.ChangeDetectionStrategy.OnPush,encapsulation:_angular_core__WEBPACK_IMPORTED_MODULE_0__.ViewEncapsulation.None,standalone:!0,template:'\x3c!--\n  All children need to be hidden for screen readers in order to support ChromeVox.\n  More context in the issue: https://github.com/angular/components/issues/22165.\n--\x3e\n<div class="mdc-linear-progress__buffer" aria-hidden="true">\n  <div\n    class="mdc-linear-progress__buffer-bar"\n    [style.flex-basis]="_getBufferBarFlexBasis()"></div>\n  <div class="mdc-linear-progress__buffer-dots"></div>\n</div>\n<div\n  class="mdc-linear-progress__bar mdc-linear-progress__primary-bar"\n  aria-hidden="true"\n  [style.transform]="_getPrimaryBarTransform()">\n  <span class="mdc-linear-progress__bar-inner"></span>\n</div>\n<div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar" aria-hidden="true">\n  <span class="mdc-linear-progress__bar-inner"></span>\n</div>\n',styles:["@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half))}100%{transform:translateX(var(--mdc-linear-progress-primary-full))}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full))}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-primary-full-neg))}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter-neg))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full-neg))}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}@media screen and (forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden}.mdc-linear-progress__buffer-dots{background-repeat:repeat-x;flex:auto;transform:rotate(180deg);-webkit-mask-image:url(\"data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E\");mask-image:url(\"data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E\");animation:mdc-linear-progress-buffering 250ms infinite linear}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__bar{right:0;-webkit-transform-origin:center right;transform-origin:center right}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__buffer-dots,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}.mdc-linear-progress--closed{opacity:0}.mdc-linear-progress--closed-animation-off .mdc-linear-progress__buffer-dots{animation:none}.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar,.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar .mdc-linear-progress__bar-inner{animation:none}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height) * -2.5))}}.mdc-linear-progress__bar-inner{border-color:var(--mdc-linear-progress-active-indicator-color)}.mdc-linear-progress__buffer-dots{background-color:var(--mdc-linear-progress-track-color)}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-color:rgba(0,0,0,0);background-image:url(\"data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='none slice'%3E%3Ccircle cx='1' cy='1' r='1' fill='rgba(244, 67, 54, 0.25)'/%3E%3C/svg%3E\")}}.mdc-linear-progress__buffer-bar{background-color:var(--mdc-linear-progress-track-color)}.mdc-linear-progress{height:max(var(--mdc-linear-progress-track-height), var(--mdc-linear-progress-active-indicator-height))}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress{height:4px}}.mdc-linear-progress__bar{height:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__bar-inner{border-top-width:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__buffer{height:var(--mdc-linear-progress-track-height)}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-size:10px var(--mdc-linear-progress-track-height)}}.mdc-linear-progress__buffer{border-radius:var(--mdc-linear-progress-track-shape)}.mat-mdc-progress-bar{display:block;text-align:start;--mdc-linear-progress-primary-half: 83.67142%;--mdc-linear-progress-primary-full: 200.611057%;--mdc-linear-progress-secondary-quarter: 37.651913%;--mdc-linear-progress-secondary-half: 84.386165%;--mdc-linear-progress-secondary-full: 160.277782%;--mdc-linear-progress-primary-half-neg: -83.67142%;--mdc-linear-progress-primary-full-neg: -200.611057%;--mdc-linear-progress-secondary-quarter-neg: -37.651913%;--mdc-linear-progress-secondary-half-neg: -84.386165%;--mdc-linear-progress-secondary-full-neg: -160.277782%}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}"]}]}],(()=>[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.NgZone},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.ChangeDetectorRef},{type:void 0,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Optional},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Inject,args:[_angular_core__WEBPACK_IMPORTED_MODULE_0__.ANIMATION_MODULE_TYPE]}]},{type:void 0,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Optional},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Inject,args:[MAT_PROGRESS_BAR_DEFAULT_OPTIONS]}]}]),{color:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input}],value:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input,args:[{transform:_angular_core__WEBPACK_IMPORTED_MODULE_0__.numberAttribute}]}],bufferValue:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input,args:[{transform:_angular_core__WEBPACK_IMPORTED_MODULE_0__.numberAttribute}]}],animationEnd:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Output}],mode:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input}]});class MatProgressBarModule{}(_MatProgressBarModule=MatProgressBarModule).ɵfac=function _MatProgressBarModule_Factory(t){return new(t||_MatProgressBarModule)},_MatProgressBarModule.ɵmod=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineNgModule"]({type:_MatProgressBarModule,imports:[MatProgressBar],exports:[MatProgressBar,_angular_material_core__WEBPACK_IMPORTED_MODULE_2__.BQ]}),_MatProgressBarModule.ɵinj=_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineInjector"]({imports:[_angular_material_core__WEBPACK_IMPORTED_MODULE_2__.BQ]}),("undefined"==typeof ngDevMode||ngDevMode)&&_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](MatProgressBarModule,[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.NgModule,args:[{imports:[MatProgressBar],exports:[MatProgressBar,_angular_material_core__WEBPACK_IMPORTED_MODULE_2__.BQ]}]}],null,null)},"./node_modules/@langchain/core/callbacks/manager.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{QH:()=>_dist_callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__.QH,Ye:()=>_dist_callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__.Ye});var _dist_callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/callbacks/manager.js")},"./node_modules/@langchain/core/dist/callbacks/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E:()=>BaseCallbackHandler});var uuid__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./v4.js"),_load_serializable_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/load/serializable.js"),_utils_env_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/utils/env.js");class BaseCallbackHandlerMethodsClass{}class BaseCallbackHandler extends BaseCallbackHandlerMethodsClass{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,_load_serializable_js__WEBPACK_IMPORTED_MODULE_0__.j)(this.constructor)]}constructor(input){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"true"!==(0,_utils_env_js__WEBPACK_IMPORTED_MODULE_1__.lS)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=input||{},input&&(this.ignoreLLM=input.ignoreLLM??this.ignoreLLM,this.ignoreChain=input.ignoreChain??this.ignoreChain,this.ignoreAgent=input.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=input.ignoreRetriever??this.ignoreRetriever,this.raiseError=input.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(input._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return _load_serializable_js__WEBPACK_IMPORTED_MODULE_0__.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return _load_serializable_js__WEBPACK_IMPORTED_MODULE_0__.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(methods){return new class Handler extends BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:uuid__WEBPACK_IMPORTED_MODULE_2__.Z()}),Object.assign(this,methods)}}}}},"./node_modules/@langchain/core/dist/callbacks/manager.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ye:()=>CallbackManager,xz:()=>ensureHandler,QH:()=>parseCallbackConfigArg});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),v4=__webpack_require__("./v4.js"),base=__webpack_require__("./node_modules/@langchain/core/dist/callbacks/base.js"),ansi_styles=__webpack_require__("./node_modules/@langchain/core/node_modules/ansi-styles/index.js"),ansi_styles_default=__webpack_require__.n(ansi_styles),tracers_base=__webpack_require__("./node_modules/@langchain/core/dist/tracers/base.js");function wrap(style,text){return`${style.open}${text}${style.close}`}function tryJsonStringify(obj,fallback){try{return JSON.stringify(obj,null,2)}catch(err){return fallback}}function elapsed(run){if(!run.end_time)return"";const elapsed=run.end_time-run.start_time;return elapsed<1e3?`${elapsed}ms`:`${(elapsed/1e3).toFixed(2)}s`}const{color}=ansi_styles_default();class ConsoleCallbackHandler extends tracers_base.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(_run){return Promise.resolve()}getParents(run){const parents=[];let currentRun=run;for(;currentRun.parent_run_id;){const parent=this.runMap.get(currentRun.parent_run_id);if(!parent)break;parents.push(parent),currentRun=parent}return parents}getBreadcrumbs(run){const string=[...this.getParents(run).reverse(),run].map(((parent,i,arr)=>{const name=`${parent.execution_order}:${parent.run_type}:${parent.name}`;return i===arr.length-1?wrap(ansi_styles_default().bold,name):name})).join(" > ");return wrap(color.grey,string)}onChainStart(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.green,"[chain/start]")} [${crumbs}] Entering Chain run with input: ${tryJsonStringify(run.inputs,"[inputs]")}`)}onChainEnd(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.cyan,"[chain/end]")} [${crumbs}] [${elapsed(run)}] Exiting Chain run with output: ${tryJsonStringify(run.outputs,"[outputs]")}`)}onChainError(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.red,"[chain/error]")} [${crumbs}] [${elapsed(run)}] Chain run errored with error: ${tryJsonStringify(run.error,"[error]")}`)}onLLMStart(run){const crumbs=this.getBreadcrumbs(run),inputs="prompts"in run.inputs?{prompts:run.inputs.prompts.map((p=>p.trim()))}:run.inputs;console.log(`${wrap(color.green,"[llm/start]")} [${crumbs}] Entering LLM run with input: ${tryJsonStringify(inputs,"[inputs]")}`)}onLLMEnd(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.cyan,"[llm/end]")} [${crumbs}] [${elapsed(run)}] Exiting LLM run with output: ${tryJsonStringify(run.outputs,"[response]")}`)}onLLMError(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.red,"[llm/error]")} [${crumbs}] [${elapsed(run)}] LLM run errored with error: ${tryJsonStringify(run.error,"[error]")}`)}onToolStart(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.green,"[tool/start]")} [${crumbs}] Entering Tool run with input: "${run.inputs.input?.trim()}"`)}onToolEnd(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.cyan,"[tool/end]")} [${crumbs}] [${elapsed(run)}] Exiting Tool run with output: "${run.outputs?.output?.trim()}"`)}onToolError(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.red,"[tool/error]")} [${crumbs}] [${elapsed(run)}] Tool run errored with error: ${tryJsonStringify(run.error,"[error]")}`)}onRetrieverStart(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.green,"[retriever/start]")} [${crumbs}] Entering Retriever run with input: ${tryJsonStringify(run.inputs,"[inputs]")}`)}onRetrieverEnd(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.cyan,"[retriever/end]")} [${crumbs}] [${elapsed(run)}] Exiting Retriever run with output: ${tryJsonStringify(run.outputs,"[outputs]")}`)}onRetrieverError(run){const crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.red,"[retriever/error]")} [${crumbs}] [${elapsed(run)}] Retriever run errored with error: ${tryJsonStringify(run.error,"[error]")}`)}onAgentAction(run){const agentRun=run,crumbs=this.getBreadcrumbs(run);console.log(`${wrap(color.blue,"[agent/action]")} [${crumbs}] Agent selected action: ${tryJsonStringify(agentRun.actions[agentRun.actions.length-1],"[action]")}`)}}var asyncGeneratorDelegate=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncGeneratorDelegate.js"),awaitAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),wrapAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),asyncIterator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js");const native_0={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let i=0;i<256;++i)byteToHex.push((i+256).toString(16).slice(1));function unsafeStringify(arr,offset=0){return(byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+"-"+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+"-"+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+"-"+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+"-"+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]).toLowerCase()}const v4_0=function v4_v4(options,buf,offset){if(native_0.randomUUID&&!buf&&!options)return native_0.randomUUID();const rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf){offset=offset||0;for(let i=0;i<16;++i)buf[offset+i]=rnds[i];return buf}return unsafeStringify(rnds)};var p_retry=__webpack_require__("./node_modules/p-retry/index.js"),p_retry_default=__webpack_require__.n(p_retry),dist=__webpack_require__("./node_modules/p-queue/dist/index.js");const STATUS_NO_RETRY=[400,401,403,404,405,406,407,408],STATUS_IGNORE=[409];class AsyncCaller{constructor(params){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=params.maxConcurrency??1/0,this.maxRetries=params.maxRetries??6,"default"in dist.Z?this.queue=new dist.Z.default({concurrency:this.maxConcurrency}):this.queue=new dist.Z({concurrency:this.maxConcurrency}),this.onFailedResponseHook=params?.onFailedResponseHook}call(callable,...args){const onFailedResponseHook=this.onFailedResponseHook;return this.queue.add((()=>p_retry_default()((()=>callable(...args).catch((error=>{throw error instanceof Error?error:new Error(error)}))),{onFailedAttempt:error=>(0,asyncToGenerator.Z)((function*(){if(error.message.startsWith("Cancel")||error.message.startsWith("TimeoutError")||error.message.startsWith("AbortError"))throw error;if("ECONNABORTED"===error?.code)throw error;const response=error?.response,status=response?.status;if(status){if(STATUS_NO_RETRY.includes(+status))throw error;if(STATUS_IGNORE.includes(+status))return;onFailedResponseHook&&(yield onFailedResponseHook(response))}}))(),retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(options,callable,...args){return options.signal?Promise.race([this.call(callable,...args),new Promise(((_,reject)=>{options.signal?.addEventListener("abort",(()=>{reject(new Error("AbortError"))}))}))]):this.call(callable,...args)}fetch(...args){return this.call((()=>fetch(...args).then((res=>res.ok?res:Promise.reject(res)))))}}function isLangChainMessage(message){return"function"==typeof message?._getType}function convertLangChainMessageToExample(message){const converted={type:message._getType(),data:{content:message.content}};return message?.additional_kwargs&&Object.keys(message.additional_kwargs).length>0&&(converted.data.additional_kwargs={...message.additional_kwargs}),converted}var process=__webpack_require__("./node_modules/process/browser.js");let globalEnv;const isDeno=()=>"undefined"!=typeof Deno,getEnv=()=>globalEnv||(globalEnv="undefined"!=typeof window&&void 0!==window.document?"browser":void 0===process||void 0===process.versions||void 0===process.versions.node||isDeno()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":isDeno()?"deno":"other":"node",globalEnv);let runtimeEnvironment,cachedCommitSHAs;function _getRuntimeEnvironment(){return _getRuntimeEnvironment=(0,asyncToGenerator.Z)((function*(){if(void 0===runtimeEnvironment){const env=getEnv(),releaseEnv=function getShas(){if(void 0!==cachedCommitSHAs)return cachedCommitSHAs;const common_release_envs=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],shas={};for(const env of common_release_envs){const envVar=env_getEnvironmentVariable(env);void 0!==envVar&&(shas[env]=envVar)}return cachedCommitSHAs=shas,shas}();runtimeEnvironment={library:"langsmith",runtime:env,sdk:"langsmith-js",sdk_version:__version__,...releaseEnv}}return runtimeEnvironment})),_getRuntimeEnvironment.apply(this,arguments)}function getEnvironmentVariables(){try{return void 0!==process&&process.env?Object.entries(process.env).reduce(((acc,[key,value])=>(acc[key]=String(value),acc)),{}):void 0}catch(e){return}}function env_getEnvironmentVariable(name){try{return void 0!==process?process.env?.[name]:void 0}catch(e){return}}const regex=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const validate_0=function validate_validate(uuid){return"string"==typeof uuid&&regex.test(uuid)};function assertUuid(str){if(!validate_0(str))throw new Error(`Invalid UUID: ${str}`)}function mergeRuntimeEnvIntoRunCreates(_x){return _mergeRuntimeEnvIntoRunCreates.apply(this,arguments)}function _mergeRuntimeEnvIntoRunCreates(){return _mergeRuntimeEnvIntoRunCreates=(0,asyncToGenerator.Z)((function*(runs){const runtimeEnv=yield function env_getRuntimeEnvironment(){return _getRuntimeEnvironment.apply(this,arguments)}(),envVars=function getLangChainEnvVarsMetadata(){const allEnvVars=getEnvironmentVariables()||{},envVars={},excluded=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[key,value]of Object.entries(allEnvVars))!key.startsWith("LANGCHAIN_")||"string"!=typeof value||excluded.includes(key)||key.toLowerCase().includes("key")||key.toLowerCase().includes("secret")||key.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===key?envVars.revision_id=value:envVars[key]=value);return envVars}();return runs.map((run=>{const extra=run.extra??{},metadata=extra.metadata;return run.extra={...extra,runtime:{...runtimeEnv,...extra?.runtime},metadata:{...envVars,...envVars.revision_id||run.revision_id?{revision_id:run.revision_id??envVars.revision_id}:{},...metadata}},run}))})),_mergeRuntimeEnvIntoRunCreates.apply(this,arguments)}const raiseForStatus=function(){var _ref=(0,asyncToGenerator.Z)((function*(response,operation){const body=yield response.text();if(!response.ok)throw new Error(`Failed to ${operation}: ${response.status} ${response.statusText} ${body}`)}));return function raiseForStatus(_x2,_x3){return _ref.apply(this,arguments)}}();function _toArray(){return(_toArray=(0,asyncToGenerator.Z)((function*(iterable){const result=[];var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(iterable);_iteratorAbruptCompletion=!(_step=yield _iterator.next()).done;_iteratorAbruptCompletion=!1){const item=_step.value;result.push(item)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield _iterator.return())}finally{if(_didIteratorError)throw _iteratorError}}return result}))).apply(this,arguments)}function trimQuotes(str){if(void 0!==str)return str.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const handle429=function(){var _ref2=(0,asyncToGenerator.Z)((function*(response){if(429===response?.status){const retryAfter=1e3*parseInt(response.headers.get("retry-after")??"30",10);if(retryAfter>0)return yield new Promise((resolve=>setTimeout(resolve,retryAfter))),!0}return!1}));return function handle429(_x5){return _ref2.apply(this,arguments)}}();class Queue{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(item){return new Promise((resolve=>{this.items.push([item,resolve])}))}pop(upToN){if(upToN<1)throw new Error("Number of items to pop off may not be less than 1.");const popped=[];for(;popped.length<upToN&&this.items.length;){const item=this.items.shift();if(!item)break;popped.push(item)}return[popped.map((it=>it[0])),()=>popped.forEach((it=>it[1]()))]}}class client_Client{constructor(config={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Queue}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const defaultConfig=client_Client.getDefaultClientConfig();this.tracingSampleRate=(()=>{const samplingRateStr=env_getEnvironmentVariable("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===samplingRateStr)return;const samplingRate=parseFloat(samplingRateStr);if(samplingRate<0||samplingRate>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${samplingRate}`);return samplingRate})(),this.apiUrl=trimQuotes(config.apiUrl??defaultConfig.apiUrl)??"",this.apiKey=trimQuotes(config.apiKey??defaultConfig.apiKey),this.webUrl=trimQuotes(config.webUrl??defaultConfig.webUrl),this.timeout_ms=config.timeout_ms??12e3,this.caller=new AsyncCaller(config.callerOptions??{}),this.batchIngestCaller=new AsyncCaller({...config.callerOptions??{},onFailedResponseHook:handle429}),this.hideInputs=config.hideInputs??defaultConfig.hideInputs,this.hideOutputs=config.hideOutputs??defaultConfig.hideOutputs,this.autoBatchTracing=config.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=config.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=config.fetchOptions||{}}static getDefaultClientConfig(){const apiKey=env_getEnvironmentVariable("LANGCHAIN_API_KEY");return{apiUrl:env_getEnvironmentVariable("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey,webUrl:void 0,hideInputs:"true"===env_getEnvironmentVariable("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===env_getEnvironmentVariable("LANGCHAIN_HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(url=>{const hostname=url.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===hostname||"127.0.0.1"===hostname||"::1"===hostname})(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const headers={"User-Agent":`langsmith-js/${__version__}`};return this.apiKey&&(headers["x-api-key"]=`${this.apiKey}`),headers}processInputs(inputs){return!1===this.hideInputs?inputs:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(inputs):inputs}processOutputs(outputs){return!1===this.hideOutputs?outputs:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(outputs):outputs}prepareRunCreateOrUpdateInputs(run){const runParams={...run};return void 0!==runParams.inputs&&(runParams.inputs=this.processInputs(runParams.inputs)),void 0!==runParams.outputs&&(runParams.outputs=this.processOutputs(runParams.outputs)),runParams}_getResponse(path,queryParams){var _this9=this;return(0,asyncToGenerator.Z)((function*(){const paramsString=queryParams?.toString()??"",url=`${_this9.apiUrl}${path}?${paramsString}`,response=yield _this9.caller.call(fetch,url,{method:"GET",headers:_this9.headers,signal:AbortSignal.timeout(_this9.timeout_ms),..._this9.fetchOptions});if(!response.ok)throw new Error(`Failed to fetch ${path}: ${response.status} ${response.statusText}`);return response}))()}_get(path,queryParams){var _this10=this;return(0,asyncToGenerator.Z)((function*(){return(yield _this10._getResponse(path,queryParams)).json()}))()}_getPaginated(path,queryParams=new URLSearchParams){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){let offset=Number(queryParams.get("offset"))||0;const limit=Number(queryParams.get("limit"))||100;for(;;){queryParams.set("offset",String(offset)),queryParams.set("limit",String(limit));const url=`${_this.apiUrl}${path}?${queryParams}`,response=yield(0,awaitAsyncGenerator.Z)(_this.caller.call(fetch,url,{method:"GET",headers:_this.headers,signal:AbortSignal.timeout(_this.timeout_ms),..._this.fetchOptions}));if(!response.ok)throw new Error(`Failed to fetch ${path}: ${response.status} ${response.statusText}`);const items=yield(0,awaitAsyncGenerator.Z)(response.json());if(0===items.length)break;if(yield items,items.length<limit)break;offset+=items.length}}))()}_getCursorPaginatedList(path,body=null,requestMethod="POST",dataKey="runs"){var _this2=this;return(0,wrapAsyncGenerator.Z)((function*(){const bodyParams=body?{...body}:{};for(;;){const response=yield(0,awaitAsyncGenerator.Z)(_this2.caller.call(fetch,`${_this2.apiUrl}${path}`,{method:requestMethod,headers:{..._this2.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(_this2.timeout_ms),..._this2.fetchOptions,body:JSON.stringify(bodyParams)})),responseBody=yield(0,awaitAsyncGenerator.Z)(response.json());if(!responseBody)break;if(!responseBody[dataKey])break;yield responseBody[dataKey];const cursors=responseBody.cursors;if(!cursors)break;if(!cursors.next)break;bodyParams.cursor=cursors.next}}))()}_filterForSampling(runs,patch=!1){if(void 0===this.tracingSampleRate)return runs;if(patch){const sampled=[];for(const run of runs)this.sampledPostUuids.has(run.id)&&(sampled.push(run),this.sampledPostUuids.delete(run.id));return sampled}{const sampled=[];for(const run of runs)Math.random()<this.tracingSampleRate&&(sampled.push(run),this.sampledPostUuids.add(run.id));return sampled}}drainAutoBatchQueue(){var _this11=this;return(0,asyncToGenerator.Z)((function*(){for(;_this11.autoBatchQueue.size>=0;){const[batch,done]=_this11.autoBatchQueue.pop(_this11.pendingAutoBatchedRunLimit);if(!batch.length)return void done();try{yield _this11.batchIngestRuns({runCreates:batch.filter((item=>"create"===item.action)).map((item=>item.item)),runUpdates:batch.filter((item=>"update"===item.action)).map((item=>item.item))})}finally{done()}}}))()}processRunOperation(item,immediatelyTriggerBatch){var _this12=this;return(0,asyncToGenerator.Z)((function*(){const oldTimeout=_this12.autoBatchTimeout;clearTimeout(_this12.autoBatchTimeout),_this12.autoBatchTimeout=void 0;const itemPromise=_this12.autoBatchQueue.push(item);return(immediatelyTriggerBatch||_this12.autoBatchQueue.size>_this12.pendingAutoBatchedRunLimit)&&(yield _this12.drainAutoBatchQueue()),_this12.autoBatchQueue.size>0&&(_this12.autoBatchTimeout=setTimeout((()=>{_this12.autoBatchTimeout=void 0,_this12.drainAutoBatchQueue().catch(console.error)}),oldTimeout?_this12.autoBatchAggregationDelayMs:_this12.autoBatchInitialDelayMs)),itemPromise}))()}_getServerInfo(){var _this13=this;return(0,asyncToGenerator.Z)((function*(){const response=yield fetch(`${_this13.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(_this13.timeout_ms),..._this13.fetchOptions});if(!response.ok)throw yield response.text(),new Error("Failed to retrieve server info.");return response.json()}))()}batchEndpointIsSupported(){var _this14=this;return(0,asyncToGenerator.Z)((function*(){try{_this14.serverInfo=yield _this14._getServerInfo()}catch(e){return!1}return!0}))()}createRun(run){var _this15=this;return(0,asyncToGenerator.Z)((function*(){if(!_this15._filterForSampling([run]).length)return;const headers={..._this15.headers,"Content-Type":"application/json"},session_name=run.project_name;delete run.project_name;const runCreate=_this15.prepareRunCreateOrUpdateInputs({session_name,...run,start_time:run.start_time??Date.now()});if(_this15.autoBatchTracing&&void 0!==runCreate.trace_id&&void 0!==runCreate.dotted_order)return void _this15.processRunOperation({action:"create",item:runCreate}).catch(console.error);const mergedRunCreateParams=yield mergeRuntimeEnvIntoRunCreates([runCreate]),response=yield _this15.caller.call(fetch,`${_this15.apiUrl}/runs`,{method:"POST",headers,body:JSON.stringify(mergedRunCreateParams[0]),signal:AbortSignal.timeout(_this15.timeout_ms),..._this15.fetchOptions});yield raiseForStatus(response,"create run")}))()}batchIngestRuns({runCreates,runUpdates}){var _this16=this;return(0,asyncToGenerator.Z)((function*(){if(void 0===runCreates&&void 0===runUpdates)return;let preparedCreateParams=runCreates?.map((create=>_this16.prepareRunCreateOrUpdateInputs(create)))??[],preparedUpdateParams=runUpdates?.map((update=>_this16.prepareRunCreateOrUpdateInputs(update)))??[];if(preparedCreateParams.length>0&&preparedUpdateParams.length>0){const createById=preparedCreateParams.reduce(((params,run)=>run.id?(params[run.id]=run,params):params),{}),standaloneUpdates=[];for(const updateParam of preparedUpdateParams)void 0!==updateParam.id&&createById[updateParam.id]?createById[updateParam.id]={...createById[updateParam.id],...updateParam}:standaloneUpdates.push(updateParam);preparedCreateParams=Object.values(createById),preparedUpdateParams=standaloneUpdates}const rawBatch={post:_this16._filterForSampling(preparedCreateParams),patch:_this16._filterForSampling(preparedUpdateParams,!0)};if(!rawBatch.post.length&&!rawBatch.patch.length)return;if(preparedCreateParams=yield mergeRuntimeEnvIntoRunCreates(preparedCreateParams),void 0===_this16.batchEndpointSupported&&(_this16.batchEndpointSupported=yield _this16.batchEndpointIsSupported()),!_this16.batchEndpointSupported){_this16.autoBatchTracing=!1;for(const preparedCreateParam of rawBatch.post)yield _this16.createRun(preparedCreateParam);for(const preparedUpdateParam of rawBatch.patch)void 0!==preparedUpdateParam.id&&(yield _this16.updateRun(preparedUpdateParam.id,preparedUpdateParam));return}const sizeLimitBytes=_this16.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,batchChunks={post:[],patch:[]};let currentBatchSizeBytes=0;for(const k of["post","patch"]){const key=k,batchItems=rawBatch[key].reverse();let batchItem=batchItems.pop();for(;void 0!==batchItem;){const stringifiedBatchItem=JSON.stringify(batchItem);currentBatchSizeBytes>0&&currentBatchSizeBytes+stringifiedBatchItem.length>sizeLimitBytes&&(yield _this16._postBatchIngestRuns(JSON.stringify(batchChunks)),currentBatchSizeBytes=0,batchChunks.post=[],batchChunks.patch=[]),currentBatchSizeBytes+=stringifiedBatchItem.length,batchChunks[key].push(batchItem),batchItem=batchItems.pop()}}(batchChunks.post.length>0||batchChunks.patch.length>0)&&(yield _this16._postBatchIngestRuns(JSON.stringify(batchChunks)))}))()}_postBatchIngestRuns(body){var _this17=this;return(0,asyncToGenerator.Z)((function*(){const headers={..._this17.headers,"Content-Type":"application/json",Accept:"application/json"},response=yield _this17.batchIngestCaller.call(fetch,`${_this17.apiUrl}/runs/batch`,{method:"POST",headers,body,signal:AbortSignal.timeout(_this17.timeout_ms),..._this17.fetchOptions});yield raiseForStatus(response,"batch create run")}))()}updateRun(runId,run){var _this18=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(runId),run.inputs&&(run.inputs=_this18.processInputs(run.inputs)),run.outputs&&(run.outputs=_this18.processOutputs(run.outputs));const data={...run,id:runId};if(!_this18._filterForSampling([data],!0).length)return;if(_this18.autoBatchTracing&&void 0!==data.trace_id&&void 0!==data.dotted_order)return void 0!==run.end_time&&void 0===data.parent_run_id?void(yield _this18.processRunOperation({action:"update",item:data},!0)):void _this18.processRunOperation({action:"update",item:data}).catch(console.error);const headers={..._this18.headers,"Content-Type":"application/json"},response=yield _this18.caller.call(fetch,`${_this18.apiUrl}/runs/${runId}`,{method:"PATCH",headers,body:JSON.stringify(run),signal:AbortSignal.timeout(_this18.timeout_ms),..._this18.fetchOptions});yield raiseForStatus(response,"update run")}))()}readRun(runId,{loadChildRuns}={loadChildRuns:!1}){var _this19=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(runId);let run=yield _this19._get(`/runs/${runId}`);return loadChildRuns&&run.child_run_ids&&(run=yield _this19._loadChildRuns(run)),run}))()}getRunUrl({runId,run,projectOpts}){var _this20=this;return(0,asyncToGenerator.Z)((function*(){if(void 0!==run){let sessionId;if(run.session_id)sessionId=run.session_id;else if(projectOpts?.projectName)sessionId=(yield _this20.readProject({projectName:projectOpts?.projectName})).id;else if(projectOpts?.projectId)sessionId=projectOpts?.projectId;else{sessionId=(yield _this20.readProject({projectName:env_getEnvironmentVariable("LANGCHAIN_PROJECT")||"default"})).id}const tenantId=yield _this20._getTenantId();return`${_this20.getHostUrl()}/o/${tenantId}/projects/p/${sessionId}/r/${run.id}?poll=true`}if(void 0!==runId){const run_=yield _this20.readRun(runId);if(!run_.app_path)throw new Error(`Run ${runId} has no app_path`);return`${_this20.getHostUrl()}${run_.app_path}`}throw new Error("Must provide either runId or run")}))()}_loadChildRuns(run){var _this21=this;return(0,asyncToGenerator.Z)((function*(){const childRuns=yield function toArray(_x4){return _toArray.apply(this,arguments)}(_this21.listRuns({id:run.child_run_ids})),treemap={},runs={};childRuns.sort(((a,b)=>(a?.dotted_order??"").localeCompare(b?.dotted_order??"")));for(const childRun of childRuns){if(null===childRun.parent_run_id||void 0===childRun.parent_run_id)throw new Error(`Child run ${childRun.id} has no parent`);childRun.parent_run_id in treemap||(treemap[childRun.parent_run_id]=[]),treemap[childRun.parent_run_id].push(childRun),runs[childRun.id]=childRun}run.child_runs=treemap[run.id]||[];for(const runId in treemap)runId!==run.id&&(runs[runId].child_runs=treemap[runId]);return run}))()}listRuns(props){var _this3=this;return(0,wrapAsyncGenerator.Z)((function*(){const{projectId,projectName,parentRunId,traceId,referenceExampleId,startTime,executionOrder,isRoot,runType,error,id,query,filter,traceFilter,treeFilter,limit,select}=props;let projectIds=[];if(projectId&&(projectIds=Array.isArray(projectId)?projectId:[projectId]),projectName){const projectNames=Array.isArray(projectName)?projectName:[projectName],projectIds_=yield(0,awaitAsyncGenerator.Z)(Promise.all(projectNames.map((name=>_this3.readProject({projectName:name}).then((project=>project.id))))));projectIds.push(...projectIds_)}const body={session:projectIds.length?projectIds:null,run_type:runType,reference_example:referenceExampleId,query,filter,trace_filter:traceFilter,tree_filter:treeFilter,execution_order:executionOrder,parent_run:parentRunId,start_time:startTime?startTime.toISOString():null,error,id,limit,trace:traceId,select:select||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:isRoot};let runsYielded=0;var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(_this3._getCursorPaginatedList("/runs/query",body));_iteratorAbruptCompletion2=!(_step2=yield(0,awaitAsyncGenerator.Z)(_iterator2.next())).done;_iteratorAbruptCompletion2=!1){const runs=_step2.value;if(limit){if(runsYielded>=limit)break;if(runs.length+runsYielded>limit){const newRuns=runs.slice(0,limit-runsYielded);yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(newRuns),awaitAsyncGenerator.Z);break}runsYielded+=runs.length,yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(runs),awaitAsyncGenerator.Z)}else yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(runs),awaitAsyncGenerator.Z)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator2.return()))}finally{if(_didIteratorError2)throw _iteratorError2}}}))()}shareRun(runId,{shareId}={}){var _this22=this;return(0,asyncToGenerator.Z)((function*(){const data={run_id:runId,share_token:shareId||v4_0()};assertUuid(runId);const response=yield _this22.caller.call(fetch,`${_this22.apiUrl}/runs/${runId}/share`,{method:"PUT",headers:_this22.headers,body:JSON.stringify(data),signal:AbortSignal.timeout(_this22.timeout_ms),..._this22.fetchOptions}),result=yield response.json();if(null===result||!("share_token"in result))throw new Error("Invalid response from server");return`${_this22.getHostUrl()}/public/${result.share_token}/r`}))()}unshareRun(runId){var _this23=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(runId);const response=yield _this23.caller.call(fetch,`${_this23.apiUrl}/runs/${runId}/share`,{method:"DELETE",headers:_this23.headers,signal:AbortSignal.timeout(_this23.timeout_ms),..._this23.fetchOptions});yield raiseForStatus(response,"unshare run")}))()}readRunSharedLink(runId){var _this24=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(runId);const response=yield _this24.caller.call(fetch,`${_this24.apiUrl}/runs/${runId}/share`,{method:"GET",headers:_this24.headers,signal:AbortSignal.timeout(_this24.timeout_ms),..._this24.fetchOptions}),result=yield response.json();if(null!==result&&"share_token"in result)return`${_this24.getHostUrl()}/public/${result.share_token}/r`}))()}listSharedRuns(shareToken,{runIds}={}){var _this25=this;return(0,asyncToGenerator.Z)((function*(){const queryParams=new URLSearchParams({share_token:shareToken});if(void 0!==runIds)for(const runId of runIds)queryParams.append("id",runId);assertUuid(shareToken);const response=yield _this25.caller.call(fetch,`${_this25.apiUrl}/public/${shareToken}/runs${queryParams}`,{method:"GET",headers:_this25.headers,signal:AbortSignal.timeout(_this25.timeout_ms),..._this25.fetchOptions});return yield response.json()}))()}readDatasetSharedSchema(datasetId,datasetName){var _this26=this;return(0,asyncToGenerator.Z)((function*(){if(!datasetId&&!datasetName)throw new Error("Either datasetId or datasetName must be given");if(!datasetId){const dataset=yield _this26.readDataset({datasetName});datasetId=dataset.id}assertUuid(datasetId);const response=yield _this26.caller.call(fetch,`${_this26.apiUrl}/datasets/${datasetId}/share`,{method:"GET",headers:_this26.headers,signal:AbortSignal.timeout(_this26.timeout_ms),..._this26.fetchOptions}),shareSchema=yield response.json();return shareSchema.url=`${_this26.getHostUrl()}/public/${shareSchema.share_token}/d`,shareSchema}))()}shareDataset(datasetId,datasetName){var _this27=this;return(0,asyncToGenerator.Z)((function*(){if(!datasetId&&!datasetName)throw new Error("Either datasetId or datasetName must be given");if(!datasetId){const dataset=yield _this27.readDataset({datasetName});datasetId=dataset.id}const data={dataset_id:datasetId};assertUuid(datasetId);const response=yield _this27.caller.call(fetch,`${_this27.apiUrl}/datasets/${datasetId}/share`,{method:"PUT",headers:_this27.headers,body:JSON.stringify(data),signal:AbortSignal.timeout(_this27.timeout_ms),..._this27.fetchOptions}),shareSchema=yield response.json();return shareSchema.url=`${_this27.getHostUrl()}/public/${shareSchema.share_token}/d`,shareSchema}))()}unshareDataset(datasetId){var _this28=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(datasetId);const response=yield _this28.caller.call(fetch,`${_this28.apiUrl}/datasets/${datasetId}/share`,{method:"DELETE",headers:_this28.headers,signal:AbortSignal.timeout(_this28.timeout_ms),..._this28.fetchOptions});yield raiseForStatus(response,"unshare dataset")}))()}readSharedDataset(shareToken){var _this29=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(shareToken);const response=yield _this29.caller.call(fetch,`${_this29.apiUrl}/public/${shareToken}/datasets`,{method:"GET",headers:_this29.headers,signal:AbortSignal.timeout(_this29.timeout_ms),..._this29.fetchOptions});return yield response.json()}))()}createProject({projectName,description=null,metadata=null,upsert=!1,projectExtra=null,referenceDatasetId=null}){var _this30=this;return(0,asyncToGenerator.Z)((function*(){const upsert_=upsert?"?upsert=true":"",endpoint=`${_this30.apiUrl}/sessions${upsert_}`,extra=projectExtra||{};metadata&&(extra.metadata=metadata);const body={name:projectName,extra,description};null!==referenceDatasetId&&(body.reference_dataset_id=referenceDatasetId);const response=yield _this30.caller.call(fetch,endpoint,{method:"POST",headers:{..._this30.headers,"Content-Type":"application/json"},body:JSON.stringify(body),signal:AbortSignal.timeout(_this30.timeout_ms),..._this30.fetchOptions}),result=yield response.json();if(!response.ok)throw new Error(`Failed to create session ${projectName}: ${response.status} ${response.statusText}`);return result}))()}updateProject(projectId,{name=null,description=null,metadata=null,projectExtra=null,endTime=null}){var _this31=this;return(0,asyncToGenerator.Z)((function*(){const endpoint=`${_this31.apiUrl}/sessions/${projectId}`;let extra=projectExtra;metadata&&(extra={...extra||{},metadata});const body={name,extra,description,end_time:endTime?new Date(endTime).toISOString():null},response=yield _this31.caller.call(fetch,endpoint,{method:"PATCH",headers:{..._this31.headers,"Content-Type":"application/json"},body:JSON.stringify(body),signal:AbortSignal.timeout(_this31.timeout_ms),..._this31.fetchOptions}),result=yield response.json();if(!response.ok)throw new Error(`Failed to update project ${projectId}: ${response.status} ${response.statusText}`);return result}))()}hasProject({projectId,projectName}){var _this32=this;return(0,asyncToGenerator.Z)((function*(){let path="/sessions";const params=new URLSearchParams;if(void 0!==projectId&&void 0!==projectName)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==projectId)assertUuid(projectId),path+=`/${projectId}`;else{if(void 0===projectName)throw new Error("Must provide projectName or projectId");params.append("name",projectName)}const response=yield _this32.caller.call(fetch,`${_this32.apiUrl}${path}?${params}`,{method:"GET",headers:_this32.headers,signal:AbortSignal.timeout(_this32.timeout_ms),..._this32.fetchOptions});try{const result=yield response.json();return!!response.ok&&(!Array.isArray(result)||result.length>0)}catch(e){return!1}}))()}readProject({projectId,projectName,includeStats}){var _this33=this;return(0,asyncToGenerator.Z)((function*(){let path="/sessions";const params=new URLSearchParams;if(void 0!==projectId&&void 0!==projectName)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==projectId)assertUuid(projectId),path+=`/${projectId}`;else{if(void 0===projectName)throw new Error("Must provide projectName or projectId");params.append("name",projectName)}void 0!==includeStats&&params.append("include_stats",includeStats.toString());const response=yield _this33._get(path,params);let result;if(Array.isArray(response)){if(0===response.length)throw new Error(`Project[id=${projectId}, name=${projectName}] not found`);result=response[0]}else result=response;return result}))()}getProjectUrl({projectId,projectName}){var _this34=this;return(0,asyncToGenerator.Z)((function*(){if(void 0===projectId&&void 0===projectName)throw new Error("Must provide either projectName or projectId");const project=yield _this34.readProject({projectId,projectName}),tenantId=yield _this34._getTenantId();return`${_this34.getHostUrl()}/o/${tenantId}/projects/p/${project.id}`}))()}getDatasetUrl({datasetId,datasetName}){var _this35=this;return(0,asyncToGenerator.Z)((function*(){if(void 0===datasetId&&void 0===datasetName)throw new Error("Must provide either datasetName or datasetId");const dataset=yield _this35.readDataset({datasetId,datasetName}),tenantId=yield _this35._getTenantId();return`${_this35.getHostUrl()}/o/${tenantId}/datasets/${dataset.id}`}))()}_getTenantId(){var _this36=this;return(0,asyncToGenerator.Z)((function*(){if(null!==_this36._tenantId)return _this36._tenantId;const queryParams=new URLSearchParams({limit:"1"});var _iteratorError3,_iteratorAbruptCompletion3=!1,_didIteratorError3=!1;try{for(var _step3,_iterator3=(0,asyncIterator.Z)(_this36._getPaginated("/sessions",queryParams));_iteratorAbruptCompletion3=!(_step3=yield _iterator3.next()).done;_iteratorAbruptCompletion3=!1){const projects=_step3.value;return _this36._tenantId=projects[0].tenant_id,projects[0].tenant_id}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorAbruptCompletion3&&null!=_iterator3.return&&(yield _iterator3.return())}finally{if(_didIteratorError3)throw _iteratorError3}}throw new Error("No projects found to resolve tenant.")}))()}listProjects({projectIds,name,nameContains,referenceDatasetId,referenceDatasetName,referenceFree}={}){var _this4=this;return(0,wrapAsyncGenerator.Z)((function*(){const params=new URLSearchParams;if(void 0!==projectIds)for(const projectId of projectIds)params.append("id",projectId);if(void 0!==name&&params.append("name",name),void 0!==nameContains&&params.append("name_contains",nameContains),void 0!==referenceDatasetId)params.append("reference_dataset",referenceDatasetId);else if(void 0!==referenceDatasetName){const dataset=yield(0,awaitAsyncGenerator.Z)(_this4.readDataset({datasetName:referenceDatasetName}));params.append("reference_dataset",dataset.id)}void 0!==referenceFree&&params.append("reference_free",referenceFree.toString());var _iteratorError4,_iteratorAbruptCompletion4=!1,_didIteratorError4=!1;try{for(var _step4,_iterator4=(0,asyncIterator.Z)(_this4._getPaginated("/sessions",params));_iteratorAbruptCompletion4=!(_step4=yield(0,awaitAsyncGenerator.Z)(_iterator4.next())).done;_iteratorAbruptCompletion4=!1){const projects=_step4.value;yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(projects),awaitAsyncGenerator.Z)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorAbruptCompletion4&&null!=_iterator4.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator4.return()))}finally{if(_didIteratorError4)throw _iteratorError4}}}))()}deleteProject({projectId,projectName}){var _this37=this;return(0,asyncToGenerator.Z)((function*(){let projectId_;if(void 0===projectId&&void 0===projectName)throw new Error("Must provide projectName or projectId");if(void 0!==projectId&&void 0!==projectName)throw new Error("Must provide either projectName or projectId, not both");projectId_=void 0===projectId?(yield _this37.readProject({projectName})).id:projectId,assertUuid(projectId_);const response=yield _this37.caller.call(fetch,`${_this37.apiUrl}/sessions/${projectId_}`,{method:"DELETE",headers:_this37.headers,signal:AbortSignal.timeout(_this37.timeout_ms),..._this37.fetchOptions});yield raiseForStatus(response,`delete session ${projectId_} (${projectName})`)}))()}uploadCsv({csvFile,fileName,inputKeys,outputKeys,description,dataType,name}){var _this38=this;return(0,asyncToGenerator.Z)((function*(){const url=`${_this38.apiUrl}/datasets/upload`,formData=new FormData;formData.append("file",csvFile,fileName),inputKeys.forEach((key=>{formData.append("input_keys",key)})),outputKeys.forEach((key=>{formData.append("output_keys",key)})),description&&formData.append("description",description),dataType&&formData.append("data_type",dataType),name&&formData.append("name",name);const response=yield _this38.caller.call(fetch,url,{method:"POST",headers:_this38.headers,body:formData,signal:AbortSignal.timeout(_this38.timeout_ms),..._this38.fetchOptions});if(!response.ok){const result=yield response.json();if(result.detail&&result.detail.includes("already exists"))throw new Error(`Dataset ${fileName} already exists`);throw new Error(`Failed to upload CSV: ${response.status} ${response.statusText}`)}return yield response.json()}))()}createDataset(name,{description,dataType}={}){var _this39=this;return(0,asyncToGenerator.Z)((function*(){const body={name,description};dataType&&(body.data_type=dataType);const response=yield _this39.caller.call(fetch,`${_this39.apiUrl}/datasets`,{method:"POST",headers:{..._this39.headers,"Content-Type":"application/json"},body:JSON.stringify(body),signal:AbortSignal.timeout(_this39.timeout_ms),..._this39.fetchOptions});if(!response.ok){const result=yield response.json();if(result.detail&&result.detail.includes("already exists"))throw new Error(`Dataset ${name} already exists`);throw new Error(`Failed to create dataset ${response.status} ${response.statusText}`)}return yield response.json()}))()}readDataset({datasetId,datasetName}){var _this40=this;return(0,asyncToGenerator.Z)((function*(){let path="/datasets";const params=new URLSearchParams({limit:"1"});if(void 0!==datasetId&&void 0!==datasetName)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==datasetId)assertUuid(datasetId),path+=`/${datasetId}`;else{if(void 0===datasetName)throw new Error("Must provide datasetName or datasetId");params.append("name",datasetName)}const response=yield _this40._get(path,params);let result;if(Array.isArray(response)){if(0===response.length)throw new Error(`Dataset[id=${datasetId}, name=${datasetName}] not found`);result=response[0]}else result=response;return result}))()}hasDataset({datasetId,datasetName}){var _this41=this;return(0,asyncToGenerator.Z)((function*(){try{return yield _this41.readDataset({datasetId,datasetName}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}))()}diffDatasetVersions({datasetId,datasetName,fromVersion,toVersion}){var _this42=this;return(0,asyncToGenerator.Z)((function*(){let datasetId_=datasetId;if(void 0===datasetId_&&void 0===datasetName)throw new Error("Must provide either datasetName or datasetId");if(void 0!==datasetId_&&void 0!==datasetName)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===datasetId_){datasetId_=(yield _this42.readDataset({datasetName})).id}const urlParams=new URLSearchParams({from_version:"string"==typeof fromVersion?fromVersion:fromVersion.toISOString(),to_version:"string"==typeof toVersion?toVersion:toVersion.toISOString()});return yield _this42._get(`/datasets/${datasetId_}/versions/diff`,urlParams)}))()}readDatasetOpenaiFinetuning({datasetId,datasetName}){var _this43=this;return(0,asyncToGenerator.Z)((function*(){if(void 0!==datasetId);else{if(void 0===datasetName)throw new Error("Must provide datasetName or datasetId");datasetId=(yield _this43.readDataset({datasetName})).id}const response=yield _this43._getResponse(`/datasets/${datasetId}/openai_ft`);return(yield response.text()).trim().split("\n").map((line=>JSON.parse(line)))}))()}listDatasets({limit=100,offset=0,datasetIds,datasetName,datasetNameContains}={}){var _this5=this;return(0,wrapAsyncGenerator.Z)((function*(){const params=new URLSearchParams({limit:limit.toString(),offset:offset.toString()});if(void 0!==datasetIds)for(const id_ of datasetIds)params.append("id",id_);void 0!==datasetName&&params.append("name",datasetName),void 0!==datasetNameContains&&params.append("name_contains",datasetNameContains);var _iteratorError5,_iteratorAbruptCompletion5=!1,_didIteratorError5=!1;try{for(var _step5,_iterator5=(0,asyncIterator.Z)(_this5._getPaginated("/datasets",params));_iteratorAbruptCompletion5=!(_step5=yield(0,awaitAsyncGenerator.Z)(_iterator5.next())).done;_iteratorAbruptCompletion5=!1){const datasets=_step5.value;yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(datasets),awaitAsyncGenerator.Z)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorAbruptCompletion5&&null!=_iterator5.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator5.return()))}finally{if(_didIteratorError5)throw _iteratorError5}}}))()}deleteDataset({datasetId,datasetName}){var _this44=this;return(0,asyncToGenerator.Z)((function*(){let path="/datasets",datasetId_=datasetId;if(void 0!==datasetId&&void 0!==datasetName)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==datasetName){datasetId_=(yield _this44.readDataset({datasetName})).id}if(void 0===datasetId_)throw new Error("Must provide datasetName or datasetId");assertUuid(datasetId_),path+=`/${datasetId_}`;const response=yield _this44.caller.call(fetch,_this44.apiUrl+path,{method:"DELETE",headers:_this44.headers,signal:AbortSignal.timeout(_this44.timeout_ms),..._this44.fetchOptions});if(!response.ok)throw new Error(`Failed to delete ${path}: ${response.status} ${response.statusText}`);yield response.json()}))()}createExample(inputs,outputs,{datasetId,datasetName,createdAt,exampleId,metadata,split}){var _this45=this;return(0,asyncToGenerator.Z)((function*(){let datasetId_=datasetId;if(void 0===datasetId_&&void 0===datasetName)throw new Error("Must provide either datasetName or datasetId");if(void 0!==datasetId_&&void 0!==datasetName)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===datasetId_){datasetId_=(yield _this45.readDataset({datasetName})).id}const createdAt_=createdAt||new Date,data={dataset_id:datasetId_,inputs,outputs,created_at:createdAt_?.toISOString(),id:exampleId,metadata,split},response=yield _this45.caller.call(fetch,`${_this45.apiUrl}/examples`,{method:"POST",headers:{..._this45.headers,"Content-Type":"application/json"},body:JSON.stringify(data),signal:AbortSignal.timeout(_this45.timeout_ms),..._this45.fetchOptions});if(!response.ok)throw new Error(`Failed to create example: ${response.status} ${response.statusText}`);return yield response.json()}))()}createExamples(props){var _this46=this;return(0,asyncToGenerator.Z)((function*(){const{inputs,outputs,metadata,sourceRunIds,exampleIds,datasetId,datasetName}=props;let datasetId_=datasetId;if(void 0===datasetId_&&void 0===datasetName)throw new Error("Must provide either datasetName or datasetId");if(void 0!==datasetId_&&void 0!==datasetName)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===datasetId_){const dataset=yield _this46.readDataset({datasetName});datasetId_=dataset.id}const formattedExamples=inputs.map(((input,idx)=>({dataset_id:datasetId_,inputs:input,outputs:outputs?outputs[idx]:void 0,metadata:metadata?metadata[idx]:void 0,split:props.splits?props.splits[idx]:void 0,id:exampleIds?exampleIds[idx]:void 0,source_run_id:sourceRunIds?sourceRunIds[idx]:void 0}))),response=yield _this46.caller.call(fetch,`${_this46.apiUrl}/examples/bulk`,{method:"POST",headers:{..._this46.headers,"Content-Type":"application/json"},body:JSON.stringify(formattedExamples),signal:AbortSignal.timeout(_this46.timeout_ms),..._this46.fetchOptions});if(!response.ok)throw new Error(`Failed to create examples: ${response.status} ${response.statusText}`);return yield response.json()}))()}createLLMExample(input,generation,options){var _this47=this;return(0,asyncToGenerator.Z)((function*(){return _this47.createExample({input},{output:generation},options)}))()}createChatExample(input,generations,options){var _this48=this;return(0,asyncToGenerator.Z)((function*(){const finalInput=input.map((message=>isLangChainMessage(message)?convertLangChainMessageToExample(message):message)),finalOutput=isLangChainMessage(generations)?convertLangChainMessageToExample(generations):generations;return _this48.createExample({input:finalInput},{output:finalOutput},options)}))()}readExample(exampleId){var _this49=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(exampleId);const path=`/examples/${exampleId}`;return yield _this49._get(path)}))()}listExamples({datasetId,datasetName,exampleIds,asOf,splits,inlineS3Urls,metadata}={}){var _this6=this;return(0,wrapAsyncGenerator.Z)((function*(){let datasetId_;if(void 0!==datasetId&&void 0!==datasetName)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==datasetId)datasetId_=datasetId;else{if(void 0===datasetName)throw new Error("Must provide a datasetName or datasetId");datasetId_=(yield(0,awaitAsyncGenerator.Z)(_this6.readDataset({datasetName}))).id}const params=new URLSearchParams({dataset:datasetId_}),dataset_version=asOf?"string"==typeof asOf?asOf:asOf?.toISOString():void 0;dataset_version&&params.append("as_of",dataset_version);const inlineS3Urls_=inlineS3Urls??!0;if(params.append("inline_s3_urls",inlineS3Urls_.toString()),void 0!==exampleIds)for(const id_ of exampleIds)params.append("id",id_);if(void 0!==splits)for(const split of splits)params.append("splits",split);if(void 0!==metadata){const serializedMetadata=JSON.stringify(metadata);params.append("metadata",serializedMetadata)}var _iteratorError6,_iteratorAbruptCompletion6=!1,_didIteratorError6=!1;try{for(var _step6,_iterator6=(0,asyncIterator.Z)(_this6._getPaginated("/examples",params));_iteratorAbruptCompletion6=!(_step6=yield(0,awaitAsyncGenerator.Z)(_iterator6.next())).done;_iteratorAbruptCompletion6=!1){const examples=_step6.value;yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(examples),awaitAsyncGenerator.Z)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorAbruptCompletion6&&null!=_iterator6.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator6.return()))}finally{if(_didIteratorError6)throw _iteratorError6}}}))()}deleteExample(exampleId){var _this50=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(exampleId);const path=`/examples/${exampleId}`,response=yield _this50.caller.call(fetch,_this50.apiUrl+path,{method:"DELETE",headers:_this50.headers,signal:AbortSignal.timeout(_this50.timeout_ms),..._this50.fetchOptions});if(!response.ok)throw new Error(`Failed to delete ${path}: ${response.status} ${response.statusText}`);yield response.json()}))()}updateExample(exampleId,update){var _this51=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(exampleId);const response=yield _this51.caller.call(fetch,`${_this51.apiUrl}/examples/${exampleId}`,{method:"PATCH",headers:{..._this51.headers,"Content-Type":"application/json"},body:JSON.stringify(update),signal:AbortSignal.timeout(_this51.timeout_ms),..._this51.fetchOptions});if(!response.ok)throw new Error(`Failed to update example ${exampleId}: ${response.status} ${response.statusText}`);return yield response.json()}))()}evaluateRun(run,evaluator,{sourceInfo,loadChildRuns,referenceExample}={loadChildRuns:!1}){var _this52=this;return(0,asyncToGenerator.Z)((function*(){let run_;if("string"==typeof run)run_=yield _this52.readRun(run,{loadChildRuns});else{if("object"!=typeof run||!("id"in run))throw new Error("Invalid run type: "+typeof run);run_=run}null!==run_.reference_example_id&&void 0!==run_.reference_example_id&&(referenceExample=yield _this52.readExample(run_.reference_example_id));const feedbackResult=yield evaluator.evaluateRun(run_,referenceExample);let sourceInfo_=sourceInfo??{};feedbackResult.evaluatorInfo&&(sourceInfo_={...sourceInfo_,...feedbackResult.evaluatorInfo});const runId=feedbackResult.targetRunId??run_.id;return yield _this52.createFeedback(runId,feedbackResult.key,{score:feedbackResult?.score,value:feedbackResult?.value,comment:feedbackResult?.comment,correction:feedbackResult?.correction,sourceInfo:sourceInfo_,feedbackSourceType:"model",sourceRunId:feedbackResult?.sourceRunId})}))()}createFeedback(runId,key,{score,value,correction,comment,sourceInfo,feedbackSourceType="api",sourceRunId,feedbackId,feedbackConfig,projectId,comparativeExperimentId}){var _this53=this;return(0,asyncToGenerator.Z)((function*(){if(!runId&&!projectId)throw new Error("One of runId or projectId must be provided");if(runId&&projectId)throw new Error("Only one of runId or projectId can be provided");const feedback_source={type:feedbackSourceType??"api",metadata:sourceInfo??{}};void 0===sourceRunId||void 0===feedback_source?.metadata||feedback_source.metadata.__run||(feedback_source.metadata.__run={run_id:sourceRunId}),void 0!==feedback_source?.metadata&&void 0!==feedback_source.metadata.__run?.run_id&&assertUuid(feedback_source.metadata.__run.run_id);const feedback={id:feedbackId??v4_0(),run_id:runId,key,score,value,correction,comment,feedback_source,comparative_experiment_id:comparativeExperimentId,feedbackConfig,session_id:projectId},url=`${_this53.apiUrl}/feedback`,response=yield _this53.caller.call(fetch,url,{method:"POST",headers:{..._this53.headers,"Content-Type":"application/json"},body:JSON.stringify(feedback),signal:AbortSignal.timeout(_this53.timeout_ms),..._this53.fetchOptions});return yield raiseForStatus(response,"create feedback"),feedback}))()}updateFeedback(feedbackId,{score,value,correction,comment}){var _this54=this;return(0,asyncToGenerator.Z)((function*(){const feedbackUpdate={};null!=score&&(feedbackUpdate.score=score),null!=value&&(feedbackUpdate.value=value),null!=correction&&(feedbackUpdate.correction=correction),null!=comment&&(feedbackUpdate.comment=comment),assertUuid(feedbackId);const response=yield _this54.caller.call(fetch,`${_this54.apiUrl}/feedback/${feedbackId}`,{method:"PATCH",headers:{..._this54.headers,"Content-Type":"application/json"},body:JSON.stringify(feedbackUpdate),signal:AbortSignal.timeout(_this54.timeout_ms),..._this54.fetchOptions});yield raiseForStatus(response,"update feedback")}))()}readFeedback(feedbackId){var _this55=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(feedbackId);const path=`/feedback/${feedbackId}`;return yield _this55._get(path)}))()}deleteFeedback(feedbackId){var _this56=this;return(0,asyncToGenerator.Z)((function*(){assertUuid(feedbackId);const path=`/feedback/${feedbackId}`,response=yield _this56.caller.call(fetch,_this56.apiUrl+path,{method:"DELETE",headers:_this56.headers,signal:AbortSignal.timeout(_this56.timeout_ms),..._this56.fetchOptions});if(!response.ok)throw new Error(`Failed to delete ${path}: ${response.status} ${response.statusText}`);yield response.json()}))()}listFeedback({runIds,feedbackKeys,feedbackSourceTypes}={}){var _this7=this;return(0,wrapAsyncGenerator.Z)((function*(){const queryParams=new URLSearchParams;if(runIds&&queryParams.append("run",runIds.join(",")),feedbackKeys)for(const key of feedbackKeys)queryParams.append("key",key);if(feedbackSourceTypes)for(const type of feedbackSourceTypes)queryParams.append("source",type);var _iteratorError7,_iteratorAbruptCompletion7=!1,_didIteratorError7=!1;try{for(var _step7,_iterator7=(0,asyncIterator.Z)(_this7._getPaginated("/feedback",queryParams));_iteratorAbruptCompletion7=!(_step7=yield(0,awaitAsyncGenerator.Z)(_iterator7.next())).done;_iteratorAbruptCompletion7=!1){const feedbacks=_step7.value;yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(feedbacks),awaitAsyncGenerator.Z)}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorAbruptCompletion7&&null!=_iterator7.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator7.return()))}finally{if(_didIteratorError7)throw _iteratorError7}}}))()}createPresignedFeedbackToken(runId,feedbackKey,{expiration,feedbackConfig}={}){var _this57=this;return(0,asyncToGenerator.Z)((function*(){const body={run_id:runId,feedback_key:feedbackKey,feedback_config:feedbackConfig};expiration?"string"==typeof expiration?body.expires_at=expiration:(expiration?.hours||expiration?.minutes||expiration?.days)&&(body.expires_in=expiration):body.expires_in={hours:3};const response=yield _this57.caller.call(fetch,`${_this57.apiUrl}/feedback/tokens`,{method:"POST",headers:{..._this57.headers,"Content-Type":"application/json"},body:JSON.stringify(body),signal:AbortSignal.timeout(_this57.timeout_ms),..._this57.fetchOptions});return yield response.json()}))()}createComparativeExperiment({name,experimentIds,referenceDatasetId,createdAt,description,metadata,id}){var _this58=this;return(0,asyncToGenerator.Z)((function*(){if(0===experimentIds.length)throw new Error("At least one experiment is required");if(referenceDatasetId||(referenceDatasetId=(yield _this58.readProject({projectId:experimentIds[0]})).reference_dataset_id),null==!referenceDatasetId)throw new Error("A reference dataset is required");const body={id,name,experiment_ids:experimentIds,reference_dataset_id:referenceDatasetId,description,created_at:(createdAt??new Date)?.toISOString(),extra:{}};metadata&&(body.extra.metadata=metadata);const response=yield _this58.caller.call(fetch,`${_this58.apiUrl}/datasets/comparative`,{method:"POST",headers:{..._this58.headers,"Content-Type":"application/json"},body:JSON.stringify(body),signal:AbortSignal.timeout(_this58.timeout_ms),..._this58.fetchOptions});return yield response.json()}))()}listPresignedFeedbackTokens(runId){var _this8=this;return(0,wrapAsyncGenerator.Z)((function*(){assertUuid(runId);const params=new URLSearchParams({run_id:runId});var _iteratorError8,_iteratorAbruptCompletion8=!1,_didIteratorError8=!1;try{for(var _step8,_iterator8=(0,asyncIterator.Z)(_this8._getPaginated("/feedback/tokens",params));_iteratorAbruptCompletion8=!(_step8=yield(0,awaitAsyncGenerator.Z)(_iterator8.next())).done;_iteratorAbruptCompletion8=!1){const tokens=_step8.value;yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(tokens),awaitAsyncGenerator.Z)}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{_iteratorAbruptCompletion8&&null!=_iterator8.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator8.return()))}finally{if(_didIteratorError8)throw _iteratorError8}}}))()}_selectEvalResults(results){let results_;return results_="results"in results?results.results:[results],results_}logEvaluationFeedback(evaluatorResponse,run,sourceInfo){var _this59=this;return(0,asyncToGenerator.Z)((function*(){const results=_this59._selectEvalResults(evaluatorResponse);for(const res of results){let sourceInfo_=sourceInfo||{};res.evaluatorInfo&&(sourceInfo_={...res.evaluatorInfo,...sourceInfo_});let runId_=null;res.targetRunId?runId_=res.targetRunId:run&&(runId_=run.id),yield _this59.createFeedback(runId_,res.key,{score:res.score,value:res.value,comment:res.comment,correction:res.correction,sourceInfo:sourceInfo_,sourceRunId:res.sourceRunId,feedbackConfig:res.feedbackConfig,feedbackSourceType:"model"})}return results}))()}}const __version__="0.1.30";var traceable=__webpack_require__("./node_modules/langsmith/singletons/traceable.js"),env=__webpack_require__("./node_modules/@langchain/core/dist/utils/env.js");class tracer_langchain_LangChainTracer extends tracers_base.Z{constructor(fields={}){super(fields),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId,projectName,client}=fields;this.projectName=projectName??(0,env.lS)("LANGCHAIN_PROJECT")??(0,env.lS)("LANGCHAIN_SESSION"),this.exampleId=exampleId,this.client=client??new client_Client({});const traceableTree=this.getTraceableRunTree();if(traceableTree){let rootRun=traceableTree;const visited=new Set;for(;rootRun.parent_run&&!visited.has(rootRun.id)&&(visited.add(rootRun.id),rootRun.parent_run);)rootRun=rootRun.parent_run;visited.clear();const queue=[rootRun];for(;queue.length>0;){const current=queue.shift();current&&!visited.has(current.id)&&(visited.add(current.id),this.runMap.set(current.id,current),current.child_runs&&queue.push(...current.child_runs))}this.client=traceableTree.client??this.client,this.projectName=traceableTree.project_name??this.projectName,this.exampleId=traceableTree.reference_example_id??this.exampleId}}_convertToCreate(run,example_id=void 0){var _this=this;return(0,asyncToGenerator.Z)((function*(){return{...run,extra:{...run.extra,runtime:yield(0,env.sA)()},child_runs:void 0,session_name:_this.projectName,reference_example_id:run.parent_run_id?void 0:example_id}}))()}persistRun(_run){return(0,asyncToGenerator.Z)((function*(){}))()}onRunCreate(run){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const persistedRun=yield _this2._convertToCreate(run,_this2.exampleId);yield _this2.client.createRun(persistedRun)}))()}onRunUpdate(run){var _this3=this;return(0,asyncToGenerator.Z)((function*(){const runUpdate={end_time:run.end_time,error:run.error,outputs:run.outputs,events:run.events,inputs:run.inputs,trace_id:run.trace_id,dotted_order:run.dotted_order,parent_run_id:run.parent_run_id};yield _this3.client.updateRun(run.id,runUpdate)}))()}getRun(id){return this.runMap.get(id)}getTraceableRunTree(){try{return(0,traceable.dy)()}catch{return}}}var dist_messages=__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js");function _getTracingV2CallbackHandler(){return(_getTracingV2CallbackHandler=(0,asyncToGenerator.Z)((function*(){return new tracer_langchain_LangChainTracer}))).apply(this,arguments)}let queue;function consumeCallback(_x,_x2){return _consumeCallback.apply(this,arguments)}function _consumeCallback(){return(_consumeCallback=(0,asyncToGenerator.Z)((function*(promiseFn,wait){!0===wait?yield promiseFn():(void 0===queue&&(queue=function createQueue(){return new("default"in dist.Z?dist.Z.default:dist.Z)({autoStart:!0,concurrency:1})}()),queue.add(promiseFn))}))).apply(this,arguments)}function parseCallbackConfigArg(arg){return arg?Array.isArray(arg)||"name"in arg?{callbacks:arg}:arg:{}}"true"===(0,env.lS)("LANGCHAIN_TRACING_V2")&&"true"!==(0,env.lS)("LANGCHAIN_CALLBACKS_BACKGROUND")&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join("\n");class BaseCallbackManager{setHandler(handler){return this.setHandlers([handler])}}class BaseRunManager{constructor(runId,handlers,inheritableHandlers,tags,inheritableTags,metadata,inheritableMetadata,_parentRunId){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:runId}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:handlers}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:inheritableHandlers}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:tags}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:inheritableTags}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:metadata}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:inheritableMetadata}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:_parentRunId})}handleText(text){var _this=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){try{yield handler.handleText?.(text,_this.runId,_this._parentRunId,_this.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleText: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}}class CallbackManagerForRetrieverRun extends BaseRunManager{getChild(tag){const manager=new CallbackManager(this.runId);return manager.setHandlers(this.inheritableHandlers),manager.addTags(this.inheritableTags),manager.addMetadata(this.inheritableMetadata),tag&&manager.addTags([tag],!1),manager}handleRetrieverEnd(documents){var _this2=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this2.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreRetriever)try{yield handler.handleRetrieverEnd?.(documents,_this2.runId,_this2._parentRunId,_this2.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleRetriever`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}handleRetrieverError(err){var _this3=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this3.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreRetriever)try{yield handler.handleRetrieverError?.(err,_this3.runId,_this3._parentRunId,_this3.tags)}catch(error){if(console.error(`Error in handler ${handler.constructor.name}, handleRetrieverError: ${error}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}}class CallbackManagerForLLMRun extends BaseRunManager{handleLLMNewToken(token,idx,_runId,_parentRunId,_tags,fields){var _this4=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this4.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreLLM)try{yield handler.handleLLMNewToken?.(token,idx??{prompt:0,completion:0},_this4.runId,_this4._parentRunId,_this4.tags,fields)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleLLMNewToken: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}handleLLMError(err){var _this5=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this5.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreLLM)try{yield handler.handleLLMError?.(err,_this5.runId,_this5._parentRunId,_this5.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleLLMError: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}handleLLMEnd(output){var _this6=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this6.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreLLM)try{yield handler.handleLLMEnd?.(output,_this6.runId,_this6._parentRunId,_this6.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleLLMEnd: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}}class CallbackManagerForChainRun extends BaseRunManager{getChild(tag){const manager=new CallbackManager(this.runId);return manager.setHandlers(this.inheritableHandlers),manager.addTags(this.inheritableTags),manager.addMetadata(this.inheritableMetadata),tag&&manager.addTags([tag],!1),manager}handleChainError(err,_runId,_parentRunId,_tags,kwargs){var _this7=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this7.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreChain)try{yield handler.handleChainError?.(err,_this7.runId,_this7._parentRunId,_this7.tags,kwargs)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleChainError: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}handleChainEnd(output,_runId,_parentRunId,_tags,kwargs){var _this8=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this8.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreChain)try{yield handler.handleChainEnd?.(output,_this8.runId,_this8._parentRunId,_this8.tags,kwargs)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleChainEnd: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}handleAgentAction(action){var _this9=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this9.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreAgent)try{yield handler.handleAgentAction?.(action,_this9.runId,_this9._parentRunId,_this9.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleAgentAction: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}handleAgentEnd(action){var _this10=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this10.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreAgent)try{yield handler.handleAgentEnd?.(action,_this10.runId,_this10._parentRunId,_this10.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleAgentEnd: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}}class CallbackManagerForToolRun extends BaseRunManager{getChild(tag){const manager=new CallbackManager(this.runId);return manager.setHandlers(this.inheritableHandlers),manager.addTags(this.inheritableTags),manager.addMetadata(this.inheritableMetadata),tag&&manager.addTags([tag],!1),manager}handleToolError(err){var _this11=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this11.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreAgent)try{yield handler.handleToolError?.(err,_this11.runId,_this11._parentRunId,_this11.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleToolError: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}handleToolEnd(output){var _this12=this;return(0,asyncToGenerator.Z)((function*(){yield Promise.all(_this12.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreAgent)try{yield handler.handleToolEnd?.(output,_this12.runId,_this12._parentRunId,_this12.tags)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleToolEnd: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers))))}))()}}class CallbackManager extends BaseCallbackManager{constructor(parentRunId,options){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=options?.handlers??this.handlers,this.inheritableHandlers=options?.inheritableHandlers??this.inheritableHandlers,this.tags=options?.tags??this.tags,this.inheritableTags=options?.inheritableTags??this.inheritableTags,this.metadata=options?.metadata??this.metadata,this.inheritableMetadata=options?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=parentRunId}getParentRunId(){return this._parentRunId}handleLLMStart(llm,prompts,runId=void 0,_parentRunId=void 0,extraParams=void 0,_tags=void 0,_metadata=void 0,runName=void 0){var _this13=this;return(0,asyncToGenerator.Z)((function*(){return Promise.all(prompts.map(function(){var _ref13=(0,asyncToGenerator.Z)((function*(prompt,idx){const runId_=0===idx&&runId?runId:(0,v4.Z)();return yield Promise.all(_this13.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreLLM)try{yield handler.handleLLMStart?.(llm,[prompt],runId_,_this13._parentRunId,extraParams,_this13.tags,_this13.metadata,runName)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleLLMStart: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers)))),new CallbackManagerForLLMRun(runId_,_this13.handlers,_this13.inheritableHandlers,_this13.tags,_this13.inheritableTags,_this13.metadata,_this13.inheritableMetadata,_this13._parentRunId)}));return function(_x,_x2){return _ref13.apply(this,arguments)}}()))}))()}handleChatModelStart(llm,messages,runId=void 0,_parentRunId=void 0,extraParams=void 0,_tags=void 0,_metadata=void 0,runName=void 0){var _this14=this;return(0,asyncToGenerator.Z)((function*(){return Promise.all(messages.map(function(){var _ref15=(0,asyncToGenerator.Z)((function*(messageGroup,idx){const runId_=0===idx&&runId?runId:(0,v4.Z)();return yield Promise.all(_this14.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreLLM)try{if(handler.handleChatModelStart)yield handler.handleChatModelStart?.(llm,[messageGroup],runId_,_this14._parentRunId,extraParams,_this14.tags,_this14.metadata,runName);else if(handler.handleLLMStart){const messageString=(0,dist_messages.zs)(messageGroup);yield handler.handleLLMStart?.(llm,[messageString],runId_,_this14._parentRunId,extraParams,_this14.tags,_this14.metadata,runName)}}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleLLMStart: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers)))),new CallbackManagerForLLMRun(runId_,_this14.handlers,_this14.inheritableHandlers,_this14.tags,_this14.inheritableTags,_this14.metadata,_this14.inheritableMetadata,_this14._parentRunId)}));return function(_x3,_x4){return _ref15.apply(this,arguments)}}()))}))()}handleChainStart(chain,inputs,runId=(0,v4.Z)(),runType=void 0,_tags=void 0,_metadata=void 0,runName=void 0){var _this15=this;return(0,asyncToGenerator.Z)((function*(){return yield Promise.all(_this15.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreChain)try{yield handler.handleChainStart?.(chain,inputs,runId,_this15._parentRunId,_this15.tags,_this15.metadata,runType,runName)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleChainStart: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers)))),new CallbackManagerForChainRun(runId,_this15.handlers,_this15.inheritableHandlers,_this15.tags,_this15.inheritableTags,_this15.metadata,_this15.inheritableMetadata,_this15._parentRunId)}))()}handleToolStart(tool,input,runId=(0,v4.Z)(),_parentRunId=void 0,_tags=void 0,_metadata=void 0,runName=void 0){var _this16=this;return(0,asyncToGenerator.Z)((function*(){return yield Promise.all(_this16.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreAgent)try{yield handler.handleToolStart?.(tool,input,runId,_this16._parentRunId,_this16.tags,_this16.metadata,runName)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleToolStart: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers)))),new CallbackManagerForToolRun(runId,_this16.handlers,_this16.inheritableHandlers,_this16.tags,_this16.inheritableTags,_this16.metadata,_this16.inheritableMetadata,_this16._parentRunId)}))()}handleRetrieverStart(retriever,query,runId=(0,v4.Z)(),_parentRunId=void 0,_tags=void 0,_metadata=void 0,runName=void 0){var _this17=this;return(0,asyncToGenerator.Z)((function*(){return yield Promise.all(_this17.handlers.map((handler=>consumeCallback((0,asyncToGenerator.Z)((function*(){if(!handler.ignoreRetriever)try{yield handler.handleRetrieverStart?.(retriever,query,runId,_this17._parentRunId,_this17.tags,_this17.metadata,runName)}catch(err){if(console.error(`Error in handler ${handler.constructor.name}, handleRetrieverStart: ${err}`),handler.raiseError)throw err}})),handler.awaitHandlers)))),new CallbackManagerForRetrieverRun(runId,_this17.handlers,_this17.inheritableHandlers,_this17.tags,_this17.inheritableTags,_this17.metadata,_this17.inheritableMetadata,_this17._parentRunId)}))()}addHandler(handler,inherit=!0){this.handlers.push(handler),inherit&&this.inheritableHandlers.push(handler)}removeHandler(handler){this.handlers=this.handlers.filter((_handler=>_handler!==handler)),this.inheritableHandlers=this.inheritableHandlers.filter((_handler=>_handler!==handler))}setHandlers(handlers,inherit=!0){this.handlers=[],this.inheritableHandlers=[];for(const handler of handlers)this.addHandler(handler,inherit)}addTags(tags,inherit=!0){this.removeTags(tags),this.tags.push(...tags),inherit&&this.inheritableTags.push(...tags)}removeTags(tags){this.tags=this.tags.filter((tag=>!tags.includes(tag))),this.inheritableTags=this.inheritableTags.filter((tag=>!tags.includes(tag)))}addMetadata(metadata,inherit=!0){this.metadata={...this.metadata,...metadata},inherit&&(this.inheritableMetadata={...this.inheritableMetadata,...metadata})}removeMetadata(metadata){for(const key of Object.keys(metadata))delete this.metadata[key],delete this.inheritableMetadata[key]}copy(additionalHandlers=[],inherit=!0){const manager=new CallbackManager(this._parentRunId);for(const handler of this.handlers){const inheritable=this.inheritableHandlers.includes(handler);manager.addHandler(handler,inheritable)}for(const tag of this.tags){const inheritable=this.inheritableTags.includes(tag);manager.addTags([tag],inheritable)}for(const key of Object.keys(this.metadata)){const inheritable=Object.keys(this.inheritableMetadata).includes(key);manager.addMetadata({[key]:this.metadata[key]},inheritable)}for(const handler of additionalHandlers)manager.handlers.filter((h=>"console_callback_handler"===h.name)).some((h=>h.name===handler.name))||manager.addHandler(handler,inherit);return manager}static fromHandlers(handlers){class Handler extends base.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,v4.Z)()}),Object.assign(this,handlers)}}const manager=new this;return manager.addHandler(new Handler),manager}static configure(inheritableHandlers,localHandlers,inheritableTags,localTags,inheritableMetadata,localMetadata,options){return(0,asyncToGenerator.Z)((function*(){let callbackManager;(inheritableHandlers||localHandlers)&&(Array.isArray(inheritableHandlers)||!inheritableHandlers?(callbackManager=new CallbackManager,callbackManager.setHandlers(inheritableHandlers?.map(ensureHandler)??[],!0)):callbackManager=inheritableHandlers,callbackManager=callbackManager.copy(Array.isArray(localHandlers)?localHandlers.map(ensureHandler):localHandlers?.handlers,!1));const verboseEnabled="true"===(0,env.lS)("LANGCHAIN_VERBOSE")||options?.verbose,tracingV2Enabled="true"===(0,env.lS)("LANGCHAIN_TRACING_V2")||"true"===(0,env.lS)("LANGSMITH_TRACING"),tracingEnabled=tracingV2Enabled||((0,env.lS)("LANGCHAIN_TRACING")??!1);if(verboseEnabled||tracingEnabled){if(callbackManager||(callbackManager=new CallbackManager),verboseEnabled&&!callbackManager.handlers.some((handler=>handler.name===ConsoleCallbackHandler.prototype.name))){const consoleHandler=new ConsoleCallbackHandler;callbackManager.addHandler(consoleHandler,!0)}if(tracingEnabled&&!callbackManager.handlers.some((handler=>"langchain_tracer"===handler.name))&&tracingV2Enabled){const tracerV2=yield function getTracingV2CallbackHandler(){return _getTracingV2CallbackHandler.apply(this,arguments)}();callbackManager.addHandler(tracerV2,!0),callbackManager._parentRunId=tracerV2.getTraceableRunTree()?.id??callbackManager._parentRunId}}return(inheritableTags||localTags)&&callbackManager&&(callbackManager.addTags(inheritableTags??[]),callbackManager.addTags(localTags??[],!1)),(inheritableMetadata||localMetadata)&&callbackManager&&(callbackManager.addMetadata(inheritableMetadata??{}),callbackManager.addMetadata(localMetadata??{},!1)),callbackManager}))()}}function ensureHandler(handler){return"name"in handler?handler:base.E.fromMethods(handler)}},"./node_modules/@langchain/core/dist/language_models/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{BD:()=>BaseLangChain,qV:()=>BaseLanguageModel});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),root="object"==typeof window?window:{},HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],blocks=[];function Sha1(sharedMemory){sharedMemory?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(message){if(!this.finalized){var notString="string"!=typeof message;notString&&message.constructor===root.ArrayBuffer&&(message=new Uint8Array(message));for(var code,i,index=0,length=message.length||0,blocks=this.blocks;index<length;){if(this.hashed&&(this.hashed=!1,blocks[0]=this.block,blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0),notString)for(i=this.start;index<length&&i<64;++index)blocks[i>>2]|=message[index]<<SHIFT[3&i++];else for(i=this.start;index<length&&i<64;++index)(code=message.charCodeAt(index))<128?blocks[i>>2]|=code<<SHIFT[3&i++]:code<2048?(blocks[i>>2]|=(192|code>>6)<<SHIFT[3&i++],blocks[i>>2]|=(128|63&code)<<SHIFT[3&i++]):code<55296||code>=57344?(blocks[i>>2]|=(224|code>>12)<<SHIFT[3&i++],blocks[i>>2]|=(128|code>>6&63)<<SHIFT[3&i++],blocks[i>>2]|=(128|63&code)<<SHIFT[3&i++]):(code=65536+((1023&code)<<10|1023&message.charCodeAt(++index)),blocks[i>>2]|=(240|code>>18)<<SHIFT[3&i++],blocks[i>>2]|=(128|code>>12&63)<<SHIFT[3&i++],blocks[i>>2]|=(128|code>>6&63)<<SHIFT[3&i++],blocks[i>>2]|=(128|63&code)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=blocks[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var blocks=this.blocks,i=this.lastByteIndex;blocks[16]=this.block,blocks[i>>2]|=EXTRA[3&i],this.block=blocks[16],i>=56&&(this.hashed||this.hash(),blocks[0]=this.block,blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0),blocks[14]=this.hBytes<<3|this.bytes>>>29,blocks[15]=this.bytes<<3,this.hash()}},Sha1.prototype.hash=function(){var j,t,a=this.h0,b=this.h1,c=this.h2,d=this.h3,e=this.h4,blocks=this.blocks;for(j=16;j<80;++j)t=blocks[j-3]^blocks[j-8]^blocks[j-14]^blocks[j-16],blocks[j]=t<<1|t>>>31;for(j=0;j<20;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b&c|~b&d)+e+1518500249+blocks[j]<<0)<<5|e>>>27)+(a&(b=b<<30|b>>>2)|~a&c)+d+1518500249+blocks[j+1]<<0)<<5|d>>>27)+(e&(a=a<<30|a>>>2)|~e&b)+c+1518500249+blocks[j+2]<<0)<<5|c>>>27)+(d&(e=e<<30|e>>>2)|~d&a)+b+1518500249+blocks[j+3]<<0)<<5|b>>>27)+(c&(d=d<<30|d>>>2)|~c&e)+a+1518500249+blocks[j+4]<<0,c=c<<30|c>>>2;for(;j<40;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b^c^d)+e+1859775393+blocks[j]<<0)<<5|e>>>27)+(a^(b=b<<30|b>>>2)^c)+d+1859775393+blocks[j+1]<<0)<<5|d>>>27)+(e^(a=a<<30|a>>>2)^b)+c+1859775393+blocks[j+2]<<0)<<5|c>>>27)+(d^(e=e<<30|e>>>2)^a)+b+1859775393+blocks[j+3]<<0)<<5|b>>>27)+(c^(d=d<<30|d>>>2)^e)+a+1859775393+blocks[j+4]<<0,c=c<<30|c>>>2;for(;j<60;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b&c|b&d|c&d)+e-1894007588+blocks[j]<<0)<<5|e>>>27)+(a&(b=b<<30|b>>>2)|a&c|b&c)+d-1894007588+blocks[j+1]<<0)<<5|d>>>27)+(e&(a=a<<30|a>>>2)|e&b|a&b)+c-1894007588+blocks[j+2]<<0)<<5|c>>>27)+(d&(e=e<<30|e>>>2)|d&a|e&a)+b-1894007588+blocks[j+3]<<0)<<5|b>>>27)+(c&(d=d<<30|d>>>2)|c&e|d&e)+a-1894007588+blocks[j+4]<<0,c=c<<30|c>>>2;for(;j<80;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b^c^d)+e-899497514+blocks[j]<<0)<<5|e>>>27)+(a^(b=b<<30|b>>>2)^c)+d-899497514+blocks[j+1]<<0)<<5|d>>>27)+(e^(a=a<<30|a>>>2)^b)+c-899497514+blocks[j+2]<<0)<<5|c>>>27)+(d^(e=e<<30|e>>>2)^a)+b-899497514+blocks[j+3]<<0)<<5|b>>>27)+(c^(d=d<<30|d>>>2)^e)+a-899497514+blocks[j+4]<<0,c=c<<30|c>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+b<<0,this.h2=this.h2+c<<0,this.h3=this.h3+d<<0,this.h4=this.h4+e<<0},Sha1.prototype.hex=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4;return HEX_CHARS[h0>>28&15]+HEX_CHARS[h0>>24&15]+HEX_CHARS[h0>>20&15]+HEX_CHARS[h0>>16&15]+HEX_CHARS[h0>>12&15]+HEX_CHARS[h0>>8&15]+HEX_CHARS[h0>>4&15]+HEX_CHARS[15&h0]+HEX_CHARS[h1>>28&15]+HEX_CHARS[h1>>24&15]+HEX_CHARS[h1>>20&15]+HEX_CHARS[h1>>16&15]+HEX_CHARS[h1>>12&15]+HEX_CHARS[h1>>8&15]+HEX_CHARS[h1>>4&15]+HEX_CHARS[15&h1]+HEX_CHARS[h2>>28&15]+HEX_CHARS[h2>>24&15]+HEX_CHARS[h2>>20&15]+HEX_CHARS[h2>>16&15]+HEX_CHARS[h2>>12&15]+HEX_CHARS[h2>>8&15]+HEX_CHARS[h2>>4&15]+HEX_CHARS[15&h2]+HEX_CHARS[h3>>28&15]+HEX_CHARS[h3>>24&15]+HEX_CHARS[h3>>20&15]+HEX_CHARS[h3>>16&15]+HEX_CHARS[h3>>12&15]+HEX_CHARS[h3>>8&15]+HEX_CHARS[h3>>4&15]+HEX_CHARS[15&h3]+HEX_CHARS[h4>>28&15]+HEX_CHARS[h4>>24&15]+HEX_CHARS[h4>>20&15]+HEX_CHARS[h4>>16&15]+HEX_CHARS[h4>>12&15]+HEX_CHARS[h4>>8&15]+HEX_CHARS[h4>>4&15]+HEX_CHARS[15&h4]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4;return[h0>>24&255,h0>>16&255,h0>>8&255,255&h0,h1>>24&255,h1>>16&255,h1>>8&255,255&h1,h2>>24&255,h2>>16&255,h2>>8&255,255&h2,h3>>24&255,h3>>16&255,h3>>8&255,255&h3,h4>>24&255,h4>>16&255,h4>>8&255,255&h4]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var buffer=new ArrayBuffer(20),dataView=new DataView(buffer);return dataView.setUint32(0,this.h0),dataView.setUint32(4,this.h1),dataView.setUint32(8,this.h2),dataView.setUint32(12,this.h3),dataView.setUint32(16,this.h4),buffer};var messages=__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js");const getCacheKey=(...strings)=>{return message=strings.join("_"),new Sha1(!0).update(message).hex();var message};class BaseCache{}const GLOBAL_MAP=new Map;class InMemoryCache extends BaseCache{constructor(map){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=map??new Map}lookup(prompt,llmKey){return Promise.resolve(this.cache.get(getCacheKey(prompt,llmKey))??null)}update(prompt,llmKey,value){var _this=this;return(0,asyncToGenerator.Z)((function*(){_this.cache.set(getCacheKey(prompt,llmKey),value)}))()}static global(){return new InMemoryCache(GLOBAL_MAP)}}var prompt_values=__webpack_require__("./node_modules/@langchain/core/dist/prompt_values.js"),async_caller=__webpack_require__("./node_modules/@langchain/core/dist/utils/async_caller.js"),defineProperty=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),base64_js=__webpack_require__("./node_modules/base64-js/index.js"),__defProp=Object.defineProperty;function bytePairEncode(piece,ranks){return 1===piece.length?[ranks.get(piece.join(","))]:function bytePairMerge(piece,ranks){let parts=Array.from({length:piece.length},((_,i)=>({start:i,end:i+1})));for(;parts.length>1;){let minRank=null;for(let i=0;i<parts.length-1;i++){const slice=piece.slice(parts[i].start,parts[i+1].end),rank=ranks.get(slice.join(","));null!=rank&&(null==minRank||rank<minRank[0])&&(minRank=[rank,i])}if(null==minRank)break;{const i=minRank[1];parts[i]={start:parts[i].start,end:parts[i+1].end},parts.splice(i+1,1)}}return parts}(piece,ranks).map((p=>ranks.get(piece.slice(p.start,p.end).join(",")))).filter((x=>null!=x))}var key,Tiktoken=class _Tiktoken{constructor(ranks,extendedSpecialTokens){(0,defineProperty.Z)(this,"specialTokens",void 0),(0,defineProperty.Z)(this,"inverseSpecialTokens",void 0),(0,defineProperty.Z)(this,"patStr",void 0),(0,defineProperty.Z)(this,"textEncoder",new TextEncoder),(0,defineProperty.Z)(this,"textDecoder",new TextDecoder("utf-8")),(0,defineProperty.Z)(this,"rankMap",new Map),(0,defineProperty.Z)(this,"textMap",new Map),this.patStr=ranks.pat_str;const uncompressed=ranks.bpe_ranks.split("\n").filter(Boolean).reduce(((memo,x)=>{const[_,offsetStr,...tokens]=x.split(" "),offset=Number.parseInt(offsetStr,10);return tokens.forEach(((token,i)=>memo[token]=offset+i)),memo}),{});for(const[token,rank]of Object.entries(uncompressed)){const bytes=base64_js.toByteArray(token);this.rankMap.set(bytes.join(","),rank),this.textMap.set(rank,bytes)}this.specialTokens={...ranks.special_tokens,...extendedSpecialTokens},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((memo,[text,rank])=>(memo[rank]=this.textEncoder.encode(text),memo)),{})}encode(text,allowedSpecial=[],disallowedSpecial="all"){const regexes=new RegExp(this.patStr,"ug"),specialRegex=_Tiktoken.specialTokenRegex(Object.keys(this.specialTokens)),ret=[],allowedSpecialSet=new Set("all"===allowedSpecial?Object.keys(this.specialTokens):allowedSpecial),disallowedSpecialSet=new Set("all"===disallowedSpecial?Object.keys(this.specialTokens).filter((x=>!allowedSpecialSet.has(x))):disallowedSpecial);if(disallowedSpecialSet.size>0){const disallowedSpecialRegex=_Tiktoken.specialTokenRegex([...disallowedSpecialSet]),specialMatch=text.match(disallowedSpecialRegex);if(null!=specialMatch)throw new Error(`The text contains a special token that is not allowed: ${specialMatch[0]}`)}let start=0;for(;;){let nextSpecial=null,startFind=start;for(;specialRegex.lastIndex=startFind,nextSpecial=specialRegex.exec(text),null!=nextSpecial&&!allowedSpecialSet.has(nextSpecial[0]);)startFind=nextSpecial.index+1;const end=nextSpecial?.index??text.length;for(const match of text.substring(start,end).matchAll(regexes)){const piece=this.textEncoder.encode(match[0]),token2=this.rankMap.get(piece.join(","));null==token2?ret.push(...bytePairEncode(piece,this.rankMap)):ret.push(token2)}if(null==nextSpecial)break;let token=this.specialTokens[nextSpecial[0]];ret.push(token),start=nextSpecial.index+nextSpecial[0].length}return ret}decode(tokens){const res=[];let length=0;for(let i2=0;i2<tokens.length;++i2){const token=tokens[i2],bytes=this.textMap.get(token)??this.inverseSpecialTokens[token];null!=bytes&&(res.push(bytes),length+=bytes.length)}const mergedArray=new Uint8Array(length);let i=0;for(const bytes of res)mergedArray.set(bytes,i),i+=bytes.length;return this.textDecoder.decode(mergedArray)}};((obj,key,value)=>{key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value})(Tiktoken,"symbol"!=typeof(key="specialTokenRegex")?key+"":key,(tokens=>new RegExp(tokens.map((i=>function escapeRegex(str){return str.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(i))).join("|"),"g")));const cache={},caller=new async_caller.L({});function _getEncoding(){return(_getEncoding=(0,asyncToGenerator.Z)((function*(encoding){return encoding in cache||(cache[encoding]=caller.fetch(`https://tiktoken.pages.dev/js/${encoding}.json`).then((res=>res.json())).then((data=>new Tiktoken(data))).catch((e=>{throw delete cache[encoding],e}))),yield cache[encoding]}))).apply(this,arguments)}function _encodingForModel(){return _encodingForModel=(0,asyncToGenerator.Z)((function*(model){return function getEncoding(_x){return _getEncoding.apply(this,arguments)}(function getEncodingNameForModel(model){switch(model){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":return"o200k_base";default:throw new Error("Unknown model")}}(model))})),_encodingForModel.apply(this,arguments)}var base=__webpack_require__("./node_modules/@langchain/core/dist/runnables/base.js");const getModelNameForTiktoken=modelName=>modelName.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":modelName.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":modelName.startsWith("gpt-4-32k")?"gpt-4-32k":modelName.startsWith("gpt-4-")?"gpt-4":modelName.startsWith("gpt-4o")?"gpt-4o":modelName;class BaseLangChain extends base.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(params){super(params),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=params.verbose??!1,this.callbacks=params.callbacks,this.tags=params.tags??[],this.metadata=params.metadata??{}}}class BaseLanguageModel extends BaseLangChain{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks,callbackManager,...params}){super({callbacks:callbacks??callbackManager,...params}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof params.cache?this.cache=params.cache:params.cache?this.cache=InMemoryCache.global():this.cache=void 0,this.caller=new async_caller.L(params??{})}getNumTokens(content){var _this=this;return(0,asyncToGenerator.Z)((function*(){if("string"!=typeof content)return 0;let numTokens=Math.ceil(content.length/4);if(!_this._encoding)try{_this._encoding=yield function tiktoken_encodingForModel(_x2){return _encodingForModel.apply(this,arguments)}("modelName"in _this?getModelNameForTiktoken(_this.modelName):"gpt2")}catch(error){console.warn("Failed to calculate number of tokens, falling back to approximate count",error)}if(_this._encoding)try{numTokens=_this._encoding.encode(content).length}catch(error){console.warn("Failed to calculate number of tokens, falling back to approximate count",error)}return numTokens}))()}static _convertInputToPromptValue(input){return"string"==typeof input?new prompt_values.nw(input):Array.isArray(input)?new prompt_values.GU(input.map(messages.E1)):input}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config,...callOptions}){const params={...this._identifyingParams(),...callOptions,_type:this._llmType(),_model:this._modelType()},filteredEntries=Object.entries(params).filter((([_,value])=>void 0!==value)),serializedEntries=filteredEntries.map((([key,value])=>`${key}:${JSON.stringify(value)}`)).sort().join(",");return serializedEntries}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static deserialize(_data){return(0,asyncToGenerator.Z)((function*(){throw new Error("Use .toJSON() instead")}))()}}},"./node_modules/@langchain/core/dist/load/serializable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{i:()=>Serializable,j:()=>get_lc_unique_name});var decamelize=__webpack_require__("./node_modules/decamelize/index.js"),decamelize_default=__webpack_require__.n(decamelize);__webpack_require__("./node_modules/camelcase/index.js");function keyToJson(key,map){return map?.[key]||decamelize_default()(key)}function mapKeys(fields,mapper,map){const mapped={};for(const key in fields)Object.hasOwn(fields,key)&&(mapped[mapper(key,map)]=fields[key]);return mapped}function shallowCopy(obj){return Array.isArray(obj)?[...obj]:{...obj}}function replaceSecrets(root,secretsMap){const result=shallowCopy(root);for(const[path,secretId]of Object.entries(secretsMap)){const[last,...partsReverse]=path.split(".").reverse();let current=result;for(const part of partsReverse.reverse()){if(void 0===current[part])break;current[part]=shallowCopy(current[part]),current=current[part]}void 0!==current[last]&&(current[last]={lc:1,type:"secret",id:[secretId]})}return result}function get_lc_unique_name(serializableClass){const parentClass=Object.getPrototypeOf(serializableClass);return"function"==typeof serializableClass.lc_name&&("function"!=typeof parentClass.lc_name||serializableClass.lc_name()!==parentClass.lc_name())?serializableClass.lc_name():serializableClass.name}class Serializable{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,get_lc_unique_name(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(kwargs,..._args){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=kwargs||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Serializable||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const aliases={},secrets={},kwargs=Object.keys(this.lc_kwargs).reduce(((acc,key)=>(acc[key]=key in this?this[key]:this.lc_kwargs[key],acc)),{});for(let current=Object.getPrototypeOf(this);current;current=Object.getPrototypeOf(current))Object.assign(aliases,Reflect.get(current,"lc_aliases",this)),Object.assign(secrets,Reflect.get(current,"lc_secrets",this)),Object.assign(kwargs,Reflect.get(current,"lc_attributes",this));return Object.keys(secrets).forEach((keyPath=>{let read=this,write=kwargs;const[last,...partsReverse]=keyPath.split(".").reverse();for(const key of partsReverse.reverse()){if(!(key in read)||void 0===read[key])return;key in write&&void 0!==write[key]||("object"==typeof read[key]&&null!=read[key]?write[key]={}:Array.isArray(read[key])&&(write[key]=[])),read=read[key],write=write[key]}last in read&&void 0!==read[last]&&(write[last]=write[last]||read[last])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:mapKeys(Object.keys(secrets).length?replaceSecrets(kwargs,secrets):kwargs,keyToJson,aliases)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},"./node_modules/@langchain/core/dist/messages/ai.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{GC:()=>AIMessageChunk,Z0:()=>isAIMessage,gY:()=>AIMessage});var _utils_json_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/utils/json.js"),_base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js"),_tool_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/messages/tool.js");class AIMessage extends _base_js__WEBPACK_IMPORTED_MODULE_0__.ku{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(fields,kwargs){let initParams;if("string"==typeof fields)initParams={content:fields,tool_calls:[],invalid_tool_calls:[],additional_kwargs:kwargs??{}};else{initParams=fields;const rawToolCalls=initParams.additional_kwargs?.tool_calls,toolCalls=initParams.tool_calls;null!=rawToolCalls&&rawToolCalls.length>0&&(void 0===toolCalls||0===toolCalls.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=rawToolCalls&&void 0===toolCalls){const[toolCalls,invalidToolCalls]=(0,_tool_js__WEBPACK_IMPORTED_MODULE_1__.jC)(rawToolCalls);initParams.tool_calls=toolCalls??[],initParams.invalid_tool_calls=invalidToolCalls??[]}else initParams.tool_calls=initParams.tool_calls??[],initParams.invalid_tool_calls=initParams.invalid_tool_calls??[]}catch(e){initParams.tool_calls=[],initParams.invalid_tool_calls=[]}}super(initParams),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"string"!=typeof initParams&&(this.tool_calls=initParams.tool_calls??this.tool_calls,this.invalid_tool_calls=initParams.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=initParams.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}}function isAIMessage(x){return"ai"===x._getType()}class AIMessageChunk extends _base_js__WEBPACK_IMPORTED_MODULE_0__.$k{constructor(fields){let initParams;if("string"==typeof fields)initParams={content:fields,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===fields.tool_call_chunks)initParams={...fields,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const toolCalls=[],invalidToolCalls=[];for(const toolCallChunk of fields.tool_call_chunks){let parsedArgs={};try{if(parsedArgs=(0,_utils_json_js__WEBPACK_IMPORTED_MODULE_2__.g)(toolCallChunk.args??"{}")??{},"object"!=typeof parsedArgs||Array.isArray(parsedArgs))throw new Error("Malformed tool call chunk args.");toolCalls.push({name:toolCallChunk.name??"",args:parsedArgs,id:toolCallChunk.id})}catch(e){invalidToolCalls.push({name:toolCallChunk.name,args:toolCallChunk.args,id:toolCallChunk.id,error:"Malformed args."})}}initParams={...fields,tool_calls:toolCalls,invalid_tool_calls:invalidToolCalls}}super(initParams),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=initParams.tool_call_chunks??this.tool_call_chunks,this.tool_calls=initParams.tool_calls??this.tool_calls,this.invalid_tool_calls=initParams.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=initParams.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(chunk){const combinedFields={content:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.Wf)(this.content,chunk.content),additional_kwargs:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.additional_kwargs,chunk.additional_kwargs),response_metadata:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.response_metadata,chunk.response_metadata),tool_call_chunks:[]};if(void 0!==this.tool_call_chunks||void 0!==chunk.tool_call_chunks){const rawToolCalls=(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.eL)(this.tool_call_chunks,chunk.tool_call_chunks);void 0!==rawToolCalls&&rawToolCalls.length>0&&(combinedFields.tool_call_chunks=rawToolCalls)}if(void 0!==this.usage_metadata||void 0!==chunk.usage_metadata){const left=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},right=chunk.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},usage_metadata={input_tokens:left.input_tokens+right.input_tokens,output_tokens:left.output_tokens+right.output_tokens,total_tokens:left.total_tokens+right.total_tokens};combinedFields.usage_metadata=usage_metadata}return new AIMessageChunk(combinedFields)}}},"./node_modules/@langchain/core/dist/messages/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$k:()=>BaseMessageChunk,QW:()=>isBaseMessage,Wf:()=>mergeContent,a2:()=>isBaseMessageChunk,eL:()=>_mergeLists,ku:()=>BaseMessage,wv:()=>_mergeDicts});var _load_serializable_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/load/serializable.js");function mergeContent(firstContent,secondContent){return"string"==typeof firstContent?"string"==typeof secondContent?firstContent+secondContent:[{type:"text",text:firstContent},...secondContent]:Array.isArray(secondContent)?[...firstContent,...secondContent]:[...firstContent,{type:"text",text:secondContent}]}class BaseMessage extends _load_serializable_js__WEBPACK_IMPORTED_MODULE_0__.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(fields,kwargs){"string"==typeof fields&&(fields={content:fields,additional_kwargs:kwargs,response_metadata:{}}),fields.additional_kwargs||(fields.additional_kwargs={}),fields.response_metadata||(fields.response_metadata={}),super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=fields.name,this.content=fields.content,this.additional_kwargs=fields.additional_kwargs,this.response_metadata=fields.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function _mergeDicts(left,right){const merged={...left};for(const[key,value]of Object.entries(right))if(null==merged[key])merged[key]=value;else{if(null==value)continue;if(typeof merged[key]!=typeof value||Array.isArray(merged[key])!==Array.isArray(value))throw new Error(`field[${key}] already exists in the message chunk, but with a different type.`);if("string"==typeof merged[key])merged[key]=merged[key]+value;else if(Array.isArray(merged[key])||"object"!=typeof merged[key])if(Array.isArray(merged[key]))merged[key]=_mergeLists(merged[key],value);else{if(merged[key]===value)continue;console.warn(`field[${key}] already exists in this message chunk and value has unsupported type.`)}else merged[key]=_mergeDicts(merged[key],value)}return merged}function _mergeLists(left,right){if(void 0!==left||void 0!==right){if(void 0===left||void 0===right)return left||right;{const merged=[...left];for(const item of right)if("object"==typeof item&&"index"in item&&"number"==typeof item.index){const toMerge=merged.findIndex((leftItem=>leftItem.index===item.index));-1!==toMerge?merged[toMerge]=_mergeDicts(merged[toMerge],item):merged.push(item)}else merged.push(item);return merged}}}class BaseMessageChunk extends BaseMessage{}function isBaseMessage(messageLike){return"function"==typeof messageLike?._getType}function isBaseMessageChunk(messageLike){return isBaseMessage(messageLike)&&"function"==typeof messageLike.concat}},"./node_modules/@langchain/core/dist/messages/chat.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{H:()=>ChatMessageChunk,J:()=>ChatMessage});var _base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js");class ChatMessage extends _base_js__WEBPACK_IMPORTED_MODULE_0__.ku{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return ChatMessage}constructor(fields,role){"string"==typeof fields&&(fields={content:fields,role}),super(fields),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=fields.role}_getType(){return"generic"}static isInstance(message){return"generic"===message._getType()}}class ChatMessageChunk extends _base_js__WEBPACK_IMPORTED_MODULE_0__.$k{static lc_name(){return"ChatMessageChunk"}constructor(fields,role){"string"==typeof fields&&(fields={content:fields,role}),super(fields),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=fields.role}_getType(){return"generic"}concat(chunk){return new ChatMessageChunk({content:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.Wf)(this.content,chunk.content),additional_kwargs:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.additional_kwargs,chunk.additional_kwargs),response_metadata:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.response_metadata,chunk.response_metadata),role:this.role})}}},"./node_modules/@langchain/core/dist/messages/function.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C:()=>FunctionMessageChunk});var _base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js");class FunctionMessageChunk extends _base_js__WEBPACK_IMPORTED_MODULE_0__.$k{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(chunk){return new FunctionMessageChunk({content:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.Wf)(this.content,chunk.content),additional_kwargs:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.additional_kwargs,chunk.additional_kwargs),response_metadata:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.response_metadata,chunk.response_metadata),name:this.name??""})}}},"./node_modules/@langchain/core/dist/messages/human.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{r:()=>HumanMessageChunk,x:()=>HumanMessage});var _base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js");class HumanMessage extends _base_js__WEBPACK_IMPORTED_MODULE_0__.ku{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class HumanMessageChunk extends _base_js__WEBPACK_IMPORTED_MODULE_0__.$k{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(chunk){return new HumanMessageChunk({content:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.Wf)(this.content,chunk.content),additional_kwargs:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.additional_kwargs,chunk.additional_kwargs),response_metadata:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.response_metadata,chunk.response_metadata)})}}},"./node_modules/@langchain/core/dist/messages/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Cq:()=>_tool_js__WEBPACK_IMPORTED_MODULE_7__.Cq,Cr:()=>_function_js__WEBPACK_IMPORTED_MODULE_3__.C,E1:()=>_utils_js__WEBPACK_IMPORTED_MODULE_6__.E1,GC:()=>_ai_js__WEBPACK_IMPORTED_MODULE_0__.GC,HD:()=>_chat_js__WEBPACK_IMPORTED_MODULE_2__.H,J:()=>_chat_js__WEBPACK_IMPORTED_MODULE_2__.J,QW:()=>_base_js__WEBPACK_IMPORTED_MODULE_1__.QW,Xz:()=>_tool_js__WEBPACK_IMPORTED_MODULE_7__.Xz,Z0:()=>_ai_js__WEBPACK_IMPORTED_MODULE_0__.Z0,gY:()=>_ai_js__WEBPACK_IMPORTED_MODULE_0__.gY,jN:()=>_system_js__WEBPACK_IMPORTED_MODULE_5__.j,ku:()=>_base_js__WEBPACK_IMPORTED_MODULE_1__.ku,ro:()=>_human_js__WEBPACK_IMPORTED_MODULE_4__.r,xk:()=>_human_js__WEBPACK_IMPORTED_MODULE_4__.x,xq:()=>_system_js__WEBPACK_IMPORTED_MODULE_5__.x,zs:()=>_utils_js__WEBPACK_IMPORTED_MODULE_6__.zs});var _ai_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/ai.js"),_base_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js"),_chat_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/messages/chat.js"),_function_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@langchain/core/dist/messages/function.js"),_human_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@langchain/core/dist/messages/human.js"),_system_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@langchain/core/dist/messages/system.js"),_utils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@langchain/core/dist/messages/utils.js"),_tool_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@langchain/core/dist/messages/tool.js")},"./node_modules/@langchain/core/dist/messages/system.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{j:()=>SystemMessage,x:()=>SystemMessageChunk});var _base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js");class SystemMessage extends _base_js__WEBPACK_IMPORTED_MODULE_0__.ku{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class SystemMessageChunk extends _base_js__WEBPACK_IMPORTED_MODULE_0__.$k{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(chunk){return new SystemMessageChunk({content:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.Wf)(this.content,chunk.content),additional_kwargs:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.additional_kwargs,chunk.additional_kwargs),response_metadata:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.response_metadata,chunk.response_metadata)})}}},"./node_modules/@langchain/core/dist/messages/tool.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Cq:()=>ToolMessage,Xz:()=>ToolMessageChunk,jC:()=>defaultToolCallParser});var _base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js");class ToolMessage extends _base_js__WEBPACK_IMPORTED_MODULE_0__.ku{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(fields,tool_call_id,name){"string"==typeof fields&&(fields={content:fields,name,tool_call_id}),super(fields),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=fields.tool_call_id}_getType(){return"tool"}static isInstance(message){return"tool"===message._getType()}}class ToolMessageChunk extends _base_js__WEBPACK_IMPORTED_MODULE_0__.$k{constructor(fields){super(fields),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=fields.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(chunk){return new ToolMessageChunk({content:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.Wf)(this.content,chunk.content),additional_kwargs:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.additional_kwargs,chunk.additional_kwargs),response_metadata:(0,_base_js__WEBPACK_IMPORTED_MODULE_0__.wv)(this.response_metadata,chunk.response_metadata),tool_call_id:this.tool_call_id})}}function defaultToolCallParser(rawToolCalls){const toolCalls=[],invalidToolCalls=[];for(const toolCall of rawToolCalls)if(toolCall.function){const functionName=toolCall.function.name;try{const parsed={name:functionName||"",args:JSON.parse(toolCall.function.arguments)||{},id:toolCall.id};toolCalls.push(parsed)}catch(error){invalidToolCalls.push({name:functionName,args:toolCall.function.arguments,id:toolCall.id,error:"Malformed args."})}}return[toolCalls,invalidToolCalls]}},"./node_modules/@langchain/core/dist/messages/utils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E1:()=>coerceMessageLikeToMessage,Oy:()=>convertToChunk,zs:()=>getBufferString});var _base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js"),_human_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/messages/human.js"),_ai_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/messages/ai.js"),_system_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@langchain/core/dist/messages/system.js"),_chat_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@langchain/core/dist/messages/chat.js"),_function_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@langchain/core/dist/messages/function.js");__webpack_require__("./node_modules/@langchain/core/dist/messages/tool.js");function coerceMessageLikeToMessage(messageLike){if("string"==typeof messageLike)return new _human_js__WEBPACK_IMPORTED_MODULE_1__.x(messageLike);if((0,_base_js__WEBPACK_IMPORTED_MODULE_0__.QW)(messageLike))return messageLike;const[type,content]=messageLike;if("human"===type||"user"===type)return new _human_js__WEBPACK_IMPORTED_MODULE_1__.x({content});if("ai"===type||"assistant"===type)return new _ai_js__WEBPACK_IMPORTED_MODULE_2__.gY({content});if("system"===type)return new _system_js__WEBPACK_IMPORTED_MODULE_3__.j({content});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function getBufferString(messages,humanPrefix="Human",aiPrefix="AI"){const string_messages=[];for(const m of messages){let role;if("human"===m._getType())role=humanPrefix;else if("ai"===m._getType())role=aiPrefix;else if("system"===m._getType())role="System";else if("function"===m._getType())role="Function";else if("tool"===m._getType())role="Tool";else{if("generic"!==m._getType())throw new Error(`Got unsupported message type: ${m._getType()}`);role=m.role}const nameStr=m.name?`${m.name}, `:"";string_messages.push(`${role}: ${nameStr}${m.content}`)}return string_messages.join("\n")}function convertToChunk(message){const type=message._getType();if("human"===type)return new _human_js__WEBPACK_IMPORTED_MODULE_1__.r({...message});if("ai"===type)return new _ai_js__WEBPACK_IMPORTED_MODULE_2__.GC({...message});if("system"===type)return new _system_js__WEBPACK_IMPORTED_MODULE_3__.x({...message});if("function"===type)return new _function_js__WEBPACK_IMPORTED_MODULE_5__.C({...message});if(_chat_js__WEBPACK_IMPORTED_MODULE_4__.J.isInstance(message))return new _chat_js__WEBPACK_IMPORTED_MODULE_4__.H({...message});throw new Error("Unknown message type.")}},"./node_modules/@langchain/core/dist/output_parsers/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{bI:()=>BaseOutputParser,dS:()=>OutputParserException,tw:()=>BaseLLMOutputParser});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_runnables_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/runnables/index.js");class BaseLLMOutputParser extends _runnables_index_js__WEBPACK_IMPORTED_MODULE_0__.eq{parseResultWithPrompt(generations,_prompt,callbacks){return this.parseResult(generations,callbacks)}_baseMessageToString(message){return"string"==typeof message.content?message.content:this._baseMessageContentToString(message.content)}_baseMessageContentToString(content){return JSON.stringify(content)}invoke(input,options){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){return"string"==typeof input?_this._callWithConfig(function(){var _ref=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(input,options){return _this.parseResult([{text:input}],options?.callbacks)}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),input,{...options,runType:"parser"}):_this._callWithConfig(function(){var _ref2=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(input,options){return _this.parseResult([{message:input,text:_this._baseMessageToString(input)}],options?.callbacks)}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}(),input,{...options,runType:"parser"})}))()}}class BaseOutputParser extends BaseLLMOutputParser{parseResult(generations,callbacks){return this.parse(generations[0].text,callbacks)}parseWithPrompt(text,_prompt,callbacks){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){return _this2.parse(text,callbacks)}))()}_type(){throw new Error("_type not implemented")}}class OutputParserException extends Error{constructor(message,llmOutput,observation,sendToLLM=!1){if(super(message),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=llmOutput,this.observation=observation,this.sendToLLM=sendToLLM,sendToLLM&&(void 0===observation||void 0===llmOutput))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}},"./node_modules/@langchain/core/dist/output_parsers/json.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Qh:()=>JsonOutputParser,gP:()=>_utils_json_js__WEBPACK_IMPORTED_MODULE_3__.g});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_transform_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/output_parsers/transform.js"),_utils_json_patch_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/utils/json_patch.js"),_utils_json_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@langchain/core/dist/utils/json.js");class JsonOutputParser extends _transform_js__WEBPACK_IMPORTED_MODULE_0__.g{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(prev,next){if(next)return prev?(0,_utils_json_patch_js__WEBPACK_IMPORTED_MODULE_1__.q)(prev,next):[{op:"replace",path:"",value:next}]}parsePartialResult(generations){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){return(0,_utils_json_js__WEBPACK_IMPORTED_MODULE_3__.M)(generations[0].text)}))()}parse(text){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){return(0,_utils_json_js__WEBPACK_IMPORTED_MODULE_3__.M)(text,JSON.parse)}))()}getFormatInstructions(){return""}}},"./node_modules/@langchain/core/dist/output_parsers/transform.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{g:()=>BaseCumulativeTransformOutputParser,G:()=>BaseTransformOutputParser});var asyncGeneratorDelegate=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncGeneratorDelegate.js"),awaitAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),wrapAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),asyncIterator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js"),base=__webpack_require__("./node_modules/@langchain/core/dist/output_parsers/base.js"),messages_base=__webpack_require__("./node_modules/@langchain/core/dist/messages/base.js"),utils=__webpack_require__("./node_modules/@langchain/core/dist/messages/utils.js"),outputs=__webpack_require__("./node_modules/@langchain/core/dist/outputs.js");function deep_compare_strict_deepCompareStrict(a,b){const typeofa=typeof a;if(typeofa!==typeof b)return!1;if(Array.isArray(a)){if(!Array.isArray(b))return!1;const length=a.length;if(length!==b.length)return!1;for(let i=0;i<length;i++)if(!deep_compare_strict_deepCompareStrict(a[i],b[i]))return!1;return!0}if("object"===typeofa){if(!a||!b)return a===b;const aKeys=Object.keys(a),bKeys=Object.keys(b);if(aKeys.length!==bKeys.length)return!1;for(const k of aKeys)if(!deep_compare_strict_deepCompareStrict(a[k],b[k]))return!1;return!0}return a===b}"undefined"!=typeof self&&self.location&&"null"!==self.location.origin&&(self.location.origin,self.location.pathname,location.search);const DATE=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,DAYS=[0,31,28,31,30,31,30,31,31,30,31,30,31],TIME=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,HOSTNAME=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,URIREF=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,URITEMPLATE=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,URL_=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,UUID=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,JSON_POINTER=/^(?:\/(?:[^~/]|~0|~1)*)*$/,JSON_POINTER_URI_FRAGMENT=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,RELATIVE_JSON_POINTER=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,FASTDATE=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,FASTTIME=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,FASTDATETIME=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,FASTURIREFERENCE=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,IPV4=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,IPV6=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i;function bind(r){return r.test.bind(r)}function date(str){const matches=str.match(DATE);if(!matches)return!1;const year=+matches[1],month=+matches[2],day=+matches[3];return month>=1&&month<=12&&day>=1&&day<=(2==month&&function isLeapYear(year){return year%4==0&&(year%100!=0||year%400==0)}(year)?29:DAYS[month])}function time(full,str){const matches=str.match(TIME);if(!matches)return!1;const hour=+matches[1],minute=+matches[2],second=+matches[3],timeZone=!!matches[5];return(hour<=23&&minute<=59&&second<=59||23==hour&&59==minute&&60==second)&&(!full||timeZone)}const DATE_TIME_SEPARATOR=/t|\s/i;const NOT_URI_FRAGMENT=/\/|:/,URI_PATTERN=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;const Z_ANCHOR=/[^\\]\\Z/;class BaseTransformOutputParser extends base.bI{_transform(inputGenerator){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(inputGenerator);_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;"string"==typeof chunk?yield _this.parseResult([{text:chunk}]):yield _this.parseResult([{message:chunk,text:_this._baseMessageToString(chunk)}])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}}))()}transform(inputGenerator,options){var _this2=this;return(0,wrapAsyncGenerator.Z)((function*(){yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(_this2._transformStreamWithConfig(inputGenerator,_this2._transform.bind(_this2),{...options,runType:"parser"})),awaitAsyncGenerator.Z)}))()}}class BaseCumulativeTransformOutputParser extends BaseTransformOutputParser{constructor(fields){super(fields),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=fields?.diff??this.diff}_transform(inputGenerator){var _this3=this;return(0,wrapAsyncGenerator.Z)((function*(){let prevParsed,accGen;var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(inputGenerator);_iteratorAbruptCompletion2=!(_step2=yield(0,awaitAsyncGenerator.Z)(_iterator2.next())).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;{if("string"!=typeof chunk&&"string"!=typeof chunk.content)throw new Error("Cannot handle non-string output.");let chunkGen;if((0,messages_base.a2)(chunk)){if("string"!=typeof chunk.content)throw new Error("Cannot handle non-string message output.");chunkGen=new outputs.Ls({message:chunk,text:chunk.content})}else if((0,messages_base.QW)(chunk)){if("string"!=typeof chunk.content)throw new Error("Cannot handle non-string message output.");chunkGen=new outputs.Ls({message:(0,utils.Oy)(chunk),text:chunk.content})}else chunkGen=new outputs.b6({text:chunk});accGen=void 0===accGen?chunkGen:accGen.concat(chunkGen);const parsed=yield(0,awaitAsyncGenerator.Z)(_this3.parsePartialResult([accGen]));null==parsed||deep_compare_strict_deepCompareStrict(parsed,prevParsed)||(_this3.diff?yield _this3._diff(prevParsed,parsed):yield parsed,prevParsed=parsed)}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator2.return()))}finally{if(_didIteratorError2)throw _iteratorError2}}}))()}}},"./node_modules/@langchain/core/dist/outputs.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ls:()=>ChatGenerationChunk,WH:()=>RUN_KEY,b6:()=>GenerationChunk});const RUN_KEY="__run";class GenerationChunk{constructor(fields){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=fields.text,this.generationInfo=fields.generationInfo}concat(chunk){return new GenerationChunk({text:this.text+chunk.text,generationInfo:{...this.generationInfo,...chunk.generationInfo}})}}class ChatGenerationChunk extends GenerationChunk{constructor(fields){super(fields),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=fields.message}concat(chunk){return new ChatGenerationChunk({text:this.text+chunk.text,generationInfo:{...this.generationInfo,...chunk.generationInfo},message:this.message.concat(chunk.message)})}}},"./node_modules/@langchain/core/dist/prompt_values.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{GU:()=>ChatPromptValue,Nn:()=>ImagePromptValue,nw:()=>StringPromptValue});var _load_serializable_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/load/serializable.js"),_messages_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js");class BasePromptValue extends _load_serializable_js__WEBPACK_IMPORTED_MODULE_0__.i{}class StringPromptValue extends BasePromptValue{static lc_name(){return"StringPromptValue"}constructor(value){super({value}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=value}toString(){return this.value}toChatMessages(){return[new _messages_index_js__WEBPACK_IMPORTED_MODULE_1__.xk(this.value)]}}class ChatPromptValue extends BasePromptValue{static lc_name(){return"ChatPromptValue"}constructor(fields){Array.isArray(fields)&&(fields={messages:fields}),super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=fields.messages}toString(){return(0,_messages_index_js__WEBPACK_IMPORTED_MODULE_1__.zs)(this.messages)}toChatMessages(){return this.messages}}class ImagePromptValue extends BasePromptValue{static lc_name(){return"ImagePromptValue"}constructor(fields){"imageUrl"in fields||(fields={imageUrl:fields}),super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=fields.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new _messages_index_js__WEBPACK_IMPORTED_MODULE_1__.xk({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},"./node_modules/@langchain/core/dist/prompts/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{d:()=>BasePromptTemplate});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_runnables_base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/runnables/base.js");class BasePromptTemplate extends _runnables_base_js__WEBPACK_IMPORTED_MODULE_0__.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(input){super(input),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables}=input;if(inputVariables.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,input)}mergePartialAndUserVariables(userVariables){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const partialVariables=_this.partialVariables??{},partialValues={};for(const[key,value]of Object.entries(partialVariables))partialValues[key]="string"==typeof value?value:yield value();return{...partialValues,...userVariables}}))()}invoke(input,options){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){return _this2._callWithConfig((input=>_this2.formatPromptValue(input)),input,{...options,runType:"prompt"})}))()}serialize(){throw new Error("Use .toJSON() instead")}static deserialize(data){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){switch(data._type){case"prompt":{const{PromptTemplate}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@langchain/core/dist/prompts/prompt.js"));return PromptTemplate.deserialize(data)}case void 0:{const{PromptTemplate}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@langchain/core/dist/prompts/prompt.js"));return PromptTemplate.deserialize({...data,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@langchain/core/dist/prompts/few_shot.js"));return FewShotPromptTemplate.deserialize(data)}default:throw new Error(`Invalid prompt type in config: ${data._type}`)}}))()}}},"./node_modules/@langchain/core/dist/prompts/chat.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{S:()=>BaseChatPromptTemplate,ax:()=>MessagesPlaceholder,gc:()=>AIMessagePromptTemplate,kq:()=>HumanMessagePromptTemplate,ks:()=>ChatPromptTemplate,ov:()=>SystemMessagePromptTemplate});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_messages_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js"),_prompt_values_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/prompt_values.js"),_runnables_base_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/runnables/base.js"),_string_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/string.js"),_base_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/base.js"),_prompt_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/prompt.js"),_image_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/image.js"),_template_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/template.js");class BaseMessagePromptTemplate extends _runnables_base_js__WEBPACK_IMPORTED_MODULE_2__.eq{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}invoke(input,options){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){return _this._callWithConfig((input=>_this.formatMessages(input)),input,{...options,runType:"prompt"})}))()}}class MessagesPlaceholder extends BaseMessagePromptTemplate{static lc_name(){return"MessagesPlaceholder"}constructor(fields){"string"==typeof fields&&(fields={variableName:fields}),super(fields),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=fields.variableName,this.optional=fields.optional??!1}get inputVariables(){return[this.variableName]}validateInputOrThrow(input,variableName){if(this.optional&&!input)return!1;if(!input){const error=new Error(`Error: Field "${variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw error.name="InputFormatError",error}let isInputBaseMessage=!1;if(isInputBaseMessage=Array.isArray(input)?input.every((message=>(0,_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.QW)(message))):(0,_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.QW)(input),!isInputBaseMessage){const readableInput="string"==typeof input?input:JSON.stringify(input,null,2),error=new Error(`Error: Field "${variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${readableInput}`);throw error.name="InputFormatError",error}return!0}formatMessages(values){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){return _this2.validateInputOrThrow(values[_this2.variableName],_this2.variableName),values[_this2.variableName]??[]}))()}}class BaseMessageStringPromptTemplate extends BaseMessagePromptTemplate{constructor(fields){"prompt"in fields||(fields={prompt:fields}),super(fields),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=fields.prompt}get inputVariables(){return this.prompt.inputVariables}formatMessages(values){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){return[yield _this3.format(values)]}))()}}class BaseChatPromptTemplate extends _base_js__WEBPACK_IMPORTED_MODULE_4__.d{constructor(input){super(input)}format(values){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){return(yield _this4.formatPromptValue(values)).toString()}))()}formatPromptValue(values){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){const resultMessages=yield _this5.formatMessages(values);return new _prompt_values_js__WEBPACK_IMPORTED_MODULE_1__.GU(resultMessages)}))()}}class ChatMessagePromptTemplate extends BaseMessageStringPromptTemplate{static lc_name(){return"ChatMessagePromptTemplate"}constructor(fields,role){"prompt"in fields||(fields={prompt:fields,role}),super(fields),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=fields.role}format(values){var _this6=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){return new _messages_index_js__WEBPACK_IMPORTED_MODULE_0__.J(yield _this6.prompt.format(values),_this6.role)}))()}static fromTemplate(template,role,options){return new this(_prompt_js__WEBPACK_IMPORTED_MODULE_5__.PromptTemplate.fromTemplate(template,{templateFormat:options?.templateFormat}),role)}}class _StringImageMessagePromptTemplate extends BaseMessagePromptTemplate{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(fields,additionalOptions){if("prompt"in fields||(fields={prompt:fields}),super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=fields.prompt,Array.isArray(this.prompt)){let inputVariables=[];this.prompt.forEach((prompt=>{"inputVariables"in prompt&&(inputVariables=inputVariables.concat(prompt.inputVariables))})),this.inputVariables=inputVariables}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=additionalOptions??this.additionalOptions}createMessage(content){const constructor=this.constructor;if(constructor._messageClass()){return new(constructor._messageClass())({content})}if(constructor.chatMessageClass){const MsgClass=constructor.chatMessageClass();return new MsgClass({content,role:this.getRoleFromMessageClass(MsgClass.lc_name())})}throw new Error("No message class defined")}getRoleFromMessageClass(name){switch(name){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(template,additionalOptions){if("string"==typeof template)return new this(_prompt_js__WEBPACK_IMPORTED_MODULE_5__.PromptTemplate.fromTemplate(template,additionalOptions));const prompt=[];for(const item of template)if("string"==typeof item||"object"==typeof item&&"text"in item){let text="";"string"==typeof item?text=item:"string"==typeof item.text&&(text=item.text??""),prompt.push(_prompt_js__WEBPACK_IMPORTED_MODULE_5__.PromptTemplate.fromTemplate(text))}else if("object"==typeof item&&"image_url"in item){let imgTemplateObject,imgTemplate=item.image_url??"",inputVariables=[];if("string"==typeof imgTemplate){const variables=(0,_template_js__WEBPACK_IMPORTED_MODULE_7__._O)(imgTemplate).flatMap((item=>"variable"===item.type?[item.name]:[]));if((variables?.length??0)>0){if(variables.length>1)throw new Error(`Only one format variable allowed per image template.\nGot: ${variables}\nFrom: ${imgTemplate}`);inputVariables=[variables[0]]}else inputVariables=[];imgTemplate={url:imgTemplate},imgTemplateObject=new _image_js__WEBPACK_IMPORTED_MODULE_6__.r({template:imgTemplate,inputVariables})}else{if("object"!=typeof imgTemplate)throw new Error("Invalid image template");if("url"in imgTemplate){inputVariables=(0,_template_js__WEBPACK_IMPORTED_MODULE_7__._O)(imgTemplate.url).flatMap((item=>"variable"===item.type?[item.name]:[]))}else inputVariables=[];imgTemplateObject=new _image_js__WEBPACK_IMPORTED_MODULE_6__.r({template:imgTemplate,inputVariables})}prompt.push(imgTemplateObject)}return new this({prompt,additionalOptions})}format(input){var _this7=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){if(_this7.prompt instanceof _string_js__WEBPACK_IMPORTED_MODULE_3__.A){const text=yield _this7.prompt.format(input);return _this7.createMessage(text)}{const content=[];for(const prompt of _this7.prompt){let inputs={};if(!("inputVariables"in prompt))throw new Error(`Prompt ${prompt} does not have inputVariables defined.`);for(const item of prompt.inputVariables)inputs||(inputs={[item]:input[item]}),inputs={...inputs,[item]:input[item]};if(prompt instanceof _string_js__WEBPACK_IMPORTED_MODULE_3__.A){const formatted=yield prompt.format(inputs);content.push({type:"text",text:formatted})}else if(prompt instanceof _image_js__WEBPACK_IMPORTED_MODULE_6__.r){const formatted=yield prompt.format(inputs);content.push({type:"image_url",image_url:formatted})}}return _this7.createMessage(content)}}))()}formatMessages(values){var _this8=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){return[yield _this8.format(values)]}))()}}class HumanMessagePromptTemplate extends _StringImageMessagePromptTemplate{static _messageClass(){return _messages_index_js__WEBPACK_IMPORTED_MODULE_0__.xk}static lc_name(){return"HumanMessagePromptTemplate"}}class AIMessagePromptTemplate extends _StringImageMessagePromptTemplate{static _messageClass(){return _messages_index_js__WEBPACK_IMPORTED_MODULE_0__.gY}static lc_name(){return"AIMessagePromptTemplate"}}class SystemMessagePromptTemplate extends _StringImageMessagePromptTemplate{static _messageClass(){return _messages_index_js__WEBPACK_IMPORTED_MODULE_0__.jN}static lc_name(){return"SystemMessagePromptTemplate"}}function _coerceMessagePromptTemplateLike(messagePromptTemplateLike,extra){if(function _isBaseMessagePromptTemplate(baseMessagePromptTemplateLike){return"function"==typeof baseMessagePromptTemplateLike.formatMessages}(messagePromptTemplateLike)||(0,_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.QW)(messagePromptTemplateLike))return messagePromptTemplateLike;if(Array.isArray(messagePromptTemplateLike)&&"placeholder"===messagePromptTemplateLike[0]){const messageContent=messagePromptTemplateLike[1];if("string"!=typeof messageContent||"{"!==messageContent[0]||"}"!==messageContent[messageContent.length-1])throw new Error(`Invalid placeholder template: "${messagePromptTemplateLike[1]}". Expected a variable name surrounded by curly braces.`);const variableName=messageContent.slice(1,-1);return new MessagesPlaceholder({variableName,optional:!0})}const message=(0,_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.E1)(messagePromptTemplateLike);let templateData;if(templateData="string"==typeof message.content?message.content:message.content.map((item=>"text"in item?{text:item.text}:"image_url"in item?{image_url:item.image_url}:item)),"human"===message._getType())return HumanMessagePromptTemplate.fromTemplate(templateData,extra);if("ai"===message._getType())return AIMessagePromptTemplate.fromTemplate(templateData,extra);if("system"===message._getType())return SystemMessagePromptTemplate.fromTemplate(templateData,extra);if(_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.J.isInstance(message))return ChatMessagePromptTemplate.fromTemplate(message.content,message.role,extra);throw new Error(`Could not coerce message prompt template from input. Received message type: "${message._getType()}".`)}class ChatPromptTemplate extends BaseChatPromptTemplate{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(input){if(super(input),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),"mustache"===input.templateFormat&&void 0===input.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,input),this.validateTemplate){const inputVariablesMessages=new Set;for(const promptMessage of this.promptMessages)if(!(promptMessage instanceof _messages_index_js__WEBPACK_IMPORTED_MODULE_0__.ku))for(const inputVariable of promptMessage.inputVariables)inputVariablesMessages.add(inputVariable);const totalInputVariables=this.inputVariables,inputVariablesInstance=new Set(this.partialVariables?totalInputVariables.concat(Object.keys(this.partialVariables)):totalInputVariables),difference=new Set([...inputVariablesInstance].filter((x=>!inputVariablesMessages.has(x))));if(difference.size>0)throw new Error(`Input variables \`${[...difference]}\` are not used in any of the prompt messages.`);const otherDifference=new Set([...inputVariablesMessages].filter((x=>!inputVariablesInstance.has(x))));if(otherDifference.size>0)throw new Error(`Input variables \`${[...otherDifference]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}_parseImagePrompts(message,inputValues){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){if("string"==typeof message.content)return message;const formattedMessageContent=yield Promise.all(message.content.map(function(){var _ref=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(item){if("image_url"!==item.type)return item;let imageUrl="";imageUrl="string"==typeof item.image_url?item.image_url:item.image_url.url;const promptTemplatePlaceholder=_prompt_js__WEBPACK_IMPORTED_MODULE_5__.PromptTemplate.fromTemplate(imageUrl),formattedUrl=yield promptTemplatePlaceholder.format(inputValues);return"string"!=typeof item.image_url&&"url"in item.image_url?item.image_url.url=formattedUrl:item.image_url=formattedUrl,item}));return function(_x){return _ref.apply(this,arguments)}}()));return message.content=formattedMessageContent,message}))()}formatMessages(values){var _this9=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){const allValues=yield _this9.mergePartialAndUserVariables(values);let resultMessages=[];for(const promptMessage of _this9.promptMessages)if(promptMessage instanceof _messages_index_js__WEBPACK_IMPORTED_MODULE_0__.ku)resultMessages.push(yield _this9._parseImagePrompts(promptMessage,allValues));else{const inputValues=promptMessage.inputVariables.reduce(((acc,inputVariable)=>{if(!(inputVariable in allValues)&&("MessagesPlaceholder"!==promptMessage.constructor.lc_name()||!promptMessage.optional))throw new Error(`Missing value for input variable \`${inputVariable.toString()}\``);return acc[inputVariable]=allValues[inputVariable],acc}),{}),message=yield promptMessage.formatMessages(inputValues);resultMessages=resultMessages.concat(message)}return resultMessages}))()}partial(values){var _this10=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_8__.Z)((function*(){const newInputVariables=_this10.inputVariables.filter((iv=>!(iv in values))),newPartialVariables={..._this10.partialVariables??{},...values},promptDict={..._this10,inputVariables:newInputVariables,partialVariables:newPartialVariables};return new ChatPromptTemplate(promptDict)}))()}static fromTemplate(template,options){const prompt=_prompt_js__WEBPACK_IMPORTED_MODULE_5__.PromptTemplate.fromTemplate(template,options),humanTemplate=new HumanMessagePromptTemplate({prompt});return this.fromMessages([humanTemplate])}static fromMessages(promptMessages,extra){const flattenedMessages=promptMessages.reduce(((acc,promptMessage)=>acc.concat(promptMessage instanceof ChatPromptTemplate?promptMessage.promptMessages:[_coerceMessagePromptTemplateLike(promptMessage,extra)])),[]),flattenedPartialVariables=promptMessages.reduce(((acc,promptMessage)=>promptMessage instanceof ChatPromptTemplate?Object.assign(acc,promptMessage.partialVariables):acc),Object.create(null)),inputVariables=new Set;for(const promptMessage of flattenedMessages)if(!(promptMessage instanceof _messages_index_js__WEBPACK_IMPORTED_MODULE_0__.ku))for(const inputVariable of promptMessage.inputVariables)inputVariable in flattenedPartialVariables||inputVariables.add(inputVariable);return new this({...extra,inputVariables:[...inputVariables],promptMessages:flattenedMessages,partialVariables:flattenedPartialVariables,templateFormat:extra?.templateFormat})}static fromPromptMessages(promptMessages){return this.fromMessages(promptMessages)}}},"./node_modules/@langchain/core/dist/prompts/few_shot.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{FewShotChatMessagePromptTemplate:()=>FewShotChatMessagePromptTemplate,FewShotPromptTemplate:()=>FewShotPromptTemplate});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_string_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/string.js"),_template_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/template.js"),_prompt_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/prompt.js"),_chat_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/chat.js");class FewShotPromptTemplate extends _string_js__WEBPACK_IMPORTED_MODULE_0__.A{constructor(input){if(super(input),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,input),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let totalInputVariables=this.inputVariables;this.partialVariables&&(totalInputVariables=totalInputVariables.concat(Object.keys(this.partialVariables))),(0,_template_js__WEBPACK_IMPORTED_MODULE_1__.af)(this.prefix+this.suffix,this.templateFormat,totalInputVariables)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}getExamples(inputVariables){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){if(void 0!==_this.examples)return _this.examples;if(void 0!==_this.exampleSelector)return _this.exampleSelector.selectExamples(inputVariables);throw new Error("One of 'examples' and 'example_selector' should be provided")}))()}partial(values){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const newInputVariables=_this2.inputVariables.filter((iv=>!(iv in values))),newPartialVariables={..._this2.partialVariables??{},...values},promptDict={..._this2,inputVariables:newInputVariables,partialVariables:newPartialVariables};return new FewShotPromptTemplate(promptDict)}))()}format(values){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const allValues=yield _this3.mergePartialAndUserVariables(values),examples=yield _this3.getExamples(allValues),exampleStrings=yield Promise.all(examples.map((example=>_this3.examplePrompt.format(example)))),template=[_this3.prefix,...exampleStrings,_this3.suffix].join(_this3.exampleSeparator);return(0,_template_js__WEBPACK_IMPORTED_MODULE_1__.SM)(template,_this3.templateFormat,allValues)}))()}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static deserialize(data){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const{example_prompt}=data;if(!example_prompt)throw new Error("Missing example prompt");const examplePrompt=yield _prompt_js__WEBPACK_IMPORTED_MODULE_2__.PromptTemplate.deserialize(example_prompt);let examples;if(!Array.isArray(data.examples))throw new Error("Invalid examples format. Only list or string are supported.");return examples=data.examples,new FewShotPromptTemplate({inputVariables:data.input_variables,examplePrompt,examples,exampleSeparator:data.example_separator,prefix:data.prefix,suffix:data.suffix,templateFormat:data.template_format})}))()}}class FewShotChatMessagePromptTemplate extends _chat_js__WEBPACK_IMPORTED_MODULE_3__.S{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(fields){if(super(fields),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=fields.examples,this.examplePrompt=fields.examplePrompt,this.exampleSeparator=fields.exampleSeparator??"\n\n",this.exampleSelector=fields.exampleSelector,this.prefix=fields.prefix??"",this.suffix=fields.suffix??"",this.templateFormat=fields.templateFormat??"f-string",this.validateTemplate=fields.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let totalInputVariables=this.inputVariables;this.partialVariables&&(totalInputVariables=totalInputVariables.concat(Object.keys(this.partialVariables))),(0,_template_js__WEBPACK_IMPORTED_MODULE_1__.af)(this.prefix+this.suffix,this.templateFormat,totalInputVariables)}}getExamples(inputVariables){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){if(void 0!==_this4.examples)return _this4.examples;if(void 0!==_this4.exampleSelector)return _this4.exampleSelector.selectExamples(inputVariables);throw new Error("One of 'examples' and 'example_selector' should be provided")}))()}formatMessages(values){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const allValues=yield _this5.mergePartialAndUserVariables(values);let examples=yield _this5.getExamples(allValues);examples=examples.map((example=>{const result={};return _this5.examplePrompt.inputVariables.forEach((inputVariable=>{result[inputVariable]=example[inputVariable]})),result}));const messages=[];for(const example of examples){const exampleMessages=yield _this5.examplePrompt.formatMessages(example);messages.push(...exampleMessages)}return messages}))()}format(values){var _this6=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const allValues=yield _this6.mergePartialAndUserVariables(values),examples=yield _this6.getExamples(allValues),exampleStrings=(yield Promise.all(examples.map((example=>_this6.examplePrompt.formatMessages(example))))).flat().map((message=>message.content)),template=[_this6.prefix,...exampleStrings,_this6.suffix].join(_this6.exampleSeparator);return(0,_template_js__WEBPACK_IMPORTED_MODULE_1__.SM)(template,_this6.templateFormat,allValues)}))()}partial(values){var _this7=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const newInputVariables=_this7.inputVariables.filter((variable=>!(variable in values))),newPartialVariables={..._this7.partialVariables??{},...values},promptDict={..._this7,inputVariables:newInputVariables,partialVariables:newPartialVariables};return new FewShotChatMessagePromptTemplate(promptDict)}))()}}},"./node_modules/@langchain/core/dist/prompts/image.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{r:()=>ImagePromptTemplate});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_prompt_values_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/prompt_values.js"),_base_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/base.js"),_template_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/template.js");class ImagePromptTemplate extends _base_js__WEBPACK_IMPORTED_MODULE_1__.d{static lc_name(){return"ImagePromptTemplate"}constructor(input){if(super(input),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.template=input.template,this.templateFormat=input.templateFormat??this.templateFormat,this.validateTemplate=input.validateTemplate??this.validateTemplate,this.validateTemplate){let totalInputVariables=this.inputVariables;this.partialVariables&&(totalInputVariables=totalInputVariables.concat(Object.keys(this.partialVariables))),(0,_template_js__WEBPACK_IMPORTED_MODULE_2__.af)([{type:"image_url",image_url:this.template}],this.templateFormat,totalInputVariables)}}_getPromptType(){return"prompt"}partial(values){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const newInputVariables=_this.inputVariables.filter((iv=>!(iv in values))),newPartialVariables={..._this.partialVariables??{},...values},promptDict={..._this,inputVariables:newInputVariables,partialVariables:newPartialVariables};return new ImagePromptTemplate(promptDict)}))()}format(values){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const formatted={};for(const[key,value]of Object.entries(_this2.template))formatted[key]="string"==typeof value?value.replace(/{([^{}]*)}/g,((match,group)=>{const replacement=values[group];return"string"==typeof replacement||"number"==typeof replacement?String(replacement):match})):value;const url=values.url||formatted.url,detail=values.detail||formatted.detail;if(!url)throw new Error("Must provide either an image URL.");if("string"!=typeof url)throw new Error("url must be a string.");const output={url};return detail&&(output.detail=detail),output}))()}formatPromptValue(values){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const formattedPrompt=yield _this3.format(values);return new _prompt_values_js__WEBPACK_IMPORTED_MODULE_0__.Nn(formattedPrompt)}))()}}},"./node_modules/@langchain/core/dist/prompts/prompt.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PromptTemplate:()=>PromptTemplate});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_string_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/string.js"),_template_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/template.js");class PromptTemplate extends _string_js__WEBPACK_IMPORTED_MODULE_0__.A{static lc_name(){return"PromptTemplate"}constructor(input){if(super(input),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),"mustache"===input.templateFormat&&void 0===input.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,input),this.validateTemplate){if("mustache"===this.templateFormat)throw new Error("Mustache templates cannot be validated.");let totalInputVariables=this.inputVariables;this.partialVariables&&(totalInputVariables=totalInputVariables.concat(Object.keys(this.partialVariables))),(0,_template_js__WEBPACK_IMPORTED_MODULE_1__.af)(this.template,this.templateFormat,totalInputVariables)}}_getPromptType(){return"prompt"}format(values){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){const allValues=yield _this.mergePartialAndUserVariables(values);return(0,_template_js__WEBPACK_IMPORTED_MODULE_1__.SM)(_this.template,_this.templateFormat,allValues)}))()}static fromExamples(examples,suffix,inputVariables,exampleSeparator="\n\n",prefix=""){const template=[prefix,...examples,suffix].join(exampleSeparator);return new PromptTemplate({inputVariables,template})}static fromTemplate(template,options){const{templateFormat="f-string",...rest}=options??{},names=new Set;return(0,_template_js__WEBPACK_IMPORTED_MODULE_1__.$M)(template,templateFormat).forEach((node=>{"variable"===node.type&&names.add(node.name)})),new PromptTemplate({inputVariables:[...names],templateFormat,template,...rest})}partial(values){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){const newInputVariables=_this2.inputVariables.filter((iv=>!(iv in values))),newPartialVariables={..._this2.partialVariables??{},...values},promptDict={..._this2,inputVariables:newInputVariables,partialVariables:newPartialVariables};return new PromptTemplate(promptDict)}))()}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static deserialize(data){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){if(!data.template)throw new Error("Prompt template must have a template");return new PromptTemplate({inputVariables:data.input_variables,template:data.template,templateFormat:data.template_format})}))()}}},"./node_modules/@langchain/core/dist/prompts/string.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>BaseStringPromptTemplate});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_prompt_values_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/prompt_values.js"),_base_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/prompts/base.js");class BaseStringPromptTemplate extends _base_js__WEBPACK_IMPORTED_MODULE_1__.d{formatPromptValue(values){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){const formattedPrompt=yield _this.format(values);return new _prompt_values_js__WEBPACK_IMPORTED_MODULE_0__.nw(formattedPrompt)}))()}}},"./node_modules/@langchain/core/dist/prompts/template.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{af:()=>checkValidTemplate,_O:()=>parseFString,$M:()=>template_parseTemplate,SM:()=>renderTemplate});var objectToString=Object.prototype.toString,isArray=Array.isArray||function isArrayPolyfill(object){return"[object Array]"===objectToString.call(object)};function isFunction(object){return"function"==typeof object}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(obj,propName){return null!=obj&&"object"==typeof obj&&propName in obj}var regExpTest=RegExp.prototype.test;var nonSpaceRe=/\S/;function isWhitespace(string){return!function testRegExp(re,string){return regExpTest.call(re,string)}(nonSpaceRe,string)}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/;function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parentContext){this.view=view,this.cache={".":this.view},this.parent=parentContext}function Writer(){this.templateCache={_cache:{},set:function set(key,value){this._cache[key]=value},get:function get(key){return this._cache[key]},clear:function clear(){this._cache={}}}}Scanner.prototype.eos=function eos(){return""===this.tail},Scanner.prototype.scan=function scan(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string},Scanner.prototype.scanUntil=function scanUntil(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.prototype.push=function push(view){return new Context(view,this)},Context.prototype.lookup=function lookup(name){var value,primitive,propName,cache=this.cache;if(cache.hasOwnProperty(name))value=cache[name];else{for(var intermediateValue,names,index,context=this,lookupHit=!1;context;){if(name.indexOf(".")>0)for(intermediateValue=context.view,names=name.split("."),index=0;null!=intermediateValue&&index<names.length;)index===names.length-1&&(lookupHit=hasProperty(intermediateValue,names[index])||(primitive=intermediateValue,propName=names[index],null!=primitive&&"object"!=typeof primitive&&primitive.hasOwnProperty&&primitive.hasOwnProperty(propName))),intermediateValue=intermediateValue[names[index++]];else intermediateValue=context.view[name],lookupHit=hasProperty(context.view,name);if(lookupHit){value=intermediateValue;break}context=context.parent}cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function clearCache(){void 0!==this.templateCache&&this.templateCache.clear()},Writer.prototype.parse=function parse(template,tags){var cache=this.templateCache,cacheKey=template+":"+(tags||mustache.tags).join(":"),isCacheEnabled=void 0!==cache,tokens=isCacheEnabled?cache.get(cacheKey):void 0;return null==tokens&&(tokens=function parseTemplate(template,tags){if(!template)return[];var openingTagRe,closingTagRe,closingCurlyRe,lineHasNonSpace=!1,sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1,indentation="",tagIndex=0;function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}function compileTags(tagsToCompile){if("string"==typeof tagsToCompile&&(tagsToCompile=tagsToCompile.split(spaceRe,2)),!isArray(tagsToCompile)||2!==tagsToCompile.length)throw new Error("Invalid tags: "+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+"\\s*"),closingTagRe=new RegExp("\\s*"+escapeRegExp(tagsToCompile[1])),closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tagsToCompile[1]))}compileTags(tags||mustache.tags);for(var start,type,value,chr,token,openSection,scanner=new Scanner(template);!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(openingTagRe))for(var i=0,valueLength=value.length;i<valueLength;++i)isWhitespace(chr=value.charAt(i))?(spaces.push(tokens.length),indentation+=chr):(nonSpace=!0,lineHasNonSpace=!0,indentation+=" "),tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&(stripSpace(),indentation="",tagIndex=0,lineHasNonSpace=!1);if(!scanner.scan(openingTagRe))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(equalsRe),scanner.scan(equalsRe),scanner.scanUntil(closingTagRe)):"{"===type?(value=scanner.scanUntil(closingCurlyRe),scanner.scan(curlyRe),scanner.scanUntil(closingTagRe),type="&"):value=scanner.scanUntil(closingTagRe),!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);if(token=">"==type?[type,value,start,scanner.pos,indentation,tagIndex,lineHasNonSpace]:[type,value,start,scanner.pos],tagIndex++,tokens.push(token),"#"===type||"^"===type)sections.push(token);else if("/"===type){if(!(openSection=sections.pop()))throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else"name"===type||"{"===type||"&"===type?nonSpace=!0:"="===type&&compileTags(value)}if(stripSpace(),openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return function nestTokens(tokens){for(var token,nestedTokens=[],collector=nestedTokens,sections=[],i=0,numTokens=tokens.length;i<numTokens;++i)switch((token=tokens[i])[0]){case"#":case"^":collector.push(token),sections.push(token),collector=token[4]=[];break;case"/":sections.pop()[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}return nestedTokens}(function squashTokens(tokens){for(var token,lastToken,squashedTokens=[],i=0,numTokens=tokens.length;i<numTokens;++i)(token=tokens[i])&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(squashedTokens.push(token),lastToken=token));return squashedTokens}(tokens))}(template,tags),isCacheEnabled&&cache.set(cacheKey,tokens)),tokens},Writer.prototype.render=function render(template,view,partials,config){var tags=this.getConfigTags(config),tokens=this.parse(template,tags),context=view instanceof Context?view:new Context(view,void 0);return this.renderTokens(tokens,context,partials,template,config)},Writer.prototype.renderTokens=function renderTokens(tokens,context,partials,originalTemplate,config){for(var token,symbol,value,buffer="",i=0,numTokens=tokens.length;i<numTokens;++i)value=void 0,"#"===(symbol=(token=tokens[i])[0])?value=this.renderSection(token,context,partials,originalTemplate,config):"^"===symbol?value=this.renderInverted(token,context,partials,originalTemplate,config):">"===symbol?value=this.renderPartial(token,context,partials,config):"&"===symbol?value=this.unescapedValue(token,context):"name"===symbol?value=this.escapedValue(token,context,config):"text"===symbol&&(value=this.rawValue(token)),void 0!==value&&(buffer+=value);return buffer},Writer.prototype.renderSection=function renderSection(token,context,partials,originalTemplate,config){var self=this,buffer="",value=context.lookup(token[1]);if(value){if(isArray(value))for(var j=0,valueLength=value.length;j<valueLength;++j)buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate,config);else if("object"==typeof value||"string"==typeof value||"number"==typeof value)buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate,config);else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");null!=(value=value.call(context.view,originalTemplate.slice(token[3],token[5]),(function subRender(template){return self.render(template,context,partials,config)})))&&(buffer+=value)}else buffer+=this.renderTokens(token[4],context,partials,originalTemplate,config);return buffer}},Writer.prototype.renderInverted=function renderInverted(token,context,partials,originalTemplate,config){var value=context.lookup(token[1]);if(!value||isArray(value)&&0===value.length)return this.renderTokens(token[4],context,partials,originalTemplate,config)},Writer.prototype.indentPartial=function indentPartial(partial,indentation,lineHasNonSpace){for(var filteredIndentation=indentation.replace(/[^ \t]/g,""),partialByNl=partial.split("\n"),i=0;i<partialByNl.length;i++)partialByNl[i].length&&(i>0||!lineHasNonSpace)&&(partialByNl[i]=filteredIndentation+partialByNl[i]);return partialByNl.join("\n")},Writer.prototype.renderPartial=function renderPartial(token,context,partials,config){if(partials){var tags=this.getConfigTags(config),value=isFunction(partials)?partials(token[1]):partials[token[1]];if(null!=value){var lineHasNonSpace=token[6],tagIndex=token[5],indentation=token[4],indentedValue=value;0==tagIndex&&indentation&&(indentedValue=this.indentPartial(value,indentation,lineHasNonSpace));var tokens=this.parse(indentedValue,tags);return this.renderTokens(tokens,context,partials,indentedValue,config)}}},Writer.prototype.unescapedValue=function unescapedValue(token,context){var value=context.lookup(token[1]);if(null!=value)return value},Writer.prototype.escapedValue=function escapedValue(token,context,config){var escape=this.getConfigEscape(config)||mustache.escape,value=context.lookup(token[1]);if(null!=value)return"number"==typeof value&&escape===mustache.escape?String(value):escape(value)},Writer.prototype.rawValue=function rawValue(token){return token[1]},Writer.prototype.getConfigTags=function getConfigTags(config){return isArray(config)?config:config&&"object"==typeof config?config.tags:void 0},Writer.prototype.getConfigEscape=function getConfigEscape(config){return config&&"object"==typeof config&&!isArray(config)?config.escape:void 0};var mustache={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(cache){defaultWriter.templateCache=cache},get templateCache(){return defaultWriter.templateCache}},defaultWriter=new Writer;mustache.clearCache=function clearCache(){return defaultWriter.clearCache()},mustache.parse=function parse(template,tags){return defaultWriter.parse(template,tags)},mustache.render=function render(template,view,partials,config){if("string"!=typeof template)throw new TypeError('Invalid template! Template should be a "string" but "'+function typeStr(obj){return isArray(obj)?"array":typeof obj}(template)+'" was given as the first argument for mustache#render(template, view, partials)');return defaultWriter.render(template,view,partials,config)},mustache.escape=function escapeHtml(string){return String(string).replace(/[&<>"'`=\/]/g,(function fromEntityMap(s){return entityMap[s]}))},mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer;const mustache_mustache=mustache,parseFString=template=>{const chars=template.split(""),nodes=[],nextBracket=(bracket,start)=>{for(let i=start;i<chars.length;i+=1)if(bracket.includes(chars[i]))return i;return-1};let i=0;for(;i<chars.length;)if("{"===chars[i]&&i+1<chars.length&&"{"===chars[i+1])nodes.push({type:"literal",text:"{"}),i+=2;else if("}"===chars[i]&&i+1<chars.length&&"}"===chars[i+1])nodes.push({type:"literal",text:"}"}),i+=2;else if("{"===chars[i]){const j=nextBracket("}",i);if(j<0)throw new Error("Unclosed '{' in template.");nodes.push({type:"variable",name:chars.slice(i+1,j).join("")}),i=j+1}else{if("}"===chars[i])throw new Error("Single '}' in template.");{const next=nextBracket("{}",i),text=(next<0?chars.slice(i):chars.slice(i,next)).join("");nodes.push({type:"literal",text}),i=next<0?chars.length:next}}return nodes},DEFAULT_FORMATTER_MAPPING={"f-string":(template,values)=>parseFString(template).reduce(((res,node)=>{if("variable"===node.type){if(node.name in values)return res+values[node.name];throw new Error(`(f-string) Missing value for input ${node.name}`)}return res+node.text}),""),mustache:(template,values)=>mustache_mustache.render(template,values)},DEFAULT_PARSER_MAPPING={"f-string":parseFString,mustache:template=>(template=>template.map((temp=>"name"===temp[0]?{type:"variable",name:temp[1].includes(".")?temp[1].split(".")[0]:temp[1]}:"#"===temp[0]?{type:"variable",name:temp[1]}:{type:"literal",text:temp[1]})))(mustache_mustache.parse(template))},renderTemplate=(template,templateFormat,inputValues)=>DEFAULT_FORMATTER_MAPPING[templateFormat](template,inputValues),template_parseTemplate=(template,templateFormat)=>DEFAULT_PARSER_MAPPING[templateFormat](template),checkValidTemplate=(template,templateFormat,inputVariables)=>{if(!(templateFormat in DEFAULT_FORMATTER_MAPPING)){const validFormats=Object.keys(DEFAULT_FORMATTER_MAPPING);throw new Error(`Invalid template format. Got \`${templateFormat}\`;\n                         should be one of ${validFormats}`)}try{const dummyInputs=inputVariables.reduce(((acc,v)=>(acc[v]="foo",acc)),{});Array.isArray(template)?template.forEach((message=>{if("text"===message.type)renderTemplate(message.text,templateFormat,dummyInputs);else{if("image_url"!==message.type)throw new Error(`Invalid message template received. ${JSON.stringify(message,null,2)}`);if("string"==typeof message.image_url)renderTemplate(message.image_url,templateFormat,dummyInputs);else{const imageUrl=message.image_url.url;renderTemplate(imageUrl,templateFormat,dummyInputs)}}})):renderTemplate(template,templateFormat,dummyInputs)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},"./node_modules/@langchain/core/dist/runnables/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{eq:()=>Runnable,Vh:()=>RunnableAssign,dT:()=>RunnableMap,lW:()=>RunnableSequence});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),asyncGeneratorDelegate=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncGeneratorDelegate.js"),asyncIterator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js"),awaitAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),wrapAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),lib=__webpack_require__("./node_modules/zod/lib/index.mjs"),p_retry=__webpack_require__("./node_modules/p-retry/index.js"),p_retry_default=__webpack_require__.n(p_retry),v4=__webpack_require__("./v4.js"),traceable=__webpack_require__("./node_modules/langsmith/singletons/traceable.js"),manager=__webpack_require__("./node_modules/@langchain/core/dist/callbacks/manager.js"),log_stream=__webpack_require__("./node_modules/@langchain/core/dist/tracers/log_stream.js"),event_stream=__webpack_require__("./node_modules/@langchain/core/dist/tracers/event_stream.js"),serializable=__webpack_require__("./node_modules/@langchain/core/dist/load/serializable.js"),utils_stream=__webpack_require__("./node_modules/@langchain/core/dist/utils/stream.js"),runnables_config=__webpack_require__("./node_modules/@langchain/core/dist/runnables/config.js"),async_caller=__webpack_require__("./node_modules/@langchain/core/dist/utils/async_caller.js"),base=__webpack_require__("./node_modules/@langchain/core/dist/tracers/base.js");class RootListenersTracer extends base.Z{constructor({config,onStart,onEnd,onError}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=config,this.argOnStart=onStart,this.argOnEnd=onEnd,this.argOnError=onError}persistRun(_){return Promise.resolve()}onRunCreate(run){var _this=this;return(0,asyncToGenerator.Z)((function*(){_this.rootId||(_this.rootId=run.id,_this.argOnStart&&(1===_this.argOnStart.length?yield _this.argOnStart(run):2===_this.argOnStart.length&&(yield _this.argOnStart(run,_this.config))))}))()}onRunUpdate(run){var _this2=this;return(0,asyncToGenerator.Z)((function*(){run.id===_this2.rootId&&(run.error?_this2.argOnError&&(1===_this2.argOnError.length?yield _this2.argOnError(run):2===_this2.argOnError.length&&(yield _this2.argOnError(run,_this2.config))):_this2.argOnEnd&&(1===_this2.argOnEnd.length?yield _this2.argOnEnd(run):2===_this2.argOnEnd.length&&(yield _this2.argOnEnd(run,_this2.config))))}))()}}function utils_isRunnableInterface(thing){return!!thing&&thing.lc_runnable}class _RootEventFilter{constructor(fields){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=fields.includeNames,this.includeTypes=fields.includeTypes,this.includeTags=fields.includeTags,this.excludeNames=fields.excludeNames,this.excludeTypes=fields.excludeTypes,this.excludeTags=fields.excludeTags}includeEvent(event,rootType){let include=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const eventTags=event.tags??[];return void 0!==this.includeNames&&(include=include||this.includeNames.includes(event.name)),void 0!==this.includeTypes&&(include=include||this.includeTypes.includes(rootType)),void 0!==this.includeTags&&(include=include||eventTags.some((tag=>this.includeTags?.includes(tag)))),void 0!==this.excludeNames&&(include=include&&!this.excludeNames.includes(event.name)),void 0!==this.excludeTypes&&(include=include&&!this.excludeTypes.includes(rootType)),void 0!==this.excludeTags&&(include=include&&eventTags.every((tag=>!this.excludeTags?.includes(tag)))),include}}var singletons=__webpack_require__("./node_modules/@langchain/core/dist/singletons/index.js"),esm=__webpack_require__("./node_modules/zod-to-json-schema/dist/esm/index.js");const regex=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const validate_0=function validate(uuid){return"string"==typeof uuid&&regex.test(uuid)};function nodeDataJson(node){return utils_isRunnableInterface(node.data)?{type:"runnable",data:{id:node.data.lc_id,name:node.data.getName()}}:{type:"schema",data:{...(0,esm.Y_)(node.data.schema),title:node.data.name}}}class Graph{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const stableNodeIds={};return Object.values(this.nodes).forEach(((node,i)=>{stableNodeIds[node.id]=validate_0(node.id)?i:node.id})),{nodes:Object.values(this.nodes).map((node=>({id:stableNodeIds[node.id],...nodeDataJson(node)}))),edges:this.edges.map((edge=>edge.data?{source:stableNodeIds[edge.source],target:stableNodeIds[edge.target],data:edge.data}:{source:stableNodeIds[edge.source],target:stableNodeIds[edge.target]}))}}addNode(data,id){if(void 0!==id&&void 0!==this.nodes[id])throw new Error(`Node with id ${id} already exists`);const nodeId=id||(0,v4.Z)(),node={id:nodeId,data};return this.nodes[nodeId]=node,node}removeNode(node){delete this.nodes[node.id],this.edges=this.edges.filter((edge=>edge.source!==node.id&&edge.target!==node.id))}addEdge(source,target,data){if(void 0===this.nodes[source.id])throw new Error(`Source node ${source.id} not in graph`);if(void 0===this.nodes[target.id])throw new Error(`Target node ${target.id} not in graph`);const edge={source:source.id,target:target.id,data};return this.edges.push(edge),edge}firstNode(){const targets=new Set(this.edges.map((edge=>edge.target))),found=[];return Object.values(this.nodes).forEach((node=>{targets.has(node.id)||found.push(node)})),found[0]}lastNode(){const sources=new Set(this.edges.map((edge=>edge.source))),found=[];return Object.values(this.nodes).forEach((node=>{sources.has(node.id)||found.push(node)})),found[0]}extend(graph){Object.entries(graph.nodes).forEach((([key,value])=>{this.nodes[key]=value})),this.edges=[...this.edges,...graph.edges]}trimFirstNode(){const firstNode=this.firstNode();if(firstNode){const outgoingEdges=this.edges.filter((edge=>edge.source===firstNode.id));1!==Object.keys(this.nodes).length&&1!==outgoingEdges.length||this.removeNode(firstNode)}}trimLastNode(){const lastNode=this.lastNode();if(lastNode){const incomingEdges=this.edges.filter((edge=>edge.target===lastNode.id));1!==Object.keys(this.nodes).length&&1!==incomingEdges.length||this.removeNode(lastNode)}}}function isIterableIterator(thing){return"object"==typeof thing&&null!==thing&&"function"==typeof thing[Symbol.iterator]&&"function"==typeof thing.next}function isAsyncIterable(thing){return"object"==typeof thing&&null!==thing&&"function"==typeof thing[Symbol.asyncIterator]}function*consumeIteratorInContext(context,iter){const storage=singletons.A.getInstance();for(;;){const{value,done}=storage.run(context,iter.next.bind(iter));if(done)break;yield value}}function consumeAsyncIterableInContext(_x,_x2){return _consumeAsyncIterableInContext.apply(this,arguments)}function _consumeAsyncIterableInContext(){return(_consumeAsyncIterableInContext=(0,wrapAsyncGenerator.Z)((function*(context,iter){const storage=singletons.A.getInstance(),iterator=iter[Symbol.asyncIterator]();for(;;){const{value,done}=yield(0,awaitAsyncGenerator.Z)(storage.run(context,iterator.next.bind(iter)));if(done)break;yield value}}))).apply(this,arguments)}function _coerceToDict(value,defaultKey){return!value||Array.isArray(value)||value instanceof Date||"object"!=typeof value?{[defaultKey]:value}:value}class Runnable extends serializable.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(suffix){const name=this.name??this.constructor.lc_name()??this.constructor.name;return suffix?`${name}${suffix}`:name}bind(kwargs){return new RunnableBinding({bound:this,kwargs,config:{}})}map(){return new RunnableEach({bound:this})}withRetry(fields){return new RunnableRetry({bound:this,kwargs:{},config:{},maxAttemptNumber:fields?.stopAfterAttempt,...fields})}withConfig(config){return new RunnableBinding({bound:this,config,kwargs:{}})}withFallbacks(fields){return new RunnableWithFallbacks({runnable:this,fallbacks:fields.fallbacks})}_getOptionsList(options,length=0){if(Array.isArray(options)&&options.length!==length)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${options.length} options for ${length} inputs`);if(Array.isArray(options))return options.map(runnables_config.LE);if(length>1&&!Array.isArray(options)&&options.runId){console.warn("Provided runId will be used only for the first element of the batch.");const subsequent=Object.fromEntries(Object.entries(options).filter((([key])=>"runId"!==key)));return Array.from({length},((_,i)=>(0,runnables_config.LE)(0===i?options:subsequent)))}return Array.from({length},(()=>(0,runnables_config.LE)(options)))}batch(inputs,options,batchOptions){var _this16=this;return(0,asyncToGenerator.Z)((function*(){const configList=_this16._getOptionsList(options??{},inputs.length),maxConcurrency=configList[0]?.maxConcurrency??batchOptions?.maxConcurrency,caller=new async_caller.L({maxConcurrency,onFailedAttempt:e=>{throw e}}),batchCalls=inputs.map(((input,i)=>caller.call((0,asyncToGenerator.Z)((function*(){try{return yield _this16.invoke(input,configList[i])}catch(e){if(batchOptions?.returnExceptions)return e;throw e}})))));return Promise.all(batchCalls)}))()}_streamIterator(input,options){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){yield _this.invoke(input,options)}))()}stream(input,options){var _this17=this;return(0,asyncToGenerator.Z)((function*(){const config=(0,runnables_config.LE)(options),wrappedGenerator=new utils_stream.qq({generator:_this17._streamIterator(input,config),config});return yield wrappedGenerator.setup,utils_stream.QJ.fromAsyncGenerator(wrappedGenerator)}))()}_separateRunnableConfigFromCallOptions(options){let runnableConfig;runnableConfig=void 0===options?(0,runnables_config.LE)(options):(0,runnables_config.LE)({callbacks:options.callbacks,tags:options.tags,metadata:options.metadata,runName:options.runName,configurable:options.configurable,recursionLimit:options.recursionLimit,maxConcurrency:options.maxConcurrency,runId:options.runId});const callOptions={...options};return delete callOptions.callbacks,delete callOptions.tags,delete callOptions.metadata,delete callOptions.runName,delete callOptions.configurable,delete callOptions.recursionLimit,delete callOptions.maxConcurrency,delete callOptions.runId,[runnableConfig,callOptions]}_callWithConfig(func,input,options){var _this18=this;return(0,asyncToGenerator.Z)((function*(){const config=(0,runnables_config.LE)(options),callbackManager_=yield(0,runnables_config.Le)(config),runManager=yield callbackManager_?.handleChainStart(_this18.toJSON(),_coerceToDict(input,"input"),config.runId,config?.runType,void 0,void 0,config?.runName??_this18.getName());let output;delete config.runId;try{output=yield func.call(_this18,input,config,runManager)}catch(e){throw yield runManager?.handleChainError(e),e}return yield runManager?.handleChainEnd(_coerceToDict(output,"output")),output}))()}_batchWithConfig(func,inputs,options,batchOptions){var _this19=this;return(0,asyncToGenerator.Z)((function*(){const optionsList=_this19._getOptionsList(options??{},inputs.length),callbackManagers=yield Promise.all(optionsList.map(runnables_config.Le)),runManagers=yield Promise.all(callbackManagers.map(function(){var _ref3=(0,asyncToGenerator.Z)((function*(callbackManager,i){const handleStartRes=yield callbackManager?.handleChainStart(_this19.toJSON(),_coerceToDict(inputs[i],"input"),optionsList[i].runId,optionsList[i].runType,void 0,void 0,optionsList[i].runName??_this19.getName());return delete optionsList[i].runId,handleStartRes}));return function(_x,_x2){return _ref3.apply(this,arguments)}}()));let outputs;try{outputs=yield func.call(_this19,inputs,optionsList,runManagers,batchOptions)}catch(e){throw yield Promise.all(runManagers.map((runManager=>runManager?.handleChainError(e)))),e}return yield Promise.all(runManagers.map((runManager=>runManager?.handleChainEnd(_coerceToDict(outputs,"output"))))),outputs}))()}_transformStreamWithConfig(inputGenerator,transformer,options){var _this2=this;return(0,wrapAsyncGenerator.Z)((function*(){let finalInput,finalOutput,finalInputSupported=!0,finalOutputSupported=!0;const config=(0,runnables_config.LE)(options),callbackManager_=yield(0,awaitAsyncGenerator.Z)((0,runnables_config.Le)(config));function _wrapInputForTracing(){return(_wrapInputForTracing=(0,wrapAsyncGenerator.Z)((function*(){var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(inputGenerator);_iteratorAbruptCompletion2=!(_step2=yield(0,awaitAsyncGenerator.Z)(_iterator2.next())).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;if(finalInputSupported)if(void 0===finalInput)finalInput=chunk;else try{finalInput=(0,utils_stream.zo)(finalInput,chunk)}catch{finalInput=void 0,finalInputSupported=!1}yield chunk}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator2.return()))}finally{if(_didIteratorError2)throw _iteratorError2}}}))).apply(this,arguments)}let runManager;try{const pipe=yield(0,awaitAsyncGenerator.Z)((0,utils_stream.E7)(transformer.bind(_this2),function wrapInputForTracing(){return _wrapInputForTracing.apply(this,arguments)}(),(0,asyncToGenerator.Z)((function*(){return callbackManager_?.handleChainStart(_this2.toJSON(),{input:""},config.runId,config.runType,void 0,void 0,config.runName??_this2.getName())})),config));delete config.runId,runManager=pipe.setup;const streamEventsHandler=runManager?.handlers.find(event_stream.C);let iterator=pipe.output;void 0!==streamEventsHandler&&void 0!==runManager&&(iterator=streamEventsHandler.tapOutputIterable(runManager.runId,iterator));const streamLogHandler=runManager?.handlers.find(log_stream.ky);void 0!==streamLogHandler&&void 0!==runManager&&(iterator=streamLogHandler.tapOutputIterable(runManager.runId,iterator));var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(iterator);_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;if(yield chunk,finalOutputSupported)if(void 0===finalOutput)finalOutput=chunk;else try{finalOutput=(0,utils_stream.zo)(finalOutput,chunk)}catch{finalOutput=void 0,finalOutputSupported=!1}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}}catch(e){throw yield(0,awaitAsyncGenerator.Z)(runManager?.handleChainError(e,void 0,void 0,void 0,{inputs:_coerceToDict(finalInput,"input")})),e}yield(0,awaitAsyncGenerator.Z)(runManager?.handleChainEnd(finalOutput??{},void 0,void 0,void 0,{inputs:_coerceToDict(finalInput,"input")}))}))()}getGraph(_){const graph=new Graph,inputNode=graph.addNode({name:`${this.getName()}Input`,schema:lib.z.any()}),runnableNode=graph.addNode(this),outputNode=graph.addNode({name:`${this.getName()}Output`,schema:lib.z.any()});return graph.addEdge(inputNode,runnableNode),graph.addEdge(runnableNode,outputNode),graph}pipe(coerceable){return new RunnableSequence({first:this,last:_coerceToRunnable(coerceable)})}pick(keys){return this.pipe(new RunnablePick(keys))}assign(mapping){return this.pipe(new RunnableAssign(new RunnableMap({steps:mapping})))}transform(generator,options){var _this3=this;return(0,wrapAsyncGenerator.Z)((function*(){let finalChunk;var _iteratorError3,_iteratorAbruptCompletion3=!1,_didIteratorError3=!1;try{for(var _step3,_iterator3=(0,asyncIterator.Z)(generator);_iteratorAbruptCompletion3=!(_step3=yield(0,awaitAsyncGenerator.Z)(_iterator3.next())).done;_iteratorAbruptCompletion3=!1){const chunk=_step3.value;finalChunk=void 0===finalChunk?chunk:(0,utils_stream.zo)(finalChunk,chunk)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorAbruptCompletion3&&null!=_iterator3.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator3.return()))}finally{if(_didIteratorError3)throw _iteratorError3}}yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(_this3._streamIterator(finalChunk,(0,runnables_config.LE)(options))),awaitAsyncGenerator.Z)}))()}streamLog(input,options,streamOptions){var _this4=this;return(0,wrapAsyncGenerator.Z)((function*(){const logStreamCallbackHandler=new log_stream.Te({...streamOptions,autoClose:!1,_schemaFormat:"original"}),config=(0,runnables_config.LE)(options);yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(_this4._streamLog(input,logStreamCallbackHandler,config)),awaitAsyncGenerator.Z)}))()}_streamLog(input,logStreamCallbackHandler,config){var _this5=this;return(0,wrapAsyncGenerator.Z)((function*(){const{callbacks}=config;if(void 0===callbacks)config.callbacks=[logStreamCallbackHandler];else if(Array.isArray(callbacks))config.callbacks=callbacks.concat([logStreamCallbackHandler]);else{const copiedCallbacks=callbacks.copy();copiedCallbacks.inheritableHandlers.push(logStreamCallbackHandler),config.callbacks=copiedCallbacks}const runnableStreamPromise=_this5.stream(input,config);function _consumeRunnableStream(){return(_consumeRunnableStream=(0,asyncToGenerator.Z)((function*(){try{const runnableStream=yield runnableStreamPromise;var _iteratorError5,_iteratorAbruptCompletion5=!1,_didIteratorError5=!1;try{for(var _step5,_iterator5=(0,asyncIterator.Z)(runnableStream);_iteratorAbruptCompletion5=!(_step5=yield _iterator5.next()).done;_iteratorAbruptCompletion5=!1){const chunk=_step5.value;{const patch=new log_stream.hv({ops:[{op:"add",path:"/streamed_output/-",value:chunk}]});yield logStreamCallbackHandler.writer.write(patch)}}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorAbruptCompletion5&&null!=_iterator5.return&&(yield _iterator5.return())}finally{if(_didIteratorError5)throw _iteratorError5}}}finally{yield logStreamCallbackHandler.writer.close()}}))).apply(this,arguments)}const runnableStreamConsumePromise=function consumeRunnableStream(){return _consumeRunnableStream.apply(this,arguments)}();try{var _iteratorError4,_iteratorAbruptCompletion4=!1,_didIteratorError4=!1;try{for(var _step4,_iterator4=(0,asyncIterator.Z)(logStreamCallbackHandler);_iteratorAbruptCompletion4=!(_step4=yield(0,awaitAsyncGenerator.Z)(_iterator4.next())).done;_iteratorAbruptCompletion4=!1){const log=_step4.value;yield log}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorAbruptCompletion4&&null!=_iterator4.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator4.return()))}finally{if(_didIteratorError4)throw _iteratorError4}}}finally{yield(0,awaitAsyncGenerator.Z)(runnableStreamConsumePromise)}}))()}streamEvents(input,options,streamOptions){let stream;if("v1"===options.version)stream=this._streamEventsV1(input,options,streamOptions);else{if("v2"!==options.version)throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');stream=this._streamEventsV2(input,options,streamOptions)}return"text/event-stream"===options.encoding?function convertToHttpEventStream(stream){const encoder=new TextEncoder,finalStream=new ReadableStream({start:controller=>(0,asyncToGenerator.Z)((function*(){var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion=!(_step=yield _iterator.next()).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;controller.enqueue(encoder.encode(`event: data\ndata: ${JSON.stringify(chunk)}\n\n`))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield _iterator.return())}finally{if(_didIteratorError)throw _iteratorError}}controller.enqueue(encoder.encode("event: end\n\n")),controller.close()}))()});return utils_stream.QJ.fromReadableStream(finalStream)}(stream):utils_stream.QJ.fromAsyncGenerator(stream)}_streamEventsV2(input,options,streamOptions){var _this6=this;return(0,wrapAsyncGenerator.Z)((function*(){const eventStreamer=new event_stream.d({...streamOptions,autoClose:!1}),config=(0,runnables_config.LE)(options),runId=config.runId??(0,v4.Z)();config.runId=runId;const callbacks=config.callbacks;if(void 0===callbacks)config.callbacks=[eventStreamer];else if(Array.isArray(callbacks))config.callbacks=callbacks.concat(eventStreamer);else{const copiedCallbacks=callbacks.copy();copiedCallbacks.inheritableHandlers.push(eventStreamer),config.callbacks=copiedCallbacks}const outerThis=_this6;function _consumeRunnableStream2(){return(_consumeRunnableStream2=(0,asyncToGenerator.Z)((function*(){try{const runnableStream=yield outerThis.stream(input,config),tappedStream=eventStreamer.tapOutputIterable(runId,runnableStream);var _iteratorError7,_iteratorAbruptCompletion7=!1,_didIteratorError7=!1;try{for(var _step7,_iterator7=(0,asyncIterator.Z)(tappedStream);_iteratorAbruptCompletion7=!(_step7=yield _iterator7.next()).done;_iteratorAbruptCompletion7=!1){_step7.value}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorAbruptCompletion7&&null!=_iterator7.return&&(yield _iterator7.return())}finally{if(_didIteratorError7)throw _iteratorError7}}}finally{yield eventStreamer.finish()}}))).apply(this,arguments)}const runnableStreamConsumePromise=function consumeRunnableStream(){return _consumeRunnableStream2.apply(this,arguments)}();let firstEventRunId,firstEventSent=!1;try{var _iteratorError6,_iteratorAbruptCompletion6=!1,_didIteratorError6=!1;try{for(var _step6,_iterator6=(0,asyncIterator.Z)(eventStreamer);_iteratorAbruptCompletion6=!(_step6=yield(0,awaitAsyncGenerator.Z)(_iterator6.next())).done;_iteratorAbruptCompletion6=!1){const event=_step6.value;firstEventSent?(event.run_id===firstEventRunId&&event.event.endsWith("_end")&&event.data?.input&&delete event.data.input,yield event):(event.data.input=input,firstEventSent=!0,firstEventRunId=event.run_id,yield event)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorAbruptCompletion6&&null!=_iterator6.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator6.return()))}finally{if(_didIteratorError6)throw _iteratorError6}}}finally{yield(0,awaitAsyncGenerator.Z)(runnableStreamConsumePromise)}}))()}_streamEventsV1(input,options,streamOptions){var _this7=this;return(0,wrapAsyncGenerator.Z)((function*(){let runLog,hasEncounteredStartEvent=!1;const config=(0,runnables_config.LE)(options),rootTags=config.tags??[],rootMetadata=config.metadata??{},rootName=config.runName??_this7.getName(),logStreamCallbackHandler=new log_stream.Te({...streamOptions,autoClose:!1,_schemaFormat:"streaming_events"}),rootEventFilter=new _RootEventFilter({...streamOptions}),logStream=_this7._streamLog(input,logStreamCallbackHandler,config);var _iteratorError8,_iteratorAbruptCompletion8=!1,_didIteratorError8=!1;try{for(var _step8,_iterator8=(0,asyncIterator.Z)(logStream);_iteratorAbruptCompletion8=!(_step8=yield(0,awaitAsyncGenerator.Z)(_iterator8.next())).done;_iteratorAbruptCompletion8=!1){const log=_step8.value;{if(runLog=runLog?runLog.concat(log):log_stream.y6.fromRunLogPatch(log),void 0===runLog.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!hasEncounteredStartEvent){hasEncounteredStartEvent=!0;const state={...runLog.state},event={run_id:state.id,event:`on_${state.type}_start`,name:rootName,tags:rootTags,metadata:rootMetadata,data:{input}};rootEventFilter.includeEvent(event,state.type)&&(yield event)}const paths=log.ops.filter((op=>op.path.startsWith("/logs/"))).map((op=>op.path.split("/")[2])),dedupedPaths=[...new Set(paths)];for(const path of dedupedPaths){let eventType,data={};const logEntry=runLog.state.logs[path];if(eventType=void 0===logEntry.end_time?logEntry.streamed_output.length>0?"stream":"start":"end","start"===eventType)void 0!==logEntry.inputs&&(data.input=logEntry.inputs);else if("end"===eventType)void 0!==logEntry.inputs&&(data.input=logEntry.inputs),data.output=logEntry.final_output;else if("stream"===eventType){const chunkCount=logEntry.streamed_output.length;if(1!==chunkCount)throw new Error(`Expected exactly one chunk of streamed output, got ${chunkCount} instead. Encountered in: "${logEntry.name}"`);data={chunk:logEntry.streamed_output[0]},logEntry.streamed_output=[]}yield{event:`on_${logEntry.type}_${eventType}`,name:logEntry.name,run_id:logEntry.id,tags:logEntry.tags,metadata:logEntry.metadata,data}}const{state}=runLog;if(state.streamed_output.length>0){const chunkCount=state.streamed_output.length;if(1!==chunkCount)throw new Error(`Expected exactly one chunk of streamed output, got ${chunkCount} instead. Encountered in: "${state.name}"`);const data={chunk:state.streamed_output[0]};state.streamed_output=[];const event={event:`on_${state.type}_stream`,run_id:state.id,tags:rootTags,metadata:rootMetadata,name:rootName,data};rootEventFilter.includeEvent(event,state.type)&&(yield event)}}}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{_iteratorAbruptCompletion8&&null!=_iterator8.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator8.return()))}finally{if(_didIteratorError8)throw _iteratorError8}}const state=runLog?.state;if(void 0!==state){const event={event:`on_${state.type}_end`,name:rootName,run_id:state.id,tags:rootTags,metadata:rootMetadata,data:{output:state.final_output}};rootEventFilter.includeEvent(event,state.type)&&(yield event)}}))()}static isRunnable(thing){return utils_isRunnableInterface(thing)}withListeners({onStart,onEnd,onError}){return new RunnableBinding({bound:this,config:{},configFactories:[config=>({callbacks:[new RootListenersTracer({config,onStart,onEnd,onError})]})]})}}class RunnableBinding extends Runnable{static lc_name(){return"RunnableBinding"}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=fields.bound,this.kwargs=fields.kwargs,this.config=fields.config,this.configFactories=fields.configFactories}getName(suffix){return this.bound.getName(suffix)}_mergeConfig(...options){var _this20=this;return(0,asyncToGenerator.Z)((function*(){const config=(0,runnables_config.t8)(_this20.config,...options);return(0,runnables_config.t8)(config,..._this20.configFactories?yield Promise.all(_this20.configFactories.map(function(){var _ref5=(0,asyncToGenerator.Z)((function*(configFactory){return yield configFactory(config)}));return function(_x3){return _ref5.apply(this,arguments)}}())):[])}))()}bind(kwargs){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...kwargs},config:this.config})}withConfig(config){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...config}})}withRetry(fields){return new this.constructor({bound:this.bound.withRetry(fields),kwargs:this.kwargs,config:this.config})}invoke(input,options){var _this21=this;return(0,asyncToGenerator.Z)((function*(){return _this21.bound.invoke(input,yield _this21._mergeConfig((0,runnables_config.LE)(options),_this21.kwargs))}))()}batch(inputs,options,batchOptions){var _this22=this;return(0,asyncToGenerator.Z)((function*(){const mergedOptions=Array.isArray(options)?yield Promise.all(options.map(function(){var _ref6=(0,asyncToGenerator.Z)((function*(individualOption){return _this22._mergeConfig((0,runnables_config.LE)(individualOption),_this22.kwargs)}));return function(_x4){return _ref6.apply(this,arguments)}}())):yield _this22._mergeConfig((0,runnables_config.LE)(options),_this22.kwargs);return _this22.bound.batch(inputs,mergedOptions,batchOptions)}))()}_streamIterator(input,options){var _this8=this;return(0,wrapAsyncGenerator.Z)((function*(){yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(_this8.bound._streamIterator(input,yield(0,awaitAsyncGenerator.Z)(_this8._mergeConfig((0,runnables_config.LE)(options),_this8.kwargs)))),awaitAsyncGenerator.Z)}))()}stream(input,options){var _this23=this;return(0,asyncToGenerator.Z)((function*(){return _this23.bound.stream(input,yield _this23._mergeConfig((0,runnables_config.LE)(options),_this23.kwargs))}))()}transform(generator,options){var _this9=this;return(0,wrapAsyncGenerator.Z)((function*(){yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(_this9.bound.transform(generator,yield(0,awaitAsyncGenerator.Z)(_this9._mergeConfig((0,runnables_config.LE)(options),_this9.kwargs)))),awaitAsyncGenerator.Z)}))()}streamEvents(input,options,streamOptions){const outerThis=this,generator=function(){var _ref=(0,wrapAsyncGenerator.Z)((function*(){yield*(0,asyncGeneratorDelegate.Z)((0,asyncIterator.Z)(outerThis.bound.streamEvents(input,{...yield(0,awaitAsyncGenerator.Z)(outerThis._mergeConfig((0,runnables_config.LE)(options),outerThis.kwargs)),version:options.version},streamOptions)),awaitAsyncGenerator.Z)}));return function generator(){return _ref.apply(this,arguments)}}();return utils_stream.QJ.fromAsyncGenerator(generator())}static isRunnableBinding(thing){return thing.bound&&Runnable.isRunnable(thing.bound)}withListeners({onStart,onEnd,onError}){return new RunnableBinding({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[config=>({callbacks:[new RootListenersTracer({config,onStart,onEnd,onError})]})]})}}class RunnableEach extends Runnable{static lc_name(){return"RunnableEach"}constructor(fields){super(fields),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=fields.bound}bind(kwargs){return new RunnableEach({bound:this.bound.bind(kwargs)})}invoke(inputs,config){var _this24=this;return(0,asyncToGenerator.Z)((function*(){return _this24._callWithConfig(_this24._invoke,inputs,config)}))()}_invoke(inputs,config,runManager){var _this25=this;return(0,asyncToGenerator.Z)((function*(){return _this25.bound.batch(inputs,(0,runnables_config.q)(config,{callbacks:runManager?.getChild()}))}))()}withListeners({onStart,onEnd,onError}){return new RunnableEach({bound:this.bound.withListeners({onStart,onEnd,onError})})}}class RunnableRetry extends RunnableBinding{static lc_name(){return"RunnableRetry"}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=fields.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=fields.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(attempt,config,runManager){const tag=attempt>1?`retry:attempt:${attempt}`:void 0;return(0,runnables_config.q)(config,{callbacks:runManager?.getChild(tag)})}_invoke(input,config,runManager){var _superprop_getInvoke=()=>super.invoke,_this26=this;return(0,asyncToGenerator.Z)((function*(){return p_retry_default()((attemptNumber=>_superprop_getInvoke().call(_this26,input,_this26._patchConfigForRetry(attemptNumber,config,runManager))),{onFailedAttempt:error=>_this26.onFailedAttempt(error,input),retries:Math.max(_this26.maxAttemptNumber-1,0),randomize:!0})}))()}invoke(input,config){var _this27=this;return(0,asyncToGenerator.Z)((function*(){return _this27._callWithConfig(_this27._invoke,input,config)}))()}_batch(inputs,configs,runManagers,batchOptions){var _superprop_getBatch=()=>super.batch,_this28=this;return(0,asyncToGenerator.Z)((function*(){const resultsMap={};try{yield p_retry_default()(function(){var _ref7=(0,asyncToGenerator.Z)((function*(attemptNumber){const remainingIndexes=inputs.map(((_,i)=>i)).filter((i=>void 0===resultsMap[i.toString()]||resultsMap[i.toString()]instanceof Error)),remainingInputs=remainingIndexes.map((i=>inputs[i])),patchedConfigs=remainingIndexes.map((i=>_this28._patchConfigForRetry(attemptNumber,configs?.[i],runManagers?.[i]))),results=yield _superprop_getBatch().call(_this28,remainingInputs,patchedConfigs,{...batchOptions,returnExceptions:!0});let firstException;for(let i=0;i<results.length;i+=1){const result=results[i],resultMapIndex=remainingIndexes[i];result instanceof Error&&void 0===firstException&&(firstException=result,firstException.input=remainingInputs[i]),resultsMap[resultMapIndex.toString()]=result}if(firstException)throw firstException;return results}));return function(_x5){return _ref7.apply(this,arguments)}}(),{onFailedAttempt:error=>_this28.onFailedAttempt(error,error.input),retries:Math.max(_this28.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==batchOptions?.returnExceptions)throw e}return Object.keys(resultsMap).sort(((a,b)=>parseInt(a,10)-parseInt(b,10))).map((key=>resultsMap[parseInt(key,10)]))}))()}batch(inputs,options,batchOptions){var _this29=this;return(0,asyncToGenerator.Z)((function*(){return _this29._batchWithConfig(_this29._batch.bind(_this29),inputs,options,batchOptions)}))()}}class RunnableSequence extends Runnable{static lc_name(){return"RunnableSequence"}constructor(fields){super(fields),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=fields.first,this.middle=fields.middle??this.middle,this.last=fields.last,this.name=fields.name}get steps(){return[this.first,...this.middle,this.last]}invoke(input,options){var _this30=this;return(0,asyncToGenerator.Z)((function*(){const config=(0,runnables_config.LE)(options),callbackManager_=yield(0,runnables_config.Le)(config),runManager=yield callbackManager_?.handleChainStart(_this30.toJSON(),_coerceToDict(input,"input"),config.runId,void 0,void 0,void 0,config?.runName);delete config.runId;let finalOutput,nextStepInput=input;try{const initialSteps=[_this30.first,..._this30.middle];for(let i=0;i<initialSteps.length;i+=1){const step=initialSteps[i];nextStepInput=yield step.invoke(nextStepInput,(0,runnables_config.q)(config,{callbacks:runManager?.getChild(`seq:step:${i+1}`)}))}finalOutput=yield _this30.last.invoke(nextStepInput,(0,runnables_config.q)(config,{callbacks:runManager?.getChild(`seq:step:${_this30.steps.length}`)}))}catch(e){throw yield runManager?.handleChainError(e),e}return yield runManager?.handleChainEnd(_coerceToDict(finalOutput,"output")),finalOutput}))()}batch(inputs,options,batchOptions){var _this31=this;return(0,asyncToGenerator.Z)((function*(){const configList=_this31._getOptionsList(options??{},inputs.length),callbackManagers=yield Promise.all(configList.map(runnables_config.Le)),runManagers=yield Promise.all(callbackManagers.map(function(){var _ref8=(0,asyncToGenerator.Z)((function*(callbackManager,i){const handleStartRes=yield callbackManager?.handleChainStart(_this31.toJSON(),_coerceToDict(inputs[i],"input"),configList[i].runId,void 0,void 0,void 0,configList[i].runName);return delete configList[i].runId,handleStartRes}));return function(_x6,_x7){return _ref8.apply(this,arguments)}}()));let nextStepInputs=inputs;try{for(let i=0;i<_this31.steps.length;i+=1){const step=_this31.steps[i];nextStepInputs=yield step.batch(nextStepInputs,runManagers.map(((runManager,j)=>{const childRunManager=runManager?.getChild(`seq:step:${i+1}`);return(0,runnables_config.q)(configList[j],{callbacks:childRunManager})})),batchOptions)}}catch(e){throw yield Promise.all(runManagers.map((runManager=>runManager?.handleChainError(e)))),e}return yield Promise.all(runManagers.map((runManager=>runManager?.handleChainEnd(_coerceToDict(nextStepInputs,"output"))))),nextStepInputs}))()}_streamIterator(input,options){var _this10=this;return(0,wrapAsyncGenerator.Z)((function*(){const callbackManager_=yield(0,awaitAsyncGenerator.Z)((0,runnables_config.Le)(options)),{runId,...otherOptions}=options??{},runManager=yield(0,awaitAsyncGenerator.Z)(callbackManager_?.handleChainStart(_this10.toJSON(),_coerceToDict(input,"input"),runId,void 0,void 0,void 0,otherOptions?.runName)),steps=[_this10.first,..._this10.middle,_this10.last];let finalOutput,concatSupported=!0;function _inputGenerator(){return(_inputGenerator=(0,wrapAsyncGenerator.Z)((function*(){yield input}))).apply(this,arguments)}try{let finalGenerator=steps[0].transform(function inputGenerator(){return _inputGenerator.apply(this,arguments)}(),(0,runnables_config.q)(otherOptions,{callbacks:runManager?.getChild("seq:step:1")}));for(let i=1;i<steps.length;i+=1){const step=steps[i];finalGenerator=yield(0,awaitAsyncGenerator.Z)(step.transform(finalGenerator,(0,runnables_config.q)(otherOptions,{callbacks:runManager?.getChild(`seq:step:${i+1}`)})))}var _iteratorError9,_iteratorAbruptCompletion9=!1,_didIteratorError9=!1;try{for(var _step9,_iterator9=(0,asyncIterator.Z)(finalGenerator);_iteratorAbruptCompletion9=!(_step9=yield(0,awaitAsyncGenerator.Z)(_iterator9.next())).done;_iteratorAbruptCompletion9=!1){const chunk=_step9.value;if(yield chunk,concatSupported)if(void 0===finalOutput)finalOutput=chunk;else try{finalOutput=(0,utils_stream.zo)(finalOutput,chunk)}catch(e){finalOutput=void 0,concatSupported=!1}}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{_iteratorAbruptCompletion9&&null!=_iterator9.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator9.return()))}finally{if(_didIteratorError9)throw _iteratorError9}}}catch(e){throw yield(0,awaitAsyncGenerator.Z)(runManager?.handleChainError(e)),e}yield(0,awaitAsyncGenerator.Z)(runManager?.handleChainEnd(_coerceToDict(finalOutput,"output")))}))()}getGraph(config){const graph=new Graph;let currentLastNode=null;return this.steps.forEach(((step,index)=>{const stepGraph=step.getGraph(config);0!==index&&stepGraph.trimFirstNode(),index!==this.steps.length-1&&stepGraph.trimLastNode(),graph.extend(stepGraph);const stepFirstNode=stepGraph.firstNode();if(!stepFirstNode)throw new Error(`Runnable ${step} has no first node`);currentLastNode&&graph.addEdge(currentLastNode,stepFirstNode),currentLastNode=stepGraph.lastNode()})),graph}pipe(coerceable){return RunnableSequence.isRunnableSequence(coerceable)?new RunnableSequence({first:this.first,middle:this.middle.concat([this.last,coerceable.first,...coerceable.middle]),last:coerceable.last,name:this.name??coerceable.name}):new RunnableSequence({first:this.first,middle:[...this.middle,this.last],last:_coerceToRunnable(coerceable),name:this.name})}static isRunnableSequence(thing){return Array.isArray(thing.middle)&&Runnable.isRunnable(thing)}static from([first,...runnables],name){return new RunnableSequence({first:_coerceToRunnable(first),middle:runnables.slice(0,-1).map(_coerceToRunnable),last:_coerceToRunnable(runnables[runnables.length-1]),name})}}class RunnableMap extends Runnable{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[key,value]of Object.entries(fields.steps))this.steps[key]=_coerceToRunnable(value)}static from(steps){return new RunnableMap({steps})}invoke(input,options){var _this32=this;return(0,asyncToGenerator.Z)((function*(){const config=(0,runnables_config.LE)(options),callbackManager_=yield(0,runnables_config.Le)(config),runManager=yield callbackManager_?.handleChainStart(_this32.toJSON(),{input},config.runId,void 0,void 0,void 0,config?.runName);delete config.runId;const output={};try{yield Promise.all(Object.entries(_this32.steps).map(function(){var _ref9=(0,asyncToGenerator.Z)((function*([key,runnable]){output[key]=yield runnable.invoke(input,(0,runnables_config.q)(config,{callbacks:runManager?.getChild(`map:key:${key}`)}))}));return function(_x8){return _ref9.apply(this,arguments)}}()))}catch(e){throw yield runManager?.handleChainError(e),e}return yield runManager?.handleChainEnd(output),output}))()}_transform(generator,runManager,options){var _this11=this;return(0,wrapAsyncGenerator.Z)((function*(){const steps={..._this11.steps},inputCopies=(0,utils_stream.y2)(generator,Object.keys(steps).length),tasks=new Map(Object.entries(steps).map((([key,runnable],i)=>{const gen=runnable.transform(inputCopies[i],(0,runnables_config.q)(options,{callbacks:runManager?.getChild(`map:key:${key}`)}));return[key,gen.next().then((result=>({key,gen,result})))]})));for(;tasks.size;){const{key,result,gen}=yield(0,awaitAsyncGenerator.Z)(Promise.race(tasks.values()));tasks.delete(key),result.done||(yield{[key]:result.value},tasks.set(key,gen.next().then((result=>({key,gen,result})))))}}))()}transform(generator,options){return this._transformStreamWithConfig(generator,this._transform.bind(this),options)}stream(input,options){var _this33=this;return(0,asyncToGenerator.Z)((function*(){function _generator(){return(_generator=(0,wrapAsyncGenerator.Z)((function*(){yield input}))).apply(this,arguments)}const config=(0,runnables_config.LE)(options),wrappedGenerator=new utils_stream.qq({generator:_this33.transform(function generator(){return _generator.apply(this,arguments)}(),config),config});return yield wrappedGenerator.setup,utils_stream.QJ.fromAsyncGenerator(wrappedGenerator)}))()}}class RunnableTraceable extends Runnable{constructor(fields){if(super(fields),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!(0,traceable.xQ)(fields.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=fields.func}invoke(input,options){var _this34=this;return(0,asyncToGenerator.Z)((function*(){const[config]=_this34._getOptionsList(options??{},1),callbacks=yield(0,runnables_config.Le)(config);return yield _this34.func((0,runnables_config.q)(config,{callbacks}),input)}))()}_streamIterator(input,options){var _this12=this;return(0,wrapAsyncGenerator.Z)((function*(){const result=yield(0,awaitAsyncGenerator.Z)(_this12.invoke(input,options));if(isAsyncIterable(result)){var _iteratorError10,_iteratorAbruptCompletion10=!1,_didIteratorError10=!1;try{for(var _step10,_iterator10=(0,asyncIterator.Z)(result);_iteratorAbruptCompletion10=!(_step10=yield(0,awaitAsyncGenerator.Z)(_iterator10.next())).done;_iteratorAbruptCompletion10=!1){const item=_step10.value;yield item}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{_iteratorAbruptCompletion10&&null!=_iterator10.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator10.return()))}finally{if(_didIteratorError10)throw _iteratorError10}}}else{var x;if(null!=(x=result)&&"object"==typeof x&&"next"in x&&"function"==typeof x.next)for(;;){const state=result.next();if(state.done)break;yield state.value}else yield result}}))()}static from(func){return new RunnableTraceable({func})}}class RunnableLambda extends Runnable{static lc_name(){return"RunnableLambda"}constructor(fields){if((0,traceable.xQ)(fields.func))return RunnableTraceable.from(fields.func);super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function assertNonTraceableFunction(func){if((0,traceable.xQ)(func))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(fields.func),this.func=fields.func}static from(func){return new RunnableLambda({func})}_invoke(input,config,runManager){var _this35=this;return(0,asyncToGenerator.Z)((function*(){return new Promise(((resolve,reject)=>{const childConfig=(0,runnables_config.q)(config,{callbacks:runManager?.getChild(),recursionLimit:(config?.recursionLimit??runnables_config.ov)-1});singletons.A.getInstance().run(childConfig,(0,asyncToGenerator.Z)((function*(){try{let output=yield _this35.func(input,{...childConfig,config:childConfig});if(output&&Runnable.isRunnable(output)){if(0===config?.recursionLimit)throw new Error("Recursion limit reached.");output=yield output.invoke(input,{...childConfig,recursionLimit:(childConfig.recursionLimit??runnables_config.ov)-1})}else if(isAsyncIterable(output)){let finalOutput;var _iteratorError11,_iteratorAbruptCompletion11=!1,_didIteratorError11=!1;try{for(var _step11,_iterator11=(0,asyncIterator.Z)(consumeAsyncIterableInContext(childConfig,output));_iteratorAbruptCompletion11=!(_step11=yield _iterator11.next()).done;_iteratorAbruptCompletion11=!1){const chunk=_step11.value;if(void 0===finalOutput)finalOutput=chunk;else try{finalOutput=(0,utils_stream.zo)(finalOutput,chunk)}catch(e){finalOutput=chunk}}}catch(err){_didIteratorError11=!0,_iteratorError11=err}finally{try{_iteratorAbruptCompletion11&&null!=_iterator11.return&&(yield _iterator11.return())}finally{if(_didIteratorError11)throw _iteratorError11}}output=finalOutput}else if(isIterableIterator(output)){let finalOutput;for(const chunk of consumeIteratorInContext(childConfig,output))if(void 0===finalOutput)finalOutput=chunk;else try{finalOutput=(0,utils_stream.zo)(finalOutput,chunk)}catch(e){finalOutput=chunk}output=finalOutput}resolve(output)}catch(e){reject(e)}})))}))}))()}invoke(input,options){var _this36=this;return(0,asyncToGenerator.Z)((function*(){return _this36._callWithConfig(_this36._invoke,input,options)}))()}_transform(generator,runManager,config){var _this13=this;return(0,wrapAsyncGenerator.Z)((function*(){let finalChunk;var _iteratorError12,_iteratorAbruptCompletion12=!1,_didIteratorError12=!1;try{for(var _step12,_iterator12=(0,asyncIterator.Z)(generator);_iteratorAbruptCompletion12=!(_step12=yield(0,awaitAsyncGenerator.Z)(_iterator12.next())).done;_iteratorAbruptCompletion12=!1){const chunk=_step12.value;if(void 0===finalChunk)finalChunk=chunk;else try{finalChunk=(0,utils_stream.zo)(finalChunk,chunk)}catch(e){finalChunk=chunk}}}catch(err){_didIteratorError12=!0,_iteratorError12=err}finally{try{_iteratorAbruptCompletion12&&null!=_iterator12.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator12.return()))}finally{if(_didIteratorError12)throw _iteratorError12}}const output=yield(0,awaitAsyncGenerator.Z)(new Promise(((resolve,reject)=>{singletons.A.getInstance().run(config,(0,asyncToGenerator.Z)((function*(){try{const res=yield _this13.func(finalChunk,{...config,config});resolve(res)}catch(e){reject(e)}})))})));if(output&&Runnable.isRunnable(output)){if(0===config?.recursionLimit)throw new Error("Recursion limit reached.");const stream=yield(0,awaitAsyncGenerator.Z)(output.stream(finalChunk,(0,runnables_config.q)(config,{callbacks:runManager?.getChild(),recursionLimit:(config?.recursionLimit??runnables_config.ov)-1})));var _iteratorError13,_iteratorAbruptCompletion13=!1,_didIteratorError13=!1;try{for(var _step13,_iterator13=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion13=!(_step13=yield(0,awaitAsyncGenerator.Z)(_iterator13.next())).done;_iteratorAbruptCompletion13=!1){const chunk=_step13.value;yield chunk}}catch(err){_didIteratorError13=!0,_iteratorError13=err}finally{try{_iteratorAbruptCompletion13&&null!=_iterator13.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator13.return()))}finally{if(_didIteratorError13)throw _iteratorError13}}}else if(isAsyncIterable(output)){var _iteratorError14,_iteratorAbruptCompletion14=!1,_didIteratorError14=!1;try{for(var _step14,_iterator14=(0,asyncIterator.Z)(consumeAsyncIterableInContext(config,output));_iteratorAbruptCompletion14=!(_step14=yield(0,awaitAsyncGenerator.Z)(_iterator14.next())).done;_iteratorAbruptCompletion14=!1){const chunk=_step14.value;yield chunk}}catch(err){_didIteratorError14=!0,_iteratorError14=err}finally{try{_iteratorAbruptCompletion14&&null!=_iterator14.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator14.return()))}finally{if(_didIteratorError14)throw _iteratorError14}}}else if(isIterableIterator(output))for(const chunk of consumeIteratorInContext(config,output))yield chunk;else yield output}))()}transform(generator,options){return this._transformStreamWithConfig(generator,this._transform.bind(this),options)}stream(input,options){var _this37=this;return(0,asyncToGenerator.Z)((function*(){function _generator2(){return(_generator2=(0,wrapAsyncGenerator.Z)((function*(){yield input}))).apply(this,arguments)}const config=(0,runnables_config.LE)(options),wrappedGenerator=new utils_stream.qq({generator:_this37.transform(function generator(){return _generator2.apply(this,arguments)}(),config),config});return yield wrappedGenerator.setup,utils_stream.QJ.fromAsyncGenerator(wrappedGenerator)}))()}}class RunnableWithFallbacks extends Runnable{static lc_name(){return"RunnableWithFallbacks"}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=fields.runnable,this.fallbacks=fields.fallbacks}*runnables(){yield this.runnable;for(const fallback of this.fallbacks)yield fallback}invoke(input,options){var _this38=this;return(0,asyncToGenerator.Z)((function*(){const callbackManager_=yield manager.Ye.configure(options?.callbacks,void 0,options?.tags,void 0,options?.metadata),{runId,...otherOptions}=options??{},runManager=yield callbackManager_?.handleChainStart(_this38.toJSON(),_coerceToDict(input,"input"),runId,void 0,void 0,void 0,otherOptions?.runName);let firstError;for(const runnable of _this38.runnables())try{const output=yield runnable.invoke(input,(0,runnables_config.q)(otherOptions,{callbacks:runManager?.getChild()}));return yield runManager?.handleChainEnd(_coerceToDict(output,"output")),output}catch(e){void 0===firstError&&(firstError=e)}if(void 0===firstError)throw new Error("No error stored at end of fallback.");throw yield runManager?.handleChainError(firstError),firstError}))()}batch(inputs,options,batchOptions){var _this39=this;return(0,asyncToGenerator.Z)((function*(){if(batchOptions?.returnExceptions)throw new Error("Not implemented.");const configList=_this39._getOptionsList(options??{},inputs.length),callbackManagers=yield Promise.all(configList.map((config=>manager.Ye.configure(config?.callbacks,void 0,config?.tags,void 0,config?.metadata)))),runManagers=yield Promise.all(callbackManagers.map(function(){var _ref12=(0,asyncToGenerator.Z)((function*(callbackManager,i){const handleStartRes=yield callbackManager?.handleChainStart(_this39.toJSON(),_coerceToDict(inputs[i],"input"),configList[i].runId,void 0,void 0,void 0,configList[i].runName);return delete configList[i].runId,handleStartRes}));return function(_x9,_x10){return _ref12.apply(this,arguments)}}()));let firstError;for(const runnable of _this39.runnables())try{const outputs=yield runnable.batch(inputs,runManagers.map(((runManager,j)=>(0,runnables_config.q)(configList[j],{callbacks:runManager?.getChild()}))),batchOptions);return yield Promise.all(runManagers.map(((runManager,i)=>runManager?.handleChainEnd(_coerceToDict(outputs[i],"output"))))),outputs}catch(e){void 0===firstError&&(firstError=e)}if(!firstError)throw new Error("No error stored at end of fallbacks.");throw yield Promise.all(runManagers.map((runManager=>runManager?.handleChainError(firstError)))),firstError}))()}}function _coerceToRunnable(coerceable){if("function"==typeof coerceable)return new RunnableLambda({func:coerceable});if(Runnable.isRunnable(coerceable))return coerceable;if(Array.isArray(coerceable)||"object"!=typeof coerceable)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const runnables={};for(const[key,value]of Object.entries(coerceable))runnables[key]=_coerceToRunnable(value);return new RunnableMap({steps:runnables})}}class RunnableAssign extends Runnable{static lc_name(){return"RunnableAssign"}constructor(fields){fields instanceof RunnableMap&&(fields={mapper:fields}),super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=fields.mapper}invoke(input,options){var _this40=this;return(0,asyncToGenerator.Z)((function*(){const mapperResult=yield _this40.mapper.invoke(input,options);return{...input,...mapperResult}}))()}_transform(generator,runManager,options){var _this14=this;return(0,wrapAsyncGenerator.Z)((function*(){const mapperKeys=_this14.mapper.getStepsKeys(),[forPassthrough,forMapper]=(0,utils_stream.y2)(generator),mapperOutput=_this14.mapper.transform(forMapper,(0,runnables_config.q)(options,{callbacks:runManager?.getChild()})),firstMapperChunkPromise=mapperOutput.next();var _iteratorError15,_iteratorAbruptCompletion15=!1,_didIteratorError15=!1;try{for(var _step15,_iterator15=(0,asyncIterator.Z)(forPassthrough);_iteratorAbruptCompletion15=!(_step15=yield(0,awaitAsyncGenerator.Z)(_iterator15.next())).done;_iteratorAbruptCompletion15=!1){const chunk=_step15.value;{if("object"!=typeof chunk||Array.isArray(chunk))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof chunk);const filtered=Object.fromEntries(Object.entries(chunk).filter((([key])=>!mapperKeys.includes(key))));Object.keys(filtered).length>0&&(yield filtered)}}}catch(err){_didIteratorError15=!0,_iteratorError15=err}finally{try{_iteratorAbruptCompletion15&&null!=_iterator15.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator15.return()))}finally{if(_didIteratorError15)throw _iteratorError15}}yield(yield(0,awaitAsyncGenerator.Z)(firstMapperChunkPromise)).value;var _iteratorError16,_iteratorAbruptCompletion16=!1,_didIteratorError16=!1;try{for(var _step16,_iterator16=(0,asyncIterator.Z)(mapperOutput);_iteratorAbruptCompletion16=!(_step16=yield(0,awaitAsyncGenerator.Z)(_iterator16.next())).done;_iteratorAbruptCompletion16=!1){const chunk=_step16.value;yield chunk}}catch(err){_didIteratorError16=!0,_iteratorError16=err}finally{try{_iteratorAbruptCompletion16&&null!=_iterator16.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator16.return()))}finally{if(_didIteratorError16)throw _iteratorError16}}}))()}transform(generator,options){return this._transformStreamWithConfig(generator,this._transform.bind(this),options)}stream(input,options){var _this41=this;return(0,asyncToGenerator.Z)((function*(){function _generator3(){return(_generator3=(0,wrapAsyncGenerator.Z)((function*(){yield input}))).apply(this,arguments)}const config=(0,runnables_config.LE)(options),wrappedGenerator=new utils_stream.qq({generator:_this41.transform(function generator(){return _generator3.apply(this,arguments)}(),config),config});return yield wrappedGenerator.setup,utils_stream.QJ.fromAsyncGenerator(wrappedGenerator)}))()}}class RunnablePick extends Runnable{static lc_name(){return"RunnablePick"}constructor(fields){("string"==typeof fields||Array.isArray(fields))&&(fields={keys:fields}),super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=fields.keys}_pick(input){var _this42=this;return(0,asyncToGenerator.Z)((function*(){if("string"==typeof _this42.keys)return input[_this42.keys];{const picked=_this42.keys.map((key=>[key,input[key]])).filter((v=>void 0!==v[1]));return 0===picked.length?void 0:Object.fromEntries(picked)}}))()}invoke(input,options){var _this43=this;return(0,asyncToGenerator.Z)((function*(){return _this43._callWithConfig(_this43._pick.bind(_this43),input,options)}))()}_transform(generator){var _this15=this;return(0,wrapAsyncGenerator.Z)((function*(){var _iteratorError17,_iteratorAbruptCompletion17=!1,_didIteratorError17=!1;try{for(var _step17,_iterator17=(0,asyncIterator.Z)(generator);_iteratorAbruptCompletion17=!(_step17=yield(0,awaitAsyncGenerator.Z)(_iterator17.next())).done;_iteratorAbruptCompletion17=!1){const chunk=_step17.value;{const picked=yield(0,awaitAsyncGenerator.Z)(_this15._pick(chunk));void 0!==picked&&(yield picked)}}}catch(err){_didIteratorError17=!0,_iteratorError17=err}finally{try{_iteratorAbruptCompletion17&&null!=_iterator17.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator17.return()))}finally{if(_didIteratorError17)throw _iteratorError17}}}))()}transform(generator,options){return this._transformStreamWithConfig(generator,this._transform.bind(this),options)}stream(input,options){var _this44=this;return(0,asyncToGenerator.Z)((function*(){function _generator4(){return(_generator4=(0,wrapAsyncGenerator.Z)((function*(){yield input}))).apply(this,arguments)}const config=(0,runnables_config.LE)(options),wrappedGenerator=new utils_stream.qq({generator:_this44.transform(function generator(){return _generator4.apply(this,arguments)}(),config),config});return yield wrappedGenerator.setup,utils_stream.QJ.fromAsyncGenerator(wrappedGenerator)}))()}}},"./node_modules/@langchain/core/dist/runnables/config.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{LE:()=>ensureConfig,Le:()=>getCallbackManagerForConfig,ov:()=>DEFAULT_RECURSION_LIMIT,q:()=>patchConfig,t8:()=>mergeConfigs});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/callbacks/manager.js"),_singletons_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/singletons/index.js");const DEFAULT_RECURSION_LIMIT=25;function getCallbackManagerForConfig(_x){return _getCallbackManagerForConfig.apply(this,arguments)}function _getCallbackManagerForConfig(){return(_getCallbackManagerForConfig=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(config){return _callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__.Ye.configure(config?.callbacks,void 0,config?.tags,void 0,config?.metadata)}))).apply(this,arguments)}function mergeConfigs(...configs){const copy={};for(const options of configs.filter((c=>!!c)))for(const key of Object.keys(options))if("metadata"===key)copy[key]={...copy[key],...options[key]};else if("tags"===key){const baseKeys=copy[key]??[];copy[key]=[...new Set(baseKeys.concat(options[key]??[]))]}else if("configurable"===key)copy[key]={...copy[key],...options[key]};else if("callbacks"===key){const baseCallbacks=copy.callbacks,providedCallbacks=options.callbacks;if(Array.isArray(providedCallbacks))if(baseCallbacks)if(Array.isArray(baseCallbacks))copy.callbacks=baseCallbacks.concat(providedCallbacks);else{const manager=baseCallbacks.copy();for(const callback of providedCallbacks)manager.addHandler((0,_callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__.xz)(callback),!0);copy.callbacks=manager}else copy.callbacks=providedCallbacks;else if(providedCallbacks)if(baseCallbacks)if(Array.isArray(baseCallbacks)){const manager=providedCallbacks.copy();for(const callback of baseCallbacks)manager.addHandler((0,_callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__.xz)(callback),!0);copy.callbacks=manager}else copy.callbacks=new _callbacks_manager_js__WEBPACK_IMPORTED_MODULE_0__.Ye(providedCallbacks._parentRunId,{handlers:baseCallbacks.handlers.concat(providedCallbacks.handlers),inheritableHandlers:baseCallbacks.inheritableHandlers.concat(providedCallbacks.inheritableHandlers),tags:Array.from(new Set(baseCallbacks.tags.concat(providedCallbacks.tags))),inheritableTags:Array.from(new Set(baseCallbacks.inheritableTags.concat(providedCallbacks.inheritableTags))),metadata:{...baseCallbacks.metadata,...providedCallbacks.metadata}});else copy.callbacks=providedCallbacks}else{const typedKey=key;copy[typedKey]=options[typedKey]??copy[typedKey]}return copy}const PRIMITIVES=new Set(["string","number","boolean"]);function ensureConfig(config){const loadedConfig=config??_singletons_index_js__WEBPACK_IMPORTED_MODULE_1__.A.getInstance().getStore();let empty={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(loadedConfig&&(empty={...empty,...loadedConfig}),loadedConfig?.configurable)for(const key of Object.keys(loadedConfig.configurable))PRIMITIVES.has(typeof loadedConfig.configurable[key])&&!empty.metadata?.[key]&&(empty.metadata||(empty.metadata={}),empty.metadata[key]=loadedConfig.configurable[key]);return empty}function patchConfig(config={},{callbacks,maxConcurrency,recursionLimit,runName,configurable,runId}={}){const newConfig=ensureConfig(config);return void 0!==callbacks&&(delete newConfig.runName,newConfig.callbacks=callbacks),void 0!==recursionLimit&&(newConfig.recursionLimit=recursionLimit),void 0!==maxConcurrency&&(newConfig.maxConcurrency=maxConcurrency),void 0!==runName&&(newConfig.runName=runName),void 0!==configurable&&(newConfig.configurable={...newConfig.configurable,...configurable}),void 0!==runId&&delete newConfig.runId,newConfig}},"./node_modules/@langchain/core/dist/runnables/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{eq:()=>base.eq,sk:()=>passthrough_RunnablePassthrough,lW:()=>base.lW,LE:()=>runnables_config.LE,q:()=>runnables_config.q});var base=__webpack_require__("./node_modules/@langchain/core/dist/runnables/base.js"),runnables_config=__webpack_require__("./node_modules/@langchain/core/dist/runnables/config.js"),asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),awaitAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),wrapAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),asyncIterator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js"),stream=__webpack_require__("./node_modules/@langchain/core/dist/utils/stream.js");class passthrough_RunnablePassthrough extends base.eq{static lc_name(){return"RunnablePassthrough"}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),fields&&(this.func=fields.func)}invoke(input,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const config=(0,runnables_config.LE)(options);return _this2.func&&(yield _this2.func(input,config)),_this2._callWithConfig((input=>Promise.resolve(input)),input,config)}))()}transform(generator,options){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){const config=(0,runnables_config.LE)(options);let finalOutput,finalOutputSupported=!0;var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(_this._transformStreamWithConfig(generator,(input=>input),config));_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;if(yield chunk,finalOutputSupported)if(void 0===finalOutput)finalOutput=chunk;else try{finalOutput=(0,stream.zo)(finalOutput,chunk)}catch{finalOutput=void 0,finalOutputSupported=!1}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}_this.func&&void 0!==finalOutput&&(yield(0,awaitAsyncGenerator.Z)(_this.func(finalOutput,config)))}))()}static assign(mapping){return new base.Vh(new base.dT({steps:mapping}))}}__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js")},"./node_modules/@langchain/core/dist/singletons/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>AsyncLocalStorageProviderSingleton});const mockAsyncLocalStorage=new class MockAsyncLocalStorage{getStore(){}run(_store,callback){return callback()}};const AsyncLocalStorageProviderSingleton=new class AsyncLocalStorageProvider{getInstance(){return globalThis.__lc_tracing_async_local_storage??mockAsyncLocalStorage}initializeGlobalInstance(instance){void 0===globalThis.__lc_tracing_async_local_storage&&(globalThis.__lc_tracing_async_local_storage=instance)}}},"./node_modules/@langchain/core/dist/tracers/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>BaseTracer});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_callbacks_base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/callbacks/base.js");function _coerceToDict(value,defaultKey){return value&&!Array.isArray(value)&&"object"==typeof value?value:{[defaultKey]:value}}class BaseTracer extends _callbacks_base_js__WEBPACK_IMPORTED_MODULE_0__.E{constructor(_fields){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(error){return error instanceof Error?error.message+(error?.stack?`\n\n${error.stack}`:""):"string"==typeof error?error:`${error}`}_addChildRun(parentRun,childRun){parentRun.child_runs.push(childRun)}_startTrace(run){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const currentDottedOrder=function convertToDottedOrderFormat(epoch,runId,executionOrder){const paddedOrder=executionOrder.toFixed(0).slice(0,3).padStart(3,"0");return function stripNonAlphanumeric(input){return input.replace(/[-:.]/g,"")}(`${new Date(epoch).toISOString().slice(0,-1)}${paddedOrder}Z`)+runId}(run.start_time,run.id,run.execution_order),storedRun={...run};if(void 0!==storedRun.parent_run_id){const parentRun=_this.runMap.get(storedRun.parent_run_id);parentRun&&(_this._addChildRun(parentRun,storedRun),parentRun.child_execution_order=Math.max(parentRun.child_execution_order,storedRun.child_execution_order),storedRun.trace_id=parentRun.trace_id,void 0!==parentRun.dotted_order&&(storedRun.dotted_order=[parentRun.dotted_order,currentDottedOrder].join(".")))}else storedRun.trace_id=storedRun.id,storedRun.dotted_order=currentDottedOrder;_this.runMap.set(storedRun.id,storedRun),yield _this.onRunCreate?.(storedRun)}))()}_endTrace(run){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const parentRun=void 0!==run.parent_run_id&&_this2.runMap.get(run.parent_run_id);parentRun?parentRun.child_execution_order=Math.max(parentRun.child_execution_order,run.child_execution_order):yield _this2.persistRun(run),_this2.runMap.delete(run.id),yield _this2.onRunUpdate?.(run)}))()}_getExecutionOrder(parentRunId){const parentRun=void 0!==parentRunId&&this.runMap.get(parentRunId);return parentRun?parentRun.child_execution_order+1:1}handleLLMStart(llm,prompts,runId,parentRunId,extraParams,tags,metadata,name){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const execution_order=_this3._getExecutionOrder(parentRunId),start_time=Date.now(),finalExtraParams=metadata?{...extraParams,metadata}:extraParams,run={id:runId,name:name??llm.id[llm.id.length-1],parent_run_id:parentRunId,start_time,serialized:llm,events:[{name:"start",time:new Date(start_time).toISOString()}],inputs:{prompts},execution_order,child_runs:[],child_execution_order:execution_order,run_type:"llm",extra:finalExtraParams??{},tags:tags||[]};return yield _this3._startTrace(run),yield _this3.onLLMStart?.(run),run}))()}handleChatModelStart(llm,messages,runId,parentRunId,extraParams,tags,metadata,name){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const execution_order=_this4._getExecutionOrder(parentRunId),start_time=Date.now(),finalExtraParams=metadata?{...extraParams,metadata}:extraParams,run={id:runId,name:name??llm.id[llm.id.length-1],parent_run_id:parentRunId,start_time,serialized:llm,events:[{name:"start",time:new Date(start_time).toISOString()}],inputs:{messages},execution_order,child_runs:[],child_execution_order:execution_order,run_type:"llm",extra:finalExtraParams??{},tags:tags||[]};return yield _this4._startTrace(run),yield _this4.onLLMStart?.(run),run}))()}handleLLMEnd(output,runId){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this5.runMap.get(runId);if(!run||"llm"!==run?.run_type)throw new Error("No LLM run to end.");return run.end_time=Date.now(),run.outputs=output,run.events.push({name:"end",time:new Date(run.end_time).toISOString()}),yield _this5.onLLMEnd?.(run),yield _this5._endTrace(run),run}))()}handleLLMError(error,runId){var _this6=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this6.runMap.get(runId);if(!run||"llm"!==run?.run_type)throw new Error("No LLM run to end.");return run.end_time=Date.now(),run.error=_this6.stringifyError(error),run.events.push({name:"error",time:new Date(run.end_time).toISOString()}),yield _this6.onLLMError?.(run),yield _this6._endTrace(run),run}))()}handleChainStart(chain,inputs,runId,parentRunId,tags,metadata,runType,name){var _this7=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const execution_order=_this7._getExecutionOrder(parentRunId),start_time=Date.now(),run={id:runId,name:name??chain.id[chain.id.length-1],parent_run_id:parentRunId,start_time,serialized:chain,events:[{name:"start",time:new Date(start_time).toISOString()}],inputs,execution_order,child_execution_order:execution_order,run_type:runType??"chain",child_runs:[],extra:metadata?{metadata}:{},tags:tags||[]};return yield _this7._startTrace(run),yield _this7.onChainStart?.(run),run}))()}handleChainEnd(outputs,runId,_parentRunId,_tags,kwargs){var _this8=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this8.runMap.get(runId);if(!run)throw new Error("No chain run to end.");return run.end_time=Date.now(),run.outputs=_coerceToDict(outputs,"output"),run.events.push({name:"end",time:new Date(run.end_time).toISOString()}),void 0!==kwargs?.inputs&&(run.inputs=_coerceToDict(kwargs.inputs,"input")),yield _this8.onChainEnd?.(run),yield _this8._endTrace(run),run}))()}handleChainError(error,runId,_parentRunId,_tags,kwargs){var _this9=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this9.runMap.get(runId);if(!run)throw new Error("No chain run to end.");return run.end_time=Date.now(),run.error=_this9.stringifyError(error),run.events.push({name:"error",time:new Date(run.end_time).toISOString()}),void 0!==kwargs?.inputs&&(run.inputs=_coerceToDict(kwargs.inputs,"input")),yield _this9.onChainError?.(run),yield _this9._endTrace(run),run}))()}handleToolStart(tool,input,runId,parentRunId,tags,metadata,name){var _this10=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const execution_order=_this10._getExecutionOrder(parentRunId),start_time=Date.now(),run={id:runId,name:name??tool.id[tool.id.length-1],parent_run_id:parentRunId,start_time,serialized:tool,events:[{name:"start",time:new Date(start_time).toISOString()}],inputs:{input},execution_order,child_execution_order:execution_order,run_type:"tool",child_runs:[],extra:metadata?{metadata}:{},tags:tags||[]};return yield _this10._startTrace(run),yield _this10.onToolStart?.(run),run}))()}handleToolEnd(output,runId){var _this11=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this11.runMap.get(runId);if(!run||"tool"!==run?.run_type)throw new Error("No tool run to end");return run.end_time=Date.now(),run.outputs={output},run.events.push({name:"end",time:new Date(run.end_time).toISOString()}),yield _this11.onToolEnd?.(run),yield _this11._endTrace(run),run}))()}handleToolError(error,runId){var _this12=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this12.runMap.get(runId);if(!run||"tool"!==run?.run_type)throw new Error("No tool run to end");return run.end_time=Date.now(),run.error=_this12.stringifyError(error),run.events.push({name:"error",time:new Date(run.end_time).toISOString()}),yield _this12.onToolError?.(run),yield _this12._endTrace(run),run}))()}handleAgentAction(action,runId){var _this13=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this13.runMap.get(runId);if(!run||"chain"!==run?.run_type)return;const agentRun=run;agentRun.actions=agentRun.actions||[],agentRun.actions.push(action),agentRun.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action}}),yield _this13.onAgentAction?.(run)}))()}handleAgentEnd(action,runId){var _this14=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this14.runMap.get(runId);run&&"chain"===run?.run_type&&(run.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action}}),yield _this14.onAgentEnd?.(run))}))()}handleRetrieverStart(retriever,query,runId,parentRunId,tags,metadata,name){var _this15=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const execution_order=_this15._getExecutionOrder(parentRunId),start_time=Date.now(),run={id:runId,name:name??retriever.id[retriever.id.length-1],parent_run_id:parentRunId,start_time,serialized:retriever,events:[{name:"start",time:new Date(start_time).toISOString()}],inputs:{query},execution_order,child_execution_order:execution_order,run_type:"retriever",child_runs:[],extra:metadata?{metadata}:{},tags:tags||[]};return yield _this15._startTrace(run),yield _this15.onRetrieverStart?.(run),run}))()}handleRetrieverEnd(documents,runId){var _this16=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this16.runMap.get(runId);if(!run||"retriever"!==run?.run_type)throw new Error("No retriever run to end");return run.end_time=Date.now(),run.outputs={documents},run.events.push({name:"end",time:new Date(run.end_time).toISOString()}),yield _this16.onRetrieverEnd?.(run),yield _this16._endTrace(run),run}))()}handleRetrieverError(error,runId){var _this17=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this17.runMap.get(runId);if(!run||"retriever"!==run?.run_type)throw new Error("No retriever run to end");return run.end_time=Date.now(),run.error=_this17.stringifyError(error),run.events.push({name:"error",time:new Date(run.end_time).toISOString()}),yield _this17.onRetrieverError?.(run),yield _this17._endTrace(run),run}))()}handleText(text,runId){var _this18=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this18.runMap.get(runId);run&&"chain"===run?.run_type&&(run.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text}}),yield _this18.onText?.(run))}))()}handleLLMNewToken(token,idx,runId,_parentRunId,_tags,fields){var _this19=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_1__.Z)((function*(){const run=_this19.runMap.get(runId);if(!run||"llm"!==run?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return run.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token,idx,chunk:fields?.chunk}}),yield _this19.onLLMNewToken?.(run,token,{chunk:fields?.chunk}),run}))()}}},"./node_modules/@langchain/core/dist/tracers/event_stream.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C:()=>isStreamEventsHandler,d:()=>EventStreamCallbackHandler});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_wrapAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js"),_base_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/tracers/base.js"),_utils_stream_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/utils/stream.js"),_messages_ai_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@langchain/core/dist/messages/ai.js"),_outputs_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@langchain/core/dist/outputs.js");function assignName({name,serialized}){return void 0!==name?name:void 0!==serialized?.name?serialized.name:void 0!==serialized?.id&&Array.isArray(serialized?.id)?serialized.id[serialized.id.length-1]:"Unnamed"}const isStreamEventsHandler=handler=>"event_stream_tracer"===handler.name;class EventStreamCallbackHandler extends _base_js__WEBPACK_IMPORTED_MODULE_1__.Z{constructor(fields){super({_awaitHandler:!0,...fields}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=fields?.autoClose??!0,this.includeNames=fields?.includeNames,this.includeTypes=fields?.includeTypes,this.includeTags=fields?.includeTags,this.excludeNames=fields?.excludeNames,this.excludeTypes=fields?.excludeTypes,this.excludeTags=fields?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_utils_stream_js__WEBPACK_IMPORTED_MODULE_2__.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(_run){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){}))()}_includeRun(run){const runTags=run.tags??[];let include=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(include=include||this.includeNames.includes(run.name)),void 0!==this.includeTypes&&(include=include||this.includeTypes.includes(run.runType)),void 0!==this.includeTags&&(include=include||void 0!==runTags.find((tag=>this.includeTags?.includes(tag)))),void 0!==this.excludeNames&&(include=include&&!this.excludeNames.includes(run.name)),void 0!==this.excludeTypes&&(include=include&&!this.excludeTypes.includes(run.runType)),void 0!==this.excludeTags&&(include=include&&runTags.every((tag=>!this.excludeTags?.includes(tag)))),include}tapOutputIterable(runId,outputStream){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_wrapAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){const firstChunk=yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)(outputStream.next());if(firstChunk.done)return;const runInfo=_this.runInfoMap.get(runId);if(void 0===runInfo)return void(yield firstChunk.value);let tappedPromise=_this.tappedPromises.get(runId);if(void 0===tappedPromise){let tappedPromiseResolver;tappedPromise=new Promise((resolve=>{tappedPromiseResolver=resolve})),_this.tappedPromises.set(runId,tappedPromise);try{const event={event:`on_${runInfo.runType}_stream`,run_id:runId,name:runInfo.name,tags:runInfo.tags,metadata:runInfo.metadata,data:{}};yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)(_this.send({...event,data:{chunk:firstChunk.value}},runInfo)),yield firstChunk.value;var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_6__.Z)(outputStream);_iteratorAbruptCompletion=!(_step=yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;"tool"!==runInfo.runType&&"retriever"!==runInfo.runType&&(yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)(_this.send({...event,data:{chunk}},runInfo))),yield chunk}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}}finally{tappedPromiseResolver()}}else{yield firstChunk.value;var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_6__.Z)(outputStream);_iteratorAbruptCompletion2=!(_step2=yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)(_iterator2.next())).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;yield chunk}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)(_iterator2.return()))}finally{if(_didIteratorError2)throw _iteratorError2}}}}))()}send(payload,run){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){_this2._includeRun(run)&&(yield _this2.writer.write(payload))}))()}sendEndEvent(payload,run){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const tappedPromise=_this3.tappedPromises.get(payload.run_id);void 0!==tappedPromise?tappedPromise.then((()=>{_this3.send(payload,run)})):yield _this3.send(payload,run)}))()}onLLMStart(run){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runName=assignName(run),runType=void 0!==run.inputs.messages?"chat_model":"llm",runInfo={tags:run.tags??[],metadata:run.extra?.metadata??{},name:runName,runType,inputs:run.inputs};_this4.runInfoMap.set(run.id,runInfo);const eventName=`on_${runType}_start`;yield _this4.send({event:eventName,data:{input:run.inputs},name:runName,tags:run.tags??[],run_id:run.id,metadata:run.extra?.metadata??{}},runInfo)}))()}onLLMNewToken(run,token,kwargs){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runInfo=_this5.runInfoMap.get(run.id);let chunk,eventName;if(void 0===runInfo)throw new Error(`onLLMNewToken: Run ID ${run.id} not found in run map.`);if("chat_model"===runInfo.runType)eventName="on_chat_model_stream",chunk=void 0===kwargs?.chunk?new _messages_ai_js__WEBPACK_IMPORTED_MODULE_3__.GC({content:token}):kwargs.chunk.message;else{if("llm"!==runInfo.runType)throw new Error(`Unexpected run type ${runInfo.runType}`);eventName="on_llm_stream",chunk=void 0===kwargs?.chunk?new _outputs_js__WEBPACK_IMPORTED_MODULE_7__.b6({text:token}):kwargs.chunk}yield _this5.send({event:eventName,data:{chunk},run_id:run.id,name:runInfo.name,tags:runInfo.tags,metadata:runInfo.metadata},runInfo)}))()}onLLMEnd(run){var _this6=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runInfo=_this6.runInfoMap.get(run.id);let eventName;if(_this6.runInfoMap.delete(run.id),void 0===runInfo)throw new Error(`onLLMEnd: Run ID ${run.id} not found in run map.`);const generations=run.outputs?.generations;let output;if("chat_model"===runInfo.runType){for(const generation of generations??[]){if(void 0!==output)break;output=generation[0]?.message}eventName="on_chat_model_end"}else{if("llm"!==runInfo.runType)throw new Error(`onLLMEnd: Unexpected run type: ${runInfo.runType}`);output={generations:generations?.map((generation=>generation.map((chunk=>({text:chunk.text,generationInfo:chunk.generationInfo}))))),llmOutput:run.outputs?.llmOutput??{}},eventName="on_llm_end"}yield _this6.sendEndEvent({event:eventName,data:{output,input:runInfo.inputs},run_id:run.id,name:runInfo.name,tags:runInfo.tags,metadata:runInfo.metadata},runInfo)}))()}onChainStart(run){var _this7=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runName=assignName(run),runType=run.run_type??"chain",runInfo={tags:run.tags??[],metadata:run.extra?.metadata??{},name:runName,runType:run.run_type};let eventData={};""===run.inputs.input&&1===Object.keys(run.inputs).length?(eventData={},runInfo.inputs={}):void 0!==run.inputs.input?(eventData.input=run.inputs.input,runInfo.inputs=run.inputs.input):(eventData.input=run.inputs,runInfo.inputs=run.inputs),_this7.runInfoMap.set(run.id,runInfo),yield _this7.send({event:`on_${runType}_start`,data:eventData,name:runName,tags:run.tags??[],run_id:run.id,metadata:run.extra?.metadata??{}},runInfo)}))()}onChainEnd(run){var _this8=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runInfo=_this8.runInfoMap.get(run.id);if(_this8.runInfoMap.delete(run.id),void 0===runInfo)throw new Error(`onChainEnd: Run ID ${run.id} not found in run map.`);const eventName=`on_${run.run_type}_end`,inputs=run.inputs??runInfo.inputs??{},data={output:run.outputs?.output??run.outputs,input:inputs};inputs.input&&1===Object.keys(inputs).length&&(data.input=inputs.input,runInfo.inputs=inputs.input),yield _this8.sendEndEvent({event:eventName,data,run_id:run.id,name:runInfo.name,tags:runInfo.tags,metadata:runInfo.metadata??{}},runInfo)}))()}onToolStart(run){var _this9=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runName=assignName(run),runInfo={tags:run.tags??[],metadata:run.extra?.metadata??{},name:runName,runType:"tool",inputs:run.inputs??{}};_this9.runInfoMap.set(run.id,runInfo),yield _this9.send({event:"on_tool_start",data:{input:run.inputs??{}},name:runName,run_id:run.id,tags:run.tags??[],metadata:run.extra?.metadata??{}},runInfo)}))()}onToolEnd(run){var _this10=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runInfo=_this10.runInfoMap.get(run.id);if(_this10.runInfoMap.delete(run.id),void 0===runInfo)throw new Error(`onToolEnd: Run ID ${run.id} not found in run map.`);if(void 0===runInfo.inputs)throw new Error(`onToolEnd: Run ID ${run.id} is a tool call, and is expected to have traced inputs.`);const output=void 0===run.outputs?.output?run.outputs:run.outputs.output;yield _this10.sendEndEvent({event:"on_tool_end",data:{output,input:runInfo.inputs},run_id:run.id,name:runInfo.name,tags:runInfo.tags,metadata:runInfo.metadata},runInfo)}))()}onRetrieverStart(run){var _this11=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runName=assignName(run),runInfo={tags:run.tags??[],metadata:run.extra?.metadata??{},name:runName,runType:"retriever",inputs:{query:run.inputs.query}};_this11.runInfoMap.set(run.id,runInfo),yield _this11.send({event:"on_retriever_start",data:{input:{query:run.inputs.query}},name:runName,tags:run.tags??[],run_id:run.id,metadata:run.extra?.metadata??{}},runInfo)}))()}onRetrieverEnd(run){var _this12=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const runInfo=_this12.runInfoMap.get(run.id);if(_this12.runInfoMap.delete(run.id),void 0===runInfo)throw new Error(`onRetrieverEnd: Run ID ${run.id} not found in run map.`);yield _this12.sendEndEvent({event:"on_retriever_end",data:{output:run.outputs?.documents??run.outputs,input:runInfo.inputs},run_id:run.id,name:runInfo.name,tags:runInfo.tags,metadata:runInfo.metadata},runInfo)}))()}finish(){var _this13=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_4__.Z)((function*(){const pendingPromises=[..._this13.tappedPromises.values()];Promise.all(pendingPromises).finally((()=>{_this13.writer.close()}))}))()}}},"./node_modules/@langchain/core/dist/tracers/log_stream.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Te:()=>LogStreamCallbackHandler,hv:()=>RunLogPatch,ky:()=>isLogStreamHandler,y6:()=>RunLog});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_wrapAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js"),_utils_fast_json_patch_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/utils/fast-json-patch/index.js"),_base_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/dist/tracers/base.js"),_utils_stream_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@langchain/core/dist/utils/stream.js"),_messages_index_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js");class RunLogPatch{constructor(fields){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=fields.ops??[]}concat(other){const ops=this.ops.concat(other.ops),states=(0,_utils_fast_json_patch_index_js__WEBPACK_IMPORTED_MODULE_1__.af)({},ops);return new RunLog({ops,state:states[states.length-1].newDocument})}}class RunLog extends RunLogPatch{constructor(fields){super(fields),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=fields.state}concat(other){const ops=this.ops.concat(other.ops),states=(0,_utils_fast_json_patch_index_js__WEBPACK_IMPORTED_MODULE_1__.af)(this.state,other.ops);return new RunLog({ops,state:states[states.length-1].newDocument})}static fromRunLogPatch(patch){const states=(0,_utils_fast_json_patch_index_js__WEBPACK_IMPORTED_MODULE_1__.af)({},patch.ops);return new RunLog({ops:patch.ops,state:states[states.length-1].newDocument})}}const isLogStreamHandler=handler=>"log_stream_tracer"===handler.name;function _getStandardizedInputs(_x,_x2){return _getStandardizedInputs2.apply(this,arguments)}function _getStandardizedInputs2(){return(_getStandardizedInputs2=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)((function*(run,schemaFormat){if("original"===schemaFormat)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs}=run;return["retriever","llm","prompt"].includes(run.run_type)?inputs:1!==Object.keys(inputs).length||""!==inputs?.input?inputs.input:void 0}))).apply(this,arguments)}function _getStandardizedOutputs(_x3,_x4){return _getStandardizedOutputs2.apply(this,arguments)}function _getStandardizedOutputs2(){return(_getStandardizedOutputs2=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)((function*(run,schemaFormat){const{outputs}=run;return"original"===schemaFormat||["retriever","llm","prompt"].includes(run.run_type)?outputs:void 0!==outputs&&1===Object.keys(outputs).length&&void 0!==outputs?.output?outputs.output:outputs}))).apply(this,arguments)}class LogStreamCallbackHandler extends _base_js__WEBPACK_IMPORTED_MODULE_2__.Z{constructor(fields){super({_awaitHandler:!0,...fields}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=fields?.autoClose??!0,this.includeNames=fields?.includeNames,this.includeTypes=fields?.includeTypes,this.includeTags=fields?.includeTags,this.excludeNames=fields?.excludeNames,this.excludeTypes=fields?.excludeTypes,this.excludeTags=fields?.excludeTags,this._schemaFormat=fields?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_utils_stream_js__WEBPACK_IMPORTED_MODULE_3__.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(_run){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)((function*(){}))()}_includeRun(run){if(run.id===this.rootId)return!1;const runTags=run.tags??[];let include=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(include=include||this.includeNames.includes(run.name)),void 0!==this.includeTypes&&(include=include||this.includeTypes.includes(run.run_type)),void 0!==this.includeTags&&(include=include||void 0!==runTags.find((tag=>this.includeTags?.includes(tag)))),void 0!==this.excludeNames&&(include=include&&!this.excludeNames.includes(run.name)),void 0!==this.excludeTypes&&(include=include&&!this.excludeTypes.includes(run.run_type)),void 0!==this.excludeTags&&(include=include&&runTags.every((tag=>!this.excludeTags?.includes(tag)))),include}tapOutputIterable(runId,output){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_wrapAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_6__.Z)(output);_iteratorAbruptCompletion=!(_step=yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_7__.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;if(runId!==_this.rootId){const key=_this.keyMapByRunId[runId];key&&(yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_7__.Z)(_this.writer.write(new RunLogPatch({ops:[{op:"add",path:`/logs/${key}/streamed_output/-`,value:chunk}]}))))}yield chunk}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_7__.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}}))()}onRunCreate(run){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)((function*(){if(void 0===_this2.rootId&&(_this2.rootId=run.id,yield _this2.writer.write(new RunLogPatch({ops:[{op:"replace",path:"",value:{id:run.id,name:run.name,type:run.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!_this2._includeRun(run))return;void 0===_this2.counterMapByRunName[run.name]&&(_this2.counterMapByRunName[run.name]=0),_this2.counterMapByRunName[run.name]+=1;const count=_this2.counterMapByRunName[run.name];_this2.keyMapByRunId[run.id]=1===count?run.name:`${run.name}:${count}`;const logEntry={id:run.id,name:run.name,type:run.run_type,tags:run.tags??[],metadata:run.extra?.metadata??{},start_time:new Date(run.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===_this2._schemaFormat&&(logEntry.inputs=yield _getStandardizedInputs(run,_this2._schemaFormat)),yield _this2.writer.write(new RunLogPatch({ops:[{op:"add",path:`/logs/${_this2.keyMapByRunId[run.id]}`,value:logEntry}]}))}))()}onRunUpdate(run){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)((function*(){try{const runName=_this3.keyMapByRunId[run.id];if(void 0===runName)return;const ops=[];"streaming_events"===_this3._schemaFormat&&ops.push({op:"replace",path:`/logs/${runName}/inputs`,value:yield _getStandardizedInputs(run,_this3._schemaFormat)}),ops.push({op:"add",path:`/logs/${runName}/final_output`,value:yield _getStandardizedOutputs(run,_this3._schemaFormat)}),void 0!==run.end_time&&ops.push({op:"add",path:`/logs/${runName}/end_time`,value:new Date(run.end_time).toISOString()});const patch=new RunLogPatch({ops});yield _this3.writer.write(patch)}finally{if(run.id===_this3.rootId){const patch=new RunLogPatch({ops:[{op:"replace",path:"/final_output",value:yield _getStandardizedOutputs(run,_this3._schemaFormat)}]});yield _this3.writer.write(patch),_this3.autoClose&&(yield _this3.writer.close())}}}))()}onLLMNewToken(run,token,kwargs){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.Z)((function*(){const runName=_this4.keyMapByRunId[run.id];if(void 0===runName)return;let streamedOutputValue;streamedOutputValue=void 0!==run.inputs.messages?function isChatGenerationChunk(x){return void 0!==x&&void 0!==x.message}(kwargs?.chunk)?kwargs?.chunk:new _messages_index_js__WEBPACK_IMPORTED_MODULE_4__.GC(token):token;const patch=new RunLogPatch({ops:[{op:"add",path:`/logs/${runName}/streamed_output_str/-`,value:token},{op:"add",path:`/logs/${runName}/streamed_output/-`,value:streamedOutputValue}]});yield _this4.writer.write(patch)}))()}}},"./node_modules/@langchain/core/dist/utils/async_caller.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{L:()=>AsyncCaller});var p_retry__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/p-retry/index.js"),p_retry__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(p_retry__WEBPACK_IMPORTED_MODULE_0__),p_queue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/p-queue/dist/index.js");const STATUS_NO_RETRY=[400,401,402,403,404,405,406,407,409],defaultFailedAttemptHandler=error=>{if(error.message.startsWith("Cancel")||error.message.startsWith("AbortError")||"AbortError"===error.name)throw error;if("ECONNABORTED"===error?.code)throw error;const status=error?.response?.status??error?.status;if(status&&STATUS_NO_RETRY.includes(+status))throw error;if("insufficient_quota"===error?.error?.code){const err=new Error(error?.message);throw err.name="InsufficientQuotaError",err}};class AsyncCaller{constructor(params){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=params.maxConcurrency??1/0,this.maxRetries=params.maxRetries??6,this.onFailedAttempt=params.onFailedAttempt??defaultFailedAttemptHandler;const PQueue="default"in p_queue__WEBPACK_IMPORTED_MODULE_1__.Z?p_queue__WEBPACK_IMPORTED_MODULE_1__.Z.default:p_queue__WEBPACK_IMPORTED_MODULE_1__.Z;this.queue=new PQueue({concurrency:this.maxConcurrency})}call(callable,...args){return this.queue.add((()=>p_retry__WEBPACK_IMPORTED_MODULE_0___default()((()=>callable(...args).catch((error=>{throw error instanceof Error?error:new Error(error)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(options,callable,...args){return options.signal?Promise.race([this.call(callable,...args),new Promise(((_,reject)=>{options.signal?.addEventListener("abort",(()=>{reject(new Error("AbortError"))}))}))]):this.call(callable,...args)}fetch(...args){return this.call((()=>fetch(...args).then((res=>res.ok?res:Promise.reject(res)))))}}},"./node_modules/@langchain/core/dist/utils/env.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{lS:()=>getEnvironmentVariable,sA:()=>getRuntimeEnvironment});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),process=__webpack_require__("./node_modules/process/browser.js");const isDeno=()=>"undefined"!=typeof Deno,getEnv=()=>{let env;return env="undefined"!=typeof window&&void 0!==window.document?"browser":void 0===process||void 0===process.versions||void 0===process.versions.node||isDeno()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":isDeno()?"deno":"other":"node",env};let runtimeEnvironment;function getRuntimeEnvironment(){return _getRuntimeEnvironment.apply(this,arguments)}function _getRuntimeEnvironment(){return(_getRuntimeEnvironment=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){if(void 0===runtimeEnvironment){const env=getEnv();runtimeEnvironment={library:"langchain-js",runtime:env}}return runtimeEnvironment}))).apply(this,arguments)}function getEnvironmentVariable(name){try{return void 0!==process?process.env?.[name]:void 0}catch(e){return}}},"./node_modules/@langchain/core/dist/utils/fast-json-patch/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{af:()=>core_applyPatch,qu:()=>compare});var core_namespaceObject={};__webpack_require__.r(core_namespaceObject),__webpack_require__.d(core_namespaceObject,{JsonPatchError:()=>JsonPatchError,_areEquals:()=>_areEquals,applyOperation:()=>applyOperation,applyPatch:()=>core_applyPatch,applyReducer:()=>applyReducer,deepClone:()=>deepClone,getValueByPointer:()=>getValueByPointer,validate:()=>validate,validator:()=>validator});const _hasOwnProperty=Object.prototype.hasOwnProperty;function helpers_hasOwnProperty(obj,key){return _hasOwnProperty.call(obj,key)}function _objectKeys(obj){if(Array.isArray(obj)){const keys=new Array(obj.length);for(let k=0;k<keys.length;k++)keys[k]=""+k;return keys}if(Object.keys)return Object.keys(obj);let keys=[];for(let i in obj)helpers_hasOwnProperty(obj,i)&&keys.push(i);return keys}function helpers_deepClone(obj){switch(typeof obj){case"object":return JSON.parse(JSON.stringify(obj));case"undefined":return null;default:return obj}}function isInteger(str){let i=0;const len=str.length;let charCode;for(;i<len;){if(charCode=str.charCodeAt(i),!(charCode>=48&&charCode<=57))return!1;i++}return!0}function escapePathComponent(path){return-1===path.indexOf("/")&&-1===path.indexOf("~")?path:path.replace(/~/g,"~0").replace(/\//g,"~1")}function unescapePathComponent(path){return path.replace(/~1/g,"/").replace(/~0/g,"~")}function hasUndefined(obj){if(void 0===obj)return!0;if(obj)if(Array.isArray(obj)){for(let i=0,len=obj.length;i<len;i++)if(hasUndefined(obj[i]))return!0}else if("object"==typeof obj){const objKeys=_objectKeys(obj),objKeysLength=objKeys.length;for(var i=0;i<objKeysLength;i++)if(hasUndefined(obj[objKeys[i]]))return!0}return!1}function patchErrorMessageFormatter(message,args){const messageParts=[message];for(const key in args){const value="object"==typeof args[key]?JSON.stringify(args[key],null,2):args[key];void 0!==value&&messageParts.push(`${key}: ${value}`)}return messageParts.join("\n")}class PatchError extends Error{constructor(message,name,index,operation,tree){super(patchErrorMessageFormatter(message,{name,index,operation,tree})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:name}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:index}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:operation}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:tree}),Object.setPrototypeOf(this,new.target.prototype),this.message=patchErrorMessageFormatter(message,{name,index,operation,tree})}}const JsonPatchError=PatchError,deepClone=helpers_deepClone,objOps={add:function(obj,key,document){return obj[key]=this.value,{newDocument:document}},remove:function(obj,key,document){var removed=obj[key];return delete obj[key],{newDocument:document,removed}},replace:function(obj,key,document){var removed=obj[key];return obj[key]=this.value,{newDocument:document,removed}},move:function(obj,key,document){let removed=getValueByPointer(document,this.path);removed&&(removed=helpers_deepClone(removed));const originalValue=applyOperation(document,{op:"remove",path:this.from}).removed;return applyOperation(document,{op:"add",path:this.path,value:originalValue}),{newDocument:document,removed}},copy:function(obj,key,document){const valueToCopy=getValueByPointer(document,this.from);return applyOperation(document,{op:"add",path:this.path,value:helpers_deepClone(valueToCopy)}),{newDocument:document}},test:function(obj,key,document){return{newDocument:document,test:_areEquals(obj[key],this.value)}},_get:function(obj,key,document){return this.value=obj[key],{newDocument:document}}};var arrOps={add:function(arr,i,document){return isInteger(i)?arr.splice(i,0,this.value):arr[i]=this.value,{newDocument:document,index:i}},remove:function(arr,i,document){return{newDocument:document,removed:arr.splice(i,1)[0]}},replace:function(arr,i,document){var removed=arr[i];return arr[i]=this.value,{newDocument:document,removed}},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get};function getValueByPointer(document,pointer){if(""==pointer)return document;var getOriginalDestination={op:"_get",path:pointer};return applyOperation(document,getOriginalDestination),getOriginalDestination.value}function applyOperation(document,operation,validateOperation=!1,mutateDocument=!0,banPrototypeModifications=!0,index=0){if(validateOperation&&("function"==typeof validateOperation?validateOperation(operation,0,document,operation.path):validator(operation,0)),""===operation.path){let returnValue={newDocument:document};if("add"===operation.op)return returnValue.newDocument=operation.value,returnValue;if("replace"===operation.op)return returnValue.newDocument=operation.value,returnValue.removed=document,returnValue;if("move"===operation.op||"copy"===operation.op)return returnValue.newDocument=getValueByPointer(document,operation.from),"move"===operation.op&&(returnValue.removed=document),returnValue;if("test"===operation.op){if(returnValue.test=_areEquals(document,operation.value),!1===returnValue.test)throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",index,operation,document);return returnValue.newDocument=document,returnValue}if("remove"===operation.op)return returnValue.removed=document,returnValue.newDocument=null,returnValue;if("_get"===operation.op)return operation.value=document,returnValue;if(validateOperation)throw new JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",index,operation,document);return returnValue}{mutateDocument||(document=helpers_deepClone(document));const keys=(operation.path||"").split("/");let existingPathFragment,key,validateFunction,obj=document,t=1,len=keys.length;for(validateFunction="function"==typeof validateOperation?validateOperation:validator;;){if(key=keys[t],key&&-1!=key.indexOf("~")&&(key=unescapePathComponent(key)),banPrototypeModifications&&("__proto__"==key||"prototype"==key&&t>0&&"constructor"==keys[t-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(validateOperation&&void 0===existingPathFragment&&(void 0===obj[key]?existingPathFragment=keys.slice(0,t).join("/"):t==len-1&&(existingPathFragment=operation.path),void 0!==existingPathFragment&&validateFunction(operation,0,document,existingPathFragment)),t++,Array.isArray(obj)){if("-"===key)key=obj.length;else{if(validateOperation&&!isInteger(key))throw new JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",index,operation,document);isInteger(key)&&(key=~~key)}if(t>=len){if(validateOperation&&"add"===operation.op&&key>obj.length)throw new JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",index,operation,document);const returnValue=arrOps[operation.op].call(operation,obj,key,document);if(!1===returnValue.test)throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",index,operation,document);return returnValue}}else if(t>=len){const returnValue=objOps[operation.op].call(operation,obj,key,document);if(!1===returnValue.test)throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",index,operation,document);return returnValue}if(obj=obj[key],validateOperation&&t<len&&(!obj||"object"!=typeof obj))throw new JsonPatchError("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",index,operation,document)}}}function core_applyPatch(document,patch,validateOperation,mutateDocument=!0,banPrototypeModifications=!0){if(validateOperation&&!Array.isArray(patch))throw new JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");mutateDocument||(document=helpers_deepClone(document));const results=new Array(patch.length);for(let i=0,length=patch.length;i<length;i++)results[i]=applyOperation(document,patch[i],validateOperation,!0,banPrototypeModifications,i),document=results[i].newDocument;return results.newDocument=document,results}function applyReducer(document,operation,index){const operationResult=applyOperation(document,operation);if(!1===operationResult.test)throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",index,operation,document);return operationResult.newDocument}function validator(operation,index,document,existingPathFragment){if("object"!=typeof operation||null===operation||Array.isArray(operation))throw new JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",index,operation,document);if(!objOps[operation.op])throw new JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",index,operation,document);if("string"!=typeof operation.path)throw new JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",index,operation,document);if(0!==operation.path.indexOf("/")&&operation.path.length>0)throw new JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",index,operation,document);if(("move"===operation.op||"copy"===operation.op)&&"string"!=typeof operation.from)throw new JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",index,operation,document);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&void 0===operation.value)throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",index,operation,document);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&hasUndefined(operation.value))throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",index,operation,document);if(document)if("add"==operation.op){var pathLen=operation.path.split("/").length,existingPathLen=existingPathFragment.split("/").length;if(pathLen!==existingPathLen+1&&pathLen!==existingPathLen)throw new JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",index,operation,document)}else if("replace"===operation.op||"remove"===operation.op||"_get"===operation.op){if(operation.path!==existingPathFragment)throw new JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",index,operation,document)}else if("move"===operation.op||"copy"===operation.op){var error=validate([{op:"_get",path:operation.from,value:void 0}],document);if(error&&"OPERATION_PATH_UNRESOLVABLE"===error.name)throw new JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",index,operation,document)}}function validate(sequence,document,externalValidator){try{if(!Array.isArray(sequence))throw new JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(document)core_applyPatch(helpers_deepClone(document),helpers_deepClone(sequence),externalValidator||!0);else{externalValidator=externalValidator||validator;for(var i=0;i<sequence.length;i++)externalValidator(sequence[i],i,document,void 0)}}catch(e){if(e instanceof JsonPatchError)return e;throw e}}function _areEquals(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var i,length,key,arrA=Array.isArray(a),arrB=Array.isArray(b);if(arrA&&arrB){if((length=a.length)!=b.length)return!1;for(i=length;0!=i--;)if(!_areEquals(a[i],b[i]))return!1;return!0}if(arrA!=arrB)return!1;var keys=Object.keys(a);if((length=keys.length)!==Object.keys(b).length)return!1;for(i=length;0!=i--;)if(!b.hasOwnProperty(keys[i]))return!1;for(i=length;0!=i--;)if(!_areEquals(a[key=keys[i]],b[key]))return!1;return!0}return a!=a&&b!=b}new WeakMap;function _generate(mirror,obj,patches,path,invertible){if(obj!==mirror){"function"==typeof obj.toJSON&&(obj=obj.toJSON());for(var newKeys=_objectKeys(obj),oldKeys=_objectKeys(mirror),deleted=!1,t=oldKeys.length-1;t>=0;t--){var oldVal=mirror[key=oldKeys[t]];if(!helpers_hasOwnProperty(obj,key)||void 0===obj[key]&&void 0!==oldVal&&!1===Array.isArray(obj))Array.isArray(mirror)===Array.isArray(obj)?(invertible&&patches.push({op:"test",path:path+"/"+escapePathComponent(key),value:helpers_deepClone(oldVal)}),patches.push({op:"remove",path:path+"/"+escapePathComponent(key)}),deleted=!0):(invertible&&patches.push({op:"test",path,value:mirror}),patches.push({op:"replace",path,value:obj}),!0);else{var newVal=obj[key];"object"==typeof oldVal&&null!=oldVal&&"object"==typeof newVal&&null!=newVal&&Array.isArray(oldVal)===Array.isArray(newVal)?_generate(oldVal,newVal,patches,path+"/"+escapePathComponent(key),invertible):oldVal!==newVal&&(!0,invertible&&patches.push({op:"test",path:path+"/"+escapePathComponent(key),value:helpers_deepClone(oldVal)}),patches.push({op:"replace",path:path+"/"+escapePathComponent(key),value:helpers_deepClone(newVal)}))}}if(deleted||newKeys.length!=oldKeys.length)for(t=0;t<newKeys.length;t++){var key;helpers_hasOwnProperty(mirror,key=newKeys[t])||void 0===obj[key]||patches.push({op:"add",path:path+"/"+escapePathComponent(key),value:helpers_deepClone(obj[key])})}}}function compare(tree1,tree2,invertible=!1){var patches=[];return _generate(tree1,tree2,patches,"",invertible),patches}},"./node_modules/@langchain/core/dist/utils/json.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function parseJsonMarkdown(s,parser=parsePartialJson){s=s.trim();const match=/```(json)?(.*)```/s.exec(s);return parser(match?match[2]:s)}function parsePartialJson(s){if(void 0===s)return null;try{return JSON.parse(s)}catch(error){}let new_s="";const stack=[];let isInsideString=!1,escaped=!1;for(let char of s){if(isInsideString)'"'!==char||escaped?"\n"!==char||escaped?escaped="\\"===char&&!escaped:char="\\n":isInsideString=!1;else if('"'===char)isInsideString=!0,escaped=!1;else if("{"===char)stack.push("}");else if("["===char)stack.push("]");else if("}"===char||"]"===char){if(!stack||stack[stack.length-1]!==char)return null;stack.pop()}new_s+=char}isInsideString&&(new_s+='"');for(let i=stack.length-1;i>=0;i-=1)new_s+=stack[i];try{return JSON.parse(new_s)}catch(error){return null}}__webpack_require__.d(__webpack_exports__,{M:()=>parseJsonMarkdown,g:()=>parsePartialJson})},"./node_modules/@langchain/core/dist/utils/json_patch.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{q:()=>_fast_json_patch_index_js__WEBPACK_IMPORTED_MODULE_0__.qu});var _fast_json_patch_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/utils/fast-json-patch/index.js")},"./node_modules/@langchain/core/dist/utils/stream.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E7:()=>pipeGeneratorWithSetup,QJ:()=>IterableReadableStream,qq:()=>AsyncGeneratorWithSetup,y2:()=>atee,zo:()=>concat});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_wrapAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),_singletons_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/dist/singletons/index.js");class IterableReadableStream extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}next(){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){_this.ensureReader();try{const result=yield _this.reader.read();return result.done?(_this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:result.value}}catch(e){throw _this.reader.releaseLock(),e}}))()}return(){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){if(_this2.ensureReader(),_this2.locked){const cancelPromise=_this2.reader.cancel();_this2.reader.releaseLock(),yield cancelPromise}return{done:!0,value:void 0}}))()}throw(e){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){if(_this3.ensureReader(),_this3.locked){const cancelPromise=_this3.reader.cancel();_this3.reader.releaseLock(),yield cancelPromise}throw e}))()}[Symbol.asyncIterator](){return this}static fromReadableStream(stream){const reader=stream.getReader();return new IterableReadableStream({start:controller=>function pump(){return reader.read().then((({done,value})=>{if(!done)return controller.enqueue(value),pump();controller.close()}))}(),cancel(){reader.releaseLock()}})}static fromAsyncGenerator(generator){return new IterableReadableStream({pull:controller=>(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){const{value,done}=yield generator.next();done&&controller.close(),controller.enqueue(value)}))(),cancel:reason=>(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){yield generator.return(reason)}))()})}}function atee(iter,length=2){const buffers=Array.from({length},(()=>[]));return buffers.map(function(){var _makeIter=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_wrapAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(buffer){for(;;)if(0===buffer.length){const result=yield(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_awaitAsyncGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)(iter.next());for(const buffer of buffers)buffer.push(result)}else{if(buffer[0].done)return;yield buffer.shift().value}}));return function makeIter(_x){return _makeIter.apply(this,arguments)}}())}function concat(first,second){if(Array.isArray(first)&&Array.isArray(second))return first.concat(second);if("string"==typeof first&&"string"==typeof second)return first+second;if("number"==typeof first&&"number"==typeof second)return first+second;if("concat"in first&&"function"==typeof first.concat)return first.concat(second);if("object"==typeof first&&"object"==typeof second){const chunk={...first};for(const[key,value]of Object.entries(second))key in chunk&&!Array.isArray(chunk[key])?chunk[key]=concat(chunk[key],value):chunk[key]=value;return chunk}throw new Error(`Cannot concat ${typeof first} and ${typeof second}`)}class AsyncGeneratorWithSetup{constructor(params){var _this4=this;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=params.generator,this.config=params.config,this.setup=new Promise(((resolve,reject)=>{_singletons_index_js__WEBPACK_IMPORTED_MODULE_1__.A.getInstance().run(params.config,(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){_this4.firstResult=params.generator.next(),params.startSetup?_this4.firstResult.then(params.startSetup).then(resolve,reject):_this4.firstResult.then((_result=>resolve(void 0)),reject)})))}))}next(...args){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){if(!_this5.firstResultUsed)return _this5.firstResultUsed=!0,_this5.firstResult;return _singletons_index_js__WEBPACK_IMPORTED_MODULE_1__.A.getInstance().run(_this5.config,(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){return _this5.generator.next(...args)})))}))()}return(value){var _this6=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){return _this6.generator.return(value)}))()}throw(e){var _this7=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){return _this7.generator.throw(e)}))()}[Symbol.asyncIterator](){return this}}function pipeGeneratorWithSetup(_x2,_x3,_x4){return _pipeGeneratorWithSetup.apply(this,arguments)}function _pipeGeneratorWithSetup(){return(_pipeGeneratorWithSetup=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(to,generator,startSetup,...args){const gen=new AsyncGeneratorWithSetup({generator,startSetup}),setup=yield gen.setup;return{output:to(gen,setup,...args),setup}}))).apply(this,arguments)}},"./node_modules/@langchain/core/language_models/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{BD:()=>_dist_language_models_base_js__WEBPACK_IMPORTED_MODULE_0__.BD,qV:()=>_dist_language_models_base_js__WEBPACK_IMPORTED_MODULE_0__.qV});var _dist_language_models_base_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/language_models/base.js")},"./node_modules/@langchain/core/load/serializable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{i:()=>_dist_load_serializable_js__WEBPACK_IMPORTED_MODULE_0__.i});var _dist_load_serializable_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/load/serializable.js")},"./node_modules/@langchain/core/messages.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Cq:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.Cq,Cr:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.Cr,GC:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.GC,HD:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.HD,J:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.J,QW:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.QW,Xz:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.Xz,Z0:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.Z0,gY:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.gY,ro:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.ro,xk:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.xk,xq:()=>_dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__.xq});var _dist_messages_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js")},"./node_modules/@langchain/core/node_modules/ansi-styles/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module=__webpack_require__.nmd(module);const wrapAnsi256=(offset=0)=>code=>`[${38+offset};5;${code}m`,wrapAnsi16m=(offset=0)=>(red,green,blue)=>`[${38+offset};2;${red};${green};${blue}m`;Object.defineProperty(module,"exports",{enumerable:!0,get:function assembleStyles(){const codes=new Map,styles={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};styles.color.gray=styles.color.blackBright,styles.bgColor.bgGray=styles.bgColor.bgBlackBright,styles.color.grey=styles.color.blackBright,styles.bgColor.bgGrey=styles.bgColor.bgBlackBright;for(const[groupName,group]of Object.entries(styles)){for(const[styleName,style]of Object.entries(group))styles[styleName]={open:`[${style[0]}m`,close:`[${style[1]}m`},group[styleName]=styles[styleName],codes.set(style[0],style[1]);Object.defineProperty(styles,groupName,{value:group,enumerable:!1})}return Object.defineProperty(styles,"codes",{value:codes,enumerable:!1}),styles.color.close="[39m",styles.bgColor.close="[49m",styles.color.ansi256=wrapAnsi256(),styles.color.ansi16m=wrapAnsi16m(),styles.bgColor.ansi256=wrapAnsi256(10),styles.bgColor.ansi16m=wrapAnsi16m(10),Object.defineProperties(styles,{rgbToAnsi256:{value:(red,green,blue)=>red===green&&green===blue?red<8?16:red>248?231:Math.round((red-8)/247*24)+232:16+36*Math.round(red/255*5)+6*Math.round(green/255*5)+Math.round(blue/255*5),enumerable:!1},hexToRgb:{value:hex=>{const matches=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(hex.toString(16));if(!matches)return[0,0,0];let{colorString}=matches.groups;3===colorString.length&&(colorString=colorString.split("").map((character=>character+character)).join(""));const integer=Number.parseInt(colorString,16);return[integer>>16&255,integer>>8&255,255&integer]},enumerable:!1},hexToAnsi256:{value:hex=>styles.rgbToAnsi256(...styles.hexToRgb(hex)),enumerable:!1}}),styles}})},"./v4.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>v4_0});const native_0={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let i=0;i<256;++i)byteToHex.push((i+256).toString(16).slice(1));function unsafeStringify(arr,offset=0){return(byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+"-"+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+"-"+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+"-"+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+"-"+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]).toLowerCase()}const v4_0=function v4(options,buf,offset){if(native_0.randomUUID&&!buf&&!options)return native_0.randomUUID();const rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf){offset=offset||0;for(let i=0;i<16;++i)buf[offset+i]=rnds[i];return buf}return unsafeStringify(rnds)}},"./node_modules/@langchain/core/output_parsers.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{bI:()=>base.bI,Qh:()=>json.Qh,dS:()=>base.dS,AN:()=>StringOutputParser,K:()=>StructuredOutputParser});var base=__webpack_require__("./node_modules/@langchain/core/dist/output_parsers/base.js"),transform=__webpack_require__("./node_modules/@langchain/core/dist/output_parsers/transform.js");__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js");class StringOutputParser extends transform.G{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(text){return Promise.resolve(text)}getFormatInstructions(){return""}_textContentToString(content){return content.text}_imageUrlContentToString(_content){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(content){switch(content.type){case"text":if("text"in content)return this._textContentToString(content);break;case"image_url":if("image_url"in content)return this._imageUrlContentToString(content);break;default:throw new Error(`Cannot coerce "${content.type}" message part into a string.`)}throw new Error(`Invalid content type: ${content.type}`)}_baseMessageContentToString(content){return content.reduce(((acc,item)=>acc+this._messageContentComplexToString(item)),"")}}var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),lib=__webpack_require__("./node_modules/zod/lib/index.mjs"),esm=__webpack_require__("./node_modules/zod-to-json-schema/dist/esm/index.js");class StructuredOutputParser extends base.bI{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(schema){super(schema),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:schema}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(schema){return new this(schema)}static fromNamesAndDescriptions(schemas){return new this(lib.z.object(Object.fromEntries(Object.entries(schemas).map((([name,description])=>[name,lib.z.string().describe(description)])))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.\n\n"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.\n\nFor example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}\nwould match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.\nThus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.\n\nYour output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!\n\nHere is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:\n\`\`\`json\n${JSON.stringify((0,esm.Y_)(this.schema))}\n\`\`\`\n`}parse(text){var _this=this;return(0,asyncToGenerator.Z)((function*(){try{const escapedJson=(text.includes("```")?text.trim().split(/```(?:json)?/)[1]:text.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,((_match,capturedGroup)=>`"${capturedGroup.replace(/\n/g,"\\n")}"`)).replace(/\n/g,"");return yield _this.schema.parseAsync(JSON.parse(escapedJson))}catch(e){throw new base.dS(`Failed to parse. Text: "${text}". Error: ${e}`,text)}}))()}}var json=__webpack_require__("./node_modules/@langchain/core/dist/output_parsers/json.js");__webpack_require__("./node_modules/@langchain/core/dist/utils/json_patch.js")},"./node_modules/@langchain/core/prompts.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{gc:()=>chat.gc,dy:()=>base.d,ks:()=>chat.ks,kq:()=>chat.kq,ax:()=>chat.ax,Pf:()=>prompts_prompt.PromptTemplate,ov:()=>chat.ov,SM:()=>template.SM});var base=__webpack_require__("./node_modules/@langchain/core/dist/prompts/base.js"),chat=__webpack_require__("./node_modules/@langchain/core/dist/prompts/chat.js");__webpack_require__("./node_modules/@langchain/core/dist/prompts/few_shot.js");var prompts_prompt=__webpack_require__("./node_modules/@langchain/core/dist/prompts/prompt.js"),template=(__webpack_require__("./node_modules/@langchain/core/dist/prompts/string.js"),__webpack_require__("./node_modules/@langchain/core/dist/prompts/template.js"));__webpack_require__("./node_modules/@langchain/core/dist/prompts/image.js")},"./node_modules/@langchain/core/runnables.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{LE:()=>_dist_runnables_index_js__WEBPACK_IMPORTED_MODULE_0__.LE,eq:()=>_dist_runnables_index_js__WEBPACK_IMPORTED_MODULE_0__.eq,lW:()=>_dist_runnables_index_js__WEBPACK_IMPORTED_MODULE_0__.lW,q:()=>_dist_runnables_index_js__WEBPACK_IMPORTED_MODULE_0__.q,sk:()=>_dist_runnables_index_js__WEBPACK_IMPORTED_MODULE_0__.sk});var _dist_runnables_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/dist/runnables/index.js")},"./node_modules/@langchain/core/tools.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{UA:()=>Tool,YE:()=>ToolInputParsingException});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),lib=__webpack_require__("./node_modules/zod/lib/index.mjs"),manager=__webpack_require__("./node_modules/@langchain/core/dist/callbacks/manager.js"),base=__webpack_require__("./node_modules/@langchain/core/dist/language_models/base.js"),runnables_config=__webpack_require__("./node_modules/@langchain/core/dist/runnables/config.js");class ToolInputParsingException extends Error{constructor(message,output){super(message),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=output}}class StructuredTool extends base.BD{get lc_namespace(){return["langchain","tools"]}constructor(fields){super(fields??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}invoke(input,config){var _this=this;return(0,asyncToGenerator.Z)((function*(){return _this.call(input,(0,runnables_config.LE)(config))}))()}call(arg,configArg,tags){var _this2=this;return(0,asyncToGenerator.Z)((function*(){let parsed;try{parsed=yield _this2.schema.parseAsync(arg)}catch(e){throw new ToolInputParsingException("Received tool input did not match expected schema",JSON.stringify(arg))}const config=(0,manager.QH)(configArg),callbackManager_=yield manager.Ye.configure(config.callbacks,_this2.callbacks,config.tags||tags,_this2.tags,config.metadata,_this2.metadata,{verbose:_this2.verbose}),runManager=yield callbackManager_?.handleToolStart(_this2.toJSON(),"string"==typeof parsed?parsed:JSON.stringify(parsed),config.runId,void 0,void 0,void 0,config.runName);let result;delete config.runId;try{result=yield _this2._call(parsed,runManager,config)}catch(e){throw yield runManager?.handleToolError(e),e}return yield runManager?.handleToolEnd(result),result}))()}}class Tool extends StructuredTool{constructor(fields){super(fields),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:lib.z.object({input:lib.z.string().optional()}).transform((obj=>obj.input))})}call(arg,callbacks){return super.call("string"!=typeof arg&&arg?arg:{input:arg},callbacks)}}},"./node_modules/@langchain/core/utils/function_calling.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{VE:()=>convertToOpenAITool});var esm=__webpack_require__("./node_modules/zod-to-json-schema/dist/esm/index.js");function convertToOpenAIFunction(tool){return{name:tool.name,description:tool.description,parameters:(0,esm.Y_)(tool.schema)}}function convertToOpenAITool(tool){return function isStructuredTool(tool){return void 0!==tool&&Array.isArray(tool.lc_namespace)}(tool)?{type:"function",function:convertToOpenAIFunction(tool)}:tool}},"./node_modules/@langchain/openai/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{z7:()=>chat_models_ChatOpenAI});var error_namespaceObject={};__webpack_require__.r(error_namespaceObject),__webpack_require__.d(error_namespaceObject,{APIConnectionError:()=>APIConnectionError,APIConnectionTimeoutError:()=>APIConnectionTimeoutError,APIError:()=>APIError,APIUserAbortError:()=>APIUserAbortError,AuthenticationError:()=>AuthenticationError,BadRequestError:()=>BadRequestError,ConflictError:()=>ConflictError,InternalServerError:()=>InternalServerError,NotFoundError:()=>NotFoundError,OpenAIError:()=>error_OpenAIError,PermissionDeniedError:()=>PermissionDeniedError,RateLimitError:()=>RateLimitError,UnprocessableEntityError:()=>UnprocessableEntityError});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),awaitAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),wrapAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),asyncIterator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js");let kind,registry_fetch,registry_FormData,registry_File,registry_ReadableStream,registry_getMultipartRequestOptions,getDefaultAgent,fileFromPath,isFsReadStream,auto=!1,registry_Request=null,registry_Response=null,registry_Headers=null,registry_Blob=null;class MultipartBody{constructor(body){this.body=body}get[Symbol.toStringTag](){return"MultipartBody"}}kind||function setShims(shims,options={auto:!1}){if(auto)throw new Error(`you must \`import 'openai/shims/${shims.kind}'\` before importing anything else from openai`);if(kind)throw new Error(`can't \`import 'openai/shims/${shims.kind}'\` after \`import 'openai/shims/${kind}'\``);auto=options.auto,kind=shims.kind,registry_fetch=shims.fetch,registry_Request=shims.Request,registry_Response=shims.Response,registry_Headers=shims.Headers,registry_FormData=shims.FormData,registry_Blob=shims.Blob,registry_File=shims.File,registry_ReadableStream=shims.ReadableStream,registry_getMultipartRequestOptions=shims.getMultipartRequestOptions,getDefaultAgent=shims.getDefaultAgent,fileFromPath=shims.fileFromPath,isFsReadStream=shims.isFsReadStream}(function getRuntime({manuallyImported}={}){const recommendation=manuallyImported?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let _fetch,_Request,_Response,_Headers;try{_fetch=fetch,_Request=Request,_Response=Response,_Headers=Headers}catch(error){throw new Error(`this environment is missing the following Web Fetch API type: ${error.message}. ${recommendation}`)}return{kind:"web",fetch:_fetch,Request:_Request,Response:_Response,Headers:_Headers,FormData:"undefined"!=typeof FormData?FormData:class FormData{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${recommendation}`)}},Blob:"undefined"!=typeof Blob?Blob:class Blob{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${recommendation}`)}},File:"undefined"!=typeof File?File:class File{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${recommendation}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class ReadableStream{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${recommendation}`)}},getMultipartRequestOptions:(_ref=(0,asyncToGenerator.Z)((function*(form,opts){return{...opts,body:new MultipartBody(form)}})),function getMultipartRequestOptions(_x,_x2){return _ref.apply(this,arguments)}),getDefaultAgent:url=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:value=>!1};var _ref}(),{auto:!0});class error_OpenAIError extends Error{}class APIError extends error_OpenAIError{constructor(status,error,message,headers){super(`${APIError.makeMessage(status,error,message)}`),this.status=status,this.headers=headers,this.request_id=headers?.["x-request-id"];const data=error;this.error=data,this.code=data?.code,this.param=data?.param,this.type=data?.type}static makeMessage(status,error,message){const msg=error?.message?"string"==typeof error.message?error.message:JSON.stringify(error.message):error?JSON.stringify(error):message;return status&&msg?`${status} ${msg}`:status?`${status} status code (no body)`:msg||"(no status code or body)"}static generate(status,errorResponse,message,headers){if(!status)return new APIConnectionError({cause:castToError(errorResponse)});const error=errorResponse?.error;return 400===status?new BadRequestError(status,error,message,headers):401===status?new AuthenticationError(status,error,message,headers):403===status?new PermissionDeniedError(status,error,message,headers):404===status?new NotFoundError(status,error,message,headers):409===status?new ConflictError(status,error,message,headers):422===status?new UnprocessableEntityError(status,error,message,headers):429===status?new RateLimitError(status,error,message,headers):status>=500?new InternalServerError(status,error,message,headers):new APIError(status,error,message,headers)}}class APIUserAbortError extends APIError{constructor({message}={}){super(void 0,void 0,message||"Request was aborted.",void 0),this.status=void 0}}class APIConnectionError extends APIError{constructor({message,cause}){super(void 0,void 0,message||"Connection error.",void 0),this.status=void 0,cause&&(this.cause=cause)}}class APIConnectionTimeoutError extends APIConnectionError{constructor({message}={}){super({message:message??"Request timed out."})}}class BadRequestError extends APIError{constructor(){super(...arguments),this.status=400}}class AuthenticationError extends APIError{constructor(){super(...arguments),this.status=401}}class PermissionDeniedError extends APIError{constructor(){super(...arguments),this.status=403}}class NotFoundError extends APIError{constructor(){super(...arguments),this.status=404}}class ConflictError extends APIError{constructor(){super(...arguments),this.status=409}}class UnprocessableEntityError extends APIError{constructor(){super(...arguments),this.status=422}}class RateLimitError extends APIError{constructor(){super(...arguments),this.status=429}}class InternalServerError extends APIError{}class Stream{constructor(iterator,controller){this.iterator=iterator,this.controller=controller}static fromSSEResponse(response,controller){let consumed=!1;function _iterator2(){return _iterator2=(0,wrapAsyncGenerator.Z)((function*(){if(consumed)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");consumed=!0;let done=!1;try{var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(function _iterSSEMessages(_x,_x2){return _iterSSEMessages2.apply(this,arguments)}(response,controller));_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const sse=_step.value;if(!done)if(sse.data.startsWith("[DONE]"))done=!0;else if(null===sse.event){let data;try{data=JSON.parse(sse.data)}catch(e){throw console.error("Could not parse message into JSON:",sse.data),console.error("From chunk:",sse.raw),e}if(data&&data.error)throw new APIError(void 0,data.error,void 0,void 0);yield data}else{let data;try{data=JSON.parse(sse.data)}catch(e){throw console.error("Could not parse message into JSON:",sse.data),console.error("From chunk:",sse.raw),e}if("error"==sse.event)throw new APIError(void 0,data.error,data.message,void 0);yield{event:sse.event,data}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}done=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{done||controller.abort()}})),_iterator2.apply(this,arguments)}return new Stream((function iterator(){return _iterator2.apply(this,arguments)}),controller)}static fromReadableStream(readableStream,controller){let consumed=!1;function _iterLines(){return(_iterLines=(0,wrapAsyncGenerator.Z)((function*(){const lineDecoder=new LineDecoder,iter=readableStreamAsyncIterable(readableStream);var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator3=(0,asyncIterator.Z)(iter);_iteratorAbruptCompletion2=!(_step2=yield(0,awaitAsyncGenerator.Z)(_iterator3.next())).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;for(const line of lineDecoder.decode(chunk))yield line}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator3.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator3.return()))}finally{if(_didIteratorError2)throw _iteratorError2}}for(const line of lineDecoder.flush())yield line}))).apply(this,arguments)}function _iterator5(){return _iterator5=(0,wrapAsyncGenerator.Z)((function*(){if(consumed)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");consumed=!0;let done=!1;try{var _iteratorError3,_iteratorAbruptCompletion3=!1,_didIteratorError3=!1;try{for(var _step3,_iterator4=(0,asyncIterator.Z)(function iterLines(){return _iterLines.apply(this,arguments)}());_iteratorAbruptCompletion3=!(_step3=yield(0,awaitAsyncGenerator.Z)(_iterator4.next())).done;_iteratorAbruptCompletion3=!1){const line=_step3.value;done||line&&(yield JSON.parse(line))}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorAbruptCompletion3&&null!=_iterator4.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator4.return()))}finally{if(_didIteratorError3)throw _iteratorError3}}done=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{done||controller.abort()}})),_iterator5.apply(this,arguments)}return new Stream((function iterator(){return _iterator5.apply(this,arguments)}),controller)}[Symbol.asyncIterator](){return this.iterator()}tee(){const left=[],right=[],iterator=this.iterator(),teeIterator=queue=>({next:()=>{if(0===queue.length){const result=iterator.next();left.push(result),right.push(result)}return queue.shift()}});return[new Stream((()=>teeIterator(left)),this.controller),new Stream((()=>teeIterator(right)),this.controller)]}toReadableStream(){const self=this;let iter;const encoder=new TextEncoder;return new registry_ReadableStream({start:()=>(0,asyncToGenerator.Z)((function*(){iter=self[Symbol.asyncIterator]()}))(),pull:ctrl=>(0,asyncToGenerator.Z)((function*(){try{const{value,done}=yield iter.next();if(done)return ctrl.close();const bytes=encoder.encode(JSON.stringify(value)+"\n");ctrl.enqueue(bytes)}catch(err){ctrl.error(err)}}))(),cancel:()=>(0,asyncToGenerator.Z)((function*(){yield iter.return?.()}))()})}}function _iterSSEMessages2(){return _iterSSEMessages2=(0,wrapAsyncGenerator.Z)((function*(response,controller){if(!response.body)throw controller.abort(),new error_OpenAIError("Attempted to iterate over a response with no body");const sseDecoder=new SSEDecoder,lineDecoder=new LineDecoder,iter=readableStreamAsyncIterable(response.body);var _iteratorError4,_iteratorAbruptCompletion4=!1,_didIteratorError4=!1;try{for(var _step4,_iterator6=(0,asyncIterator.Z)(function iterSSEChunks(_x3){return _iterSSEChunks.apply(this,arguments)}(iter));_iteratorAbruptCompletion4=!(_step4=yield(0,awaitAsyncGenerator.Z)(_iterator6.next())).done;_iteratorAbruptCompletion4=!1){const sseChunk=_step4.value;for(const line of lineDecoder.decode(sseChunk)){const sse=sseDecoder.decode(line);sse&&(yield sse)}}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorAbruptCompletion4&&null!=_iterator6.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator6.return()))}finally{if(_didIteratorError4)throw _iteratorError4}}for(const line of lineDecoder.flush()){const sse=sseDecoder.decode(line);sse&&(yield sse)}})),_iterSSEMessages2.apply(this,arguments)}function _iterSSEChunks(){return(_iterSSEChunks=(0,wrapAsyncGenerator.Z)((function*(iterator){let data=new Uint8Array;var _iteratorError5,_iteratorAbruptCompletion5=!1,_didIteratorError5=!1;try{for(var _step5,_iterator7=(0,asyncIterator.Z)(iterator);_iteratorAbruptCompletion5=!(_step5=yield(0,awaitAsyncGenerator.Z)(_iterator7.next())).done;_iteratorAbruptCompletion5=!1){const chunk=_step5.value;{if(null==chunk)continue;const binaryChunk=chunk instanceof ArrayBuffer?new Uint8Array(chunk):"string"==typeof chunk?(new TextEncoder).encode(chunk):chunk;let patternIndex,newData=new Uint8Array(data.length+binaryChunk.length);for(newData.set(data),newData.set(binaryChunk,data.length),data=newData;-1!==(patternIndex=findDoubleNewlineIndex(data));)yield data.slice(0,patternIndex),data=data.slice(patternIndex)}}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorAbruptCompletion5&&null!=_iterator7.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator7.return()))}finally{if(_didIteratorError5)throw _iteratorError5}}data.length>0&&(yield data)}))).apply(this,arguments)}function findDoubleNewlineIndex(buffer){for(let i=0;i<buffer.length-2;i++){if(10===buffer[i]&&10===buffer[i+1])return i+2;if(13===buffer[i]&&13===buffer[i+1])return i+2;if(13===buffer[i]&&10===buffer[i+1]&&i+3<buffer.length&&13===buffer[i+2]&&10===buffer[i+3])return i+4}return-1}class SSEDecoder{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(line){if(line.endsWith("\r")&&(line=line.substring(0,line.length-1)),!line){if(!this.event&&!this.data.length)return null;const sse={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],sse}if(this.chunks.push(line),line.startsWith(":"))return null;let[fieldname,_,value]=function partition(str,delimiter){const index=str.indexOf(delimiter);if(-1!==index)return[str.substring(0,index),delimiter,str.substring(index+delimiter.length)];return[str,"",""]}(line,":");return value.startsWith(" ")&&(value=value.substring(1)),"event"===fieldname?this.event=value:"data"===fieldname&&this.data.push(value),null}}class LineDecoder{constructor(){this.buffer=[],this.trailingCR=!1}decode(chunk){let text=this.decodeText(chunk);if(this.trailingCR&&(text="\r"+text,this.trailingCR=!1),text.endsWith("\r")&&(this.trailingCR=!0,text=text.slice(0,-1)),!text)return[];const trailingNewline=LineDecoder.NEWLINE_CHARS.has(text[text.length-1]||"");let lines=text.split(LineDecoder.NEWLINE_REGEXP);return trailingNewline&&lines.pop(),1!==lines.length||trailingNewline?(this.buffer.length>0&&(lines=[this.buffer.join("")+lines[0],...lines.slice(1)],this.buffer=[]),trailingNewline||(this.buffer=[lines.pop()||""]),lines):(this.buffer.push(lines[0]),[])}decodeText(bytes){if(null==bytes)return"";if("string"==typeof bytes)return bytes;if("undefined"!=typeof Buffer){if(bytes instanceof Buffer)return bytes.toString();if(bytes instanceof Uint8Array)return Buffer.from(bytes).toString();throw new error_OpenAIError(`Unexpected: received non-Uint8Array (${bytes.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(bytes instanceof Uint8Array||bytes instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(bytes);throw new error_OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${bytes.constructor.name}) in a web platform. Please report this error.`)}throw new error_OpenAIError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const lines=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,lines}}function readableStreamAsyncIterable(stream){if(stream[Symbol.asyncIterator])return stream;const reader=stream.getReader();return{next:()=>(0,asyncToGenerator.Z)((function*(){try{const result=yield reader.read();return result?.done&&reader.releaseLock(),result}catch(e){throw reader.releaseLock(),e}}))(),return:()=>(0,asyncToGenerator.Z)((function*(){const cancelPromise=reader.cancel();return reader.releaseLock(),yield cancelPromise,{done:!0,value:void 0}}))(),[Symbol.asyncIterator](){return this}}}LineDecoder.NEWLINE_CHARS=new Set(["\n","\r"]),LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const isResponseLike=value=>null!=value&&"object"==typeof value&&"string"==typeof value.url&&"function"==typeof value.blob,isFileLike=value=>null!=value&&"object"==typeof value&&"string"==typeof value.name&&"number"==typeof value.lastModified&&isBlobLike(value),isBlobLike=value=>null!=value&&"object"==typeof value&&"number"==typeof value.size&&"string"==typeof value.type&&"function"==typeof value.text&&"function"==typeof value.slice&&"function"==typeof value.arrayBuffer,isUploadable=value=>isFileLike(value)||isResponseLike(value)||isFsReadStream(value);function toFile(_x,_x2,_x3){return _toFile.apply(this,arguments)}function _toFile(){return _toFile=(0,asyncToGenerator.Z)((function*(value,name,options){if(value=yield value,options??(options=isFileLike(value)?{lastModified:value.lastModified,type:value.type}:{}),isResponseLike(value)){const blob=yield value.blob();return name||(name=new URL(value.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new registry_File([blob],name,options)}const bits=yield function getBytes(_x4){return _getBytes.apply(this,arguments)}(value);if(name||(name=function getName(value){return getStringFromMaybeBuffer(value.name)||getStringFromMaybeBuffer(value.filename)||getStringFromMaybeBuffer(value.path)?.split(/[\\/]/).pop()}(value)??"unknown_file"),!options.type){const type=bits[0]?.type;"string"==typeof type&&(options={...options,type})}return new registry_File(bits,name,options)})),_toFile.apply(this,arguments)}function _getBytes(){return(_getBytes=(0,asyncToGenerator.Z)((function*(value){let parts=[];if("string"==typeof value||ArrayBuffer.isView(value)||value instanceof ArrayBuffer)parts.push(value);else if(isBlobLike(value))parts.push(yield value.arrayBuffer());else{if(!isAsyncIterableIterator(value))throw new Error(`Unexpected data type: ${typeof value}; constructor: ${value?.constructor?.name}; props: ${function propsForError(value){const props=Object.getOwnPropertyNames(value);return`[${props.map((p=>`"${p}"`)).join(", ")}]`}(value)}`);var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(value);_iteratorAbruptCompletion=!(_step=yield _iterator.next()).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;parts.push(chunk)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield _iterator.return())}finally{if(_didIteratorError)throw _iteratorError}}}return parts}))).apply(this,arguments)}const getStringFromMaybeBuffer=x=>"string"==typeof x?x:"undefined"!=typeof Buffer&&x instanceof Buffer?String(x):void 0,isAsyncIterableIterator=value=>null!=value&&"object"==typeof value&&"function"==typeof value[Symbol.asyncIterator],isMultipartBody=body=>body&&"object"==typeof body&&body.body&&"MultipartBody"===body[Symbol.toStringTag];const multipartFormRequestOptions=function(){var _ref2=(0,asyncToGenerator.Z)((function*(opts){const form=yield createForm(opts.body);return registry_getMultipartRequestOptions(form,opts)}));return function multipartFormRequestOptions(_x6){return _ref2.apply(this,arguments)}}(),createForm=function(){var _ref3=(0,asyncToGenerator.Z)((function*(body){const form=new registry_FormData;return yield Promise.all(Object.entries(body||{}).map((([key,value])=>addFormValue(form,key,value)))),form}));return function createForm(_x7){return _ref3.apply(this,arguments)}}(),addFormValue=function(){var _ref4=(0,asyncToGenerator.Z)((function*(form,key,value){if(void 0!==value){if(null==value)throw new TypeError(`Received null for "${key}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof value||"number"==typeof value||"boolean"==typeof value)form.append(key,String(value));else if(isUploadable(value)){const file=yield toFile(value);form.append(key,file)}else if(Array.isArray(value))yield Promise.all(value.map((entry=>addFormValue(form,key+"[]",entry))));else{if("object"!=typeof value)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${value} instead`);yield Promise.all(Object.entries(value).map((([name,prop])=>addFormValue(form,`${key}[${name}]`,prop))))}}}));return function addFormValue(_x8,_x9,_x10){return _ref4.apply(this,arguments)}}();var _AbstractPage_client,process=__webpack_require__("./node_modules/process/browser.js"),__classPrivateFieldSet=function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value},__classPrivateFieldGet=function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)};function defaultParseResponse(_x){return _defaultParseResponse.apply(this,arguments)}function _defaultParseResponse(){return _defaultParseResponse=(0,asyncToGenerator.Z)((function*(props){const{response}=props;if(props.options.stream)return debug("response",response.status,response.url,response.headers,response.body),props.options.__streamClass?props.options.__streamClass.fromSSEResponse(response,props.controller):Stream.fromSSEResponse(response,props.controller);if(204===response.status)return null;if(props.options.__binaryResponse)return response;const contentType=response.headers.get("content-type");if(contentType?.includes("application/json")||contentType?.includes("application/vnd.api+json")){const json=yield response.json();return debug("response",response.status,response.url,response.headers,json),json}const text=yield response.text();return debug("response",response.status,response.url,response.headers,text),text})),_defaultParseResponse.apply(this,arguments)}class APIPromise extends Promise{constructor(responsePromise,parseResponse=defaultParseResponse){super((resolve=>{resolve(null)})),this.responsePromise=responsePromise,this.parseResponse=parseResponse}_thenUnwrap(transform){var _this4=this;return new APIPromise(this.responsePromise,function(){var _ref=(0,asyncToGenerator.Z)((function*(props){return transform(yield _this4.parseResponse(props))}));return function(_x2){return _ref.apply(this,arguments)}}())}asResponse(){return this.responsePromise.then((p=>p.response))}withResponse(){var _this5=this;return(0,asyncToGenerator.Z)((function*(){const[data,response]=yield Promise.all([_this5.parse(),_this5.asResponse()]);return{data,response}}))()}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(onfulfilled,onrejected){return this.parse().then(onfulfilled,onrejected)}catch(onrejected){return this.parse().catch(onrejected)}finally(onfinally){return this.parse().finally(onfinally)}}class APIClient{constructor({baseURL,maxRetries=2,timeout=6e5,httpAgent,fetch:overridenFetch}){this.baseURL=baseURL,this.maxRetries=validatePositiveInteger("maxRetries",maxRetries),this.timeout=validatePositiveInteger("timeout",timeout),this.httpAgent=httpAgent,this.fetch=overridenFetch??registry_fetch}authHeaders(opts){return{}}defaultHeaders(opts){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...getPlatformHeaders(),...this.authHeaders(opts)}}validateHeaders(headers,customHeaders){}defaultIdempotencyKey(){return`stainless-node-retry-${uuid4()}`}get(path,opts){return this.methodRequest("get",path,opts)}post(path,opts){return this.methodRequest("post",path,opts)}patch(path,opts){return this.methodRequest("patch",path,opts)}put(path,opts){return this.methodRequest("put",path,opts)}delete(path,opts){return this.methodRequest("delete",path,opts)}methodRequest(method,path,opts){return this.request(Promise.resolve(opts).then((opts=>({method,path,...opts}))))}getAPIList(path,Page,opts){return this.requestAPIList(Page,{method:"get",path,...opts})}calculateContentLength(body){if("string"==typeof body){if("undefined"!=typeof Buffer)return Buffer.byteLength(body,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(body).length.toString()}}return null}buildRequest(options){const{method,path,query,headers={}}=options,body=isMultipartBody(options.body)?options.body.body:options.body?JSON.stringify(options.body,null,2):null,contentLength=this.calculateContentLength(body),url=this.buildURL(path,query);"timeout"in options&&validatePositiveInteger("timeout",options.timeout);const timeout=options.timeout??this.timeout,httpAgent=options.httpAgent??this.httpAgent??getDefaultAgent(url),minAgentTimeout=timeout+1e3;"number"==typeof httpAgent?.options?.timeout&&minAgentTimeout>(httpAgent.options.timeout??0)&&(httpAgent.options.timeout=minAgentTimeout),this.idempotencyHeader&&"get"!==method&&(options.idempotencyKey||(options.idempotencyKey=this.defaultIdempotencyKey()),headers[this.idempotencyHeader]=options.idempotencyKey);return{req:{method,...body&&{body},headers:this.buildHeaders({options,headers,contentLength}),...httpAgent&&{agent:httpAgent},signal:options.signal??null},url,timeout}}buildHeaders({options,headers,contentLength}){const reqHeaders={};contentLength&&(reqHeaders["content-length"]=contentLength);return applyHeadersMut(reqHeaders,this.defaultHeaders(options)),applyHeadersMut(reqHeaders,headers),isMultipartBody(options.body)&&"node"!==kind&&delete reqHeaders["content-type"],this.validateHeaders(reqHeaders,headers),reqHeaders}prepareOptions(options){return(0,asyncToGenerator.Z)((function*(){}))()}prepareRequest(request,{url,options}){return(0,asyncToGenerator.Z)((function*(){}))()}parseHeaders(headers){return headers?Symbol.iterator in headers?Object.fromEntries(Array.from(headers).map((header=>[...header]))):{...headers}:{}}makeStatusError(status,error,message,headers){return APIError.generate(status,error,message,headers)}request(options,remainingRetries=null){return new APIPromise(this.makeRequest(options,remainingRetries))}makeRequest(optionsInput,retriesRemaining){var _this6=this;return(0,asyncToGenerator.Z)((function*(){const options=yield optionsInput;null==retriesRemaining&&(retriesRemaining=options.maxRetries??_this6.maxRetries),yield _this6.prepareOptions(options);const{req,url,timeout}=_this6.buildRequest(options);if(yield _this6.prepareRequest(req,{url,options}),debug("request",url,options,req.headers),options.signal?.aborted)throw new APIUserAbortError;const controller=new AbortController,response=yield _this6.fetchWithTimeout(url,req,timeout,controller).catch(castToError);if(response instanceof Error){if(options.signal?.aborted)throw new APIUserAbortError;if(retriesRemaining)return _this6.retryRequest(options,retriesRemaining);if("AbortError"===response.name)throw new APIConnectionTimeoutError;throw new APIConnectionError({cause:response})}const responseHeaders=createResponseHeaders(response.headers);if(!response.ok){if(retriesRemaining&&_this6.shouldRetry(response)){return debug(`response (error; ${`retrying, ${retriesRemaining} attempts remaining`})`,response.status,url,responseHeaders),_this6.retryRequest(options,retriesRemaining,responseHeaders)}const errText=yield response.text().catch((e=>castToError(e).message)),errJSON=safeJSON(errText),errMessage=errJSON?void 0:errText;debug(`response (error; ${retriesRemaining?"(error; no more retries left)":"(error; not retryable)"})`,response.status,url,responseHeaders,errMessage);throw _this6.makeStatusError(response.status,errJSON,errMessage,responseHeaders)}return{response,options,controller}}))()}requestAPIList(Page,options){const request=this.makeRequest(options,null);return new PagePromise(this,request,Page)}buildURL(path,query){const url=isAbsoluteURL(path)?new URL(path):new URL(this.baseURL+(this.baseURL.endsWith("/")&&path.startsWith("/")?path.slice(1):path)),defaultQuery=this.defaultQuery();return isEmptyObj(defaultQuery)||(query={...defaultQuery,...query}),"object"==typeof query&&query&&!Array.isArray(query)&&(url.search=this.stringifyQuery(query)),url.toString()}stringifyQuery(query){return Object.entries(query).filter((([_,value])=>void 0!==value)).map((([key,value])=>{if("string"==typeof value||"number"==typeof value||"boolean"==typeof value)return`${encodeURIComponent(key)}=${encodeURIComponent(value)}`;if(null===value)return`${encodeURIComponent(key)}=`;throw new error_OpenAIError(`Cannot stringify type ${typeof value}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}fetchWithTimeout(url,init,ms,controller){var _this7=this;return(0,asyncToGenerator.Z)((function*(){const{signal,...options}=init||{};signal&&signal.addEventListener("abort",(()=>controller.abort()));const timeout=setTimeout((()=>controller.abort()),ms);return _this7.getRequestClient().fetch.call(void 0,url,{signal:controller.signal,...options}).finally((()=>{clearTimeout(timeout)}))}))()}getRequestClient(){return{fetch:this.fetch}}shouldRetry(response){const shouldRetryHeader=response.headers.get("x-should-retry");return"true"===shouldRetryHeader||"false"!==shouldRetryHeader&&(408===response.status||(409===response.status||(429===response.status||response.status>=500)))}retryRequest(options,retriesRemaining,responseHeaders){var _this8=this;return(0,asyncToGenerator.Z)((function*(){let timeoutMillis;const retryAfterMillisHeader=responseHeaders?.["retry-after-ms"];if(retryAfterMillisHeader){const timeoutMs=parseFloat(retryAfterMillisHeader);Number.isNaN(timeoutMs)||(timeoutMillis=timeoutMs)}const retryAfterHeader=responseHeaders?.["retry-after"];if(retryAfterHeader&&!timeoutMillis){const timeoutSeconds=parseFloat(retryAfterHeader);timeoutMillis=Number.isNaN(timeoutSeconds)?Date.parse(retryAfterHeader)-Date.now():1e3*timeoutSeconds}if(!(timeoutMillis&&0<=timeoutMillis&&timeoutMillis<6e4)){const maxRetries=options.maxRetries??_this8.maxRetries;timeoutMillis=_this8.calculateDefaultRetryTimeoutMillis(retriesRemaining,maxRetries)}return yield sleep(timeoutMillis),_this8.makeRequest(options,retriesRemaining-1)}))()}calculateDefaultRetryTimeoutMillis(retriesRemaining,maxRetries){const numRetries=maxRetries-retriesRemaining;return Math.min(.5*Math.pow(2,numRetries),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS 4.47.3`}}class AbstractPage{constructor(client,response,body,options){_AbstractPage_client.set(this,void 0),__classPrivateFieldSet(this,_AbstractPage_client,client,"f"),this.options=options,this.response=response,this.body=body}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}getNextPage(){var _this9=this;return(0,asyncToGenerator.Z)((function*(){const nextInfo=_this9.nextPageInfo();if(!nextInfo)throw new error_OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const nextOptions={..._this9.options};if("params"in nextInfo&&"object"==typeof nextOptions.query)nextOptions.query={...nextOptions.query,...nextInfo.params};else if("url"in nextInfo){const params=[...Object.entries(nextOptions.query||{}),...nextInfo.url.searchParams.entries()];for(const[key,value]of params)nextInfo.url.searchParams.set(key,value);nextOptions.query=void 0,nextOptions.path=nextInfo.url.toString()}return yield __classPrivateFieldGet(_this9,_AbstractPage_client,"f").requestAPIList(_this9.constructor,nextOptions)}))()}iterPages(){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){let page=_this;for(yield page;page.hasNextPage();)page=yield(0,awaitAsyncGenerator.Z)(page.getNextPage()),yield page}))()}[(_AbstractPage_client=new WeakMap,Symbol.asyncIterator)](){var _this2=this;return(0,wrapAsyncGenerator.Z)((function*(){var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(_this2.iterPages());_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const page=_step.value;for(const item of page.getPaginatedItems())yield item}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}}))()}}class PagePromise extends APIPromise{constructor(client,request,Page){super(request,function(){var _ref2=(0,asyncToGenerator.Z)((function*(props){return new Page(client,props.response,yield defaultParseResponse(props),props.options)}));return function(_x3){return _ref2.apply(this,arguments)}}())}[Symbol.asyncIterator](){var _this3=this;return(0,wrapAsyncGenerator.Z)((function*(){const page=yield(0,awaitAsyncGenerator.Z)(_this3);var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(page);_iteratorAbruptCompletion2=!(_step2=yield(0,awaitAsyncGenerator.Z)(_iterator2.next())).done;_iteratorAbruptCompletion2=!1){const item=_step2.value;yield item}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator2.return()))}finally{if(_didIteratorError2)throw _iteratorError2}}}))()}}const createResponseHeaders=headers=>new Proxy(Object.fromEntries(headers.entries()),{get(target,name){const key=name.toString();return target[key.toLowerCase()]||target[key]}}),requestOptionsKeys={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},isRequestOptions=obj=>"object"==typeof obj&&null!==obj&&!isEmptyObj(obj)&&Object.keys(obj).every((k=>hasOwn(requestOptionsKeys,k))),getPlatformProperties=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":"4.47.3","X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":"4.47.3","X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call(void 0!==process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":"4.47.3","X-Stainless-OS":normalizePlatform(process.platform),"X-Stainless-Arch":normalizeArch(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const browserInfo=function getBrowserInfo(){if("undefined"==typeof navigator||!navigator)return null;const browserPatterns=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key,pattern}of browserPatterns){const match=pattern.exec(navigator.userAgent);if(match){return{browser:key,version:`${match[1]||0}.${match[2]||0}.${match[3]||0}`}}}return null}();return browserInfo?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":"4.47.3","X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${browserInfo.browser}`,"X-Stainless-Runtime-Version":browserInfo.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":"4.47.3","X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const normalizeArch=arch=>"x32"===arch?"x32":"x86_64"===arch||"x64"===arch?"x64":"arm"===arch?"arm":"aarch64"===arch||"arm64"===arch?"arm64":arch?`other:${arch}`:"unknown",normalizePlatform=platform=>(platform=platform.toLowerCase()).includes("ios")?"iOS":"android"===platform?"Android":"darwin"===platform?"MacOS":"win32"===platform?"Windows":"freebsd"===platform?"FreeBSD":"openbsd"===platform?"OpenBSD":"linux"===platform?"Linux":platform?`Other:${platform}`:"Unknown";let _platformHeaders;const getPlatformHeaders=()=>_platformHeaders??(_platformHeaders=getPlatformProperties()),safeJSON=text=>{try{return JSON.parse(text)}catch(err){return}},startsWithSchemeRegexp=new RegExp("^(?:[a-z]+:)?//","i"),isAbsoluteURL=url=>startsWithSchemeRegexp.test(url),sleep=ms=>new Promise((resolve=>setTimeout(resolve,ms))),validatePositiveInteger=(name,n)=>{if("number"!=typeof n||!Number.isInteger(n))throw new error_OpenAIError(`${name} must be an integer`);if(n<0)throw new error_OpenAIError(`${name} must be a positive integer`);return n},castToError=err=>err instanceof Error?err:new Error(err),readEnv=env=>void 0!==process?process.env?.[env]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(env)?.trim():void 0;function isEmptyObj(obj){if(!obj)return!0;for(const _k in obj)return!1;return!0}function hasOwn(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function applyHeadersMut(targetHeaders,newHeaders){for(const k in newHeaders){if(!hasOwn(newHeaders,k))continue;const lowerKey=k.toLowerCase();if(!lowerKey)continue;const val=newHeaders[k];null===val?delete targetHeaders[lowerKey]:void 0!==val&&(targetHeaders[lowerKey]=val)}}function debug(action,...args){void 0!==process&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${action}`,...args)}const uuid4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(c=>{const r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)}));function isObj(obj){return null!=obj&&"object"==typeof obj&&!Array.isArray(obj)}class Page extends AbstractPage{constructor(client,response,body,options){super(client,response,body,options),this.data=body.data||[],this.object=body.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class CursorPage extends AbstractPage{constructor(client,response,body,options){super(client,response,body,options),this.data=body.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const info=this.nextPageInfo();if(!info)return null;if("params"in info)return info.params;const params=Object.fromEntries(info.url.searchParams);return Object.keys(params).length?params:null}nextPageInfo(){const data=this.getPaginatedItems();if(!data.length)return null;const id=data[data.length-1]?.id;return id?{params:{after:id}}:null}}class APIResource{constructor(client){this._client=client}}class Completions extends APIResource{create(body,options){return this._client.post("/completions",{body,...options,stream:body.stream??!1})}}Completions||(Completions={});class completions_Completions extends APIResource{create(body,options){return this._client.post("/chat/completions",{body,...options,stream:body.stream??!1})}}completions_Completions||(completions_Completions={});class Chat extends APIResource{constructor(){super(...arguments),this.completions=new completions_Completions(this._client)}}!function(Chat){Chat.Completions=completions_Completions}(Chat||(Chat={}));class embeddings_Embeddings extends APIResource{create(body,options){return this._client.post("/embeddings",{body,...options})}}embeddings_Embeddings||(embeddings_Embeddings={});class Files extends APIResource{create(body,options){return this._client.post("/files",multipartFormRequestOptions({body,...options}))}retrieve(fileId,options){return this._client.get(`/files/${fileId}`,options)}list(query={},options){return isRequestOptions(query)?this.list({},query):this._client.getAPIList("/files",FileObjectsPage,{query,...options})}del(fileId,options){return this._client.delete(`/files/${fileId}`,options)}content(fileId,options){return this._client.get(`/files/${fileId}/content`,{...options,__binaryResponse:!0})}retrieveContent(fileId,options){return this._client.get(`/files/${fileId}/content`,{...options,headers:{Accept:"application/json",...options?.headers}})}waitForProcessing(id,{pollInterval=5e3,maxWait=18e5}={}){var _this=this;return(0,asyncToGenerator.Z)((function*(){const TERMINAL_STATES=new Set(["processed","error","deleted"]),start=Date.now();let file=yield _this.retrieve(id);for(;!file.status||!TERMINAL_STATES.has(file.status);)if(yield sleep(pollInterval),file=yield _this.retrieve(id),Date.now()-start>maxWait)throw new APIConnectionTimeoutError({message:`Giving up on waiting for file ${id} to finish processing after ${maxWait} milliseconds.`});return file}))()}}class FileObjectsPage extends Page{}!function(Files){Files.FileObjectsPage=FileObjectsPage}(Files||(Files={}));class Images extends APIResource{createVariation(body,options){return this._client.post("/images/variations",multipartFormRequestOptions({body,...options}))}edit(body,options){return this._client.post("/images/edits",multipartFormRequestOptions({body,...options}))}generate(body,options){return this._client.post("/images/generations",{body,...options})}}Images||(Images={});class Speech extends APIResource{create(body,options){return this._client.post("/audio/speech",{body,...options,__binaryResponse:!0})}}Speech||(Speech={});class Transcriptions extends APIResource{create(body,options){return this._client.post("/audio/transcriptions",multipartFormRequestOptions({body,...options}))}}Transcriptions||(Transcriptions={});class Translations extends APIResource{create(body,options){return this._client.post("/audio/translations",multipartFormRequestOptions({body,...options}))}}Translations||(Translations={});class Audio extends APIResource{constructor(){super(...arguments),this.transcriptions=new Transcriptions(this._client),this.translations=new Translations(this._client),this.speech=new Speech(this._client)}}!function(Audio){Audio.Transcriptions=Transcriptions,Audio.Translations=Translations,Audio.Speech=Speech}(Audio||(Audio={}));class Moderations extends APIResource{create(body,options){return this._client.post("/moderations",{body,...options})}}Moderations||(Moderations={});class Models extends APIResource{retrieve(model,options){return this._client.get(`/models/${model}`,options)}list(options){return this._client.getAPIList("/models",ModelsPage,options)}del(model,options){return this._client.delete(`/models/${model}`,options)}}class ModelsPage extends Page{}!function(Models){Models.ModelsPage=ModelsPage}(Models||(Models={}));class Checkpoints extends APIResource{list(fineTuningJobId,query={},options){return isRequestOptions(query)?this.list(fineTuningJobId,{},query):this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/checkpoints`,FineTuningJobCheckpointsPage,{query,...options})}}class FineTuningJobCheckpointsPage extends CursorPage{}!function(Checkpoints){Checkpoints.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage}(Checkpoints||(Checkpoints={}));class Jobs extends APIResource{constructor(){super(...arguments),this.checkpoints=new Checkpoints(this._client)}create(body,options){return this._client.post("/fine_tuning/jobs",{body,...options})}retrieve(fineTuningJobId,options){return this._client.get(`/fine_tuning/jobs/${fineTuningJobId}`,options)}list(query={},options){return isRequestOptions(query)?this.list({},query):this._client.getAPIList("/fine_tuning/jobs",FineTuningJobsPage,{query,...options})}cancel(fineTuningJobId,options){return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/cancel`,options)}listEvents(fineTuningJobId,query={},options){return isRequestOptions(query)?this.listEvents(fineTuningJobId,{},query):this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/events`,FineTuningJobEventsPage,{query,...options})}}class FineTuningJobsPage extends CursorPage{}class FineTuningJobEventsPage extends CursorPage{}!function(Jobs){Jobs.FineTuningJobsPage=FineTuningJobsPage,Jobs.FineTuningJobEventsPage=FineTuningJobEventsPage,Jobs.Checkpoints=Checkpoints,Jobs.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage}(Jobs||(Jobs={}));class FineTuning extends APIResource{constructor(){super(...arguments),this.jobs=new Jobs(this._client)}}!function(FineTuning){FineTuning.Jobs=Jobs,FineTuning.FineTuningJobsPage=FineTuningJobsPage,FineTuning.FineTuningJobEventsPage=FineTuningJobEventsPage}(FineTuning||(FineTuning={}));class Assistants extends APIResource{create(body,options){return this._client.post("/assistants",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(assistantId,options){return this._client.get(`/assistants/${assistantId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(assistantId,body,options){return this._client.post(`/assistants/${assistantId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(query={},options){return isRequestOptions(query)?this.list({},query):this._client.getAPIList("/assistants",AssistantsPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(assistantId,options){return this._client.delete(`/assistants/${assistantId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}class AssistantsPage extends CursorPage{}function isRunnableFunctionWithParse(fn){return"function"==typeof fn.parse}!function(Assistants){Assistants.AssistantsPage=AssistantsPage}(Assistants||(Assistants={}));const isAssistantMessage=message=>"assistant"===message?.role,isFunctionMessage=message=>"function"===message?.role,isToolMessage=message=>"tool"===message?.role;var _AbstractChatCompletionRunner_instances,_AbstractChatCompletionRunner_connectedPromise,_AbstractChatCompletionRunner_resolveConnectedPromise,_AbstractChatCompletionRunner_rejectConnectedPromise,_AbstractChatCompletionRunner_endPromise,_AbstractChatCompletionRunner_resolveEndPromise,_AbstractChatCompletionRunner_rejectEndPromise,_AbstractChatCompletionRunner_listeners,_AbstractChatCompletionRunner_ended,_AbstractChatCompletionRunner_errored,_AbstractChatCompletionRunner_aborted,_AbstractChatCompletionRunner_catchingPromiseCreated,_AbstractChatCompletionRunner_getFinalContent,_AbstractChatCompletionRunner_getFinalMessage,_AbstractChatCompletionRunner_getFinalFunctionCall,_AbstractChatCompletionRunner_getFinalFunctionCallResult,_AbstractChatCompletionRunner_calculateTotalUsage,_AbstractChatCompletionRunner_handleError,_AbstractChatCompletionRunner_validateParams,_AbstractChatCompletionRunner_stringifyFunctionCallResult,AbstractChatCompletionRunner_classPrivateFieldSet=function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value},AbstractChatCompletionRunner_classPrivateFieldGet=function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)};const DEFAULT_MAX_CHAT_COMPLETIONS=10;class AbstractChatCompletionRunner{constructor(){_AbstractChatCompletionRunner_instances.add(this),this.controller=new AbortController,_AbstractChatCompletionRunner_connectedPromise.set(this,void 0),_AbstractChatCompletionRunner_resolveConnectedPromise.set(this,(()=>{})),_AbstractChatCompletionRunner_rejectConnectedPromise.set(this,(()=>{})),_AbstractChatCompletionRunner_endPromise.set(this,void 0),_AbstractChatCompletionRunner_resolveEndPromise.set(this,(()=>{})),_AbstractChatCompletionRunner_rejectEndPromise.set(this,(()=>{})),_AbstractChatCompletionRunner_listeners.set(this,{}),this._chatCompletions=[],this.messages=[],_AbstractChatCompletionRunner_ended.set(this,!1),_AbstractChatCompletionRunner_errored.set(this,!1),_AbstractChatCompletionRunner_aborted.set(this,!1),_AbstractChatCompletionRunner_catchingPromiseCreated.set(this,!1),_AbstractChatCompletionRunner_handleError.set(this,(error=>{if(AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_errored,!0,"f"),error instanceof Error&&"AbortError"===error.name&&(error=new APIUserAbortError),error instanceof APIUserAbortError)return AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_aborted,!0,"f"),this._emit("abort",error);if(error instanceof error_OpenAIError)return this._emit("error",error);if(error instanceof Error){const openAIError=new error_OpenAIError(error.message);return openAIError.cause=error,this._emit("error",openAIError)}return this._emit("error",new error_OpenAIError(String(error)))})),AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_connectedPromise,new Promise(((resolve,reject)=>{AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_resolveConnectedPromise,resolve,"f"),AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_rejectConnectedPromise,reject,"f")})),"f"),AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_endPromise,new Promise(((resolve,reject)=>{AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_resolveEndPromise,resolve,"f"),AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_rejectEndPromise,reject,"f")})),"f"),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_connectedPromise,"f").catch((()=>{})),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_endPromise,"f").catch((()=>{}))}_run(executor){setTimeout((()=>{executor().then((()=>{this._emitFinal(),this._emit("end")}),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_handleError,"f"))}),0)}_addChatCompletion(chatCompletion){this._chatCompletions.push(chatCompletion),this._emit("chatCompletion",chatCompletion);const message=chatCompletion.choices[0]?.message;return message&&this._addMessage(message),chatCompletion}_addMessage(message,emit=!0){if("content"in message||(message.content=null),this.messages.push(message),emit)if(this._emit("message",message),(isFunctionMessage(message)||isToolMessage(message))&&message.content)this._emit("functionCallResult",message.content);else if(isAssistantMessage(message)&&message.function_call)this._emit("functionCall",message.function_call);else if(isAssistantMessage(message)&&message.tool_calls)for(const tool_call of message.tool_calls)"function"===tool_call.type&&this._emit("functionCall",tool_call.function)}_connected(){this.ended||(AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_resolveConnectedPromise,"f").call(this),this._emit("connect"))}get ended(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_ended,"f")}get errored(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_errored,"f")}get aborted(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_aborted,"f")}abort(){this.controller.abort()}on(event,listener){return(AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_listeners,"f")[event]||(AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_listeners,"f")[event]=[])).push({listener}),this}off(event,listener){const listeners=AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_listeners,"f")[event];if(!listeners)return this;const index=listeners.findIndex((l=>l.listener===listener));return index>=0&&listeners.splice(index,1),this}once(event,listener){return(AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_listeners,"f")[event]||(AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_listeners,"f")[event]=[])).push({listener,once:!0}),this}emitted(event){return new Promise(((resolve,reject)=>{AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_catchingPromiseCreated,!0,"f"),"error"!==event&&this.once("error",reject),this.once(event,resolve)}))}done(){var _this=this;return(0,asyncToGenerator.Z)((function*(){AbstractChatCompletionRunner_classPrivateFieldSet(_this,_AbstractChatCompletionRunner_catchingPromiseCreated,!0,"f"),yield AbstractChatCompletionRunner_classPrivateFieldGet(_this,_AbstractChatCompletionRunner_endPromise,"f")}))()}finalChatCompletion(){var _this2=this;return(0,asyncToGenerator.Z)((function*(){yield _this2.done();const completion=_this2._chatCompletions[_this2._chatCompletions.length-1];if(!completion)throw new error_OpenAIError("stream ended without producing a ChatCompletion");return completion}))()}finalContent(){var _this3=this;return(0,asyncToGenerator.Z)((function*(){return yield _this3.done(),AbstractChatCompletionRunner_classPrivateFieldGet(_this3,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(_this3)}))()}finalMessage(){var _this4=this;return(0,asyncToGenerator.Z)((function*(){return yield _this4.done(),AbstractChatCompletionRunner_classPrivateFieldGet(_this4,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(_this4)}))()}finalFunctionCall(){var _this5=this;return(0,asyncToGenerator.Z)((function*(){return yield _this5.done(),AbstractChatCompletionRunner_classPrivateFieldGet(_this5,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(_this5)}))()}finalFunctionCallResult(){var _this6=this;return(0,asyncToGenerator.Z)((function*(){return yield _this6.done(),AbstractChatCompletionRunner_classPrivateFieldGet(_this6,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(_this6)}))()}totalUsage(){var _this7=this;return(0,asyncToGenerator.Z)((function*(){return yield _this7.done(),AbstractChatCompletionRunner_classPrivateFieldGet(_this7,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(_this7)}))()}allChatCompletions(){return[...this._chatCompletions]}_emit(event,...args){if(AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_ended,"f"))return;"end"===event&&(AbstractChatCompletionRunner_classPrivateFieldSet(this,_AbstractChatCompletionRunner_ended,!0,"f"),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_resolveEndPromise,"f").call(this));const listeners=AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_listeners,"f")[event];if(listeners&&(AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_listeners,"f")[event]=listeners.filter((l=>!l.once)),listeners.forEach((({listener})=>listener(...args)))),"abort"===event){const error=args[0];return AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_catchingPromiseCreated,"f")||listeners?.length||Promise.reject(error),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_rejectConnectedPromise,"f").call(this,error),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_rejectEndPromise,"f").call(this,error),void this._emit("end")}if("error"===event){const error=args[0];AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_catchingPromiseCreated,"f")||listeners?.length||Promise.reject(error),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_rejectConnectedPromise,"f").call(this,error),AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_rejectEndPromise,"f").call(this,error),this._emit("end")}}_emitFinal(){const completion=this._chatCompletions[this._chatCompletions.length-1];completion&&this._emit("finalChatCompletion",completion);const finalMessage=AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this);finalMessage&&this._emit("finalMessage",finalMessage);const finalContent=AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(this);finalContent&&this._emit("finalContent",finalContent);const finalFunctionCall=AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(this);finalFunctionCall&&this._emit("finalFunctionCall",finalFunctionCall);const finalFunctionCallResult=AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this);null!=finalFunctionCallResult&&this._emit("finalFunctionCallResult",finalFunctionCallResult),this._chatCompletions.some((c=>c.usage))&&this._emit("totalUsage",AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(this))}_createChatCompletion(completions,params,options){var _this8=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this8.controller.abort(),signal.addEventListener("abort",(()=>_this8.controller.abort()))),AbstractChatCompletionRunner_classPrivateFieldGet(_this8,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_validateParams).call(_this8,params);const chatCompletion=yield completions.create({...params,stream:!1},{...options,signal:_this8.controller.signal});return _this8._connected(),_this8._addChatCompletion(chatCompletion)}))()}_runChatCompletion(completions,params,options){var _this9=this;return(0,asyncToGenerator.Z)((function*(){for(const message of params.messages)_this9._addMessage(message,!1);return yield _this9._createChatCompletion(completions,params,options)}))()}_runFunctions(completions,params,options){var _this10=this;return(0,asyncToGenerator.Z)((function*(){const role="function",{function_call="auto",stream,...restParams}=params,singleFunctionToCall="string"!=typeof function_call&&function_call?.name,{maxChatCompletions=DEFAULT_MAX_CHAT_COMPLETIONS}=options||{},functionsByName={};for(const f of params.functions)functionsByName[f.name||f.function.name]=f;const functions=params.functions.map((f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description})));for(const message of params.messages)_this10._addMessage(message,!1);for(let i=0;i<maxChatCompletions;++i){const chatCompletion=yield _this10._createChatCompletion(completions,{...restParams,function_call,functions,messages:[..._this10.messages]},options),message=chatCompletion.choices[0]?.message;if(!message)throw new error_OpenAIError("missing message in ChatCompletion response");if(!message.function_call)return;const{name,arguments:args}=message.function_call,fn=functionsByName[name];if(!fn){const content=`Invalid function_call: ${JSON.stringify(name)}. Available options are: ${functions.map((f=>JSON.stringify(f.name))).join(", ")}. Please try again`;_this10._addMessage({role,name,content});continue}if(singleFunctionToCall&&singleFunctionToCall!==name){const content=`Invalid function_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;_this10._addMessage({role,name,content});continue}let parsed;try{parsed=isRunnableFunctionWithParse(fn)?yield fn.parse(args):args}catch(error){_this10._addMessage({role,name,content:error instanceof Error?error.message:String(error)});continue}const rawContent=yield fn.function(parsed,_this10),content=AbstractChatCompletionRunner_classPrivateFieldGet(_this10,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(_this10,rawContent);if(_this10._addMessage({role,name,content}),singleFunctionToCall)return}}))()}_runTools(completions,params,options){var _this11=this;return(0,asyncToGenerator.Z)((function*(){const{tool_choice="auto",stream,...restParams}=params,singleFunctionToCall="string"!=typeof tool_choice&&tool_choice?.function?.name,{maxChatCompletions=DEFAULT_MAX_CHAT_COMPLETIONS}=options||{},functionsByName={};for(const f of params.tools)"function"===f.type&&(functionsByName[f.function.name||f.function.function.name]=f.function);const tools="tools"in params?params.tools.map((t=>"function"===t.type?{type:"function",function:{name:t.function.name||t.function.function.name,parameters:t.function.parameters,description:t.function.description}}:t)):void 0;for(const message of params.messages)_this11._addMessage(message,!1);for(let i=0;i<maxChatCompletions;++i){const chatCompletion=yield _this11._createChatCompletion(completions,{...restParams,tool_choice,tools,messages:[..._this11.messages]},options),message=chatCompletion.choices[0]?.message;if(!message)throw new error_OpenAIError("missing message in ChatCompletion response");if(!message.tool_calls)return;for(const tool_call of message.tool_calls){if("function"!==tool_call.type)continue;const tool_call_id=tool_call.id,{name,arguments:args}=tool_call.function,fn=functionsByName[name];if(!fn){const content=`Invalid tool_call: ${JSON.stringify(name)}. Available options are: ${tools.map((f=>JSON.stringify(f.function.name))).join(", ")}. Please try again`;_this11._addMessage({role:"tool",tool_call_id,content});continue}if(singleFunctionToCall&&singleFunctionToCall!==name){const content=`Invalid tool_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;_this11._addMessage({role:"tool",tool_call_id,content});continue}let parsed;try{parsed=isRunnableFunctionWithParse(fn)?yield fn.parse(args):args}catch(error){const content=error instanceof Error?error.message:String(error);_this11._addMessage({role:"tool",tool_call_id,content});continue}const rawContent=yield fn.function(parsed,_this11),content=AbstractChatCompletionRunner_classPrivateFieldGet(_this11,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(_this11,rawContent);if(_this11._addMessage({role:"tool",tool_call_id,content}),singleFunctionToCall)return}}}))()}}_AbstractChatCompletionRunner_connectedPromise=new WeakMap,_AbstractChatCompletionRunner_resolveConnectedPromise=new WeakMap,_AbstractChatCompletionRunner_rejectConnectedPromise=new WeakMap,_AbstractChatCompletionRunner_endPromise=new WeakMap,_AbstractChatCompletionRunner_resolveEndPromise=new WeakMap,_AbstractChatCompletionRunner_rejectEndPromise=new WeakMap,_AbstractChatCompletionRunner_listeners=new WeakMap,_AbstractChatCompletionRunner_ended=new WeakMap,_AbstractChatCompletionRunner_errored=new WeakMap,_AbstractChatCompletionRunner_aborted=new WeakMap,_AbstractChatCompletionRunner_catchingPromiseCreated=new WeakMap,_AbstractChatCompletionRunner_handleError=new WeakMap,_AbstractChatCompletionRunner_instances=new WeakSet,_AbstractChatCompletionRunner_getFinalContent=function _AbstractChatCompletionRunner_getFinalContent(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this).content??null},_AbstractChatCompletionRunner_getFinalMessage=function _AbstractChatCompletionRunner_getFinalMessage(){let i=this.messages.length;for(;i-- >0;){const message=this.messages[i];if(isAssistantMessage(message))return{...message,content:message.content??null}}throw new error_OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},_AbstractChatCompletionRunner_getFinalFunctionCall=function _AbstractChatCompletionRunner_getFinalFunctionCall(){for(let i=this.messages.length-1;i>=0;i--){const message=this.messages[i];if(isAssistantMessage(message)&&message?.function_call)return message.function_call;if(isAssistantMessage(message)&&message?.tool_calls?.length)return message.tool_calls.at(-1)?.function}},_AbstractChatCompletionRunner_getFinalFunctionCallResult=function _AbstractChatCompletionRunner_getFinalFunctionCallResult(){for(let i=this.messages.length-1;i>=0;i--){const message=this.messages[i];if(isFunctionMessage(message)&&null!=message.content)return message.content;if(isToolMessage(message)&&null!=message.content&&this.messages.some((x=>"assistant"===x.role&&x.tool_calls?.some((y=>"function"===y.type&&y.id===message.tool_call_id)))))return message.content}},_AbstractChatCompletionRunner_calculateTotalUsage=function _AbstractChatCompletionRunner_calculateTotalUsage(){const total={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage}of this._chatCompletions)usage&&(total.completion_tokens+=usage.completion_tokens,total.prompt_tokens+=usage.prompt_tokens,total.total_tokens+=usage.total_tokens);return total},_AbstractChatCompletionRunner_validateParams=function _AbstractChatCompletionRunner_validateParams(params){if(null!=params.n&&params.n>1)throw new error_OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},_AbstractChatCompletionRunner_stringifyFunctionCallResult=function _AbstractChatCompletionRunner_stringifyFunctionCallResult(rawContent){return"string"==typeof rawContent?rawContent:void 0===rawContent?"undefined":JSON.stringify(rawContent)};class ChatCompletionRunner extends AbstractChatCompletionRunner{static runFunctions(completions,params,options){const runner=new ChatCompletionRunner,opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return runner._run((()=>runner._runFunctions(completions,params,opts))),runner}static runTools(completions,params,options){const runner=new ChatCompletionRunner,opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runTools"}};return runner._run((()=>runner._runTools(completions,params,opts))),runner}_addMessage(message){super._addMessage(message),isAssistantMessage(message)&&message.content&&this._emit("content",message.content)}}var _ChatCompletionStream_instances,_ChatCompletionStream_currentChatCompletionSnapshot,_ChatCompletionStream_beginRequest,_ChatCompletionStream_addChunk,_ChatCompletionStream_endRequest,_ChatCompletionStream_accumulateChatCompletion,ChatCompletionStream_classPrivateFieldGet=function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)},ChatCompletionStream_classPrivateFieldSet=function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value};class ChatCompletionStream extends AbstractChatCompletionRunner{constructor(){super(...arguments),_ChatCompletionStream_instances.add(this),_ChatCompletionStream_currentChatCompletionSnapshot.set(this,void 0)}get currentChatCompletionSnapshot(){return ChatCompletionStream_classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f")}static fromReadableStream(stream){const runner=new ChatCompletionStream;return runner._run((()=>runner._fromReadableStream(stream))),runner}static createChatCompletion(completions,params,options){const runner=new ChatCompletionStream;return runner._run((()=>runner._runChatCompletion(completions,{...params,stream:!0},{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}))),runner}_createChatCompletion(completions,params,options){var _this=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this.controller.abort(),signal.addEventListener("abort",(()=>_this.controller.abort()))),ChatCompletionStream_classPrivateFieldGet(_this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(_this);const stream=yield completions.create({...params,stream:!0},{...options,signal:_this.controller.signal});_this._connected();var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion=!(_step=yield _iterator.next()).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;ChatCompletionStream_classPrivateFieldGet(_this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(_this,chunk)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield _iterator.return())}finally{if(_didIteratorError)throw _iteratorError}}if(stream.controller.signal?.aborted)throw new APIUserAbortError;return _this._addChatCompletion(ChatCompletionStream_classPrivateFieldGet(_this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(_this))}))()}_fromReadableStream(readableStream,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this2.controller.abort(),signal.addEventListener("abort",(()=>_this2.controller.abort()))),ChatCompletionStream_classPrivateFieldGet(_this2,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(_this2),_this2._connected();const stream=Stream.fromReadableStream(readableStream,_this2.controller);let chatId;var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion2=!(_step2=yield _iterator2.next()).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;chatId&&chatId!==chunk.id&&_this2._addChatCompletion(ChatCompletionStream_classPrivateFieldGet(_this2,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(_this2)),ChatCompletionStream_classPrivateFieldGet(_this2,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(_this2,chunk),chatId=chunk.id}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield _iterator2.return())}finally{if(_didIteratorError2)throw _iteratorError2}}if(stream.controller.signal?.aborted)throw new APIUserAbortError;return _this2._addChatCompletion(ChatCompletionStream_classPrivateFieldGet(_this2,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(_this2))}))()}[(_ChatCompletionStream_currentChatCompletionSnapshot=new WeakMap,_ChatCompletionStream_instances=new WeakSet,_ChatCompletionStream_beginRequest=function _ChatCompletionStream_beginRequest(){this.ended||ChatCompletionStream_classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,void 0,"f")},_ChatCompletionStream_addChunk=function _ChatCompletionStream_addChunk(chunk){if(this.ended)return;const completion=ChatCompletionStream_classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_accumulateChatCompletion).call(this,chunk);this._emit("chunk",chunk,completion);const delta=chunk.choices[0]?.delta?.content,snapshot=completion.choices[0]?.message;null!=delta&&"assistant"===snapshot?.role&&snapshot?.content&&this._emit("content",delta,snapshot.content)},_ChatCompletionStream_endRequest=function _ChatCompletionStream_endRequest(){if(this.ended)throw new error_OpenAIError("stream has ended, this shouldn't happen");const snapshot=ChatCompletionStream_classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f");if(!snapshot)throw new error_OpenAIError("request ended without sending any chunks");return ChatCompletionStream_classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,void 0,"f"),function finalizeChatCompletion(snapshot){const{id,choices,created,model,system_fingerprint,...rest}=snapshot;return{...rest,id,choices:choices.map((({message,finish_reason,index,logprobs,...choiceRest})=>{if(!finish_reason)throw new error_OpenAIError(`missing finish_reason for choice ${index}`);const{content=null,function_call,tool_calls,...messageRest}=message,role=message.role;if(!role)throw new error_OpenAIError(`missing role for choice ${index}`);if(function_call){const{arguments:args,name}=function_call;if(null==args)throw new error_OpenAIError(`missing function_call.arguments for choice ${index}`);if(!name)throw new error_OpenAIError(`missing function_call.name for choice ${index}`);return{...choiceRest,message:{content,function_call:{arguments:args,name},role},finish_reason,index,logprobs}}return tool_calls?{...choiceRest,index,finish_reason,logprobs,message:{...messageRest,role,content,tool_calls:tool_calls.map(((tool_call,i)=>{const{function:fn,type,id,...toolRest}=tool_call,{arguments:args,name,...fnRest}=fn||{};if(null==id)throw new error_OpenAIError(`missing choices[${index}].tool_calls[${i}].id\n${str(snapshot)}`);if(null==type)throw new error_OpenAIError(`missing choices[${index}].tool_calls[${i}].type\n${str(snapshot)}`);if(null==name)throw new error_OpenAIError(`missing choices[${index}].tool_calls[${i}].function.name\n${str(snapshot)}`);if(null==args)throw new error_OpenAIError(`missing choices[${index}].tool_calls[${i}].function.arguments\n${str(snapshot)}`);return{...toolRest,id,type,function:{...fnRest,name,arguments:args}}}))}}:{...choiceRest,message:{...messageRest,content,role},finish_reason,index,logprobs}})),created,model,object:"chat.completion",...system_fingerprint?{system_fingerprint}:{}}}(snapshot)},_ChatCompletionStream_accumulateChatCompletion=function _ChatCompletionStream_accumulateChatCompletion(chunk){var _a,_b,_c;let snapshot=ChatCompletionStream_classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f");const{choices,...rest}=chunk;snapshot?Object.assign(snapshot,rest):snapshot=ChatCompletionStream_classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,{...rest,choices:[]},"f");for(const{delta,finish_reason,index,logprobs=null,...other}of chunk.choices){let choice=snapshot.choices[index];if(choice||(choice=snapshot.choices[index]={finish_reason,index,message:{},logprobs,...other}),logprobs)if(choice.logprobs){const{content,...rest}=logprobs;Object.assign(choice.logprobs,rest),content&&((_a=choice.logprobs).content??(_a.content=[]),choice.logprobs.content.push(...content))}else choice.logprobs=Object.assign({},logprobs);if(finish_reason&&(choice.finish_reason=finish_reason),Object.assign(choice,other),!delta)continue;const{content,function_call,role,tool_calls,...rest}=delta;if(Object.assign(choice.message,rest),content&&(choice.message.content=(choice.message.content||"")+content),role&&(choice.message.role=role),function_call&&(choice.message.function_call?(function_call.name&&(choice.message.function_call.name=function_call.name),function_call.arguments&&((_b=choice.message.function_call).arguments??(_b.arguments=""),choice.message.function_call.arguments+=function_call.arguments)):choice.message.function_call=function_call),tool_calls){choice.message.tool_calls||(choice.message.tool_calls=[]);for(const{index,id,type,function:fn,...rest}of tool_calls){const tool_call=(_c=choice.message.tool_calls)[index]??(_c[index]={});Object.assign(tool_call,rest),id&&(tool_call.id=id),type&&(tool_call.type=type),fn&&(tool_call.function??(tool_call.function={arguments:""})),fn?.name&&(tool_call.function.name=fn.name),fn?.arguments&&(tool_call.function.arguments+=fn.arguments)}}}return snapshot},Symbol.asyncIterator)](){var _this3=this;const pushQueue=[],readQueue=[];let done=!1;return this.on("chunk",(chunk=>{const reader=readQueue.shift();reader?reader.resolve(chunk):pushQueue.push(chunk)})),this.on("end",(()=>{done=!0;for(const reader of readQueue)reader.resolve(void 0);readQueue.length=0})),this.on("abort",(err=>{done=!0;for(const reader of readQueue)reader.reject(err);readQueue.length=0})),this.on("error",(err=>{done=!0;for(const reader of readQueue)reader.reject(err);readQueue.length=0})),{next:function(){var _ref=(0,asyncToGenerator.Z)((function*(){if(!pushQueue.length)return done?{value:void 0,done:!0}:new Promise(((resolve,reject)=>readQueue.push({resolve,reject}))).then((chunk=>chunk?{value:chunk,done:!1}:{value:void 0,done:!0}));return{value:pushQueue.shift(),done:!1}}));return function next(){return _ref.apply(this,arguments)}}(),return:(_ref2=(0,asyncToGenerator.Z)((function*(){return _this3.abort(),{value:void 0,done:!0}})),function _return(){return _ref2.apply(this,arguments)})};var _ref2}toReadableStream(){return new Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function str(x){return JSON.stringify(x)}class ChatCompletionStreamingRunner extends ChatCompletionStream{static fromReadableStream(stream){const runner=new ChatCompletionStreamingRunner;return runner._run((()=>runner._fromReadableStream(stream))),runner}static runFunctions(completions,params,options){const runner=new ChatCompletionStreamingRunner,opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return runner._run((()=>runner._runFunctions(completions,params,opts))),runner}static runTools(completions,params,options){const runner=new ChatCompletionStreamingRunner,opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runTools"}};return runner._run((()=>runner._runTools(completions,params,opts))),runner}}class chat_completions_Completions extends APIResource{runFunctions(body,options){return body.stream?ChatCompletionStreamingRunner.runFunctions(this._client.chat.completions,body,options):ChatCompletionRunner.runFunctions(this._client.chat.completions,body,options)}runTools(body,options){return body.stream?ChatCompletionStreamingRunner.runTools(this._client.chat.completions,body,options):ChatCompletionRunner.runTools(this._client.chat.completions,body,options)}stream(body,options){return ChatCompletionStream.createChatCompletion(this._client.chat.completions,body,options)}}class chat_Chat extends APIResource{constructor(){super(...arguments),this.completions=new chat_completions_Completions(this._client)}}!function(Chat){Chat.Completions=chat_completions_Completions}(chat_Chat||(chat_Chat={}));var _AbstractAssistantStreamRunner_connectedPromise,_AbstractAssistantStreamRunner_resolveConnectedPromise,_AbstractAssistantStreamRunner_rejectConnectedPromise,_AbstractAssistantStreamRunner_endPromise,_AbstractAssistantStreamRunner_resolveEndPromise,_AbstractAssistantStreamRunner_rejectEndPromise,_AbstractAssistantStreamRunner_listeners,_AbstractAssistantStreamRunner_ended,_AbstractAssistantStreamRunner_errored,_AbstractAssistantStreamRunner_aborted,_AbstractAssistantStreamRunner_catchingPromiseCreated,_AbstractAssistantStreamRunner_handleError,AbstractAssistantStreamRunner_classPrivateFieldSet=function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value},AbstractAssistantStreamRunner_classPrivateFieldGet=function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)};class AbstractAssistantStreamRunner{constructor(){this.controller=new AbortController,_AbstractAssistantStreamRunner_connectedPromise.set(this,void 0),_AbstractAssistantStreamRunner_resolveConnectedPromise.set(this,(()=>{})),_AbstractAssistantStreamRunner_rejectConnectedPromise.set(this,(()=>{})),_AbstractAssistantStreamRunner_endPromise.set(this,void 0),_AbstractAssistantStreamRunner_resolveEndPromise.set(this,(()=>{})),_AbstractAssistantStreamRunner_rejectEndPromise.set(this,(()=>{})),_AbstractAssistantStreamRunner_listeners.set(this,{}),_AbstractAssistantStreamRunner_ended.set(this,!1),_AbstractAssistantStreamRunner_errored.set(this,!1),_AbstractAssistantStreamRunner_aborted.set(this,!1),_AbstractAssistantStreamRunner_catchingPromiseCreated.set(this,!1),_AbstractAssistantStreamRunner_handleError.set(this,(error=>{if(AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_errored,!0,"f"),error instanceof Error&&"AbortError"===error.name&&(error=new APIUserAbortError),error instanceof APIUserAbortError)return AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_aborted,!0,"f"),this._emit("abort",error);if(error instanceof error_OpenAIError)return this._emit("error",error);if(error instanceof Error){const openAIError=new error_OpenAIError(error.message);return openAIError.cause=error,this._emit("error",openAIError)}return this._emit("error",new error_OpenAIError(String(error)))})),AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_connectedPromise,new Promise(((resolve,reject)=>{AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_resolveConnectedPromise,resolve,"f"),AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_rejectConnectedPromise,reject,"f")})),"f"),AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_endPromise,new Promise(((resolve,reject)=>{AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_resolveEndPromise,resolve,"f"),AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_rejectEndPromise,reject,"f")})),"f"),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_connectedPromise,"f").catch((()=>{})),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_endPromise,"f").catch((()=>{}))}_run(executor){setTimeout((()=>{executor().then((()=>{this._emit("end")}),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_handleError,"f"))}),0)}_addRun(run){return run}_connected(){this.ended||(AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_resolveConnectedPromise,"f").call(this),this._emit("connect"))}get ended(){return AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_ended,"f")}get errored(){return AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_errored,"f")}get aborted(){return AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_aborted,"f")}abort(){this.controller.abort()}on(event,listener){return(AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_listeners,"f")[event]||(AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_listeners,"f")[event]=[])).push({listener}),this}off(event,listener){const listeners=AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_listeners,"f")[event];if(!listeners)return this;const index=listeners.findIndex((l=>l.listener===listener));return index>=0&&listeners.splice(index,1),this}once(event,listener){return(AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_listeners,"f")[event]||(AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_listeners,"f")[event]=[])).push({listener,once:!0}),this}emitted(event){return new Promise(((resolve,reject)=>{AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_catchingPromiseCreated,!0,"f"),"error"!==event&&this.once("error",reject),this.once(event,resolve)}))}done(){var _this=this;return(0,asyncToGenerator.Z)((function*(){AbstractAssistantStreamRunner_classPrivateFieldSet(_this,_AbstractAssistantStreamRunner_catchingPromiseCreated,!0,"f"),yield AbstractAssistantStreamRunner_classPrivateFieldGet(_this,_AbstractAssistantStreamRunner_endPromise,"f")}))()}_emit(event,...args){if(AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_ended,"f"))return;"end"===event&&(AbstractAssistantStreamRunner_classPrivateFieldSet(this,_AbstractAssistantStreamRunner_ended,!0,"f"),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_resolveEndPromise,"f").call(this));const listeners=AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_listeners,"f")[event];if(listeners&&(AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_listeners,"f")[event]=listeners.filter((l=>!l.once)),listeners.forEach((({listener})=>listener(...args)))),"abort"===event){const error=args[0];return AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_catchingPromiseCreated,"f")||listeners?.length||Promise.reject(error),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_rejectConnectedPromise,"f").call(this,error),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_rejectEndPromise,"f").call(this,error),void this._emit("end")}if("error"===event){const error=args[0];AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_catchingPromiseCreated,"f")||listeners?.length||Promise.reject(error),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_rejectConnectedPromise,"f").call(this,error),AbstractAssistantStreamRunner_classPrivateFieldGet(this,_AbstractAssistantStreamRunner_rejectEndPromise,"f").call(this,error),this._emit("end")}}_threadAssistantStream(body,thread,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){return yield _this2._createThreadAssistantStream(thread,body,options)}))()}_runAssistantStream(threadId,runs,params,options){var _this3=this;return(0,asyncToGenerator.Z)((function*(){return yield _this3._createAssistantStream(runs,threadId,params,options)}))()}_runToolAssistantStream(threadId,runId,runs,params,options){var _this4=this;return(0,asyncToGenerator.Z)((function*(){return yield _this4._createToolAssistantStream(runs,threadId,runId,params,options)}))()}_createThreadAssistantStream(thread,body,options){var _this5=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this5.controller.abort(),signal.addEventListener("abort",(()=>_this5.controller.abort())));const runResult=yield thread.createAndRun({...body,stream:!1},{...options,signal:_this5.controller.signal});return _this5._connected(),_this5._addRun(runResult)}))()}_createToolAssistantStream(run,threadId,runId,params,options){var _this6=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this6.controller.abort(),signal.addEventListener("abort",(()=>_this6.controller.abort())));const runResult=yield run.submitToolOutputs(threadId,runId,{...params,stream:!1},{...options,signal:_this6.controller.signal});return _this6._connected(),_this6._addRun(runResult)}))()}_createAssistantStream(run,threadId,params,options){var _this7=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this7.controller.abort(),signal.addEventListener("abort",(()=>_this7.controller.abort())));const runResult=yield run.create(threadId,{...params,stream:!1},{...options,signal:_this7.controller.signal});return _this7._connected(),_this7._addRun(runResult)}))()}}_AbstractAssistantStreamRunner_connectedPromise=new WeakMap,_AbstractAssistantStreamRunner_resolveConnectedPromise=new WeakMap,_AbstractAssistantStreamRunner_rejectConnectedPromise=new WeakMap,_AbstractAssistantStreamRunner_endPromise=new WeakMap,_AbstractAssistantStreamRunner_resolveEndPromise=new WeakMap,_AbstractAssistantStreamRunner_rejectEndPromise=new WeakMap,_AbstractAssistantStreamRunner_listeners=new WeakMap,_AbstractAssistantStreamRunner_ended=new WeakMap,_AbstractAssistantStreamRunner_errored=new WeakMap,_AbstractAssistantStreamRunner_aborted=new WeakMap,_AbstractAssistantStreamRunner_catchingPromiseCreated=new WeakMap,_AbstractAssistantStreamRunner_handleError=new WeakMap;var _AssistantStream_instances,_AssistantStream_events,_AssistantStream_runStepSnapshots,_AssistantStream_messageSnapshots,_AssistantStream_messageSnapshot,_AssistantStream_finalRun,_AssistantStream_currentContentIndex,_AssistantStream_currentContent,_AssistantStream_currentToolCallIndex,_AssistantStream_currentToolCall,_AssistantStream_currentEvent,_AssistantStream_currentRunSnapshot,_AssistantStream_currentRunStepSnapshot,_AssistantStream_addEvent,_AssistantStream_endRequest,_AssistantStream_handleMessage,_AssistantStream_handleRunStep,_AssistantStream_handleEvent,_AssistantStream_accumulateRunStep,_AssistantStream_accumulateMessage,_AssistantStream_accumulateContent,_AssistantStream_handleRun,AssistantStream_classPrivateFieldGet=function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)},AssistantStream_classPrivateFieldSet=function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value};class AssistantStream extends AbstractAssistantStreamRunner{constructor(){super(...arguments),_AssistantStream_instances.add(this),_AssistantStream_events.set(this,[]),_AssistantStream_runStepSnapshots.set(this,{}),_AssistantStream_messageSnapshots.set(this,{}),_AssistantStream_messageSnapshot.set(this,void 0),_AssistantStream_finalRun.set(this,void 0),_AssistantStream_currentContentIndex.set(this,void 0),_AssistantStream_currentContent.set(this,void 0),_AssistantStream_currentToolCallIndex.set(this,void 0),_AssistantStream_currentToolCall.set(this,void 0),_AssistantStream_currentEvent.set(this,void 0),_AssistantStream_currentRunSnapshot.set(this,void 0),_AssistantStream_currentRunStepSnapshot.set(this,void 0)}[(_AssistantStream_events=new WeakMap,_AssistantStream_runStepSnapshots=new WeakMap,_AssistantStream_messageSnapshots=new WeakMap,_AssistantStream_messageSnapshot=new WeakMap,_AssistantStream_finalRun=new WeakMap,_AssistantStream_currentContentIndex=new WeakMap,_AssistantStream_currentContent=new WeakMap,_AssistantStream_currentToolCallIndex=new WeakMap,_AssistantStream_currentToolCall=new WeakMap,_AssistantStream_currentEvent=new WeakMap,_AssistantStream_currentRunSnapshot=new WeakMap,_AssistantStream_currentRunStepSnapshot=new WeakMap,_AssistantStream_instances=new WeakSet,Symbol.asyncIterator)](){var _this=this;const pushQueue=[],readQueue=[];let done=!1;return this.on("event",(event=>{const reader=readQueue.shift();reader?reader.resolve(event):pushQueue.push(event)})),this.on("end",(()=>{done=!0;for(const reader of readQueue)reader.resolve(void 0);readQueue.length=0})),this.on("abort",(err=>{done=!0;for(const reader of readQueue)reader.reject(err);readQueue.length=0})),this.on("error",(err=>{done=!0;for(const reader of readQueue)reader.reject(err);readQueue.length=0})),{next:function(){var _ref=(0,asyncToGenerator.Z)((function*(){if(!pushQueue.length)return done?{value:void 0,done:!0}:new Promise(((resolve,reject)=>readQueue.push({resolve,reject}))).then((chunk=>chunk?{value:chunk,done:!1}:{value:void 0,done:!0}));return{value:pushQueue.shift(),done:!1}}));return function next(){return _ref.apply(this,arguments)}}(),return:(_ref2=(0,asyncToGenerator.Z)((function*(){return _this.abort(),{value:void 0,done:!0}})),function _return(){return _ref2.apply(this,arguments)})};var _ref2}static fromReadableStream(stream){const runner=new AssistantStream;return runner._run((()=>runner._fromReadableStream(stream))),runner}_fromReadableStream(readableStream,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this2.controller.abort(),signal.addEventListener("abort",(()=>_this2.controller.abort()))),_this2._connected();const stream=Stream.fromReadableStream(readableStream,_this2.controller);var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion=!(_step=yield _iterator.next()).done;_iteratorAbruptCompletion=!1){const event=_step.value;AssistantStream_classPrivateFieldGet(_this2,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(_this2,event)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield _iterator.return())}finally{if(_didIteratorError)throw _iteratorError}}if(stream.controller.signal?.aborted)throw new APIUserAbortError;return _this2._addRun(AssistantStream_classPrivateFieldGet(_this2,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(_this2))}))()}toReadableStream(){return new Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(threadId,runId,runs,body,options){const runner=new AssistantStream;return runner._run((()=>runner._runToolAssistantStream(threadId,runId,runs,body,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}))),runner}_createToolAssistantStream(run,threadId,runId,params,options){var _this3=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this3.controller.abort(),signal.addEventListener("abort",(()=>_this3.controller.abort())));const body={...params,stream:!0},stream=yield run.submitToolOutputs(threadId,runId,body,{...options,signal:_this3.controller.signal});_this3._connected();var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion2=!(_step2=yield _iterator2.next()).done;_iteratorAbruptCompletion2=!1){const event=_step2.value;AssistantStream_classPrivateFieldGet(_this3,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(_this3,event)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield _iterator2.return())}finally{if(_didIteratorError2)throw _iteratorError2}}if(stream.controller.signal?.aborted)throw new APIUserAbortError;return _this3._addRun(AssistantStream_classPrivateFieldGet(_this3,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(_this3))}))()}static createThreadAssistantStream(body,thread,options){const runner=new AssistantStream;return runner._run((()=>runner._threadAssistantStream(body,thread,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}))),runner}static createAssistantStream(threadId,runs,params,options){const runner=new AssistantStream;return runner._run((()=>runner._runAssistantStream(threadId,runs,params,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}))),runner}currentEvent(){return AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentEvent,"f")}currentRun(){return AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentRunSnapshot,"f")}currentMessageSnapshot(){return AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f")}currentRunStepSnapshot(){return AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentRunStepSnapshot,"f")}finalRunSteps(){var _this4=this;return(0,asyncToGenerator.Z)((function*(){return yield _this4.done(),Object.values(AssistantStream_classPrivateFieldGet(_this4,_AssistantStream_runStepSnapshots,"f"))}))()}finalMessages(){var _this5=this;return(0,asyncToGenerator.Z)((function*(){return yield _this5.done(),Object.values(AssistantStream_classPrivateFieldGet(_this5,_AssistantStream_messageSnapshots,"f"))}))()}finalRun(){var _this6=this;return(0,asyncToGenerator.Z)((function*(){if(yield _this6.done(),!AssistantStream_classPrivateFieldGet(_this6,_AssistantStream_finalRun,"f"))throw Error("Final run was not received.");return AssistantStream_classPrivateFieldGet(_this6,_AssistantStream_finalRun,"f")}))()}_createThreadAssistantStream(thread,params,options){var _this7=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this7.controller.abort(),signal.addEventListener("abort",(()=>_this7.controller.abort())));const body={...params,stream:!0},stream=yield thread.createAndRun(body,{...options,signal:_this7.controller.signal});_this7._connected();var _iteratorError3,_iteratorAbruptCompletion3=!1,_didIteratorError3=!1;try{for(var _step3,_iterator3=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion3=!(_step3=yield _iterator3.next()).done;_iteratorAbruptCompletion3=!1){const event=_step3.value;AssistantStream_classPrivateFieldGet(_this7,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(_this7,event)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorAbruptCompletion3&&null!=_iterator3.return&&(yield _iterator3.return())}finally{if(_didIteratorError3)throw _iteratorError3}}if(stream.controller.signal?.aborted)throw new APIUserAbortError;return _this7._addRun(AssistantStream_classPrivateFieldGet(_this7,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(_this7))}))()}_createAssistantStream(run,threadId,params,options){var _this8=this;return(0,asyncToGenerator.Z)((function*(){const signal=options?.signal;signal&&(signal.aborted&&_this8.controller.abort(),signal.addEventListener("abort",(()=>_this8.controller.abort())));const body={...params,stream:!0},stream=yield run.create(threadId,body,{...options,signal:_this8.controller.signal});_this8._connected();var _iteratorError4,_iteratorAbruptCompletion4=!1,_didIteratorError4=!1;try{for(var _step4,_iterator4=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion4=!(_step4=yield _iterator4.next()).done;_iteratorAbruptCompletion4=!1){const event=_step4.value;AssistantStream_classPrivateFieldGet(_this8,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(_this8,event)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorAbruptCompletion4&&null!=_iterator4.return&&(yield _iterator4.return())}finally{if(_didIteratorError4)throw _iteratorError4}}if(stream.controller.signal?.aborted)throw new APIUserAbortError;return _this8._addRun(AssistantStream_classPrivateFieldGet(_this8,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(_this8))}))()}static accumulateDelta(acc,delta){for(const[key,deltaValue]of Object.entries(delta)){if(!acc.hasOwnProperty(key)){acc[key]=deltaValue;continue}let accValue=acc[key];if(null!=accValue)if("index"!==key&&"type"!==key){if("string"==typeof accValue&&"string"==typeof deltaValue)accValue+=deltaValue;else if("number"==typeof accValue&&"number"==typeof deltaValue)accValue+=deltaValue;else if(isObj(accValue)&&isObj(deltaValue))accValue=this.accumulateDelta(accValue,deltaValue);else{if(!Array.isArray(accValue)||!Array.isArray(deltaValue))throw Error(`Unhandled record type: ${key}, deltaValue: ${deltaValue}, accValue: ${accValue}`);if(accValue.every((x=>"string"==typeof x||"number"==typeof x))){accValue.push(...deltaValue);continue}}acc[key]=accValue}else acc[key]=deltaValue;else acc[key]=deltaValue}return acc}}_AssistantStream_addEvent=function _AssistantStream_addEvent(event){if(!this.ended)switch(AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentEvent,event,"f"),AssistantStream_classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleEvent).call(this,event),event.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":AssistantStream_classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleRun).call(this,event);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":AssistantStream_classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleRunStep).call(this,event);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":AssistantStream_classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleMessage).call(this,event);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},_AssistantStream_endRequest=function _AssistantStream_endRequest(){if(this.ended)throw new error_OpenAIError("stream has ended, this shouldn't happen");if(!AssistantStream_classPrivateFieldGet(this,_AssistantStream_finalRun,"f"))throw Error("Final run has not been received");return AssistantStream_classPrivateFieldGet(this,_AssistantStream_finalRun,"f")},_AssistantStream_handleMessage=function _AssistantStream_handleMessage(event){const[accumulatedMessage,newContent]=AssistantStream_classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateMessage).call(this,event,AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));AssistantStream_classPrivateFieldSet(this,_AssistantStream_messageSnapshot,accumulatedMessage,"f"),AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshots,"f")[accumulatedMessage.id]=accumulatedMessage;for(const content of newContent){const snapshotContent=accumulatedMessage.content[content.index];"text"==snapshotContent?.type&&this._emit("textCreated",snapshotContent.text)}switch(event.event){case"thread.message.created":this._emit("messageCreated",event.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",event.data.delta,accumulatedMessage),event.data.delta.content)for(const content of event.data.delta.content){if("text"==content.type&&content.text){let textDelta=content.text,snapshot=accumulatedMessage.content[content.index];if(!snapshot||"text"!=snapshot.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",textDelta,snapshot.text)}if(content.index!=AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")){if(AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentContent,"f"))switch(AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentContent,"f").type){case"text":this._emit("textDone",AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentContent,"f").text,AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break;case"image_file":this._emit("imageFileDone",AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentContent,"f").image_file,AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"))}AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentContentIndex,content.index,"f")}AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentContent,accumulatedMessage.content[content.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")){const currentContent=event.data.content[AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")];if(currentContent)switch(currentContent.type){case"image_file":this._emit("imageFileDone",currentContent.image_file,AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break;case"text":this._emit("textDone",currentContent.text,AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"))}}AssistantStream_classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f")&&this._emit("messageDone",event.data),AssistantStream_classPrivateFieldSet(this,_AssistantStream_messageSnapshot,void 0,"f")}},_AssistantStream_handleRunStep=function _AssistantStream_handleRunStep(event){const accumulatedRunStep=AssistantStream_classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateRunStep).call(this,event);switch(AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentRunStepSnapshot,accumulatedRunStep,"f"),event.event){case"thread.run.step.created":this._emit("runStepCreated",event.data);break;case"thread.run.step.delta":const delta=event.data.delta;if(delta.step_details&&"tool_calls"==delta.step_details.type&&delta.step_details.tool_calls&&"tool_calls"==accumulatedRunStep.step_details.type)for(const toolCall of delta.step_details.tool_calls)toolCall.index==AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCallIndex,"f")?this._emit("toolCallDelta",toolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index]):(AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&this._emit("toolCallDone",AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")),AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentToolCallIndex,toolCall.index,"f"),AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentToolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index],"f"),AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&this._emit("toolCallCreated",AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")));this._emit("runStepDelta",event.data.delta,accumulatedRunStep);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentRunStepSnapshot,void 0,"f");"tool_calls"==event.data.step_details.type&&AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&(this._emit("toolCallDone",AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")),AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentToolCall,void 0,"f")),this._emit("runStepDone",event.data,accumulatedRunStep)}},_AssistantStream_handleEvent=function _AssistantStream_handleEvent(event){AssistantStream_classPrivateFieldGet(this,_AssistantStream_events,"f").push(event),this._emit("event",event)},_AssistantStream_accumulateRunStep=function _AssistantStream_accumulateRunStep(event){switch(event.event){case"thread.run.step.created":return AssistantStream_classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=event.data,event.data;case"thread.run.step.delta":let snapshot=AssistantStream_classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];if(!snapshot)throw Error("Received a RunStepDelta before creation of a snapshot");let data=event.data;if(data.delta){const accumulated=AssistantStream.accumulateDelta(snapshot,data.delta);AssistantStream_classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=accumulated}return AssistantStream_classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":AssistantStream_classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=event.data}if(AssistantStream_classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id])return AssistantStream_classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];throw new Error("No snapshot available")},_AssistantStream_accumulateMessage=function _AssistantStream_accumulateMessage(event,snapshot){let newContent=[];switch(event.event){case"thread.message.created":return[event.data,newContent];case"thread.message.delta":if(!snapshot)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let data=event.data;if(data.delta.content)for(const contentElement of data.delta.content)if(contentElement.index in snapshot.content){let currentContent=snapshot.content[contentElement.index];snapshot.content[contentElement.index]=AssistantStream_classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateContent).call(this,contentElement,currentContent)}else snapshot.content[contentElement.index]=contentElement,newContent.push(contentElement);return[snapshot,newContent];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(snapshot)return[snapshot,newContent];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},_AssistantStream_accumulateContent=function _AssistantStream_accumulateContent(contentElement,currentContent){return AssistantStream.accumulateDelta(currentContent,contentElement)},_AssistantStream_handleRun=function _AssistantStream_handleRun(event){switch(AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentRunSnapshot,event.data,"f"),event.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":AssistantStream_classPrivateFieldSet(this,_AssistantStream_finalRun,event.data,"f"),AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")&&(this._emit("toolCallDone",AssistantStream_classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")),AssistantStream_classPrivateFieldSet(this,_AssistantStream_currentToolCall,void 0,"f"))}};class Messages extends APIResource{create(threadId,body,options){return this._client.post(`/threads/${threadId}/messages`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(threadId,messageId,options){return this._client.get(`/threads/${threadId}/messages/${messageId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,messageId,body,options){return this._client.post(`/threads/${threadId}/messages/${messageId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,query={},options){return isRequestOptions(query)?this.list(threadId,{},query):this._client.getAPIList(`/threads/${threadId}/messages`,MessagesPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(threadId,messageId,options){return this._client.delete(`/threads/${threadId}/messages/${messageId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}class MessagesPage extends CursorPage{}!function(Messages){Messages.MessagesPage=MessagesPage}(Messages||(Messages={}));class Steps extends APIResource{retrieve(threadId,runId,stepId,options){return this._client.get(`/threads/${threadId}/runs/${runId}/steps/${stepId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,runId,query={},options){return isRequestOptions(query)?this.list(threadId,runId,{},query):this._client.getAPIList(`/threads/${threadId}/runs/${runId}/steps`,RunStepsPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}class RunStepsPage extends CursorPage{}!function(Steps){Steps.RunStepsPage=RunStepsPage}(Steps||(Steps={}));class Runs extends APIResource{constructor(){super(...arguments),this.steps=new Steps(this._client)}create(threadId,body,options){return this._client.post(`/threads/${threadId}/runs`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:body.stream??!1})}retrieve(threadId,runId,options){return this._client.get(`/threads/${threadId}/runs/${runId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/${runId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,query={},options){return isRequestOptions(query)?this.list(threadId,{},query):this._client.getAPIList(`/threads/${threadId}/runs`,RunsPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}cancel(threadId,runId,options){return this._client.post(`/threads/${threadId}/runs/${runId}/cancel`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}createAndPoll(threadId,body,options){var _this=this;return(0,asyncToGenerator.Z)((function*(){const run=yield _this.create(threadId,body,options);return yield _this.poll(threadId,run.id,options)}))()}createAndStream(threadId,body,options){return AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}poll(threadId,runId,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};for(options?.pollIntervalMs&&(headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString());;){const{data:run,response}=yield _this2.retrieve(threadId,runId,{...options,headers:{...options?.headers,...headers}}).withResponse();switch(run.status){case"queued":case"in_progress":case"cancelling":let sleepInterval=5e3;if(options?.pollIntervalMs)sleepInterval=options.pollIntervalMs;else{const headerInterval=response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);isNaN(headerIntervalMs)||(sleepInterval=headerIntervalMs)}}yield sleep(sleepInterval);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return run}}}))()}stream(threadId,body,options){return AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}submitToolOutputs(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/${runId}/submit_tool_outputs`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:body.stream??!1})}submitToolOutputsAndPoll(threadId,runId,body,options){var _this3=this;return(0,asyncToGenerator.Z)((function*(){const run=yield _this3.submitToolOutputs(threadId,runId,body,options);return yield _this3.poll(threadId,run.id,options)}))()}submitToolOutputsStream(threadId,runId,body,options){return AssistantStream.createToolAssistantStream(threadId,runId,this._client.beta.threads.runs,body,options)}}class RunsPage extends CursorPage{}!function(Runs){Runs.RunsPage=RunsPage,Runs.Steps=Steps,Runs.RunStepsPage=RunStepsPage}(Runs||(Runs={}));class Threads extends APIResource{constructor(){super(...arguments),this.runs=new Runs(this._client),this.messages=new Messages(this._client)}create(body={},options){return isRequestOptions(body)?this.create({},body):this._client.post("/threads",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(threadId,options){return this._client.get(`/threads/${threadId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,body,options){return this._client.post(`/threads/${threadId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(threadId,options){return this._client.delete(`/threads/${threadId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}createAndRun(body,options){return this._client.post("/threads/runs",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:body.stream??!1})}createAndRunPoll(body,options){var _this=this;return(0,asyncToGenerator.Z)((function*(){const run=yield _this.createAndRun(body,options);return yield _this.runs.poll(run.thread_id,run.id,options)}))()}createAndRunStream(body,options){return AssistantStream.createThreadAssistantStream(body,this._client.beta.threads,options)}}!function(Threads){Threads.Runs=Runs,Threads.RunsPage=RunsPage,Threads.Messages=Messages,Threads.MessagesPage=MessagesPage}(Threads||(Threads={}));const allSettledWithThrow=function(){var _ref=(0,asyncToGenerator.Z)((function*(promises){const results=yield Promise.allSettled(promises),rejected=results.filter((result=>"rejected"===result.status));if(rejected.length){for(const result of rejected)console.error(result.reason);throw new Error(`${rejected.length} promise(s) failed - see the above errors`)}const values=[];for(const result of results)"fulfilled"===result.status&&values.push(result.value);return values}));return function allSettledWithThrow(_x){return _ref.apply(this,arguments)}}();class files_Files extends APIResource{create(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/files`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,fileId,options){return this._client.get(`/vector_stores/${vectorStoreId}/files/${fileId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(vectorStoreId,query={},options){return isRequestOptions(query)?this.list(vectorStoreId,{},query):this._client.getAPIList(`/vector_stores/${vectorStoreId}/files`,VectorStoreFilesPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(vectorStoreId,fileId,options){return this._client.delete(`/vector_stores/${vectorStoreId}/files/${fileId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}createAndPoll(vectorStoreId,body,options){var _this=this;return(0,asyncToGenerator.Z)((function*(){const file=yield _this.create(vectorStoreId,body,options);return yield _this.poll(vectorStoreId,file.id,options)}))()}poll(vectorStoreId,fileId,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};for(options?.pollIntervalMs&&(headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString());;){const fileResponse=yield _this2.retrieve(vectorStoreId,fileId,{...options,headers}).withResponse(),file=fileResponse.data;switch(file.status){case"in_progress":let sleepInterval=5e3;if(options?.pollIntervalMs)sleepInterval=options.pollIntervalMs;else{const headerInterval=fileResponse.response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);isNaN(headerIntervalMs)||(sleepInterval=headerIntervalMs)}}yield sleep(sleepInterval);break;case"failed":case"completed":return file}}}))()}upload(vectorStoreId,file,options){var _this3=this;return(0,asyncToGenerator.Z)((function*(){const fileInfo=yield _this3._client.files.create({file,purpose:"assistants"},options);return _this3.create(vectorStoreId,{file_id:fileInfo.id},options)}))()}uploadAndPoll(vectorStoreId,file,options){var _this4=this;return(0,asyncToGenerator.Z)((function*(){const fileInfo=yield _this4.upload(vectorStoreId,file,options);return yield _this4.poll(vectorStoreId,fileInfo.id,options)}))()}}class VectorStoreFilesPage extends CursorPage{}!function(Files){Files.VectorStoreFilesPage=VectorStoreFilesPage}(files_Files||(files_Files={}));class FileBatches extends APIResource{create(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,batchId,options){return this._client.get(`/vector_stores/${vectorStoreId}/file_batches/${batchId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}cancel(vectorStoreId,batchId,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/cancel`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}createAndPoll(vectorStoreId,body,options){var _this=this;return(0,asyncToGenerator.Z)((function*(){const batch=yield _this.create(vectorStoreId,body);return yield _this.poll(vectorStoreId,batch.id,options)}))()}listFiles(vectorStoreId,batchId,query={},options){return isRequestOptions(query)?this.listFiles(vectorStoreId,batchId,{},query):this._client.getAPIList(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/files`,VectorStoreFilesPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}poll(vectorStoreId,batchId,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};for(options?.pollIntervalMs&&(headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString());;){const{data:batch,response}=yield _this2.retrieve(vectorStoreId,batchId,{...options,headers}).withResponse();switch(batch.status){case"in_progress":let sleepInterval=5e3;if(options?.pollIntervalMs)sleepInterval=options.pollIntervalMs;else{const headerInterval=response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);isNaN(headerIntervalMs)||(sleepInterval=headerIntervalMs)}}yield sleep(sleepInterval);break;case"failed":case"cancelled":case"completed":return batch}}}))()}uploadAndPoll(vectorStoreId,{files,fileIds=[]},options){var _this3=this;return(0,asyncToGenerator.Z)((function*(){if(null===files||0==files.length)throw new Error("No files provided to process.");const configuredConcurrency=options?.maxConcurrency??5,concurrencyLimit=Math.min(configuredConcurrency,files.length),client=_this3._client,fileIterator=files.values(),allFileIds=[...fileIds];function _processFiles(){return(_processFiles=(0,asyncToGenerator.Z)((function*(iterator){for(let item of iterator){const fileObj=yield client.files.create({file:item,purpose:"assistants"},options);allFileIds.push(fileObj.id)}}))).apply(this,arguments)}const workers=Array(concurrencyLimit).fill(fileIterator).map((function processFiles(_x){return _processFiles.apply(this,arguments)}));return yield allSettledWithThrow(workers),yield _this3.createAndPoll(vectorStoreId,{file_ids:allFileIds})}))()}}FileBatches||(FileBatches={});class VectorStores extends APIResource{constructor(){super(...arguments),this.files=new files_Files(this._client),this.fileBatches=new FileBatches(this._client)}create(body,options){return this._client.post("/vector_stores",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,options){return this._client.get(`/vector_stores/${vectorStoreId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(query={},options){return isRequestOptions(query)?this.list({},query):this._client.getAPIList("/vector_stores",VectorStoresPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(vectorStoreId,options){return this._client.delete(`/vector_stores/${vectorStoreId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}class VectorStoresPage extends CursorPage{}!function(VectorStores){VectorStores.VectorStoresPage=VectorStoresPage,VectorStores.Files=files_Files,VectorStores.VectorStoreFilesPage=VectorStoreFilesPage,VectorStores.FileBatches=FileBatches}(VectorStores||(VectorStores={}));class Beta extends APIResource{constructor(){super(...arguments),this.vectorStores=new VectorStores(this._client),this.chat=new chat_Chat(this._client),this.assistants=new Assistants(this._client),this.threads=new Threads(this._client)}}!function(Beta){Beta.VectorStores=VectorStores,Beta.VectorStoresPage=VectorStoresPage,Beta.Chat=chat_Chat,Beta.Assistants=Assistants,Beta.AssistantsPage=AssistantsPage,Beta.Threads=Threads}(Beta||(Beta={}));class Batches extends APIResource{create(body,options){return this._client.post("/batches",{body,...options})}retrieve(batchId,options){return this._client.get(`/batches/${batchId}`,options)}list(query={},options){return isRequestOptions(query)?this.list({},query):this._client.getAPIList("/batches",BatchesPage,{query,...options})}cancel(batchId,options){return this._client.post(`/batches/${batchId}/cancel`,options)}}class BatchesPage extends CursorPage{}!function(Batches){Batches.BatchesPage=BatchesPage}(Batches||(Batches={}));var _a;__webpack_require__("./node_modules/process/browser.js");class openai_OpenAI extends APIClient{constructor({baseURL=readEnv("OPENAI_BASE_URL"),apiKey=readEnv("OPENAI_API_KEY"),organization=readEnv("OPENAI_ORG_ID")??null,project=readEnv("OPENAI_PROJECT_ID")??null,...opts}={}){if(void 0===apiKey)throw new error_OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const options={apiKey,organization,project,...opts,baseURL:baseURL||"https://api.openai.com/v1"};if(!options.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new error_OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:options.baseURL,timeout:options.timeout??6e5,httpAgent:options.httpAgent,maxRetries:options.maxRetries,fetch:options.fetch}),this.completions=new Completions(this),this.chat=new Chat(this),this.embeddings=new embeddings_Embeddings(this),this.files=new Files(this),this.images=new Images(this),this.audio=new Audio(this),this.moderations=new Moderations(this),this.models=new Models(this),this.fineTuning=new FineTuning(this),this.beta=new Beta(this),this.batches=new Batches(this),this._options=options,this.apiKey=apiKey,this.organization=organization,this.project=project}defaultQuery(){return this._options.defaultQuery}defaultHeaders(opts){return{...super.defaultHeaders(opts),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(opts){return{Authorization:`Bearer ${this.apiKey}`}}}_a=openai_OpenAI,openai_OpenAI.OpenAI=_a,openai_OpenAI.OpenAIError=error_OpenAIError,openai_OpenAI.APIError=APIError,openai_OpenAI.APIConnectionError=APIConnectionError,openai_OpenAI.APIConnectionTimeoutError=APIConnectionTimeoutError,openai_OpenAI.APIUserAbortError=APIUserAbortError,openai_OpenAI.NotFoundError=NotFoundError,openai_OpenAI.ConflictError=ConflictError,openai_OpenAI.RateLimitError=RateLimitError,openai_OpenAI.BadRequestError=BadRequestError,openai_OpenAI.AuthenticationError=AuthenticationError,openai_OpenAI.InternalServerError=InternalServerError,openai_OpenAI.PermissionDeniedError=PermissionDeniedError,openai_OpenAI.UnprocessableEntityError=UnprocessableEntityError,openai_OpenAI.toFile=toFile,openai_OpenAI.fileFromPath=fileFromPath;const{OpenAIError:openai_OpenAIError,APIError:openai_APIError,APIConnectionError:openai_APIConnectionError,APIConnectionTimeoutError:openai_APIConnectionTimeoutError,APIUserAbortError:openai_APIUserAbortError,NotFoundError:openai_NotFoundError,ConflictError:openai_ConflictError,RateLimitError:openai_RateLimitError,BadRequestError:openai_BadRequestError,AuthenticationError:openai_AuthenticationError,InternalServerError:openai_InternalServerError,PermissionDeniedError:openai_PermissionDeniedError,UnprocessableEntityError:openai_UnprocessableEntityError}=error_namespaceObject;!function(OpenAI){OpenAI.Page=Page,OpenAI.CursorPage=CursorPage,OpenAI.Completions=Completions,OpenAI.Chat=Chat,OpenAI.Embeddings=embeddings_Embeddings,OpenAI.Files=Files,OpenAI.FileObjectsPage=FileObjectsPage,OpenAI.Images=Images,OpenAI.Audio=Audio,OpenAI.Moderations=Moderations,OpenAI.Models=Models,OpenAI.ModelsPage=ModelsPage,OpenAI.FineTuning=FineTuning,OpenAI.Beta=Beta,OpenAI.Batches=Batches,OpenAI.BatchesPage=BatchesPage}(openai_OpenAI||(openai_OpenAI={}));new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]);var core_messages=__webpack_require__("./node_modules/@langchain/core/messages.js"),outputs=__webpack_require__("./node_modules/@langchain/core/dist/outputs.js"),env=__webpack_require__("./node_modules/@langchain/core/dist/utils/env.js"),dist_messages=__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js"),base=__webpack_require__("./node_modules/@langchain/core/dist/language_models/base.js"),manager=__webpack_require__("./node_modules/@langchain/core/dist/callbacks/manager.js"),event_stream=__webpack_require__("./node_modules/@langchain/core/dist/tracers/event_stream.js"),log_stream=__webpack_require__("./node_modules/@langchain/core/dist/tracers/log_stream.js"),utils_stream=__webpack_require__("./node_modules/@langchain/core/dist/utils/stream.js");class BaseChatModel extends base.qV{constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(options){const[runnableConfig,callOptions]=super._separateRunnableConfigFromCallOptions(options);return callOptions?.timeout&&!callOptions.signal&&(callOptions.signal=AbortSignal.timeout(callOptions.timeout)),[runnableConfig,callOptions]}invoke(input,options){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const promptValue=BaseChatModel._convertInputToPromptValue(input);return(yield _this2.generatePrompt([promptValue],options,options?.callbacks)).generations[0][0].message}))()}_streamResponseChunks(_messages,_options,_runManager){return(0,wrapAsyncGenerator.Z)((function*(){throw new Error("Not implemented.")}))()}_streamIterator(input,options){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){if(_this._streamResponseChunks===BaseChatModel.prototype._streamResponseChunks)yield _this.invoke(input,options);else{const messages=BaseChatModel._convertInputToPromptValue(input).toChatMessages(),[runnableConfig,callOptions]=_this._separateRunnableConfigFromCallOptions(options),inheritableMetadata={...runnableConfig.metadata,..._this.getLsParams(callOptions)},callbackManager_=yield(0,awaitAsyncGenerator.Z)(manager.Ye.configure(runnableConfig.callbacks,_this.callbacks,runnableConfig.tags,_this.tags,inheritableMetadata,_this.metadata,{verbose:_this.verbose})),extra={options:callOptions,invocation_params:_this?.invocationParams(callOptions),batch_size:1},runManagers=yield(0,awaitAsyncGenerator.Z)(callbackManager_?.handleChatModelStart(_this.toJSON(),[messages],runnableConfig.runId,void 0,extra,void 0,void 0,runnableConfig.runName));let generationChunk;try{var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(_this._streamResponseChunks(messages,callOptions,runManagers?.[0]));_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;chunk.message.response_metadata={...chunk.generationInfo,...chunk.message.response_metadata},yield chunk.message,generationChunk=generationChunk?generationChunk.concat(chunk):chunk}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}}catch(err){throw yield(0,awaitAsyncGenerator.Z)(Promise.all((runManagers??[]).map((runManager=>runManager?.handleLLMError(err))))),err}yield(0,awaitAsyncGenerator.Z)(Promise.all((runManagers??[]).map((runManager=>runManager?.handleLLMEnd({generations:[[generationChunk]]})))))}}))()}getLsParams(options){return{ls_model_type:"chat",ls_stop:options.stop}}_generateUncached(messages,parsedOptions,handledOptions){var _this3=this;return(0,asyncToGenerator.Z)((function*(){const baseMessages=messages.map((messageList=>messageList.map(dist_messages.E1))),inheritableMetadata={...handledOptions.metadata,..._this3.getLsParams(parsedOptions)},callbackManager_=yield manager.Ye.configure(handledOptions.callbacks,_this3.callbacks,handledOptions.tags,_this3.tags,inheritableMetadata,_this3.metadata,{verbose:_this3.verbose}),extra={options:parsedOptions,invocation_params:_this3?.invocationParams(parsedOptions),batch_size:1},runManagers=yield callbackManager_?.handleChatModelStart(_this3.toJSON(),baseMessages,handledOptions.runId,void 0,extra,void 0,void 0,handledOptions.runName),generations=[],llmOutputs=[];if(!!runManagers?.[0].handlers.find((handler=>(0,event_stream.C)(handler)||(0,log_stream.ky)(handler)))&&1===baseMessages.length&&_this3._streamResponseChunks!==BaseChatModel.prototype._streamResponseChunks)try{const stream=yield _this3._streamResponseChunks(baseMessages[0],parsedOptions,runManagers?.[0]);let aggregated;var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion2=!(_step2=yield _iterator2.next()).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;aggregated=void 0===aggregated?chunk:(0,utils_stream.zo)(aggregated,chunk)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield _iterator2.return())}finally{if(_didIteratorError2)throw _iteratorError2}}if(void 0===aggregated)throw new Error("Received empty response from chat model call.");generations.push([aggregated]),yield runManagers?.[0].handleLLMEnd({generations,llmOutput:{}})}catch(e){throw yield runManagers?.[0].handleLLMError(e),e}else{const results=yield Promise.allSettled(baseMessages.map(((messageList,i)=>_this3._generate(messageList,{...parsedOptions,promptIndex:i},runManagers?.[i]))));yield Promise.all(results.map(function(){var _ref=(0,asyncToGenerator.Z)((function*(pResult,i){if("fulfilled"===pResult.status){const result=pResult.value;for(const generation of result.generations)generation.message.response_metadata={...generation.generationInfo,...generation.message.response_metadata};return 1===result.generations.length&&(result.generations[0].message.response_metadata={...result.llmOutput,...result.generations[0].message.response_metadata}),generations[i]=result.generations,llmOutputs[i]=result.llmOutput,runManagers?.[i]?.handleLLMEnd({generations:[result.generations],llmOutput:result.llmOutput})}return yield runManagers?.[i]?.handleLLMError(pResult.reason),Promise.reject(pResult.reason)}));return function(_x,_x2){return _ref.apply(this,arguments)}}()))}const output={generations,llmOutput:llmOutputs.length?_this3._combineLLMOutput?.(...llmOutputs):void 0};return Object.defineProperty(output,outputs.WH,{value:runManagers?{runIds:runManagers?.map((manager=>manager.runId))}:void 0,configurable:!0}),output}))()}_generateCached({messages,cache,llmStringKey,parsedOptions,handledOptions}){var _this4=this;return(0,asyncToGenerator.Z)((function*(){const baseMessages=messages.map((messageList=>messageList.map(dist_messages.E1))),inheritableMetadata={...handledOptions.metadata,..._this4.getLsParams(parsedOptions)},callbackManager_=yield manager.Ye.configure(handledOptions.callbacks,_this4.callbacks,handledOptions.tags,_this4.tags,inheritableMetadata,_this4.metadata,{verbose:_this4.verbose}),extra={options:parsedOptions,invocation_params:_this4?.invocationParams(parsedOptions),batch_size:1,cached:!0},runManagers=yield callbackManager_?.handleChatModelStart(_this4.toJSON(),baseMessages,handledOptions.runId,void 0,extra,void 0,void 0,handledOptions.runName),missingPromptIndices=[],results=yield Promise.allSettled(baseMessages.map(function(){var _ref2=(0,asyncToGenerator.Z)((function*(baseMessage,index){const prompt=BaseChatModel._convertInputToPromptValue(baseMessage).toString(),result=yield cache.lookup(prompt,llmStringKey);return null==result&&missingPromptIndices.push(index),result}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}())),cachedResults=results.map(((result,index)=>({result,runManager:runManagers?.[index]}))).filter((({result})=>"fulfilled"===result.status&&null!=result.value||"rejected"===result.status)),generations=[];yield Promise.all(cachedResults.map(function(){var _ref3=(0,asyncToGenerator.Z)((function*({result:promiseResult,runManager},i){if("fulfilled"===promiseResult.status){const result=promiseResult.value;return generations[i]=result,result.length&&(yield runManager?.handleLLMNewToken(result[0].text)),runManager?.handleLLMEnd({generations:[result]})}return yield runManager?.handleLLMError(promiseResult.reason),Promise.reject(promiseResult.reason)}));return function(_x5,_x6){return _ref3.apply(this,arguments)}}()));const output={generations,missingPromptIndices};return Object.defineProperty(output,outputs.WH,{value:runManagers?{runIds:runManagers?.map((manager=>manager.runId))}:void 0,configurable:!0}),output}))()}generate(messages,options,callbacks){var _this5=this;return(0,asyncToGenerator.Z)((function*(){let parsedOptions;parsedOptions=Array.isArray(options)?{stop:options}:options;const baseMessages=messages.map((messageList=>messageList.map(dist_messages.E1))),[runnableConfig,callOptions]=_this5._separateRunnableConfigFromCallOptions(parsedOptions);if(runnableConfig.callbacks=runnableConfig.callbacks??callbacks,!_this5.cache)return _this5._generateUncached(baseMessages,callOptions,runnableConfig);const{cache}=_this5,llmStringKey=_this5._getSerializedCacheKeyParametersForCall(callOptions),{generations,missingPromptIndices}=yield _this5._generateCached({messages:baseMessages,cache,llmStringKey,parsedOptions:callOptions,handledOptions:runnableConfig});let llmOutput={};if(missingPromptIndices.length>0){const results=yield _this5._generateUncached(missingPromptIndices.map((i=>baseMessages[i])),callOptions,runnableConfig);yield Promise.all(results.generations.map(function(){var _ref4=(0,asyncToGenerator.Z)((function*(generation,index){const promptIndex=missingPromptIndices[index];generations[promptIndex]=generation;const prompt=BaseChatModel._convertInputToPromptValue(baseMessages[promptIndex]).toString();return cache.update(prompt,llmStringKey,generation)}));return function(_x7,_x8){return _ref4.apply(this,arguments)}}())),llmOutput=results.llmOutput??{}}return{generations,llmOutput}}))()}invocationParams(_options){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}generatePrompt(promptValues,options,callbacks){var _this6=this;return(0,asyncToGenerator.Z)((function*(){const promptMessages=promptValues.map((promptValue=>promptValue.toChatMessages()));return _this6.generate(promptMessages,options,callbacks)}))()}call(messages,options,callbacks){var _this7=this;return(0,asyncToGenerator.Z)((function*(){return(yield _this7.generate([messages.map(dist_messages.E1)],options,callbacks)).generations[0][0].message}))()}callPrompt(promptValue,options,callbacks){var _this8=this;return(0,asyncToGenerator.Z)((function*(){const promptMessages=promptValue.toChatMessages();return _this8.call(promptMessages,options,callbacks)}))()}predictMessages(messages,options,callbacks){var _this9=this;return(0,asyncToGenerator.Z)((function*(){return _this9.call(messages,options,callbacks)}))()}predict(text,options,callbacks){var _this10=this;return(0,asyncToGenerator.Z)((function*(){const message=new dist_messages.xk(text),result=yield _this10.call([message],options,callbacks);if("string"!=typeof result.content)throw new Error("Cannot use predict when output is not a string.");return result.content}))()}}var function_calling=__webpack_require__("./node_modules/@langchain/core/utils/function_calling.js"),runnables=__webpack_require__("./node_modules/@langchain/core/runnables.js"),output_parsers=__webpack_require__("./node_modules/@langchain/core/output_parsers.js"),output_parsers_base=__webpack_require__("./node_modules/@langchain/core/dist/output_parsers/base.js"),json=__webpack_require__("./node_modules/@langchain/core/dist/output_parsers/json.js");function parseToolCall(rawToolCall,options){if(void 0===rawToolCall.function)return;let functionArgs;if(options?.partial)try{functionArgs=(0,json.gP)(rawToolCall.function.arguments??"{}")}catch(e){return}else try{functionArgs=JSON.parse(rawToolCall.function.arguments)}catch(e){throw new output_parsers_base.dS([`Function "${rawToolCall.function.name}" arguments:`,"",rawToolCall.function.arguments,"","are not valid JSON.",`Error: ${e.message}`].join("\n"))}const parsedToolCall={name:rawToolCall.function.name,args:functionArgs};return options?.returnId&&(parsedToolCall.id=rawToolCall.id),parsedToolCall}function convertLangChainToolCallToOpenAI(toolCall){if(void 0===toolCall.id)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:toolCall.id,type:"function",function:{name:toolCall.name,arguments:JSON.stringify(toolCall.args)}}}function makeInvalidToolCall(rawToolCall,errorMsg){return{name:rawToolCall.function?.name,args:rawToolCall.function?.arguments,id:rawToolCall.id,error:errorMsg}}class JsonOutputToolsParser extends output_parsers_base.tw{static lc_name(){return"JsonOutputToolsParser"}constructor(fields){super(fields),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=fields?.returnId??this.returnId}parseResult(generations){return(0,asyncToGenerator.Z)((function*(){const toolCalls=generations[0].message.additional_kwargs.tool_calls;if(!toolCalls)throw new Error(`No tools_call in message ${JSON.stringify(generations)}`);const clonedToolCalls=JSON.parse(JSON.stringify(toolCalls)),parsedToolCalls=[];for(const toolCall of clonedToolCalls){const parsedToolCall=parseToolCall(toolCall,{partial:!0});if(void 0!==parsedToolCall){const backwardsCompatibleToolCall={type:parsedToolCall.name,args:parsedToolCall.args,id:parsedToolCall.id};Object.defineProperty(backwardsCompatibleToolCall,"name",{get(){return this.type}}),Object.defineProperty(backwardsCompatibleToolCall,"arguments",{get(){return this.args}}),parsedToolCalls.push(backwardsCompatibleToolCall)}}return parsedToolCalls}))()}}class JsonOutputKeyToolsParser extends output_parsers_base.tw{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(params){super(params),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=params.keyName,this.returnSingle=params.returnSingle??this.returnSingle,this.initialParser=new JsonOutputToolsParser(params),this.zodSchema=params.zodSchema}_validateResult(result){var _this=this;return(0,asyncToGenerator.Z)((function*(){if(void 0===_this.zodSchema)return result;const zodParsedResult=yield _this.zodSchema.safeParseAsync(result);if(zodParsedResult.success)return zodParsedResult.data;throw new output_parsers_base.dS(`Failed to parse. Text: "${JSON.stringify(result,null,2)}". Error: ${JSON.stringify(zodParsedResult.error.errors)}`,JSON.stringify(result,null,2))}))()}parseResult(generations){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const matchingResults=(yield _this2.initialParser.parseResult(generations)).filter((result=>result.type===_this2.keyName));let returnedValues=matchingResults;if(_this2.returnId||(returnedValues=matchingResults.map((result=>result.args))),_this2.returnSingle)return _this2._validateResult(returnedValues[0]);return yield Promise.all(returnedValues.map((value=>_this2._validateResult(value))))}))()}}var esm=__webpack_require__("./node_modules/zod-to-json-schema/dist/esm/index.js");function formatObjectProperties(obj,indent){const lines=[];for(const[name,param]of Object.entries(obj.properties??{}))param.description&&indent<2&&lines.push(`// ${param.description}`),obj.required?.includes(name)?lines.push(`${name}: ${formatType(param,indent)},`):lines.push(`${name}?: ${formatType(param,indent)},`);return lines.map((line=>" ".repeat(indent)+line)).join("\n")}function formatType(param,indent){if(function isAnyOfProp(prop){return void 0!==prop.anyOf&&Array.isArray(prop.anyOf)}(param))return param.anyOf.map((v=>formatType(v,indent))).join(" | ");switch(param.type){case"string":return param.enum?param.enum.map((v=>`"${v}"`)).join(" | "):"string";case"number":case"integer":return param.enum?param.enum.map((v=>`${v}`)).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",formatObjectProperties(param,indent+2),"}"].join("\n");case"array":return param.items?`${formatType(param.items,indent)}[]`:"any[]";default:return""}}function messageToOpenAIRole(message){const type=message._getType();switch(type){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!core_messages.J.isInstance(message))throw new Error("Invalid generic chat message");return function extractGenericMessageCustomRole(message){return"system"!==message.role&&"assistant"!==message.role&&"user"!==message.role&&"function"!==message.role&&"tool"!==message.role&&console.warn(`Unknown message role: ${message.role}`),message.role}(message);default:throw new Error(`Unknown message type: ${type}`)}}function openAIResponseToChatMessage(message){const rawToolCalls=message.tool_calls;if("assistant"===message.role){const toolCalls=[],invalidToolCalls=[];for(const rawToolCall of rawToolCalls??[])try{toolCalls.push(parseToolCall(rawToolCall,{returnId:!0}))}catch(e){invalidToolCalls.push(makeInvalidToolCall(rawToolCall,e.message))}return new core_messages.gY({content:message.content||"",tool_calls:toolCalls,invalid_tool_calls:invalidToolCalls,additional_kwargs:{function_call:message.function_call,tool_calls:rawToolCalls}})}return new core_messages.J(message.content||"",message.role??"unknown")}function _convertDeltaToMessageChunk(delta,defaultRole){const role=delta.role??defaultRole,content=delta.content??"";let additional_kwargs;if(additional_kwargs=delta.function_call?{function_call:delta.function_call}:delta.tool_calls?{tool_calls:delta.tool_calls}:{},"user"===role)return new core_messages.ro({content});if("assistant"===role){const toolCallChunks=[];if(Array.isArray(delta.tool_calls))for(const rawToolCall of delta.tool_calls)toolCallChunks.push({name:rawToolCall.function?.name,args:rawToolCall.function?.arguments,id:rawToolCall.id,index:rawToolCall.index});return new core_messages.GC({content,tool_call_chunks:toolCallChunks,additional_kwargs})}return"system"===role?new core_messages.xq({content}):"function"===role?new core_messages.Cr({content,additional_kwargs,name:delta.name}):"tool"===role?new core_messages.Xz({content,additional_kwargs,tool_call_id:delta.tool_call_id}):new core_messages.HD({content,role})}function convertMessagesToOpenAIParams(messages){return messages.map((message=>{const completionParam={role:messageToOpenAIRole(message),content:message.content};return null!=message.name&&(completionParam.name=message.name),null!=message.additional_kwargs.function_call&&(completionParam.function_call=message.additional_kwargs.function_call),(0,core_messages.Z0)(message)&&message.tool_calls?.length?completionParam.tool_calls=message.tool_calls.map(convertLangChainToolCallToOpenAI):(null!=message.additional_kwargs.tool_calls&&(completionParam.tool_calls=message.additional_kwargs.tool_calls),null!=message.tool_call_id&&(completionParam.tool_call_id=message.tool_call_id)),completionParam}))}class chat_models_ChatOpenAI extends BaseChatModel{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(fields,configuration){if(super(fields??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=fields?.apiKey??fields?.openAIApiKey??(0,env.lS)("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=fields?.azureOpenAIApiKey??(0,env.lS)("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=fields?.azureADTokenProvider??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=fields?.azureOpenAIApiInstanceName??(0,env.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=fields?.azureOpenAIApiDeploymentName??(0,env.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=fields?.azureOpenAIApiVersion??(0,env.lS)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=fields?.azureOpenAIBasePath??(0,env.lS)("AZURE_OPENAI_BASE_PATH"),this.organization=fields?.configuration?.organization??(0,env.lS)("OPENAI_ORGANIZATION"),this.modelName=fields?.model??fields?.modelName??this.model,this.model=this.modelName,this.modelKwargs=fields?.modelKwargs??{},this.timeout=fields?.timeout,this.temperature=fields?.temperature??this.temperature,this.topP=fields?.topP??this.topP,this.frequencyPenalty=fields?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=fields?.presencePenalty??this.presencePenalty,this.maxTokens=fields?.maxTokens,this.logprobs=fields?.logprobs,this.topLogprobs=fields?.topLogprobs,this.n=fields?.n??this.n,this.logitBias=fields?.logitBias,this.stop=fields?.stopSequences??fields?.stop,this.stopSequences=this?.stop,this.user=fields?.user,this.streaming=fields?.streaming??!1,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:configuration?.basePath??fields?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:configuration?.baseOptions?.headers??fields?.configuration?.baseOptions?.headers,defaultQuery:configuration?.baseOptions?.params??fields?.configuration?.baseOptions?.params,...configuration,...fields?.configuration}}getLsParams(options){const params=this.invocationParams(options);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:params.temperature??void 0,ls_max_tokens:params.max_tokens??void 0,ls_stop:options.stop}}bindTools(tools,kwargs){return this.bind({tools:tools.map(function_calling.VE),...kwargs})}invocationParams(options){const params={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:options?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:options?.functions,function_call:options?.function_call,tools:function isStructuredToolArray(tools){return void 0!==tools&&tools.every((tool=>Array.isArray(tool.lc_namespace)))}(options?.tools)?options?.tools.map(function_calling.VE):options?.tools,tool_choice:options?.tool_choice,response_format:options?.response_format,seed:options?.seed,...this.modelKwargs};return params}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}_streamResponseChunks(messages,options,runManager){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){const messagesMapped=convertMessagesToOpenAIParams(messages),params={..._this.invocationParams(options),messages:messagesMapped,stream:!0};let defaultRole;const streamIterable=yield(0,awaitAsyncGenerator.Z)(_this.completionWithRetry(params,options));var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(streamIterable);_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const data=_step.value;{const choice=data?.choices[0];if(!choice)continue;const{delta}=choice;if(!delta)continue;const chunk=_convertDeltaToMessageChunk(delta,defaultRole);defaultRole=delta.role??defaultRole;const newTokenIndices={prompt:options.promptIndex??0,completion:choice.index??0};if("string"!=typeof chunk.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const generationInfo={...newTokenIndices};void 0!==choice.finish_reason&&(generationInfo.finish_reason=choice.finish_reason),_this.logprobs&&(generationInfo.logprobs=choice.logprobs);const generationChunk=new outputs.Ls({message:chunk,text:chunk.content,generationInfo});yield generationChunk,runManager?.handleLLMNewToken(generationChunk.text??"",newTokenIndices,void 0,void 0,void 0,{chunk:generationChunk})}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}if(options.signal?.aborted)throw new Error("AbortError")}))()}identifyingParams(){return this._identifyingParams()}_generate(messages,options,runManager){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const tokenUsage={},params=_this2.invocationParams(options),messagesMapped=convertMessagesToOpenAIParams(messages);if(params.stream){const stream=_this2._streamResponseChunks(messages,options,runManager),finalChunks={};var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion2=!(_step2=yield _iterator2.next()).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;{chunk.message.response_metadata={...chunk.generationInfo,...chunk.message.response_metadata};const index=chunk.generationInfo?.completion??0;void 0===finalChunks[index]?finalChunks[index]=chunk:finalChunks[index]=finalChunks[index].concat(chunk)}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield _iterator2.return())}finally{if(_didIteratorError2)throw _iteratorError2}}const generations=Object.entries(finalChunks).sort((([aKey],[bKey])=>parseInt(aKey,10)-parseInt(bKey,10))).map((([_,value])=>value)),{functions,function_call}=_this2.invocationParams(options),promptTokenUsage=yield _this2.getEstimatedTokenCountFromPrompt(messages,functions,function_call),completionTokenUsage=yield _this2.getNumTokensFromGenerations(generations);return tokenUsage.promptTokens=promptTokenUsage,tokenUsage.completionTokens=completionTokenUsage,tokenUsage.totalTokens=promptTokenUsage+completionTokenUsage,{generations,llmOutput:{estimatedTokenUsage:tokenUsage}}}{const data=yield _this2.completionWithRetry({...params,stream:!1,messages:messagesMapped},{signal:options?.signal,...options?.options}),{completion_tokens:completionTokens,prompt_tokens:promptTokens,total_tokens:totalTokens}=data?.usage??{};completionTokens&&(tokenUsage.completionTokens=(tokenUsage.completionTokens??0)+completionTokens),promptTokens&&(tokenUsage.promptTokens=(tokenUsage.promptTokens??0)+promptTokens),totalTokens&&(tokenUsage.totalTokens=(tokenUsage.totalTokens??0)+totalTokens);const generations=[];for(const part of data?.choices??[]){const generation={text:part.message?.content??"",message:openAIResponseToChatMessage(part.message??{role:"assistant"})};generation.generationInfo={...part.finish_reason?{finish_reason:part.finish_reason}:{},...part.logprobs?{logprobs:part.logprobs}:{}},generations.push(generation)}return{generations,llmOutput:{tokenUsage}}}}))()}getEstimatedTokenCountFromPrompt(messages,functions,function_call){var _this3=this;return(0,asyncToGenerator.Z)((function*(){let tokens=(yield _this3.getNumTokensFromMessages(messages)).totalCount;if(functions&&"auto"!==function_call){const promptDefinitions=function formatFunctionDefinitions(functions){const lines=["namespace functions {",""];for(const f of functions)f.description&&lines.push(`// ${f.description}`),Object.keys(f.parameters.properties??{}).length>0?(lines.push(`type ${f.name} = (_: {`),lines.push(formatObjectProperties(f.parameters,0)),lines.push("}) => any;")):lines.push(`type ${f.name} = () => any;`),lines.push("");return lines.push("} // namespace functions"),lines.join("\n")}(functions);tokens+=(yield _this3.getNumTokens(promptDefinitions)),tokens+=9}return functions&&messages.find((m=>"system"===m._getType()))&&(tokens-=4),"none"===function_call?tokens+=1:"object"==typeof function_call&&(tokens+=(yield _this3.getNumTokens(function_call.name))+4),tokens}))()}getNumTokensFromGenerations(generations){var _this4=this;return(0,asyncToGenerator.Z)((function*(){const generationUsages=yield Promise.all(generations.map(function(){var _ref=(0,asyncToGenerator.Z)((function*(generation){return generation.message.additional_kwargs?.function_call?(yield _this4.getNumTokensFromMessages([generation.message])).countPerMessage[0]:yield _this4.getNumTokens(generation.message.content)}));return function(_x){return _ref.apply(this,arguments)}}()));return generationUsages.reduce(((a,b)=>a+b),0)}))()}getNumTokensFromMessages(messages){var _this5=this;return(0,asyncToGenerator.Z)((function*(){let totalCount=0,tokensPerMessage=0,tokensPerName=0;"gpt-3.5-turbo-0301"===_this5.model?(tokensPerMessage=4,tokensPerName=-1):(tokensPerMessage=3,tokensPerName=1);const countPerMessage=yield Promise.all(messages.map(function(){var _ref2=(0,asyncToGenerator.Z)((function*(message){const textCount=yield _this5.getNumTokens(message.content),roleCount=yield _this5.getNumTokens(messageToOpenAIRole(message)),nameCount=void 0!==message.name?tokensPerName+(yield _this5.getNumTokens(message.name)):0;let count=textCount+tokensPerMessage+roleCount+nameCount;const openAIMessage=message;if("function"===openAIMessage._getType()&&(count-=2),openAIMessage.additional_kwargs?.function_call&&(count+=3),openAIMessage?.additional_kwargs.function_call?.name&&(count+=(yield _this5.getNumTokens(openAIMessage.additional_kwargs.function_call?.name))),openAIMessage.additional_kwargs.function_call?.arguments)try{count+=(yield _this5.getNumTokens(JSON.stringify(JSON.parse(openAIMessage.additional_kwargs.function_call?.arguments))))}catch(error){console.error("Error parsing function arguments",error,JSON.stringify(openAIMessage.additional_kwargs.function_call)),count+=(yield _this5.getNumTokens(openAIMessage.additional_kwargs.function_call?.arguments))}return totalCount+=count,count}));return function(_x2){return _ref2.apply(this,arguments)}}()));return totalCount+=3,{totalCount,countPerMessage}}))()}completionWithRetry(request,options){var _this6=this;return(0,asyncToGenerator.Z)((function*(){const requestOptions=_this6._getClientOptions(options);return _this6.caller.call((0,asyncToGenerator.Z)((function*(){try{return yield _this6.client.chat.completions.create(request,requestOptions)}catch(e){const error=function openai_wrapOpenAIClientError(e){let error;return e.constructor.name===openai_APIConnectionTimeoutError.name?(error=new Error(e.message),error.name="TimeoutError"):e.constructor.name===openai_APIUserAbortError.name?(error=new Error(e.message),error.name="AbortError"):error=e,error}(e);throw error}})))}))()}_getClientOptions(options){if(!this.client){const endpoint=function azure_getEndpoint(config){const{azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName,azureOpenAIApiKey,azureOpenAIBasePath,baseURL,azureADTokenProvider}=config;if(azureOpenAIApiKey&&azureOpenAIBasePath&&azureOpenAIApiDeploymentName)return`${azureOpenAIBasePath}/${azureOpenAIApiDeploymentName}`;if(azureOpenAIApiKey||azureADTokenProvider){if(!azureOpenAIApiInstanceName)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!azureOpenAIApiDeploymentName)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${azureOpenAIApiInstanceName}.openai.azure.com/openai/deployments/${azureOpenAIApiDeploymentName}`}return baseURL}({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL}),params={...this.clientConfig,baseURL:endpoint,timeout:this.timeout,maxRetries:0};params.baseURL||delete params.baseURL,this.client=new openai_OpenAI(params)}const requestOptions={...this.clientConfig,...options};return this.azureOpenAIApiKey&&(requestOptions.headers={"api-key":this.azureOpenAIApiKey,...requestOptions.headers},requestOptions.query={"api-version":this.azureOpenAIApiVersion,...requestOptions.query}),requestOptions}_llmType(){return"openai"}_combineLLMOutput(...llmOutputs){return llmOutputs.reduce(((acc,llmOutput)=>(llmOutput&&llmOutput.tokenUsage&&(acc.tokenUsage.completionTokens+=llmOutput.tokenUsage.completionTokens??0,acc.tokenUsage.promptTokens+=llmOutput.tokenUsage.promptTokens??0,acc.tokenUsage.totalTokens+=llmOutput.tokenUsage.totalTokens??0),acc)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(outputSchema,config){let schema,name,method,includeRaw,llm,outputParser;if(!function isStructuredOutputMethodParams(x){return void 0!==x&&"object"==typeof x.schema}(outputSchema)?(schema=outputSchema,name=config?.name,method=config?.method,includeRaw=config?.includeRaw):(schema=outputSchema.schema,name=outputSchema.name,method=outputSchema.method,includeRaw=outputSchema.includeRaw),"jsonMode"===method)llm=this.bind({response_format:{type:"json_object"}}),outputParser=isZodSchema(schema)?output_parsers.K.fromZodSchema(schema):new output_parsers.Qh;else{let functionName=name??"extract";if(isZodSchema(schema)){const asJsonSchema=(0,esm.Y_)(schema);llm=this.bind({tools:[{type:"function",function:{name:functionName,description:asJsonSchema.description,parameters:asJsonSchema}}],tool_choice:{type:"function",function:{name:functionName}}}),outputParser=new JsonOutputKeyToolsParser({returnSingle:!0,keyName:functionName,zodSchema:schema})}else{let openAIFunctionDefinition;"string"==typeof schema.name&&"object"==typeof schema.parameters&&null!=schema.parameters?(openAIFunctionDefinition=schema,functionName=schema.name):(functionName=schema.title??functionName,openAIFunctionDefinition={name:functionName,description:schema.description??"",parameters:schema}),llm=this.bind({tools:[{type:"function",function:openAIFunctionDefinition}],tool_choice:{type:"function",function:{name:functionName}}}),outputParser=new JsonOutputKeyToolsParser({returnSingle:!0,keyName:functionName})}}if(!includeRaw)return llm.pipe(outputParser);const parserAssign=runnables.sk.assign({parsed:(input,config)=>outputParser.invoke(input.raw,config)}),parserNone=runnables.sk.assign({parsed:()=>null}),parsedWithFallback=parserAssign.withFallbacks({fallbacks:[parserNone]});return runnables.lW.from([{raw:llm},parsedWithFallback])}}function isZodSchema(input){return"function"==typeof input?.parse}__webpack_require__("./node_modules/@langchain/core/language_models/base.js");__webpack_require__("./node_modules/@langchain/core/dist/utils/async_caller.js");var tools=__webpack_require__("./node_modules/@langchain/core/tools.js");class DallEAPIWrapper extends tools.UA{static lc_name(){return"DallEAPIWrapper"}constructor(fields){super(fields),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const clientConfig={apiKey:fields?.apiKey??fields?.openAIApiKey??(0,env.lS)("OPENAI_API_KEY"),organization:fields?.organization??(0,env.lS)("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0};this.client=new openai_OpenAI(clientConfig),this.model=fields?.model??fields?.modelName??this.model,this.style=fields?.style??this.style,this.quality=fields?.quality??this.quality,this.n=fields?.n??this.n,this.size=fields?.size??this.size,this.responseFormat=fields?.responseFormat??this.responseFormat,this.user=fields?.user}_call(input){var _this=this;return(0,asyncToGenerator.Z)((function*(){const response=yield _this.client.images.generate({model:_this.model,prompt:input,n:_this.n,size:_this.size,response_format:_this.responseFormat,style:_this.style,quality:_this.quality,user:_this.user});let data="";return"url"===_this.responseFormat?[data]=response.data.map((item=>item.url)).filter((url=>"undefined"!==url)):[data]=response.data.map((item=>item.b64_json)).filter((b64_json=>"undefined"!==b64_json)),data}))()}}Object.defineProperty(DallEAPIWrapper,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"})},"./node_modules/@microsoft/fetch-event-source/lib/esm/fetch.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>EventStreamContentType,L:()=>fetchEventSource});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");function _getBytes(){return(_getBytes=(0,asyncToGenerator.Z)((function*(stream,onChunk){const reader=stream.getReader();let result;for(;!(result=yield reader.read()).done;)onChunk(result.value)}))).apply(this,arguments)}function getLines(onLine){let buffer,position,fieldLength,discardTrailingNewline=!1;return function onChunk(arr){void 0===buffer?(buffer=arr,position=0,fieldLength=-1):buffer=function concat(a,b){const res=new Uint8Array(a.length+b.length);return res.set(a),res.set(b,a.length),res}(buffer,arr);const bufLength=buffer.length;let lineStart=0;for(;position<bufLength;){discardTrailingNewline&&(10===buffer[position]&&(lineStart=++position),discardTrailingNewline=!1);let lineEnd=-1;for(;position<bufLength&&-1===lineEnd;++position)switch(buffer[position]){case 58:-1===fieldLength&&(fieldLength=position-lineStart);break;case 13:discardTrailingNewline=!0;case 10:lineEnd=position}if(-1===lineEnd)break;onLine(buffer.subarray(lineStart,lineEnd),fieldLength),lineStart=position,fieldLength=-1}lineStart===bufLength?buffer=void 0:0!==lineStart&&(buffer=buffer.subarray(lineStart),position-=lineStart)}}var __rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const EventStreamContentType="text/event-stream",DefaultRetryInterval=1e3,LastEventId="last-event-id";function fetchEventSource(input,_a){var{signal:inputSignal,headers:inputHeaders,onopen:inputOnOpen,onmessage,onclose,onerror,openWhenHidden,fetch:inputFetch}=_a,rest=__rest(_a,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(((resolve,reject)=>{const headers=Object.assign({},inputHeaders);let curRequestController;function onVisibilityChange(){curRequestController.abort(),document.hidden||create()}headers.accept||(headers.accept=EventStreamContentType),openWhenHidden||document.addEventListener("visibilitychange",onVisibilityChange);let retryInterval=DefaultRetryInterval,retryTimer=0;function dispose(){document.removeEventListener("visibilitychange",onVisibilityChange),window.clearTimeout(retryTimer),curRequestController.abort()}null==inputSignal||inputSignal.addEventListener("abort",(()=>{dispose(),resolve()}));const fetch=null!=inputFetch?inputFetch:window.fetch,onopen=null!=inputOnOpen?inputOnOpen:defaultOnOpen;function create(){return _create.apply(this,arguments)}function _create(){return _create=(0,asyncToGenerator.Z)((function*(){var _a;curRequestController=new AbortController;try{const response=yield fetch(input,Object.assign(Object.assign({},rest),{headers,signal:curRequestController.signal}));yield onopen(response),yield function getBytes(_x,_x2){return _getBytes.apply(this,arguments)}(response.body,getLines(function getMessages(onId,onRetry,onMessage){let message={data:"",event:"",id:"",retry:void 0};const decoder=new TextDecoder;return function onLine(line,fieldLength){if(0===line.length)null==onMessage||onMessage(message),message={data:"",event:"",id:"",retry:void 0};else if(fieldLength>0){const field=decoder.decode(line.subarray(0,fieldLength)),valueOffset=fieldLength+(32===line[fieldLength+1]?2:1),value=decoder.decode(line.subarray(valueOffset));switch(field){case"data":message.data=message.data?message.data+"\n"+value:value;break;case"event":message.event=value;break;case"id":onId(message.id=value);break;case"retry":const retry=parseInt(value,10);isNaN(retry)||onRetry(message.retry=retry)}}}}((id=>{id?headers[LastEventId]=id:delete headers[LastEventId]}),(retry=>{retryInterval=retry}),onmessage))),null==onclose||onclose(),dispose(),resolve()}catch(err){if(!curRequestController.signal.aborted)try{const interval=null!==(_a=null==onerror?void 0:onerror(err))&&void 0!==_a?_a:retryInterval;window.clearTimeout(retryTimer),retryTimer=window.setTimeout(create,interval)}catch(innerErr){dispose(),reject(innerErr)}}})),_create.apply(this,arguments)}create()}))}function defaultOnOpen(response){const contentType=response.headers.get("content-type");if(!(null==contentType?void 0:contentType.startsWith(EventStreamContentType)))throw new Error(`Expected content-type to be ${EventStreamContentType}, Actual: ${contentType}`)}},"./node_modules/ai/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{t2:()=>AIStream,uY:()=>COMPLEX_HEADER,HP:()=>OpenAIStream,T_:()=>createCallbacksTransformer,NX:()=>createChunkDecoder,h6:()=>createStreamDataTransformer,x0:()=>dist_nanoid,uU:()=>readableFromAsyncIterable,qq:()=>trimStartOfStreamHelper});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),awaitAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),wrapAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),asyncIterator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js");const BOM=[239,187,191];var textStreamPart={code:"0",name:"text",parse:value=>{if("string"!=typeof value)throw new Error('"text" parts expect a string value.');return{type:"text",value}}},functionCallStreamPart={code:"1",name:"function_call",parse:value=>{if(null==value||"object"!=typeof value||!("function_call"in value)||"object"!=typeof value.function_call||null==value.function_call||!("name"in value.function_call)||!("arguments"in value.function_call)||"string"!=typeof value.function_call.name||"string"!=typeof value.function_call.arguments)throw new Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value}}},dataStreamPart={code:"2",name:"data",parse:value=>{if(!Array.isArray(value))throw new Error('"data" parts expect an array value.');return{type:"data",value}}},errorStreamPart={code:"3",name:"error",parse:value=>{if("string"!=typeof value)throw new Error('"error" parts expect a string value.');return{type:"error",value}}},assistantMessageStreamPart={code:"4",name:"assistant_message",parse:value=>{if(!(null!=value&&"object"==typeof value&&"id"in value&&"role"in value&&"content"in value&&"string"==typeof value.id&&"string"==typeof value.role&&"assistant"===value.role&&Array.isArray(value.content)&&value.content.every((item=>null!=item&&"object"==typeof item&&"type"in item&&"text"===item.type&&"text"in item&&null!=item.text&&"object"==typeof item.text&&"value"in item.text&&"string"==typeof item.text.value))))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value}}},assistantControlDataStreamPart={code:"5",name:"assistant_control_data",parse:value=>{if(null==value||"object"!=typeof value||!("threadId"in value)||!("messageId"in value)||"string"!=typeof value.threadId||"string"!=typeof value.messageId)throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:value.threadId,messageId:value.messageId}}}},dataMessageStreamPart={code:"6",name:"data_message",parse:value=>{if(null==value||"object"!=typeof value||!("role"in value)||!("data"in value)||"string"!=typeof value.role||"data"!==value.role)throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value}}},toolCallStreamPart={code:"7",name:"tool_calls",parse:value=>{if(null==value||"object"!=typeof value||!("tool_calls"in value)||"object"!=typeof value.tool_calls||null==value.tool_calls||!Array.isArray(value.tool_calls)||value.tool_calls.some((tc=>{null!=tc&&"object"==typeof tc&&"id"in tc&&"string"==typeof tc.id&&"type"in tc&&"string"==typeof tc.type&&"function"in tc&&null!=tc.function&&"object"==typeof tc.function&&"arguments"in tc.function&&"string"==typeof tc.function.name&&tc.function.arguments})))throw new Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value}}},messageAnnotationsStreamPart={code:"8",name:"message_annotations",parse:value=>{if(!Array.isArray(value))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value}}},streamParts=[textStreamPart,functionCallStreamPart,dataStreamPart,errorStreamPart,assistantMessageStreamPart,assistantControlDataStreamPart,dataMessageStreamPart,toolCallStreamPart,messageAnnotationsStreamPart],streamPartsByCode={[textStreamPart.code]:textStreamPart,[functionCallStreamPart.code]:functionCallStreamPart,[dataStreamPart.code]:dataStreamPart,[errorStreamPart.code]:errorStreamPart,[assistantMessageStreamPart.code]:assistantMessageStreamPart,[assistantControlDataStreamPart.code]:assistantControlDataStreamPart,[dataMessageStreamPart.code]:dataMessageStreamPart,[toolCallStreamPart.code]:toolCallStreamPart,[messageAnnotationsStreamPart.code]:messageAnnotationsStreamPart},validCodes=streamParts.map((part=>part.code)),parseStreamPart=line=>{const firstSeparatorIndex=line.indexOf(":");if(-1===firstSeparatorIndex)throw new Error("Failed to parse stream string. No separator found.");const prefix=line.slice(0,firstSeparatorIndex);if(!validCodes.includes(prefix))throw new Error(`Failed to parse stream string. Invalid code ${prefix}.`);const code=prefix,textValue=line.slice(firstSeparatorIndex+1),jsonValue=JSON.parse(textValue);return streamPartsByCode[code].parse(jsonValue)};function formatStreamPart(type,value){const streamPart=streamParts.find((part=>part.name===type));if(!streamPart)throw new Error(`Invalid stream part type: ${type}`);return`${streamPart.code}:${JSON.stringify(value)}\n`}var dist_nanoid=((alphabet,defaultSize=21)=>(size=defaultSize)=>{let id="",i=size;for(;i--;)id+=alphabet[Math.random()*alphabet.length|0];return id})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function createChunkDecoder(complex){const decoder=new TextDecoder;return complex?function(chunk){return decoder.decode(chunk,{stream:!0}).split("\n").filter((line=>""!==line)).map(parseStreamPart).filter(Boolean)}:function(chunk){return chunk?decoder.decode(chunk,{stream:!0}):""}}var COMPLEX_HEADER="X-Experimental-Stream-Data";function createEventStreamTransformer(customParser){const textDecoder=new TextDecoder;let eventSourceParser;return new TransformStream({start:controller=>(0,asyncToGenerator.Z)((function*(){eventSourceParser=function createParser(onParse){let isFirstChunk,buffer,startingPosition,startingFieldLength,eventId,eventName,data;return reset(),{feed:function feed(chunk){buffer=buffer?buffer+chunk:chunk,isFirstChunk&&function hasBom(buffer){return BOM.every(((charCode,index)=>buffer.charCodeAt(index)===charCode))}(buffer)&&(buffer=buffer.slice(BOM.length)),isFirstChunk=!1;const length=buffer.length;let position=0,discardTrailingNewline=!1;for(;position<length;){discardTrailingNewline&&("\n"===buffer[position]&&++position,discardTrailingNewline=!1);let character,lineLength=-1,fieldLength=startingFieldLength;for(let index=startingPosition;lineLength<0&&index<length;++index)character=buffer[index],":"===character&&fieldLength<0?fieldLength=index-position:"\r"===character?(discardTrailingNewline=!0,lineLength=index-position):"\n"===character&&(lineLength=index-position);if(lineLength<0){startingPosition=length-position,startingFieldLength=fieldLength;break}startingPosition=0,startingFieldLength=-1,parseEventStreamLine(buffer,position,fieldLength,lineLength),position+=lineLength+1}position===length?buffer="":position>0&&(buffer=buffer.slice(position))},reset};function reset(){isFirstChunk=!0,buffer="",startingPosition=0,startingFieldLength=-1,eventId=void 0,eventName=void 0,data=""}function parseEventStreamLine(lineBuffer,index,fieldLength,lineLength){if(0===lineLength)return data.length>0&&(onParse({type:"event",id:eventId,event:eventName||void 0,data:data.slice(0,-1)}),data="",eventId=void 0),void(eventName=void 0);const noValue=fieldLength<0,field=lineBuffer.slice(index,index+(noValue?lineLength:fieldLength));let step=0;step=noValue?lineLength:" "===lineBuffer[index+fieldLength+1]?fieldLength+2:fieldLength+1;const position=index+step,valueLength=lineLength-step,value=lineBuffer.slice(position,position+valueLength).toString();if("data"===field)data+=value?"".concat(value,"\n"):"\n";else if("event"===field)eventName=value;else if("id"!==field||value.includes("\0")){if("retry"===field){const retry=parseInt(value,10);Number.isNaN(retry)||onParse({type:"reconnect-interval",value:retry})}}else eventId=value}}((event=>{if("data"in event&&"event"===event.type&&"[DONE]"===event.data||"done"===event.event)controller.terminate();else if("data"in event){const parsedMessage=customParser?customParser(event.data,{event:event.event}):event.data;parsedMessage&&controller.enqueue(parsedMessage)}}))}))(),transform(chunk){eventSourceParser.feed(textDecoder.decode(chunk))}})}function createCallbacksTransformer(cb){const textEncoder=new TextEncoder;let aggregatedResponse="";const callbacks=cb||{};return new TransformStream({start:()=>(0,asyncToGenerator.Z)((function*(){callbacks.onStart&&(yield callbacks.onStart())}))(),transform:(message,controller)=>(0,asyncToGenerator.Z)((function*(){controller.enqueue(textEncoder.encode(message)),aggregatedResponse+=message,callbacks.onToken&&(yield callbacks.onToken(message))}))(),flush:()=>(0,asyncToGenerator.Z)((function*(){const isOpenAICallbacks=function isOfTypeOpenAIStreamCallbacks(callbacks){return"experimental_onFunctionCall"in callbacks}(callbacks);callbacks.onCompletion&&(yield callbacks.onCompletion(aggregatedResponse)),callbacks.onFinal&&!isOpenAICallbacks&&(yield callbacks.onFinal(aggregatedResponse))}))()})}function trimStartOfStreamHelper(){let isStreamStart=!0;return text=>(isStreamStart&&(text=text.trimStart())&&(isStreamStart=!1),text)}function AIStream(response,customParser,callbacks){if(!response.ok){if(response.body){const reader=response.body.getReader();return new ReadableStream({start:controller=>(0,asyncToGenerator.Z)((function*(){const{done,value}=yield reader.read();if(!done){const errorText=(new TextDecoder).decode(value);controller.error(new Error(`Response error: ${errorText}`))}}))()})}return new ReadableStream({start(controller){controller.error(new Error("Response error: No response body"))}})}return(response.body||function createEmptyReadableStream(){return new ReadableStream({start(controller){controller.close()}})}()).pipeThrough(createEventStreamTransformer(customParser)).pipeThrough(createCallbacksTransformer(callbacks))}function readableFromAsyncIterable(iterable){let it=iterable[Symbol.asyncIterator]();return new ReadableStream({pull:controller=>(0,asyncToGenerator.Z)((function*(){const{done,value}=yield it.next();done?controller.close():controller.enqueue(value)}))(),cancel:reason=>(0,asyncToGenerator.Z)((function*(){var _a;yield null==(_a=it.return)?void 0:_a.call(it,reason)}))()})}function createStreamDataTransformer(experimental_streamData){if(!experimental_streamData)return new TransformStream({transform:(_ref3=(0,asyncToGenerator.Z)((function*(chunk,controller){controller.enqueue(chunk)})),function transform(_x12,_x13){return _ref3.apply(this,arguments)})});var _ref3;const encoder=new TextEncoder,decoder=new TextDecoder;return new TransformStream({transform:(_ref4=(0,asyncToGenerator.Z)((function*(chunk,controller){const message=decoder.decode(chunk);controller.enqueue(encoder.encode(formatStreamPart("text",message)))})),function transform(_x14,_x15){return _ref4.apply(this,arguments)})});var _ref4}new TextDecoder("utf-8");function _streamable5(){return(_streamable5=(0,wrapAsyncGenerator.Z)((function*(stream){const extract=chunkToText();var _iteratorError6,_iteratorAbruptCompletion6=!1,_didIteratorError6=!1;try{for(var _step6,_iterator6=(0,asyncIterator.Z)(stream);_iteratorAbruptCompletion6=!(_step6=yield(0,awaitAsyncGenerator.Z)(_iterator6.next())).done;_iteratorAbruptCompletion6=!1){let chunk=_step6.value;{"promptFilterResults"in chunk&&(chunk={id:chunk.id,created:chunk.created.getDate(),object:chunk.object,model:chunk.model,choices:chunk.choices.map((choice=>{var _a,_b,_c,_d,_e,_f,_g;return{delta:{content:null==(_a=choice.delta)?void 0:_a.content,function_call:null==(_b=choice.delta)?void 0:_b.functionCall,role:null==(_c=choice.delta)?void 0:_c.role,tool_calls:(null==(_e=null==(_d=choice.delta)?void 0:_d.toolCalls)?void 0:_e.length)?null==(_g=null==(_f=choice.delta)?void 0:_f.toolCalls)?void 0:_g.map(((toolCall,index)=>({index,id:toolCall.id,function:toolCall.function,type:toolCall.type}))):void 0},finish_reason:choice.finishReason,index:choice.index}}))});const text=extract(chunk);text&&(yield text)}}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorAbruptCompletion6&&null!=_iterator6.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator6.return()))}finally{if(_didIteratorError6)throw _iteratorError6}}}))).apply(this,arguments)}function chunkToText(){const trimStartOfStream=trimStartOfStreamHelper();let isFunctionStreamingIn;return json=>{var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p,_q,_r;if(isChatCompletionChunk(json)){const delta=null==(_a=json.choices[0])?void 0:_a.delta;if(null==(_b=delta.function_call)?void 0:_b.name)return isFunctionStreamingIn=!0,`{"function_call": {"name": "${delta.function_call.name}", "arguments": "`;if(null==(_e=null==(_d=null==(_c=delta.tool_calls)?void 0:_c[0])?void 0:_d.function)?void 0:_e.name){isFunctionStreamingIn=!0;const toolCall=delta.tool_calls[0];return 0===toolCall.index?`{"tool_calls":[ {"id": "${toolCall.id}", "type": "function", "function": {"name": "${null==(_f=toolCall.function)?void 0:_f.name}", "arguments": "`:`"}}, {"id": "${toolCall.id}", "type": "function", "function": {"name": "${null==(_g=toolCall.function)?void 0:_g.name}", "arguments": "`}if(null==(_h=delta.function_call)?void 0:_h.arguments)return cleanupArguments(null==(_i=delta.function_call)?void 0:_i.arguments);if(null==(_l=null==(_k=null==(_j=delta.tool_calls)?void 0:_j[0])?void 0:_k.function)?void 0:_l.arguments)return cleanupArguments(null==(_o=null==(_n=null==(_m=delta.tool_calls)?void 0:_m[0])?void 0:_n.function)?void 0:_o.arguments);if(isFunctionStreamingIn&&("function_call"===(null==(_p=json.choices[0])?void 0:_p.finish_reason)||"stop"===(null==(_q=json.choices[0])?void 0:_q.finish_reason)))return isFunctionStreamingIn=!1,'"}}';if(isFunctionStreamingIn&&"tool_calls"===(null==(_r=json.choices[0])?void 0:_r.finish_reason))return isFunctionStreamingIn=!1,'"}}]}'}return trimStartOfStream(isChatCompletionChunk(json)&&json.choices[0].delta.content?json.choices[0].delta.content:function isCompletion(data){return"choices"in data&&data.choices&&data.choices[0]&&"text"in data.choices[0]}(json)?json.choices[0].text:"")};function cleanupArguments(argumentChunk){return`${argumentChunk.replace(/\\/g,"\\\\").replace(/\//g,"\\/").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f")}`}}var __internal__OpenAIFnMessagesSymbol=Symbol("internal_openai_fn_messages");function isChatCompletionChunk(data){return"choices"in data&&data.choices&&data.choices[0]&&"delta"in data.choices[0]}function OpenAIStream(res,callbacks){const cb=callbacks;let stream;if(stream=Symbol.asyncIterator in res?readableFromAsyncIterable(function streamable5(_x7){return _streamable5.apply(this,arguments)}(res)).pipeThrough(createCallbacksTransformer((null==cb?void 0:cb.experimental_onFunctionCall)||(null==cb?void 0:cb.experimental_onToolCall)?{...cb,onFinal:void 0}:{...cb})):AIStream(res,function parseOpenAIStream(){const extract=chunkToText();return data=>extract(JSON.parse(data))}(),(null==cb?void 0:cb.experimental_onFunctionCall)||(null==cb?void 0:cb.experimental_onToolCall)?{...cb,onFinal:void 0}:{...cb}),cb&&(cb.experimental_onFunctionCall||cb.experimental_onToolCall)){const functionCallTransformer=function createFunctionCallTransformer(callbacks){const textEncoder=new TextEncoder;let isFirstChunk=!0,aggregatedResponse="",aggregatedFinalCompletionResponse="",isFunctionStreamingIn=!1,functionCallMessages=callbacks[__internal__OpenAIFnMessagesSymbol]||[];const isComplexMode=null==callbacks?void 0:callbacks.experimental_streamData,decode=createChunkDecoder();return new TransformStream({transform:(chunk,controller)=>(0,asyncToGenerator.Z)((function*(){const message=decode(chunk);aggregatedFinalCompletionResponse+=message;if(isFirstChunk&&(message.startsWith('{"function_call":')||message.startsWith('{"tool_calls":')))return isFunctionStreamingIn=!0,aggregatedResponse+=message,void(isFirstChunk=!1);isFunctionStreamingIn?aggregatedResponse+=message:controller.enqueue(isComplexMode?textEncoder.encode(formatStreamPart("text",message)):chunk)}))(),flush:controller=>(0,asyncToGenerator.Z)((function*(){try{if(!isFirstChunk&&isFunctionStreamingIn&&(callbacks.experimental_onFunctionCall||callbacks.experimental_onToolCall)){isFunctionStreamingIn=!1;const payload=JSON.parse(aggregatedResponse);let functionResponse,newFunctionCallMessages=[...functionCallMessages];if(callbacks.experimental_onFunctionCall){void 0===payload.function_call&&console.warn("experimental_onFunctionCall should not be defined when using tools");const argumentsPayload=JSON.parse(payload.function_call.arguments);functionResponse=yield callbacks.experimental_onFunctionCall({name:payload.function_call.name,arguments:argumentsPayload},(result=>(newFunctionCallMessages=[...functionCallMessages,{role:"assistant",content:"",function_call:payload.function_call},{role:"function",name:payload.function_call.name,content:JSON.stringify(result)}],newFunctionCallMessages)))}if(callbacks.experimental_onToolCall){const toolCalls={tools:[]};for(const tool of payload.tool_calls)toolCalls.tools.push({id:tool.id,type:"function",func:{name:tool.function.name,arguments:tool.function.arguments}});let responseIndex=0;try{functionResponse=yield callbacks.experimental_onToolCall(toolCalls,(result=>{if(result){const{tool_call_id,function_name,tool_call_result}=result;newFunctionCallMessages=[...newFunctionCallMessages,...0===responseIndex?[{role:"assistant",content:"",tool_calls:payload.tool_calls.map((tc=>({id:tc.id,type:"function",function:{name:tc.function.name,arguments:JSON.stringify(tc.function.arguments)}})))}]:[],{role:"tool",tool_call_id,name:function_name,content:JSON.stringify(tool_call_result)}],responseIndex++}return newFunctionCallMessages}))}catch(e){console.error("Error calling experimental_onToolCall:",e)}}if(!functionResponse)return void controller.enqueue(textEncoder.encode(isComplexMode?formatStreamPart(payload.function_call?"function_call":"tool_calls",JSON.parse(aggregatedResponse)):aggregatedResponse));if("string"==typeof functionResponse)return controller.enqueue(isComplexMode?textEncoder.encode(formatStreamPart("text",functionResponse)):textEncoder.encode(functionResponse)),void(aggregatedFinalCompletionResponse=functionResponse);const filteredCallbacks={...callbacks,onStart:void 0};callbacks.onFinal=void 0;const reader=OpenAIStream(functionResponse,{...filteredCallbacks,[__internal__OpenAIFnMessagesSymbol]:newFunctionCallMessages}).getReader();for(;;){const{done,value}=yield reader.read();if(done)break;controller.enqueue(value)}}}finally{callbacks.onFinal&&aggregatedFinalCompletionResponse&&(yield callbacks.onFinal(aggregatedFinalCompletionResponse))}}))()})}(cb);return stream.pipeThrough(functionCallTransformer)}return stream.pipeThrough(createStreamDataTransformer(null==cb?void 0:cb.experimental_streamData))}"\n".charCodeAt(0)},"./node_modules/base64-js/index.js":(__unused_webpack_module,exports)=>{"use strict";exports.byteLength=function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function toByteArray(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},"./node_modules/camelcase/index.js":module=>{"use strict";const UPPERCASE=/[\p{Lu}]/u,LOWERCASE=/[\p{Ll}]/u,LEADING_CAPITAL=/^[\p{Lu}](?![\p{Lu}])/gu,IDENTIFIER=/([\p{Alpha}\p{N}_]|$)/u,SEPARATORS=/[_.\- ]+/,LEADING_SEPARATORS=new RegExp("^"+SEPARATORS.source),SEPARATORS_AND_IDENTIFIER=new RegExp(SEPARATORS.source+IDENTIFIER.source,"gu"),NUMBERS_AND_IDENTIFIER=new RegExp("\\d+"+IDENTIFIER.source,"gu"),camelCase=(input,options)=>{if("string"!=typeof input&&!Array.isArray(input))throw new TypeError("Expected the input to be `string | string[]`");if(options={pascalCase:!1,preserveConsecutiveUppercase:!1,...options},0===(input=Array.isArray(input)?input.map((x=>x.trim())).filter((x=>x.length)).join("-"):input.trim()).length)return"";const toLowerCase=!1===options.locale?string=>string.toLowerCase():string=>string.toLocaleLowerCase(options.locale),toUpperCase=!1===options.locale?string=>string.toUpperCase():string=>string.toLocaleUpperCase(options.locale);if(1===input.length)return options.pascalCase?toUpperCase(input):toLowerCase(input);return input!==toLowerCase(input)&&(input=((string,toLowerCase,toUpperCase)=>{let isLastCharLower=!1,isLastCharUpper=!1,isLastLastCharUpper=!1;for(let i=0;i<string.length;i++){const character=string[i];isLastCharLower&&UPPERCASE.test(character)?(string=string.slice(0,i)+"-"+string.slice(i),isLastCharLower=!1,isLastLastCharUpper=isLastCharUpper,isLastCharUpper=!0,i++):isLastCharUpper&&isLastLastCharUpper&&LOWERCASE.test(character)?(string=string.slice(0,i-1)+"-"+string.slice(i-1),isLastLastCharUpper=isLastCharUpper,isLastCharUpper=!1,isLastCharLower=!0):(isLastCharLower=toLowerCase(character)===character&&toUpperCase(character)!==character,isLastLastCharUpper=isLastCharUpper,isLastCharUpper=toUpperCase(character)===character&&toLowerCase(character)!==character)}return string})(input,toLowerCase,toUpperCase)),input=input.replace(LEADING_SEPARATORS,""),input=options.preserveConsecutiveUppercase?((input,toLowerCase)=>(LEADING_CAPITAL.lastIndex=0,input.replace(LEADING_CAPITAL,(m1=>toLowerCase(m1)))))(input,toLowerCase):toLowerCase(input),options.pascalCase&&(input=toUpperCase(input.charAt(0))+input.slice(1)),((input,toUpperCase)=>(SEPARATORS_AND_IDENTIFIER.lastIndex=0,NUMBERS_AND_IDENTIFIER.lastIndex=0,input.replace(SEPARATORS_AND_IDENTIFIER,((_,identifier)=>toUpperCase(identifier))).replace(NUMBERS_AND_IDENTIFIER,(m=>toUpperCase(m)))))(input,toUpperCase)};module.exports=camelCase,module.exports.default=camelCase},"./node_modules/decamelize/index.js":module=>{"use strict";module.exports=function(str,sep){if("string"!=typeof str)throw new TypeError("Expected a string");return sep=void 0===sep?"_":sep,str.replace(/([a-z\d])([A-Z])/g,"$1"+sep+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+sep+"$2").toLowerCase()}},"./node_modules/eventemitter3/index.js":module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/json5/dist/index.js":function(module){module.exports=function(){"use strict";function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}var _global=createCommonjsModule((function(module){var global=module.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global)})),_core=createCommonjsModule((function(module){var core=module.exports={version:"2.6.5"};"number"==typeof __e&&(__e=core)})),_isObject=(_core.version,function(it){return"object"==typeof it?null!==it:"function"==typeof it}),_anObject=function(it){if(!_isObject(it))throw TypeError(it+" is not an object!");return it},_fails=function(exec){try{return!!exec()}catch(e){return!0}},_descriptors=!_fails((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),document=_global.document,is=_isObject(document)&&_isObject(document.createElement),_domCreate=function(it){return is?document.createElement(it):{}},_ie8DomDefine=!_descriptors&&!_fails((function(){return 7!=Object.defineProperty(_domCreate("div"),"a",{get:function(){return 7}}).a})),_toPrimitive=function(it,S){if(!_isObject(it))return it;var fn,val;if(S&&"function"==typeof(fn=it.toString)&&!_isObject(val=fn.call(it)))return val;if("function"==typeof(fn=it.valueOf)&&!_isObject(val=fn.call(it)))return val;if(!S&&"function"==typeof(fn=it.toString)&&!_isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")},dP=Object.defineProperty,_objectDp={f:_descriptors?Object.defineProperty:function defineProperty(O,P,Attributes){if(_anObject(O),P=_toPrimitive(P,!0),_anObject(Attributes),_ie8DomDefine)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");return"value"in Attributes&&(O[P]=Attributes.value),O}},_propertyDesc=function(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value}},_hide=_descriptors?function(object,key,value){return _objectDp.f(object,key,_propertyDesc(1,value))}:function(object,key,value){return object[key]=value,object},hasOwnProperty={}.hasOwnProperty,_has=function(it,key){return hasOwnProperty.call(it,key)},id=0,px=Math.random(),_uid=function(key){return"Symbol(".concat(void 0===key?"":key,")_",(++id+px).toString(36))},_library=!1,_shared=createCommonjsModule((function(module){var SHARED="__core-js_shared__",store=_global[SHARED]||(_global[SHARED]={});(module.exports=function(key,value){return store[key]||(store[key]=void 0!==value?value:{})})("versions",[]).push({version:_core.version,mode:_library?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),_functionToString=_shared("native-function-to-string",Function.toString),_redefine=createCommonjsModule((function(module){var SRC=_uid("src"),TO_STRING="toString",TPL=(""+_functionToString).split(TO_STRING);_core.inspectSource=function(it){return _functionToString.call(it)},(module.exports=function(O,key,val,safe){var isFunction="function"==typeof val;isFunction&&(_has(val,"name")||_hide(val,"name",key)),O[key]!==val&&(isFunction&&(_has(val,SRC)||_hide(val,SRC,O[key]?""+O[key]:TPL.join(String(key)))),O===_global?O[key]=val:safe?O[key]?O[key]=val:_hide(O,key,val):(delete O[key],_hide(O,key,val)))})(Function.prototype,TO_STRING,(function toString(){return"function"==typeof this&&this[SRC]||_functionToString.call(this)}))})),_aFunction=function(it){if("function"!=typeof it)throw TypeError(it+" is not a function!");return it},_ctx=function(fn,that,length){if(_aFunction(fn),void 0===that)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}},PROTOTYPE="prototype",$export=function(type,name,source){var key,own,out,exp,IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?_global:IS_STATIC?_global[name]||(_global[name]={}):(_global[name]||{})[PROTOTYPE],exports=IS_GLOBAL?_core:_core[name]||(_core[name]={}),expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={});for(key in IS_GLOBAL&&(source=name),source)out=((own=!IS_FORCED&&target&&void 0!==target[key])?target:source)[key],exp=IS_BIND&&own?_ctx(out,_global):IS_PROTO&&"function"==typeof out?_ctx(Function.call,out):out,target&&_redefine(target,key,out,type&$export.U),exports[key]!=out&&_hide(exports,key,exp),IS_PROTO&&expProto[key]!=out&&(expProto[key]=out)};_global.core=_core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var TO_STRING,_export=$export,ceil=Math.ceil,floor=Math.floor,_toInteger=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)},_defined=function(it){if(null==it)throw TypeError("Can't call method on  "+it);return it},$at=(TO_STRING=!1,function(that,pos){var a,b,s=String(_defined(that)),i=_toInteger(pos),l=s.length;return i<0||i>=l?TO_STRING?"":void 0:(a=s.charCodeAt(i))<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):b-56320+(a-55296<<10)+65536});_export(_export.P,"String",{codePointAt:function codePointAt(pos){return $at(this,pos)}}),_core.String.codePointAt;var max=Math.max,min=Math.min,_toAbsoluteIndex=function(index,length){return(index=_toInteger(index))<0?max(index+length,0):min(index,length)},fromCharCode=String.fromCharCode,$fromCodePoint=String.fromCodePoint;_export(_export.S+_export.F*(!!$fromCodePoint&&1!=$fromCodePoint.length),"String",{fromCodePoint:function fromCodePoint(x){for(var code,arguments$1=arguments,res=[],aLen=arguments.length,i=0;aLen>i;){if(code=+arguments$1[i++],_toAbsoluteIndex(code,1114111)!==code)throw RangeError(code+" is not a valid code point");res.push(code<65536?fromCharCode(code):fromCharCode(55296+((code-=65536)>>10),code%1024+56320))}return res.join("")}}),_core.String.fromCodePoint;var source,parseState,stack,pos,line,column,token,key,root,lexState,buffer,doubleQuote,sign,c,unicode={Space_Separator:/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ID_Start:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ID_Continue:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},util={isSpaceSeparator:function isSpaceSeparator(c){return"string"==typeof c&&unicode.Space_Separator.test(c)},isIdStartChar:function isIdStartChar(c){return"string"==typeof c&&(c>="a"&&c<="z"||c>="A"&&c<="Z"||"$"===c||"_"===c||unicode.ID_Start.test(c))},isIdContinueChar:function isIdContinueChar(c){return"string"==typeof c&&(c>="a"&&c<="z"||c>="A"&&c<="Z"||c>="0"&&c<="9"||"$"===c||"_"===c||"‌"===c||"‍"===c||unicode.ID_Continue.test(c))},isDigit:function isDigit(c){return"string"==typeof c&&/[0-9]/.test(c)},isHexDigit:function isHexDigit(c){return"string"==typeof c&&/[0-9A-Fa-f]/.test(c)}},parse=function parse(text,reviver){source=String(text),parseState="start",stack=[],pos=0,line=1,column=0,token=void 0,key=void 0,root=void 0;do{token=lex(),parseStates[parseState]()}while("eof"!==token.type);return"function"==typeof reviver?internalize({"":root},"",reviver):root};function internalize(holder,name,reviver){var value=holder[name];if(null!=value&&"object"==typeof value)if(Array.isArray(value))for(var i=0;i<value.length;i++){var key=String(i),replacement=internalize(value,key,reviver);void 0===replacement?delete value[key]:Object.defineProperty(value,key,{value:replacement,writable:!0,enumerable:!0,configurable:!0})}else for(var key$1 in value){var replacement$1=internalize(value,key$1,reviver);void 0===replacement$1?delete value[key$1]:Object.defineProperty(value,key$1,{value:replacement$1,writable:!0,enumerable:!0,configurable:!0})}return reviver.call(holder,name,value)}function lex(){for(lexState="default",buffer="",doubleQuote=!1,sign=1;;){c=peek();var token=lexStates[lexState]();if(token)return token}}function peek(){if(source[pos])return String.fromCodePoint(source.codePointAt(pos))}function read(){var c=peek();return"\n"===c?(line++,column=0):c?column+=c.length:column++,c&&(pos+=c.length),c}var lexStates={default:function default$1(){switch(c){case"\t":case"\v":case"\f":case" ":case" ":case"\ufeff":case"\n":case"\r":case"\u2028":case"\u2029":return void read();case"/":return read(),void(lexState="comment");case void 0:return read(),newToken("eof")}if(!util.isSpaceSeparator(c))return lexStates[parseState]();read()},comment:function comment(){switch(c){case"*":return read(),void(lexState="multiLineComment");case"/":return read(),void(lexState="singleLineComment")}throw invalidChar(read())},multiLineComment:function multiLineComment(){switch(c){case"*":return read(),void(lexState="multiLineCommentAsterisk");case void 0:throw invalidChar(read())}read()},multiLineCommentAsterisk:function multiLineCommentAsterisk(){switch(c){case"*":return void read();case"/":return read(),void(lexState="default");case void 0:throw invalidChar(read())}read(),lexState="multiLineComment"},singleLineComment:function singleLineComment(){switch(c){case"\n":case"\r":case"\u2028":case"\u2029":return read(),void(lexState="default");case void 0:return read(),newToken("eof")}read()},value:function value(){switch(c){case"{":case"[":return newToken("punctuator",read());case"n":return read(),literal("ull"),newToken("null",null);case"t":return read(),literal("rue"),newToken("boolean",!0);case"f":return read(),literal("alse"),newToken("boolean",!1);case"-":case"+":return"-"===read()&&(sign=-1),void(lexState="sign");case".":return buffer=read(),void(lexState="decimalPointLeading");case"0":return buffer=read(),void(lexState="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return buffer=read(),void(lexState="decimalInteger");case"I":return read(),literal("nfinity"),newToken("numeric",1/0);case"N":return read(),literal("aN"),newToken("numeric",NaN);case'"':case"'":return doubleQuote='"'===read(),buffer="",void(lexState="string")}throw invalidChar(read())},identifierNameStartEscape:function identifierNameStartEscape(){if("u"!==c)throw invalidChar(read());read();var u=unicodeEscape();switch(u){case"$":case"_":break;default:if(!util.isIdStartChar(u))throw invalidIdentifier()}buffer+=u,lexState="identifierName"},identifierName:function identifierName(){switch(c){case"$":case"_":case"‌":case"‍":return void(buffer+=read());case"\\":return read(),void(lexState="identifierNameEscape")}if(!util.isIdContinueChar(c))return newToken("identifier",buffer);buffer+=read()},identifierNameEscape:function identifierNameEscape(){if("u"!==c)throw invalidChar(read());read();var u=unicodeEscape();switch(u){case"$":case"_":case"‌":case"‍":break;default:if(!util.isIdContinueChar(u))throw invalidIdentifier()}buffer+=u,lexState="identifierName"},sign:function sign$1(){switch(c){case".":return buffer=read(),void(lexState="decimalPointLeading");case"0":return buffer=read(),void(lexState="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return buffer=read(),void(lexState="decimalInteger");case"I":return read(),literal("nfinity"),newToken("numeric",sign*(1/0));case"N":return read(),literal("aN"),newToken("numeric",NaN)}throw invalidChar(read())},zero:function zero(){switch(c){case".":return buffer+=read(),void(lexState="decimalPoint");case"e":case"E":return buffer+=read(),void(lexState="decimalExponent");case"x":case"X":return buffer+=read(),void(lexState="hexadecimal")}return newToken("numeric",0*sign)},decimalInteger:function decimalInteger(){switch(c){case".":return buffer+=read(),void(lexState="decimalPoint");case"e":case"E":return buffer+=read(),void(lexState="decimalExponent")}if(!util.isDigit(c))return newToken("numeric",sign*Number(buffer));buffer+=read()},decimalPointLeading:function decimalPointLeading(){if(util.isDigit(c))return buffer+=read(),void(lexState="decimalFraction");throw invalidChar(read())},decimalPoint:function decimalPoint(){switch(c){case"e":case"E":return buffer+=read(),void(lexState="decimalExponent")}return util.isDigit(c)?(buffer+=read(),void(lexState="decimalFraction")):newToken("numeric",sign*Number(buffer))},decimalFraction:function decimalFraction(){switch(c){case"e":case"E":return buffer+=read(),void(lexState="decimalExponent")}if(!util.isDigit(c))return newToken("numeric",sign*Number(buffer));buffer+=read()},decimalExponent:function decimalExponent(){switch(c){case"+":case"-":return buffer+=read(),void(lexState="decimalExponentSign")}if(util.isDigit(c))return buffer+=read(),void(lexState="decimalExponentInteger");throw invalidChar(read())},decimalExponentSign:function decimalExponentSign(){if(util.isDigit(c))return buffer+=read(),void(lexState="decimalExponentInteger");throw invalidChar(read())},decimalExponentInteger:function decimalExponentInteger(){if(!util.isDigit(c))return newToken("numeric",sign*Number(buffer));buffer+=read()},hexadecimal:function hexadecimal(){if(util.isHexDigit(c))return buffer+=read(),void(lexState="hexadecimalInteger");throw invalidChar(read())},hexadecimalInteger:function hexadecimalInteger(){if(!util.isHexDigit(c))return newToken("numeric",sign*Number(buffer));buffer+=read()},string:function string(){switch(c){case"\\":return read(),void(buffer+=escape());case'"':return doubleQuote?(read(),newToken("string",buffer)):void(buffer+=read());case"'":return doubleQuote?void(buffer+=read()):(read(),newToken("string",buffer));case"\n":case"\r":throw invalidChar(read());case"\u2028":case"\u2029":separatorChar(c);break;case void 0:throw invalidChar(read())}buffer+=read()},start:function start(){switch(c){case"{":case"[":return newToken("punctuator",read())}lexState="value"},beforePropertyName:function beforePropertyName(){switch(c){case"$":case"_":return buffer=read(),void(lexState="identifierName");case"\\":return read(),void(lexState="identifierNameStartEscape");case"}":return newToken("punctuator",read());case'"':case"'":return doubleQuote='"'===read(),void(lexState="string")}if(util.isIdStartChar(c))return buffer+=read(),void(lexState="identifierName");throw invalidChar(read())},afterPropertyName:function afterPropertyName(){if(":"===c)return newToken("punctuator",read());throw invalidChar(read())},beforePropertyValue:function beforePropertyValue(){lexState="value"},afterPropertyValue:function afterPropertyValue(){switch(c){case",":case"}":return newToken("punctuator",read())}throw invalidChar(read())},beforeArrayValue:function beforeArrayValue(){if("]"===c)return newToken("punctuator",read());lexState="value"},afterArrayValue:function afterArrayValue(){switch(c){case",":case"]":return newToken("punctuator",read())}throw invalidChar(read())},end:function end(){throw invalidChar(read())}};function newToken(type,value){return{type,value,line,column}}function literal(s){for(var i=0,list=s;i<list.length;i+=1){var c=list[i];if(peek()!==c)throw invalidChar(read());read()}}function escape(){switch(peek()){case"b":return read(),"\b";case"f":return read(),"\f";case"n":return read(),"\n";case"r":return read(),"\r";case"t":return read(),"\t";case"v":return read(),"\v";case"0":if(read(),util.isDigit(peek()))throw invalidChar(read());return"\0";case"x":return read(),hexEscape();case"u":return read(),unicodeEscape();case"\n":case"\u2028":case"\u2029":return read(),"";case"\r":return read(),"\n"===peek()&&read(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case void 0:throw invalidChar(read())}return read()}function hexEscape(){var buffer="",c=peek();if(!util.isHexDigit(c))throw invalidChar(read());if(buffer+=read(),c=peek(),!util.isHexDigit(c))throw invalidChar(read());return buffer+=read(),String.fromCodePoint(parseInt(buffer,16))}function unicodeEscape(){for(var buffer="",count=4;count-- >0;){var c=peek();if(!util.isHexDigit(c))throw invalidChar(read());buffer+=read()}return String.fromCodePoint(parseInt(buffer,16))}var parseStates={start:function start(){if("eof"===token.type)throw invalidEOF();push()},beforePropertyName:function beforePropertyName(){switch(token.type){case"identifier":case"string":return key=token.value,void(parseState="afterPropertyName");case"punctuator":return void pop();case"eof":throw invalidEOF()}},afterPropertyName:function afterPropertyName(){if("eof"===token.type)throw invalidEOF();parseState="beforePropertyValue"},beforePropertyValue:function beforePropertyValue(){if("eof"===token.type)throw invalidEOF();push()},beforeArrayValue:function beforeArrayValue(){if("eof"===token.type)throw invalidEOF();"punctuator"!==token.type||"]"!==token.value?push():pop()},afterPropertyValue:function afterPropertyValue(){if("eof"===token.type)throw invalidEOF();switch(token.value){case",":return void(parseState="beforePropertyName");case"}":pop()}},afterArrayValue:function afterArrayValue(){if("eof"===token.type)throw invalidEOF();switch(token.value){case",":return void(parseState="beforeArrayValue");case"]":pop()}},end:function end(){}};function push(){var value;switch(token.type){case"punctuator":switch(token.value){case"{":value={};break;case"[":value=[]}break;case"null":case"boolean":case"numeric":case"string":value=token.value}if(void 0===root)root=value;else{var parent=stack[stack.length-1];Array.isArray(parent)?parent.push(value):Object.defineProperty(parent,key,{value,writable:!0,enumerable:!0,configurable:!0})}if(null!==value&&"object"==typeof value)stack.push(value),parseState=Array.isArray(value)?"beforeArrayValue":"beforePropertyName";else{var current=stack[stack.length-1];parseState=null==current?"end":Array.isArray(current)?"afterArrayValue":"afterPropertyValue"}}function pop(){stack.pop();var current=stack[stack.length-1];parseState=null==current?"end":Array.isArray(current)?"afterArrayValue":"afterPropertyValue"}function invalidChar(c){return syntaxError(void 0===c?"JSON5: invalid end of input at "+line+":"+column:"JSON5: invalid character '"+formatChar(c)+"' at "+line+":"+column)}function invalidEOF(){return syntaxError("JSON5: invalid end of input at "+line+":"+column)}function invalidIdentifier(){return syntaxError("JSON5: invalid identifier character at "+line+":"+(column-=5))}function separatorChar(c){console.warn("JSON5: '"+formatChar(c)+"' in strings is not valid ECMAScript; consider escaping")}function formatChar(c){var replacements={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(replacements[c])return replacements[c];if(c<" "){var hexString=c.charCodeAt(0).toString(16);return"\\x"+("00"+hexString).substring(hexString.length)}return c}function syntaxError(message){var err=new SyntaxError(message);return err.lineNumber=line,err.columnNumber=column,err}return{parse,stringify:function stringify(value,replacer,space){var propertyList,replacerFunc,quote,stack=[],indent="",gap="";if(null==replacer||"object"!=typeof replacer||Array.isArray(replacer)||(space=replacer.space,quote=replacer.quote,replacer=replacer.replacer),"function"==typeof replacer)replacerFunc=replacer;else if(Array.isArray(replacer)){propertyList=[];for(var i=0,list=replacer;i<list.length;i+=1){var v=list[i],item=void 0;"string"==typeof v?item=v:("number"==typeof v||v instanceof String||v instanceof Number)&&(item=String(v)),void 0!==item&&propertyList.indexOf(item)<0&&propertyList.push(item)}}return space instanceof Number?space=Number(space):space instanceof String&&(space=String(space)),"number"==typeof space?space>0&&(space=Math.min(10,Math.floor(space)),gap="          ".substr(0,space)):"string"==typeof space&&(gap=space.substr(0,10)),serializeProperty("",{"":value});function serializeProperty(key,holder){var value=holder[key];switch(null!=value&&("function"==typeof value.toJSON5?value=value.toJSON5(key):"function"==typeof value.toJSON&&(value=value.toJSON(key))),replacerFunc&&(value=replacerFunc.call(holder,key,value)),value instanceof Number?value=Number(value):value instanceof String?value=String(value):value instanceof Boolean&&(value=value.valueOf()),value){case null:return"null";case!0:return"true";case!1:return"false"}return"string"==typeof value?quoteString(value,!1):"number"==typeof value?String(value):"object"==typeof value?Array.isArray(value)?serializeArray(value):serializeObject(value):void 0}function quoteString(value){for(var quotes={"'":.1,'"':.2},replacements={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},product="",i=0;i<value.length;i++){var c=value[i];switch(c){case"'":case'"':quotes[c]++,product+=c;continue;case"\0":if(util.isDigit(value[i+1])){product+="\\x00";continue}}if(replacements[c])product+=replacements[c];else if(c<" "){var hexString=c.charCodeAt(0).toString(16);product+="\\x"+("00"+hexString).substring(hexString.length)}else product+=c}var quoteChar=quote||Object.keys(quotes).reduce((function(a,b){return quotes[a]<quotes[b]?a:b}));return quoteChar+(product=product.replace(new RegExp(quoteChar,"g"),replacements[quoteChar]))+quoteChar}function serializeObject(value){if(stack.indexOf(value)>=0)throw TypeError("Converting circular structure to JSON5");stack.push(value);var stepback=indent;indent+=gap;for(var final,properties,partial=[],i=0,list=propertyList||Object.keys(value);i<list.length;i+=1){var key=list[i],propertyString=serializeProperty(key,value);if(void 0!==propertyString){var member=serializeKey(key)+":";""!==gap&&(member+=" "),member+=propertyString,partial.push(member)}}if(0===partial.length)final="{}";else if(""===gap)final="{"+(properties=partial.join(","))+"}";else{var separator=",\n"+indent;properties=partial.join(separator),final="{\n"+indent+properties+",\n"+stepback+"}"}return stack.pop(),indent=stepback,final}function serializeKey(key){if(0===key.length)return quoteString(key,!0);var firstChar=String.fromCodePoint(key.codePointAt(0));if(!util.isIdStartChar(firstChar))return quoteString(key,!0);for(var i=firstChar.length;i<key.length;i++)if(!util.isIdContinueChar(String.fromCodePoint(key.codePointAt(i))))return quoteString(key,!0);return key}function serializeArray(value){if(stack.indexOf(value)>=0)throw TypeError("Converting circular structure to JSON5");stack.push(value);var stepback=indent;indent+=gap;for(var final,partial=[],i=0;i<value.length;i++){var propertyString=serializeProperty(String(i),value);partial.push(void 0!==propertyString?propertyString:"null")}if(0===partial.length)final="[]";else if(""===gap)final="["+partial.join(",")+"]";else{var separator=",\n"+indent,properties$1=partial.join(separator);final="[\n"+indent+properties$1+",\n"+stepback+"]"}return stack.pop(),indent=stepback,final}}}}()},"./node_modules/jsonpointer/jsonpointer.js":(__unused_webpack_module,exports)=>{var hasExcape=/~/,escapeMatcher=/~[01]/g;function escapeReplacer(m){switch(m){case"~1":return"/";case"~0":return"~"}throw new Error("Invalid tilde escape: "+m)}function untilde(str){return hasExcape.test(str)?str.replace(escapeMatcher,escapeReplacer):str}function compilePointer(pointer){if("string"==typeof pointer){if(""===(pointer=pointer.split("/"))[0])return pointer;throw new Error("Invalid JSON pointer.")}if(Array.isArray(pointer)){for(const part of pointer)if("string"!=typeof part&&"number"!=typeof part)throw new Error("Invalid JSON pointer. Must be of type string or number.");return pointer}throw new Error("Invalid JSON pointer.")}function get(obj,pointer){if("object"!=typeof obj)throw new Error("Invalid input object.");var len=(pointer=compilePointer(pointer)).length;if(1===len)return obj;for(var p=1;p<len;){if(obj=obj[untilde(pointer[p++])],len===p)return obj;if("object"!=typeof obj||null===obj)return}}function set(obj,pointer,value){if("object"!=typeof obj)throw new Error("Invalid input object.");if(0===(pointer=compilePointer(pointer)).length)throw new Error("Invalid JSON pointer for set.");return function setter(obj,pointer,value){for(var part,hasNextPart,p=1,len=pointer.length;p<len;){if("constructor"===pointer[p]||"prototype"===pointer[p]||"__proto__"===pointer[p])return obj;if(part=untilde(pointer[p++]),hasNextPart=len>p,void 0===obj[part]&&(Array.isArray(obj)&&"-"===part&&(part=obj.length),hasNextPart&&(""!==pointer[p]&&pointer[p]<1/0||"-"===pointer[p]?obj[part]=[]:obj[part]={})),!hasNextPart)break;obj=obj[part]}var oldValue=obj[part];return void 0===value?delete obj[part]:obj[part]=value,oldValue}(obj,pointer,value)}},"./node_modules/langchain/agents.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ij:()=>executor_AgentExecutor,uv:()=>createOpenAIToolsAgent});var agents_agent=__webpack_require__("./node_modules/langchain/dist/agents/agent.js"),tools=__webpack_require__("./node_modules/@langchain/core/tools.js"),serializable=(__webpack_require__("./node_modules/jsonpointer/jsonpointer.js"),__webpack_require__("./node_modules/@langchain/core/load/serializable.js"));__webpack_require__("./node_modules/langchain/dist/chains/llm_chain.js"),__webpack_require__("./node_modules/langchain/dist/agents/mrkl/index.js");var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),asyncIterator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js"),awaitAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator.js"),wrapAsyncGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator.js"),runnables=__webpack_require__("./node_modules/@langchain/core/runnables.js"),manager=__webpack_require__("./node_modules/@langchain/core/callbacks/manager.js"),output_parsers=__webpack_require__("./node_modules/@langchain/core/output_parsers.js"),base=__webpack_require__("./node_modules/langchain/dist/chains/base.js");class AgentExecutorIterator extends serializable.i{get finalOutputs(){return this._finalOutputs}setFinalOutputs(value){var _this3=this;return(0,asyncToGenerator.Z)((function*(){if(_this3._finalOutputs=void 0,value){const preparedOutputs=yield _this3.agentExecutor.prepOutputs(_this3.inputs,value,!0);_this3._finalOutputs=preparedOutputs}}))()}get nameToToolMap(){const toolMap=this.agentExecutor.tools.map((tool=>({[tool.name]:tool})));return Object.assign({},...toolMap)}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","executor_iterator"]}),Object.defineProperty(this,"agentExecutor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_finalOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"intermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"iterations",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.agentExecutor=fields.agentExecutor,this.inputs=fields.inputs,this.callbacks=fields.callbacks,this.tags=fields.tags,this.metadata=fields.metadata,this.runName=fields.runName,this.runManager=fields.runManager,this.config=fields.config}reset(){this.intermediateSteps=[],this.iterations=0,this._finalOutputs=void 0}updateIterations(){this.iterations+=1}streamIterator(){var _this=this;return(0,wrapAsyncGenerator.Z)((function*(){for(_this.reset();;)try{0===_this.iterations&&(yield(0,awaitAsyncGenerator.Z)(_this.onFirstStep()));const result=yield(0,awaitAsyncGenerator.Z)(_this._callNext());yield result}catch(e){if("message"in e&&e.message.startsWith("Final outputs already reached: ")){if(!_this.finalOutputs)throw e;return _this.finalOutputs}throw _this.runManager&&(yield(0,awaitAsyncGenerator.Z)(_this.runManager.handleChainError(e))),e}}))()}onFirstStep(){var _this4=this;return(0,asyncToGenerator.Z)((function*(){if(0===_this4.iterations){const callbackManager=yield manager.Ye.configure(_this4.callbacks??_this4.config?.callbacks,_this4.agentExecutor.callbacks,_this4.tags??_this4.config?.tags,_this4.agentExecutor.tags,_this4.metadata??_this4.config?.metadata,_this4.agentExecutor.metadata,{verbose:_this4.agentExecutor.verbose});_this4.runManager=yield callbackManager?.handleChainStart(_this4.agentExecutor.toJSON(),_this4.inputs,_this4.config?.runId,void 0,_this4.tags??_this4.config?.tags,_this4.metadata??_this4.config?.metadata,_this4.runName??_this4.config?.runName),void 0!==_this4.config&&delete _this4.config.runId}}))()}_executeNextStep(runManager){var _this5=this;return(0,asyncToGenerator.Z)((function*(){return _this5.agentExecutor._takeNextStep(_this5.nameToToolMap,_this5.inputs,_this5.intermediateSteps,runManager,_this5.config)}))()}_processNextStepOutput(nextStepOutput,runManager){var _this6=this;return(0,asyncToGenerator.Z)((function*(){if("returnValues"in nextStepOutput){const output=yield _this6.agentExecutor._return(nextStepOutput,_this6.intermediateSteps,runManager);return _this6.runManager&&(yield _this6.runManager.handleChainEnd(output)),yield _this6.setFinalOutputs(output),output}_this6.intermediateSteps=_this6.intermediateSteps.concat(nextStepOutput);let output={};if(Array.isArray(nextStepOutput)&&1===nextStepOutput.length){const nextStep=nextStepOutput[0],toolReturn=yield _this6.agentExecutor._getToolReturn(nextStep);toolReturn&&(output=yield _this6.agentExecutor._return(toolReturn,_this6.intermediateSteps,runManager),yield _this6.runManager?.handleChainEnd(output),yield _this6.setFinalOutputs(output))}return output={intermediateSteps:nextStepOutput},output}))()}_stop(){var _this7=this;return(0,asyncToGenerator.Z)((function*(){const output=yield _this7.agentExecutor.agent.returnStoppedResponse(_this7.agentExecutor.earlyStoppingMethod,_this7.intermediateSteps,_this7.inputs),returnedOutput=yield _this7.agentExecutor._return(output,_this7.intermediateSteps,_this7.runManager);return yield _this7.setFinalOutputs(returnedOutput),yield _this7.runManager?.handleChainEnd(returnedOutput),returnedOutput}))()}_callNext(){var _this8=this;return(0,asyncToGenerator.Z)((function*(){if(_this8.finalOutputs)throw new Error(`Final outputs already reached: ${JSON.stringify(_this8.finalOutputs,null,2)}`);if(!_this8.agentExecutor.shouldContinueGetter(_this8.iterations))return _this8._stop();const nextStepOutput=yield _this8._executeNextStep(_this8.runManager),output=yield _this8._processNextStepOutput(nextStepOutput,_this8.runManager);return _this8.updateIterations(),output}))()}}class ExceptionTool extends tools.UA{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"_Exception"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Exception tool"})}_call(query){return(0,asyncToGenerator.Z)((function*(){return query}))()}}class executor_AgentExecutor extends base.l{static lc_name(){return"AgentExecutor"}get lc_namespace(){return["langchain","agents","executor"]}get inputKeys(){return this.agent.inputKeys}get outputKeys(){return this.agent.returnValues}constructor(input){let agent,returnOnlyOutputs=!0;if(runnables.eq.isRunnable(input.agent)?(agent=agents_agent.fU.isAgentRunnableSequence(input.agent)?input.agent.singleAction?new agents_agent.Mj({runnable:input.agent,streamRunnable:input.agent.streamRunnable}):new agents_agent.zn({runnable:input.agent,streamRunnable:input.agent.streamRunnable}):new agents_agent.zn({runnable:input.agent}),returnOnlyOutputs=!1):((0,agents_agent.Ck)(input.agent)&&(returnOnlyOutputs=!1),agent=input.agent),super(input),Object.defineProperty(this,"agent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(this,"earlyStoppingMethod",{enumerable:!0,configurable:!0,writable:!0,value:"force"}),Object.defineProperty(this,"returnOnlyOutputs",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"handleParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.agent=agent,this.tools=input.tools,this.handleParsingErrors=input.handleParsingErrors??this.handleParsingErrors,this.returnOnlyOutputs=returnOnlyOutputs,"multi"===this.agent._agentActionType())for(const tool of this.tools)if(tool.returnDirect)throw new Error(`Tool with return direct ${tool.name} not supported for multi-action agent.`);this.returnIntermediateSteps=input.returnIntermediateSteps??this.returnIntermediateSteps,this.maxIterations=input.maxIterations??this.maxIterations,this.earlyStoppingMethod=input.earlyStoppingMethod??this.earlyStoppingMethod}static fromAgentAndTools(fields){return new executor_AgentExecutor(fields)}get shouldContinueGetter(){return this.shouldContinue.bind(this)}shouldContinue(iterations){return void 0===this.maxIterations||iterations<this.maxIterations}_call(inputs,runManager,config){var _this9=this;return(0,asyncToGenerator.Z)((function*(){const toolsByName=Object.fromEntries(_this9.tools.map((t=>[t.name.toLowerCase(),t]))),steps=[];let iterations=0;const getOutput=function(){var _ref=(0,asyncToGenerator.Z)((function*(finishStep){const{returnValues}=finishStep,additional=yield _this9.agent.prepareForOutput(returnValues,steps);let response;return yield runManager?.handleAgentEnd(finishStep),response=_this9.returnIntermediateSteps?{...returnValues,intermediateSteps:steps,...additional}:{...returnValues,...additional},_this9.returnOnlyOutputs||(response={...inputs,...response}),response}));return function getOutput(_x){return _ref.apply(this,arguments)}}();for(;_this9.shouldContinue(iterations);){let output,actions;try{output=yield _this9.agent.plan(steps,inputs,runManager?.getChild(),config)}catch(e){if(!(e instanceof output_parsers.dS))throw e;{let observation,text=e.message;if(!0===_this9.handleParsingErrors)e.sendToLLM?(observation=e.observation,text=e.llmOutput??""):observation="Invalid or incomplete response";else if("string"==typeof _this9.handleParsingErrors)observation=_this9.handleParsingErrors;else{if("function"!=typeof _this9.handleParsingErrors)throw e;observation=_this9.handleParsingErrors(e)}output={tool:"_Exception",toolInput:observation,log:text}}}if("returnValues"in output)return getOutput(output);actions=Array.isArray(output)?output:[output];const newSteps=yield Promise.all(actions.map(function(){var _ref2=(0,asyncToGenerator.Z)((function*(action){yield runManager?.handleAgentAction(action);const tool="_Exception"===action.tool?new ExceptionTool:toolsByName[action.tool?.toLowerCase()];let observation;try{observation=tool?yield tool.invoke(action.toolInput,(0,runnables.q)(config,{callbacks:runManager?.getChild()})):`${action.tool} is not a valid tool, try another one.`}catch(e){if(e instanceof tools.YE){if(!0===_this9.handleParsingErrors)observation="Invalid or incomplete tool input. Please try again.";else if("string"==typeof _this9.handleParsingErrors)observation=_this9.handleParsingErrors;else{if("function"!=typeof _this9.handleParsingErrors)throw e;observation=_this9.handleParsingErrors(e)}return observation=yield(new ExceptionTool).call(observation,runManager?.getChild()),{action,observation:observation??""}}}return{action,observation:observation??""}}));return function(_x2){return _ref2.apply(this,arguments)}}()));steps.push(...newSteps);const lastStep=steps[steps.length-1],lastTool=toolsByName[lastStep.action.tool?.toLowerCase()];if(lastTool?.returnDirect)return getOutput({returnValues:{[_this9.agent.returnValues[0]]:lastStep.observation},log:""});iterations+=1}return getOutput(yield _this9.agent.returnStoppedResponse(_this9.earlyStoppingMethod,steps,inputs))}))()}_takeNextStep(nameToolMap,inputs,intermediateSteps,runManager,config){var _this10=this;return(0,asyncToGenerator.Z)((function*(){let output,actions;try{output=yield _this10.agent.plan(intermediateSteps,inputs,runManager?.getChild(),config)}catch(e){if(!(e instanceof output_parsers.dS))throw e;{let observation,text=e.message;if(!0===_this10.handleParsingErrors)e.sendToLLM?(observation=e.observation,text=e.llmOutput??""):observation="Invalid or incomplete response";else if("string"==typeof _this10.handleParsingErrors)observation=_this10.handleParsingErrors;else{if("function"!=typeof _this10.handleParsingErrors)throw e;observation=_this10.handleParsingErrors(e)}output={tool:"_Exception",toolInput:observation,log:text}}}if("returnValues"in output)return output;actions=Array.isArray(output)?output:[output];const result=[];for(const agentAction of actions){let observation="";if(runManager&&(yield runManager?.handleAgentAction(agentAction)),agentAction.tool in nameToolMap){const tool=nameToolMap[agentAction.tool];try{observation=yield tool.call(agentAction.toolInput,runManager?.getChild())}catch(e){if(e instanceof tools.YE){if(!0===_this10.handleParsingErrors)observation="Invalid or incomplete tool input. Please try again.";else if("string"==typeof _this10.handleParsingErrors)observation=_this10.handleParsingErrors;else{if("function"!=typeof _this10.handleParsingErrors)throw e;observation=_this10.handleParsingErrors(e)}observation=yield(new ExceptionTool).call(observation,runManager?.getChild())}}}else observation=`${agentAction.tool} is not a valid tool, try another available tool: ${Object.keys(nameToolMap).join(", ")}`;result.push({action:agentAction,observation})}return result}))()}_return(output,intermediateSteps,runManager){var _this11=this;return(0,asyncToGenerator.Z)((function*(){runManager&&(yield runManager.handleAgentEnd(output));const finalOutput=output.returnValues;return _this11.returnIntermediateSteps&&(finalOutput.intermediateSteps=intermediateSteps),finalOutput}))()}_getToolReturn(nextStepOutput){var _this12=this;return(0,asyncToGenerator.Z)((function*(){const{action,observation}=nextStepOutput,nameToolMap=Object.fromEntries(_this12.tools.map((t=>[t.name.toLowerCase(),t]))),[returnValueKey="output"]=_this12.agent.returnValues;return action.tool in nameToolMap&&nameToolMap[action.tool].returnDirect?{returnValues:{[returnValueKey]:observation},log:""}:null}))()}_returnStoppedResponse(earlyStoppingMethod){if("force"===earlyStoppingMethod)return{returnValues:{output:"Agent stopped due to iteration limit or time limit."},log:""};throw new Error(`Got unsupported early_stopping_method: ${earlyStoppingMethod}`)}_streamIterator(inputs,options){var _this2=this;return(0,wrapAsyncGenerator.Z)((function*(){const iterator=new AgentExecutorIterator({inputs,agentExecutor:_this2,config:options,metadata:options?.metadata,tags:options?.tags,callbacks:options?.callbacks}).streamIterator();var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,asyncIterator.Z)(iterator);_iteratorAbruptCompletion=!(_step=yield(0,awaitAsyncGenerator.Z)(_iterator.next())).done;_iteratorAbruptCompletion=!1){const step=_step.value;step&&(yield step)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield(0,awaitAsyncGenerator.Z)(_iterator.return()))}finally{if(_didIteratorError)throw _iteratorError}}}))()}_chainType(){return"agent_executor"}serialize(){throw new Error("Cannot serialize an AgentExecutor")}}__webpack_require__("./node_modules/langchain/dist/chains/vector_db_qa.js");var messages=__webpack_require__("./node_modules/@langchain/core/messages.js");__webpack_require__("./node_modules/@langchain/core/prompts.js");__webpack_require__("./node_modules/@langchain/core/dist/load/serializable.js"),__webpack_require__("./node_modules/@langchain/core/dist/messages/index.js");var types=__webpack_require__("./node_modules/langchain/dist/agents/types.js");__webpack_require__("./node_modules/zod-to-json-schema/dist/esm/index.js");var function_calling=__webpack_require__("./node_modules/@langchain/core/utils/function_calling.js");class OpenAIToolsAgentOutputParser extends types.${constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","openai"]})}static lc_name(){return"OpenAIToolsAgentOutputParser"}parse(text){return(0,asyncToGenerator.Z)((function*(){throw new Error(`OpenAIFunctionsAgentOutputParser can only parse messages.\nPassed input: ${text}`)}))()}parseResult(generations){var _this=this;return(0,asyncToGenerator.Z)((function*(){if("message"in generations[0]&&(0,messages.QW)(generations[0].message))return _this.parseAIMessage(generations[0].message);throw new Error("parseResult on OpenAIFunctionsAgentOutputParser only works on ChatGeneration output")}))()}parseAIMessage(message){if(message.content&&"string"!=typeof message.content)throw new Error("This agent cannot parse non-string model responses.");if(!message.additional_kwargs.tool_calls)return{returnValues:{output:message.content},log:message.content};{const toolCalls=message.additional_kwargs.tool_calls;try{return toolCalls.map(((toolCall,i)=>{const toolInput=toolCall.function.arguments?JSON.parse(toolCall.function.arguments):{},messageLog=0===i?[message]:[];return{tool:toolCall.function.name,toolInput,toolCallId:toolCall.id,log:`Invoking "${toolCall.function.name}" with ${toolCall.function.arguments??"{}"}\n${message.content}`,messageLog}}))}catch(error){throw new output_parsers.dS(`Failed to parse tool arguments from chat model response. Text: "${JSON.stringify(toolCalls)}". ${error}`)}}}getFormatInstructions(){throw new Error("getFormatInstructions not implemented inside OpenAIToolsAgentOutputParser.")}}__webpack_require__("./node_modules/langchain/dist/agents/mrkl/outputParser.js");function tool_calling_formatToToolMessages(steps){return steps.flatMap((({action,observation})=>{if("messageLog"in action&&void 0!==action.messageLog){return action.messageLog.concat(function _createToolMessage(step){return new messages.Cq({tool_call_id:step.action.toolCallId,content:step.observation,additional_kwargs:{name:step.action.tool}})}({action,observation}))}return[new messages.gY(action.log)]}))}function createOpenAIToolsAgent(_x){return _createOpenAIToolsAgent.apply(this,arguments)}function _createOpenAIToolsAgent(){return _createOpenAIToolsAgent=(0,asyncToGenerator.Z)((function*({llm,tools,prompt,streamRunnable}){if(!prompt.inputVariables.includes("agent_scratchpad"))throw new Error(['Prompt must have an input variable named "agent_scratchpad".',`Found ${JSON.stringify(prompt.inputVariables)} instead.`].join("\n"));const modelWithTools=llm.bind({tools:tools.map(function_calling.VE)});return agents_agent.fU.fromRunnables([runnables.sk.assign({agent_scratchpad:input=>tool_calling_formatToToolMessages(input.steps)}),prompt,modelWithTools,new OpenAIToolsAgentOutputParser],{name:"OpenAIToolsAgent",streamRunnable,singleAction:!1})})),_createOpenAIToolsAgent.apply(this,arguments)}},"./node_modules/langchain/dist/agents/agent.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ck:()=>isRunnableAgent,Mj:()=>RunnableSingleActionAgent,Py:()=>Agent,fU:()=>AgentRunnableSequence,zn:()=>RunnableMultiActionAgent});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncIterator.js"),_langchain_core_load_serializable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/load/serializable.js"),_langchain_core_runnables__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/runnables.js");class ParseError extends Error{constructor(msg,output){super(msg),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=output}}class BaseAgent extends _langchain_core_load_serializable__WEBPACK_IMPORTED_MODULE_0__.i{get returnValues(){return["output"]}get allowedTools(){}_agentType(){throw new Error("Not implemented")}returnStoppedResponse(earlyStoppingMethod,_steps,_inputs,_callbackManager){if("force"===earlyStoppingMethod)return Promise.resolve({returnValues:{output:"Agent stopped due to max iterations."},log:""});throw new Error(`Invalid stopping method: ${earlyStoppingMethod}`)}prepareForOutput(_returnValues,_steps){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){return{}}))()}}class BaseSingleActionAgent extends BaseAgent{_agentActionType(){return"single"}}class BaseMultiActionAgent extends BaseAgent{_agentActionType(){return"multi"}}function isRunnableAgent(x){return void 0!==x.runnable}class AgentRunnableSequence extends _langchain_core_runnables__WEBPACK_IMPORTED_MODULE_1__.lW{constructor(){super(...arguments),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"singleAction",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}static fromRunnables([first,...runnables],config){const sequence=_langchain_core_runnables__WEBPACK_IMPORTED_MODULE_1__.lW.from([first,...runnables],config.name);return sequence.singleAction=config.singleAction,sequence.streamRunnable=config.streamRunnable,sequence}static isAgentRunnableSequence(x){return"boolean"==typeof x.singleAction}}class RunnableSingleActionAgent extends BaseSingleActionAgent{get inputKeys(){return[]}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","runnable"]}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"defaultRunName",{enumerable:!0,configurable:!0,writable:!0,value:"RunnableAgent"}),this.runnable=fields.runnable,this.defaultRunName=fields.defaultRunName??this.runnable.name??this.defaultRunName,this.streamRunnable=fields.streamRunnable??this.streamRunnable}plan(steps,inputs,callbackManager,config){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){const combinedInput={...inputs,steps},combinedConfig=(0,_langchain_core_runnables__WEBPACK_IMPORTED_MODULE_1__.q)(config,{callbacks:callbackManager,runName:_this.defaultRunName});if(_this.streamRunnable){const stream=yield _this.runnable.stream(combinedInput,combinedConfig);let finalOutput;var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_3__.Z)(stream);_iteratorAbruptCompletion=!(_step=yield _iterator.next()).done;_iteratorAbruptCompletion=!1){const chunk=_step.value;if(void 0!==finalOutput)throw new Error(["Multiple agent actions/finishes received in streamed agent output.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join("\n"));finalOutput=chunk}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield _iterator.return())}finally{if(_didIteratorError)throw _iteratorError}}if(void 0===finalOutput)throw new Error(["No streaming output received from underlying runnable.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join("\n"));return finalOutput}return _this.runnable.invoke(combinedInput,combinedConfig)}))()}}class RunnableMultiActionAgent extends BaseMultiActionAgent{get inputKeys(){return[]}constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","runnable"]}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultRunName",{enumerable:!0,configurable:!0,writable:!0,value:"RunnableAgent"}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.runnable=fields.runnable,this.stop=fields.stop,this.defaultRunName=fields.defaultRunName??this.runnable.name??this.defaultRunName,this.streamRunnable=fields.streamRunnable??this.streamRunnable}plan(steps,inputs,callbackManager,config){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){const combinedInput={...inputs,steps},combinedConfig=(0,_langchain_core_runnables__WEBPACK_IMPORTED_MODULE_1__.q)(config,{callbacks:callbackManager,runName:_this2.defaultRunName});let output;if(_this2.streamRunnable){const stream=yield _this2.runnable.stream(combinedInput,combinedConfig);let finalOutput;var _iteratorError2,_iteratorAbruptCompletion2=!1,_didIteratorError2=!1;try{for(var _step2,_iterator2=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncIterator_js__WEBPACK_IMPORTED_MODULE_3__.Z)(stream);_iteratorAbruptCompletion2=!(_step2=yield _iterator2.next()).done;_iteratorAbruptCompletion2=!1){const chunk=_step2.value;if(void 0!==finalOutput)throw new Error(["Multiple agent actions/finishes received in streamed agent output.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join("\n"));finalOutput=chunk}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorAbruptCompletion2&&null!=_iterator2.return&&(yield _iterator2.return())}finally{if(_didIteratorError2)throw _iteratorError2}}if(void 0===finalOutput)throw new Error(["No streaming output received from underlying runnable.",'Set "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.'].join("\n"));output=finalOutput}else output=yield _this2.runnable.invoke(combinedInput,combinedConfig);return function isAgentAction(input){return!Array.isArray(input)&&void 0!==input?.tool}(output)?[output]:output}))()}}class Agent extends BaseSingleActionAgent{get allowedTools(){return this._allowedTools}get inputKeys(){return this.llmChain.inputKeys.filter((k=>"agent_scratchpad"!==k))}constructor(input){super(input),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_allowedTools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=input.llmChain,this._allowedTools=input.allowedTools,this.outputParser=input.outputParser}static getDefaultOutputParser(_fields){throw new Error("Not implemented")}static createPrompt(_tools,_fields){throw new Error("Not implemented")}static fromLLMAndTools(_llm,_tools,_args){throw new Error("Not implemented")}static validateTools(_tools){}_stop(){return[`\n${this.observationPrefix()}`]}finishToolName(){return"Final Answer"}constructScratchPad(steps){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){return steps.reduce(((thoughts,{action,observation})=>thoughts+[action.log,`${_this4.observationPrefix()}${observation}`,_this4.llmPrefix()].join("\n")),"")}))()}_plan(steps,inputs,suffix,callbackManager){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){const thoughts=yield _this5.constructScratchPad(steps),newInputs={...inputs,agent_scratchpad:suffix?`${thoughts}${suffix}`:thoughts};0!==_this5._stop().length&&(newInputs.stop=_this5._stop());const output=yield _this5.llmChain.predict(newInputs,callbackManager);if(!_this5.outputParser)throw new Error("Output parser not set");return _this5.outputParser.parse(output,callbackManager)}))()}plan(steps,inputs,callbackManager){return this._plan(steps,inputs,void 0,callbackManager)}returnStoppedResponse(earlyStoppingMethod,steps,inputs,callbackManager){var _this6=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){if("force"===earlyStoppingMethod)return{returnValues:{output:"Agent stopped due to max iterations."},log:""};if("generate"===earlyStoppingMethod)try{const action=yield _this6._plan(steps,inputs,"\n\nI now need to return a final answer based on the previous steps:",callbackManager);return"returnValues"in action?action:{returnValues:{output:action.log},log:action.log}}catch(err){if(!(err instanceof ParseError))throw err;return{returnValues:{output:err.output},log:err.output}}throw new Error(`Invalid stopping method: ${earlyStoppingMethod}`)}))()}static deserialize(data){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){if("zero-shot-react-description"===data._type){const{ZeroShotAgent}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/agents/mrkl/index.js"));return ZeroShotAgent.deserialize(data)}throw new Error("Unknown agent type")}))()}}},"./node_modules/langchain/dist/agents/mrkl/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ZeroShotAgent:()=>ZeroShotAgent});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),prompts=__webpack_require__("./node_modules/@langchain/core/prompts.js"),llm_chain=__webpack_require__("./node_modules/langchain/dist/chains/llm_chain.js"),agent=__webpack_require__("./node_modules/langchain/dist/agents/agent.js");const deserializeHelper=function(){var _ref=(0,asyncToGenerator.Z)((function*(llm,tools,data,fromLLMAndTools,fromConstructor){if(data.load_from_llm_and_tools){if(!llm)throw new Error("Loading from llm and tools, llm must be provided.");if(!tools)throw new Error("Loading from llm and tools, tools must be provided.");return fromLLMAndTools(llm,tools,data)}if(!data.llm_chain)throw new Error("Loading from constructor, llm_chain must be provided.");const llmChain=yield llm_chain.LLMChain.deserialize(data.llm_chain);return fromConstructor({...data,llmChain})}));return function deserializeHelper(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments)}}();var outputParser=__webpack_require__("./node_modules/langchain/dist/agents/mrkl/outputParser.js"),mrkl_prompt=__webpack_require__("./node_modules/langchain/dist/agents/mrkl/prompt.js");class ZeroShotAgent extends agent.Py{static lc_name(){return"ZeroShotAgent"}constructor(input){const outputParser=input?.outputParser??ZeroShotAgent.getDefaultOutputParser();super({...input,outputParser}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]})}_agentType(){return"zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}static getDefaultOutputParser(fields){return new outputParser.S(fields)}static validateTools(tools){const descriptionlessTool=tools.find((tool=>!tool.description));if(descriptionlessTool){const msg=`Got a tool ${descriptionlessTool.name} without a description. This agent requires descriptions for all tools.`;throw new Error(msg)}}static createPrompt(tools,args){const{prefix=mrkl_prompt.Bq,suffix=mrkl_prompt.NS,inputVariables=["input","agent_scratchpad"]}=args??{},toolStrings=tools.map((tool=>`${tool.name}: ${tool.description}`)).join("\n"),toolNames=tools.map((tool=>tool.name)),template=[prefix,toolStrings,(0,prompts.SM)(mrkl_prompt.cQ,"f-string",{tool_names:toolNames}),suffix].join("\n\n");return new prompts.Pf({template,inputVariables})}static fromLLMAndTools(llm,tools,args){ZeroShotAgent.validateTools(tools);const prompt=ZeroShotAgent.createPrompt(tools,args),outputParser=args?.outputParser??ZeroShotAgent.getDefaultOutputParser(),chain=new llm_chain.LLMChain({prompt,llm,callbacks:args?.callbacks??args?.callbackManager});return new ZeroShotAgent({llmChain:chain,allowedTools:tools.map((t=>t.name)),outputParser})}static deserialize(data){return(0,asyncToGenerator.Z)((function*(){const{llm,tools,...rest}=data;return deserializeHelper(llm,tools,rest,((llm,tools,args)=>ZeroShotAgent.fromLLMAndTools(llm,tools,{prefix:args.prefix,suffix:args.suffix,inputVariables:args.input_variables})),(args=>new ZeroShotAgent(args)))}))()}}},"./node_modules/langchain/dist/agents/mrkl/outputParser.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{S:()=>ZeroShotAgentOutputParser});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_langchain_core_output_parsers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/output_parsers.js"),_types_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/langchain/dist/agents/types.js"),_prompt_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/langchain/dist/agents/mrkl/prompt.js");class ZeroShotAgentOutputParser extends _types_js__WEBPACK_IMPORTED_MODULE_1__.h{constructor(fields){super(fields),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]}),Object.defineProperty(this,"finishToolName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.finishToolName=fields?.finishToolName||"Final Answer:"}parse(text){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)((function*(){if(text.includes(_this.finishToolName)){const parts=text.split(_this.finishToolName);return{returnValues:{output:parts[parts.length-1].trim()},log:text}}const match=/Action:([\s\S]*?)(?:\nAction Input:([\s\S]*?))?$/.exec(text);if(!match)throw new _langchain_core_output_parsers__WEBPACK_IMPORTED_MODULE_0__.dS(`Could not parse LLM output: ${text}`);return{tool:match[1].trim(),toolInput:match[2]?match[2].trim().replace(/^("+)(.*?)(\1)$/,"$2"):"",log:text}}))()}getFormatInstructions(){return _prompt_js__WEBPACK_IMPORTED_MODULE_3__.cQ}}},"./node_modules/langchain/dist/agents/mrkl/prompt.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Bq:()=>PREFIX,NS:()=>SUFFIX,cQ:()=>FORMAT_INSTRUCTIONS});const PREFIX="Answer the following questions as best you can. You have access to the following tools:",FORMAT_INSTRUCTIONS="Use the following format in your response:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: the action to take, should be one of [{tool_names}]\nAction Input: the input to the action\nObservation: the result of the action\n... (this Thought/Action/Action Input/Observation can repeat N times)\nThought: I now know the final answer\nFinal Answer: the final answer to the original input question",SUFFIX="Begin!\n\nQuestion: {input}\nThought:{agent_scratchpad}"},"./node_modules/langchain/dist/agents/types.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$:()=>AgentMultiActionOutputParser,h:()=>AgentActionOutputParser});var _langchain_core_output_parsers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/output_parsers.js");class AgentActionOutputParser extends _langchain_core_output_parsers__WEBPACK_IMPORTED_MODULE_0__.bI{}class AgentMultiActionOutputParser extends _langchain_core_output_parsers__WEBPACK_IMPORTED_MODULE_0__.bI{}},"./node_modules/langchain/dist/chains/base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{l:()=>BaseChain});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_langchain_core_outputs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@langchain/core/dist/outputs.js"),_langchain_core_callbacks_manager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/callbacks/manager.js"),_langchain_core_runnables__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@langchain/core/runnables.js"),_langchain_core_language_models_base__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@langchain/core/language_models/base.js");class BaseChain extends _langchain_core_language_models_base__WEBPACK_IMPORTED_MODULE_2__.BD{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(fields,verbose,callbacks){if(1!==arguments.length||"object"!=typeof fields||"saveContext"in fields)super({verbose,callbacks}),this.memory=fields;else{const{memory,callbackManager,...rest}=fields;super({...rest,callbacks:callbackManager??rest.callbacks}),this.memory=memory}}_selectMemoryInputs(values){const valuesForMemory={...values};return"signal"in valuesForMemory&&delete valuesForMemory.signal,"timeout"in valuesForMemory&&delete valuesForMemory.timeout,valuesForMemory}invoke(input,options){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const config=(0,_langchain_core_runnables__WEBPACK_IMPORTED_MODULE_1__.LE)(options),fullValues=yield _this._formatValues(input),callbackManager_=yield _langchain_core_callbacks_manager__WEBPACK_IMPORTED_MODULE_0__.Ye.configure(config?.callbacks,_this.callbacks,config?.tags,_this.tags,config?.metadata,_this.metadata,{verbose:_this.verbose}),runManager=yield callbackManager_?.handleChainStart(_this.toJSON(),fullValues,void 0,void 0,void 0,void 0,config?.runName);let outputValues;try{outputValues=yield fullValues.signal?Promise.race([_this._call(fullValues,runManager,config),new Promise(((_,reject)=>{fullValues.signal?.addEventListener("abort",(()=>{reject(new Error("AbortError"))}))}))]):_this._call(fullValues,runManager,config)}catch(e){throw yield runManager?.handleChainError(e),e}return null!=_this.memory&&(yield _this.memory.saveContext(_this._selectMemoryInputs(input),outputValues)),yield runManager?.handleChainEnd(outputValues),Object.defineProperty(outputValues,_langchain_core_outputs__WEBPACK_IMPORTED_MODULE_4__.WH,{value:runManager?{runId:runManager?.runId}:void 0,configurable:!0}),outputValues}))()}_validateOutputs(outputs){const missingKeys=this.outputKeys.filter((k=>!(k in outputs)));if(missingKeys.length)throw new Error(`Missing output keys: ${missingKeys.join(", ")} from chain ${this._chainType()}`)}prepOutputs(inputs,outputs,returnOnlyOutputs=!1){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){return _this2._validateOutputs(outputs),_this2.memory&&(yield _this2.memory.saveContext(inputs,outputs)),returnOnlyOutputs?outputs:{...inputs,...outputs}}))()}serialize(){throw new Error("Method not implemented.")}run(input,config){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const inputKeys=_this3.inputKeys.filter((k=>!_this3.memory?.memoryKeys.includes(k)??!0));if(!(inputKeys.length<=1))throw new Error(`Chain ${_this3._chainType()} expects multiple inputs, cannot use 'run' `);const values=inputKeys.length?{[inputKeys[0]]:input}:{},returnValues=yield _this3.call(values,config),keys=Object.keys(returnValues);if(1===keys.length)return returnValues[keys[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}))()}_formatValues(values){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const fullValues={...values};if(fullValues.timeout&&!fullValues.signal&&(fullValues.signal=AbortSignal.timeout(fullValues.timeout),delete fullValues.timeout),null!=_this4.memory){const newValues=yield _this4.memory.loadMemoryVariables(_this4._selectMemoryInputs(values));for(const[key,value]of Object.entries(newValues))fullValues[key]=value}return fullValues}))()}call(values,config,tags){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const parsedConfig={tags,...(0,_langchain_core_callbacks_manager__WEBPACK_IMPORTED_MODULE_0__.QH)(config)};return _this5.invoke(values,parsedConfig)}))()}apply(inputs,config){var _this6=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){return Promise.all(inputs.map(function(){var _ref=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(i,idx){return _this6.call(i,config?.[idx])}));return function(_x,_x2){return _ref.apply(this,arguments)}}()))}))()}static deserialize(data,values={}){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){switch(data._type){case"llm_chain":{const{LLMChain}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/llm_chain.js"));return LLMChain.deserialize(data)}case"sequential_chain":{const{SequentialChain}=yield __webpack_require__.e(5289).then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/sequential_chain.js"));return SequentialChain.deserialize(data)}case"simple_sequential_chain":{const{SimpleSequentialChain}=yield __webpack_require__.e(5289).then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/sequential_chain.js"));return SimpleSequentialChain.deserialize(data)}case"stuff_documents_chain":{const{StuffDocumentsChain}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/combine_docs_chain.js"));return StuffDocumentsChain.deserialize(data)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/combine_docs_chain.js"));return MapReduceDocumentsChain.deserialize(data)}case"refine_documents_chain":{const{RefineDocumentsChain}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/combine_docs_chain.js"));return RefineDocumentsChain.deserialize(data)}case"vector_db_qa":{const{VectorDBQAChain}=yield Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/vector_db_qa.js"));return VectorDBQAChain.deserialize(data,values)}case"api_chain":{const{APIChain}=yield __webpack_require__.e(3907).then(__webpack_require__.bind(__webpack_require__,"./node_modules/langchain/dist/chains/api/api_chain.js"));return APIChain.deserialize(data)}default:throw new Error(`Invalid prompt type in config: ${data._type}`)}}))()}}},"./node_modules/langchain/dist/chains/combine_docs_chain.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MapReduceDocumentsChain:()=>MapReduceDocumentsChain,RefineDocumentsChain:()=>RefineDocumentsChain,StuffDocumentsChain:()=>StuffDocumentsChain});var _home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_langchain_core_prompts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@langchain/core/prompts.js"),_base_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/langchain/dist/chains/base.js"),_llm_chain_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/langchain/dist/chains/llm_chain.js");class StuffDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.l{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter((key=>key!==this.documentVariableName))}get outputKeys(){return this.llmChain.outputKeys}constructor(fields){super(fields),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=fields.llmChain,this.documentVariableName=fields.documentVariableName??this.documentVariableName,this.inputKey=fields.inputKey??this.inputKey}_prepInputs(values){if(!(this.inputKey in values))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:docs,...rest}=values,text=docs.map((({pageContent})=>pageContent)).join("\n\n");return{...rest,[this.documentVariableName]:text}}_call(values,runManager){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){return yield _this.llmChain.call(_this._prepInputs(values),runManager?.getChild("combine_documents"))}))()}_chainType(){return"stuff_documents_chain"}static deserialize(data){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){if(!data.llm_chain)throw new Error("Missing llm_chain");return new StuffDocumentsChain({llmChain:yield _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(data.llm_chain)})}))()}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class MapReduceDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.l{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(fields){super(fields),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=fields.llmChain,this.combineDocumentChain=fields.combineDocumentChain,this.documentVariableName=fields.documentVariableName??this.documentVariableName,this.ensureMapStep=fields.ensureMapStep??this.ensureMapStep,this.inputKey=fields.inputKey??this.inputKey,this.maxTokens=fields.maxTokens??this.maxTokens,this.maxIterations=fields.maxIterations??this.maxIterations,this.returnIntermediateSteps=fields.returnIntermediateSteps??!1}_call(values,runManager){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){if(!(_this2.inputKey in values))throw new Error(`Document key ${_this2.inputKey} not found.`);const{[_this2.inputKey]:docs,...rest}=values;let currentDocs=docs,intermediateSteps=[];for(let i=0;i<_this2.maxIterations;i+=1){const inputs=currentDocs.map((d=>({[_this2.documentVariableName]:d.pageContent,...rest})));if(0!==i||!_this2.ensureMapStep){const formatted=yield _this2.combineDocumentChain.llmChain.prompt.format(_this2.combineDocumentChain._prepInputs({[_this2.combineDocumentChain.inputKey]:currentDocs,...rest}));if((yield _this2.combineDocumentChain.llmChain._getNumTokens(formatted))<_this2.maxTokens)break}const results=yield _this2.llmChain.apply(inputs,runManager?Array.from({length:inputs.length},((_,i)=>runManager.getChild(`map_${i+1}`))):void 0),{outputKey}=_this2.llmChain;_this2.returnIntermediateSteps&&(intermediateSteps=intermediateSteps.concat(results.map((r=>r[outputKey])))),currentDocs=results.map((r=>({pageContent:r[outputKey],metadata:{}})))}const newInputs={[_this2.combineDocumentChain.inputKey]:currentDocs,...rest},result=yield _this2.combineDocumentChain.call(newInputs,runManager?.getChild("combine_documents"));return _this2.returnIntermediateSteps?{...result,intermediateSteps}:result}))()}_chainType(){return"map_reduce_documents_chain"}static deserialize(data){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){if(!data.llm_chain)throw new Error("Missing llm_chain");if(!data.combine_document_chain)throw new Error("Missing combine_document_chain");return new MapReduceDocumentsChain({llmChain:yield _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(data.llm_chain),combineDocumentChain:yield StuffDocumentsChain.deserialize(data.combine_document_chain)})}))()}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class RefineDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.l{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new _langchain_core_prompts__WEBPACK_IMPORTED_MODULE_0__.Pf({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter((key=>key!==this.documentVariableName&&key!==this.initialResponseName))}get outputKeys(){return[this.outputKey]}constructor(fields){super(fields),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=fields.llmChain,this.refineLLMChain=fields.refineLLMChain,this.documentVariableName=fields.documentVariableName??this.documentVariableName,this.inputKey=fields.inputKey??this.inputKey,this.outputKey=fields.outputKey??this.outputKey,this.documentPrompt=fields.documentPrompt??this.documentPrompt,this.initialResponseName=fields.initialResponseName??this.initialResponseName}_constructInitialInputs(doc,rest){var _this3=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const baseInfo={page_content:doc.pageContent,...doc.metadata},documentInfo={};_this3.documentPrompt.inputVariables.forEach((value=>{documentInfo[value]=baseInfo[value]}));return{...{[_this3.documentVariableName]:yield _this3.documentPrompt.format({...documentInfo})},...rest}}))()}_constructRefineInputs(doc,res){var _this4=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const baseInfo={page_content:doc.pageContent,...doc.metadata},documentInfo={};_this4.documentPrompt.inputVariables.forEach((value=>{documentInfo[value]=baseInfo[value]}));const baseInputs={[_this4.documentVariableName]:yield _this4.documentPrompt.format({...documentInfo})};return{[_this4.initialResponseName]:res,...baseInputs}}))()}_call(values,runManager){var _this5=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){if(!(_this5.inputKey in values))throw new Error(`Document key ${_this5.inputKey} not found.`);const{[_this5.inputKey]:docs,...rest}=values,currentDocs=docs,initialInputs=yield _this5._constructInitialInputs(currentDocs[0],rest);let res=yield _this5.llmChain.predict({...initialInputs},runManager?.getChild("answer"));const refineSteps=[res];for(let i=1;i<currentDocs.length;i+=1){const inputs={...yield _this5._constructRefineInputs(currentDocs[i],res),...rest};res=yield _this5.refineLLMChain.predict({...inputs},runManager?.getChild("refine")),refineSteps.push(res)}return{[_this5.outputKey]:res}}))()}_chainType(){return"refine_documents_chain"}static deserialize(data){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)((function*(){const SerializedLLMChain=data.llm_chain;if(!SerializedLLMChain)throw new Error("Missing llm_chain");const SerializedRefineDocumentChain=data.refine_llm_chain;if(!SerializedRefineDocumentChain)throw new Error("Missing refine_llm_chain");return new RefineDocumentsChain({llmChain:yield _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(SerializedLLMChain),refineLLMChain:yield _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(SerializedRefineDocumentChain)})}))()}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}},"./node_modules/langchain/dist/chains/llm_chain.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMChain:()=>LLMChain});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),base=__webpack_require__("./node_modules/@langchain/core/language_models/base.js"),prompts=__webpack_require__("./node_modules/@langchain/core/prompts.js"),runnables=__webpack_require__("./node_modules/@langchain/core/runnables.js"),chains_base=__webpack_require__("./node_modules/langchain/dist/chains/base.js"),output_parsers=__webpack_require__("./node_modules/@langchain/core/output_parsers.js");class NoOpOutputParser extends output_parsers.bI{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(text){return Promise.resolve(text)}getFormatInstructions(){return""}}function _getLanguageModel(llmLike){if(function isBaseLanguageModel(llmLike){return"function"==typeof llmLike._llmType}(llmLike))return llmLike;if("bound"in llmLike&&runnables.eq.isRunnable(llmLike.bound))return _getLanguageModel(llmLike.bound);if("runnable"in llmLike&&"fallbacks"in llmLike&&runnables.eq.isRunnable(llmLike.runnable))return _getLanguageModel(llmLike.runnable);if("default"in llmLike&&runnables.eq.isRunnable(llmLike.default))return _getLanguageModel(llmLike.default);throw new Error("Unable to extract BaseLanguageModel from llmLike object.")}class LLMChain extends chains_base.l{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(fields){if(super(fields),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=fields.prompt,this.llm=fields.llm,this.llmKwargs=fields.llmKwargs,this.outputKey=fields.outputKey??this.outputKey,this.outputParser=fields.outputParser??new NoOpOutputParser,this.prompt.outputParser){if(fields.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}getCallKeys(){return"callKeys"in this.llm?this.llm.callKeys:[]}_selectMemoryInputs(values){const valuesForMemory=super._selectMemoryInputs(values),callKeys=this.getCallKeys();for(const key of callKeys)key in values&&delete valuesForMemory[key];return valuesForMemory}_getFinalOutput(generations,promptValue,runManager){var _this=this;return(0,asyncToGenerator.Z)((function*(){let finalCompletion;return finalCompletion=_this.outputParser?yield _this.outputParser.parseResultWithPrompt(generations,promptValue,runManager?.getChild()):generations[0].text,finalCompletion}))()}call(values,config){return super.call(values,config)}_call(values,runManager){var _this2=this;return(0,asyncToGenerator.Z)((function*(){const valuesForPrompt={...values},valuesForLLM={..._this2.llmKwargs},callKeys=_this2.getCallKeys();for(const key of callKeys)key in values&&valuesForLLM&&(valuesForLLM[key]=values[key],delete valuesForPrompt[key]);const promptValue=yield _this2.prompt.formatPromptValue(valuesForPrompt);if("generatePrompt"in _this2.llm){const{generations}=yield _this2.llm.generatePrompt([promptValue],valuesForLLM,runManager?.getChild());return{[_this2.outputKey]:yield _this2._getFinalOutput(generations[0],promptValue,runManager)}}const modelWithParser=_this2.outputParser?_this2.llm.pipe(_this2.outputParser):_this2.llm,response=yield modelWithParser.invoke(promptValue,runManager?.getChild());return{[_this2.outputKey]:response}}))()}predict(values,callbackManager){var _this3=this;return(0,asyncToGenerator.Z)((function*(){return(yield _this3.call(values,callbackManager))[_this3.outputKey]}))()}_chainType(){return"llm"}static deserialize(data){return(0,asyncToGenerator.Z)((function*(){const{llm,prompt}=data;if(!llm)throw new Error("LLMChain must have llm");if(!prompt)throw new Error("LLMChain must have prompt");return new LLMChain({llm:yield base.qV.deserialize(llm),prompt:yield prompts.dy.deserialize(prompt)})}))()}serialize(){const serialize="serialize"in this.llm?this.llm.serialize():void 0;return{_type:`${this._chainType()}_chain`,llm:serialize,prompt:this.prompt.serialize()}}_getNumTokens(text){return _getLanguageModel(this.llm).getNumTokens(text)}}},"./node_modules/langchain/dist/chains/vector_db_qa.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{VectorDBQAChain:()=>VectorDBQAChain});var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),base=__webpack_require__("./node_modules/langchain/dist/chains/base.js"),llm_chain=__webpack_require__("./node_modules/langchain/dist/chains/llm_chain.js"),combine_docs_chain=__webpack_require__("./node_modules/langchain/dist/chains/combine_docs_chain.js"),prompts=__webpack_require__("./node_modules/@langchain/core/prompts.js");__webpack_require__("./node_modules/@langchain/core/dist/load/serializable.js");class BasePromptSelector{getPromptAsync(llm,options){var _this=this;return(0,asyncToGenerator.Z)((function*(){return _this.getPrompt(llm).partial(options?.partialVariables??{})}))()}}class ConditionalPromptSelector extends BasePromptSelector{constructor(default_prompt,conditionals=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=default_prompt,this.conditionals=conditionals}getPrompt(llm){for(const[condition,prompt]of this.conditionals)if(condition(llm))return prompt;return this.defaultPrompt}}function isChatModel(llm){return"base_chat_model"===llm._modelType()}const DEFAULT_QA_PROMPT=new prompts.Pf({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]}),messages=[prompts.ov.fromTemplate("Use the following pieces of context to answer the users question. \nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}"),prompts.kq.fromTemplate("{question}")],QA_PROMPT_SELECTOR=new ConditionalPromptSelector(DEFAULT_QA_PROMPT,[[isChatModel,prompts.ks.fromMessages(messages)]]);function loadQAStuffChain(llm,params={}){const{prompt=QA_PROMPT_SELECTOR.getPrompt(llm),verbose}=params,llmChain=new llm_chain.LLMChain({prompt,llm,verbose});return new combine_docs_chain.StuffDocumentsChain({llmChain,verbose})}class VectorDBQAChain extends base.l{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(fields){super(fields),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=fields.vectorstore,this.combineDocumentsChain=fields.combineDocumentsChain,this.inputKey=fields.inputKey??this.inputKey,this.k=fields.k??this.k,this.returnSourceDocuments=fields.returnSourceDocuments??this.returnSourceDocuments}_call(values,runManager){var _this=this;return(0,asyncToGenerator.Z)((function*(){if(!(_this.inputKey in values))throw new Error(`Question key ${_this.inputKey} not found.`);const question=values[_this.inputKey],docs=yield _this.vectorstore.similaritySearch(question,_this.k,values.filter,runManager?.getChild("vectorstore")),inputs={question,input_documents:docs},result=yield _this.combineDocumentsChain.call(inputs,runManager?.getChild("combine_documents"));return _this.returnSourceDocuments?{...result,sourceDocuments:docs}:result}))()}_chainType(){return"vector_db_qa"}static deserialize(data,values){return(0,asyncToGenerator.Z)((function*(){if(!("vectorstore"in values))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore}=values;if(!data.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new VectorDBQAChain({combineDocumentsChain:yield base.l.deserialize(data.combine_documents_chain),k:data.k,vectorstore})}))()}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(llm,vectorstore,options){return new this({vectorstore,combineDocumentsChain:loadQAStuffChain(llm),...options})}}},"./node_modules/langsmith/singletons/traceable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{dy:()=>getCurrentRunTree,xQ:()=>isTraceableFunction});class MockAsyncLocalStorage{getStore(){}run(_,callback){return callback()}}const AsyncLocalStorageProviderSingleton=new class AsyncLocalStorageProvider{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new MockAsyncLocalStorage}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(instance){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=instance)}},getCurrentRunTree=()=>{const runTree=AsyncLocalStorageProviderSingleton.getInstance().getStore();if(void 0===runTree)throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function."].join("\n"));return runTree};Symbol.for("langsmith:traceable:root");function isTraceableFunction(x){return"function"==typeof x&&"langsmith:traceable"in x}},"./node_modules/nanoid/index.browser.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{x0:()=>nanoid});let nanoid=(size=21)=>crypto.getRandomValues(new Uint8Array(size)).reduce(((id,byte)=>id+=(byte&=63)<36?byte.toString(36):byte<62?(byte-26).toString(36).toUpperCase():byte>62?"-":"_"),"")},"./node_modules/ngx-popperjs/fesm2020/ngx-popperjs.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{X_:()=>NgxPopperjsModule,Mz:()=>NgxPopperjsPlacements,f3:()=>NgxPopperjsTriggers});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");function getWindow(node){if(null==node)return window;if("[object Window]"!==node.toString()){var ownerDocument=node.ownerDocument;return ownerDocument&&ownerDocument.defaultView||window}return node}function isElement(node){return node instanceof getWindow(node).Element||node instanceof Element}function isHTMLElement(node){return node instanceof getWindow(node).HTMLElement||node instanceof HTMLElement}function isShadowRoot(node){return"undefined"!=typeof ShadowRoot&&(node instanceof getWindow(node).ShadowRoot||node instanceof ShadowRoot)}var math_max=Math.max,math_min=Math.min,round=Math.round;function getUAString(){var uaData=navigator.userAgentData;return null!=uaData&&uaData.brands&&Array.isArray(uaData.brands)?uaData.brands.map((function(item){return item.brand+"/"+item.version})).join(" "):navigator.userAgent}function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString())}function getBoundingClientRect(element,includeScale,isFixedStrategy){void 0===includeScale&&(includeScale=!1),void 0===isFixedStrategy&&(isFixedStrategy=!1);var clientRect=element.getBoundingClientRect(),scaleX=1,scaleY=1;includeScale&&isHTMLElement(element)&&(scaleX=element.offsetWidth>0&&round(clientRect.width)/element.offsetWidth||1,scaleY=element.offsetHeight>0&&round(clientRect.height)/element.offsetHeight||1);var visualViewport=(isElement(element)?getWindow(element):window).visualViewport,addVisualOffsets=!isLayoutViewport()&&isFixedStrategy,x=(clientRect.left+(addVisualOffsets&&visualViewport?visualViewport.offsetLeft:0))/scaleX,y=(clientRect.top+(addVisualOffsets&&visualViewport?visualViewport.offsetTop:0))/scaleY,width=clientRect.width/scaleX,height=clientRect.height/scaleY;return{width,height,top:y,right:x+width,bottom:y+height,left:x,x,y}}function getWindowScroll(node){var win=getWindow(node);return{scrollLeft:win.pageXOffset,scrollTop:win.pageYOffset}}function getNodeName(element){return element?(element.nodeName||"").toLowerCase():null}function getDocumentElement(element){return((isElement(element)?element.ownerDocument:element.document)||window.document).documentElement}function getWindowScrollBarX(element){return getBoundingClientRect(getDocumentElement(element)).left+getWindowScroll(element).scrollLeft}function getComputedStyle(element){return getWindow(element).getComputedStyle(element)}function isScrollParent(element){var _getComputedStyle=getComputedStyle(element),overflow=_getComputedStyle.overflow,overflowX=_getComputedStyle.overflowX,overflowY=_getComputedStyle.overflowY;return/auto|scroll|overlay|hidden/.test(overflow+overflowY+overflowX)}function getCompositeRect(elementOrVirtualElement,offsetParent,isFixed){void 0===isFixed&&(isFixed=!1);var isOffsetParentAnElement=isHTMLElement(offsetParent),offsetParentIsScaled=isHTMLElement(offsetParent)&&function isElementScaled(element){var rect=element.getBoundingClientRect(),scaleX=round(rect.width)/element.offsetWidth||1,scaleY=round(rect.height)/element.offsetHeight||1;return 1!==scaleX||1!==scaleY}(offsetParent),documentElement=getDocumentElement(offsetParent),rect=getBoundingClientRect(elementOrVirtualElement,offsetParentIsScaled,isFixed),scroll={scrollLeft:0,scrollTop:0},offsets={x:0,y:0};return(isOffsetParentAnElement||!isOffsetParentAnElement&&!isFixed)&&(("body"!==getNodeName(offsetParent)||isScrollParent(documentElement))&&(scroll=function getNodeScroll(node){return node!==getWindow(node)&&isHTMLElement(node)?function getHTMLElementScroll(element){return{scrollLeft:element.scrollLeft,scrollTop:element.scrollTop}}(node):getWindowScroll(node)}(offsetParent)),isHTMLElement(offsetParent)?((offsets=getBoundingClientRect(offsetParent,!0)).x+=offsetParent.clientLeft,offsets.y+=offsetParent.clientTop):documentElement&&(offsets.x=getWindowScrollBarX(documentElement))),{x:rect.left+scroll.scrollLeft-offsets.x,y:rect.top+scroll.scrollTop-offsets.y,width:rect.width,height:rect.height}}function getLayoutRect(element){var clientRect=getBoundingClientRect(element),width=element.offsetWidth,height=element.offsetHeight;return Math.abs(clientRect.width-width)<=1&&(width=clientRect.width),Math.abs(clientRect.height-height)<=1&&(height=clientRect.height),{x:element.offsetLeft,y:element.offsetTop,width,height}}function getParentNode(element){return"html"===getNodeName(element)?element:element.assignedSlot||element.parentNode||(isShadowRoot(element)?element.host:null)||getDocumentElement(element)}function getScrollParent(node){return["html","body","#document"].indexOf(getNodeName(node))>=0?node.ownerDocument.body:isHTMLElement(node)&&isScrollParent(node)?node:getScrollParent(getParentNode(node))}function listScrollParents(element,list){var _element$ownerDocumen;void 0===list&&(list=[]);var scrollParent=getScrollParent(element),isBody=scrollParent===(null==(_element$ownerDocumen=element.ownerDocument)?void 0:_element$ownerDocumen.body),win=getWindow(scrollParent),target=isBody?[win].concat(win.visualViewport||[],isScrollParent(scrollParent)?scrollParent:[]):scrollParent,updatedList=list.concat(target);return isBody?updatedList:updatedList.concat(listScrollParents(getParentNode(target)))}function isTableElement(element){return["table","td","th"].indexOf(getNodeName(element))>=0}function getTrueOffsetParent(element){return isHTMLElement(element)&&"fixed"!==getComputedStyle(element).position?element.offsetParent:null}function getOffsetParent(element){for(var window=getWindow(element),offsetParent=getTrueOffsetParent(element);offsetParent&&isTableElement(offsetParent)&&"static"===getComputedStyle(offsetParent).position;)offsetParent=getTrueOffsetParent(offsetParent);return offsetParent&&("html"===getNodeName(offsetParent)||"body"===getNodeName(offsetParent)&&"static"===getComputedStyle(offsetParent).position)?window:offsetParent||function getContainingBlock(element){var isFirefox=/firefox/i.test(getUAString());if(/Trident/i.test(getUAString())&&isHTMLElement(element)&&"fixed"===getComputedStyle(element).position)return null;var currentNode=getParentNode(element);for(isShadowRoot(currentNode)&&(currentNode=currentNode.host);isHTMLElement(currentNode)&&["html","body"].indexOf(getNodeName(currentNode))<0;){var css=getComputedStyle(currentNode);if("none"!==css.transform||"none"!==css.perspective||"paint"===css.contain||-1!==["transform","perspective"].indexOf(css.willChange)||isFirefox&&"filter"===css.willChange||isFirefox&&css.filter&&"none"!==css.filter)return currentNode;currentNode=currentNode.parentNode}return null}(element)||window}var enums_top="top",bottom="bottom",right="right",left="left",auto="auto",basePlacements=[enums_top,bottom,right,left],start="start",end="end",clippingParents="clippingParents",viewport="viewport",popper="popper",reference="reference",variationPlacements=basePlacements.reduce((function(acc,placement){return acc.concat([placement+"-"+start,placement+"-"+end])}),[]),enums_placements=[].concat(basePlacements,[auto]).reduce((function(acc,placement){return acc.concat([placement,placement+"-"+start,placement+"-"+end])}),[]),modifierPhases=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function order(modifiers){var map=new Map,visited=new Set,result=[];function sort(modifier){visited.add(modifier.name),[].concat(modifier.requires||[],modifier.requiresIfExists||[]).forEach((function(dep){if(!visited.has(dep)){var depModifier=map.get(dep);depModifier&&sort(depModifier)}})),result.push(modifier)}return modifiers.forEach((function(modifier){map.set(modifier.name,modifier)})),modifiers.forEach((function(modifier){visited.has(modifier.name)||sort(modifier)})),result}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return!args.some((function(element){return!(element&&"function"==typeof element.getBoundingClientRect)}))}function popperGenerator(generatorOptions){void 0===generatorOptions&&(generatorOptions={});var _generatorOptions=generatorOptions,_generatorOptions$def=_generatorOptions.defaultModifiers,defaultModifiers=void 0===_generatorOptions$def?[]:_generatorOptions$def,_generatorOptions$def2=_generatorOptions.defaultOptions,defaultOptions=void 0===_generatorOptions$def2?DEFAULT_OPTIONS:_generatorOptions$def2;return function createPopper(reference,popper,options){void 0===options&&(options=defaultOptions);var fn,pending,state={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,defaultOptions),modifiersData:{},elements:{reference,popper},attributes:{},styles:{}},effectCleanupFns=[],isDestroyed=!1,instance={state,setOptions:function setOptions(setOptionsAction){var options="function"==typeof setOptionsAction?setOptionsAction(state.options):setOptionsAction;cleanupModifierEffects(),state.options=Object.assign({},defaultOptions,state.options,options),state.scrollParents={reference:isElement(reference)?listScrollParents(reference):reference.contextElement?listScrollParents(reference.contextElement):[],popper:listScrollParents(popper)};var orderedModifiers=function orderModifiers(modifiers){var orderedModifiers=order(modifiers);return modifierPhases.reduce((function(acc,phase){return acc.concat(orderedModifiers.filter((function(modifier){return modifier.phase===phase})))}),[])}(function mergeByName(modifiers){var merged=modifiers.reduce((function(merged,current){var existing=merged[current.name];return merged[current.name]=existing?Object.assign({},existing,current,{options:Object.assign({},existing.options,current.options),data:Object.assign({},existing.data,current.data)}):current,merged}),{});return Object.keys(merged).map((function(key){return merged[key]}))}([].concat(defaultModifiers,state.options.modifiers)));return state.orderedModifiers=orderedModifiers.filter((function(m){return m.enabled})),function runModifierEffects(){state.orderedModifiers.forEach((function(_ref){var name=_ref.name,_ref$options=_ref.options,options=void 0===_ref$options?{}:_ref$options,effect=_ref.effect;if("function"==typeof effect){var cleanupFn=effect({state,name,instance,options}),noopFn=function noopFn(){};effectCleanupFns.push(cleanupFn||noopFn)}}))}(),instance.update()},forceUpdate:function forceUpdate(){if(!isDestroyed){var _state$elements=state.elements,reference=_state$elements.reference,popper=_state$elements.popper;if(areValidElements(reference,popper)){state.rects={reference:getCompositeRect(reference,getOffsetParent(popper),"fixed"===state.options.strategy),popper:getLayoutRect(popper)},state.reset=!1,state.placement=state.options.placement,state.orderedModifiers.forEach((function(modifier){return state.modifiersData[modifier.name]=Object.assign({},modifier.data)}));for(var index=0;index<state.orderedModifiers.length;index++)if(!0!==state.reset){var _state$orderedModifie=state.orderedModifiers[index],fn=_state$orderedModifie.fn,_state$orderedModifie2=_state$orderedModifie.options,_options=void 0===_state$orderedModifie2?{}:_state$orderedModifie2,name=_state$orderedModifie.name;"function"==typeof fn&&(state=fn({state,options:_options,name,instance})||state)}else state.reset=!1,index=-1}}},update:(fn=function(){return new Promise((function(resolve){instance.forceUpdate(),resolve(state)}))},function(){return pending||(pending=new Promise((function(resolve){Promise.resolve().then((function(){pending=void 0,resolve(fn())}))}))),pending}),destroy:function destroy(){cleanupModifierEffects(),isDestroyed=!0}};if(!areValidElements(reference,popper))return instance;function cleanupModifierEffects(){effectCleanupFns.forEach((function(fn){return fn()})),effectCleanupFns=[]}return instance.setOptions(options).then((function(state){!isDestroyed&&options.onFirstUpdate&&options.onFirstUpdate(state)})),instance}}var passive={passive:!0};function getBasePlacement(placement){return placement.split("-")[0]}function getVariation(placement){return placement.split("-")[1]}function getMainAxisFromPlacement(placement){return["top","bottom"].indexOf(placement)>=0?"x":"y"}function computeOffsets(_ref){var offsets,reference=_ref.reference,element=_ref.element,placement=_ref.placement,basePlacement=placement?getBasePlacement(placement):null,variation=placement?getVariation(placement):null,commonX=reference.x+reference.width/2-element.width/2,commonY=reference.y+reference.height/2-element.height/2;switch(basePlacement){case enums_top:offsets={x:commonX,y:reference.y-element.height};break;case bottom:offsets={x:commonX,y:reference.y+reference.height};break;case right:offsets={x:reference.x+reference.width,y:commonY};break;case left:offsets={x:reference.x-element.width,y:commonY};break;default:offsets={x:reference.x,y:reference.y}}var mainAxis=basePlacement?getMainAxisFromPlacement(basePlacement):null;if(null!=mainAxis){var len="y"===mainAxis?"height":"width";switch(variation){case start:offsets[mainAxis]=offsets[mainAxis]-(reference[len]/2-element[len]/2);break;case end:offsets[mainAxis]=offsets[mainAxis]+(reference[len]/2-element[len]/2)}}return offsets}var unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mapToStyles(_ref2){var _Object$assign2,popper=_ref2.popper,popperRect=_ref2.popperRect,placement=_ref2.placement,variation=_ref2.variation,offsets=_ref2.offsets,position=_ref2.position,gpuAcceleration=_ref2.gpuAcceleration,adaptive=_ref2.adaptive,roundOffsets=_ref2.roundOffsets,isFixed=_ref2.isFixed,_offsets$x=offsets.x,x=void 0===_offsets$x?0:_offsets$x,_offsets$y=offsets.y,y=void 0===_offsets$y?0:_offsets$y,_ref3="function"==typeof roundOffsets?roundOffsets({x,y}):{x,y};x=_ref3.x,y=_ref3.y;var hasX=offsets.hasOwnProperty("x"),hasY=offsets.hasOwnProperty("y"),sideX=left,sideY=enums_top,win=window;if(adaptive){var offsetParent=getOffsetParent(popper),heightProp="clientHeight",widthProp="clientWidth";if(offsetParent===getWindow(popper)&&"static"!==getComputedStyle(offsetParent=getDocumentElement(popper)).position&&"absolute"===position&&(heightProp="scrollHeight",widthProp="scrollWidth"),placement===enums_top||(placement===left||placement===right)&&variation===end)sideY=bottom,y-=(isFixed&&offsetParent===win&&win.visualViewport?win.visualViewport.height:offsetParent[heightProp])-popperRect.height,y*=gpuAcceleration?1:-1;if(placement===left||(placement===enums_top||placement===bottom)&&variation===end)sideX=right,x-=(isFixed&&offsetParent===win&&win.visualViewport?win.visualViewport.width:offsetParent[widthProp])-popperRect.width,x*=gpuAcceleration?1:-1}var _Object$assign,commonStyles=Object.assign({position},adaptive&&unsetSides),_ref4=!0===roundOffsets?function roundOffsetsByDPR(_ref,win){var x=_ref.x,y=_ref.y,dpr=win.devicePixelRatio||1;return{x:round(x*dpr)/dpr||0,y:round(y*dpr)/dpr||0}}({x,y},getWindow(popper)):{x,y};return x=_ref4.x,y=_ref4.y,gpuAcceleration?Object.assign({},commonStyles,((_Object$assign={})[sideY]=hasY?"0":"",_Object$assign[sideX]=hasX?"0":"",_Object$assign.transform=(win.devicePixelRatio||1)<=1?"translate("+x+"px, "+y+"px)":"translate3d("+x+"px, "+y+"px, 0)",_Object$assign)):Object.assign({},commonStyles,((_Object$assign2={})[sideY]=hasY?y+"px":"",_Object$assign2[sideX]=hasX?x+"px":"",_Object$assign2.transform="",_Object$assign2))}const modifiers_offset={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function offset(_ref2){var state=_ref2.state,options=_ref2.options,name=_ref2.name,_options$offset=options.offset,offset=void 0===_options$offset?[0,0]:_options$offset,data=enums_placements.reduce((function(acc,placement){return acc[placement]=function distanceAndSkiddingToXY(placement,rects,offset){var basePlacement=getBasePlacement(placement),invertDistance=[left,enums_top].indexOf(basePlacement)>=0?-1:1,_ref="function"==typeof offset?offset(Object.assign({},rects,{placement})):offset,skidding=_ref[0],distance=_ref[1];return skidding=skidding||0,distance=(distance||0)*invertDistance,[left,right].indexOf(basePlacement)>=0?{x:distance,y:skidding}:{x:skidding,y:distance}}(placement,state.rects,offset),acc}),{}),_data$state$placement=data[state.placement],x=_data$state$placement.x,y=_data$state$placement.y;null!=state.modifiersData.popperOffsets&&(state.modifiersData.popperOffsets.x+=x,state.modifiersData.popperOffsets.y+=y),state.modifiersData[name]=data}};var hash={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(placement){return placement.replace(/left|right|bottom|top/g,(function(matched){return hash[matched]}))}var getOppositeVariationPlacement_hash={start:"end",end:"start"};function getOppositeVariationPlacement(placement){return placement.replace(/start|end/g,(function(matched){return getOppositeVariationPlacement_hash[matched]}))}function contains(parent,child){var rootNode=child.getRootNode&&child.getRootNode();if(parent.contains(child))return!0;if(rootNode&&isShadowRoot(rootNode)){var next=child;do{if(next&&parent.isSameNode(next))return!0;next=next.parentNode||next.host}while(next)}return!1}function rectToClientRect(rect){return Object.assign({},rect,{left:rect.x,top:rect.y,right:rect.x+rect.width,bottom:rect.y+rect.height})}function getClientRectFromMixedType(element,clippingParent,strategy){return clippingParent===viewport?rectToClientRect(function getViewportRect(element,strategy){var win=getWindow(element),html=getDocumentElement(element),visualViewport=win.visualViewport,width=html.clientWidth,height=html.clientHeight,x=0,y=0;if(visualViewport){width=visualViewport.width,height=visualViewport.height;var layoutViewport=isLayoutViewport();(layoutViewport||!layoutViewport&&"fixed"===strategy)&&(x=visualViewport.offsetLeft,y=visualViewport.offsetTop)}return{width,height,x:x+getWindowScrollBarX(element),y}}(element,strategy)):isElement(clippingParent)?function getInnerBoundingClientRect(element,strategy){var rect=getBoundingClientRect(element,!1,"fixed"===strategy);return rect.top=rect.top+element.clientTop,rect.left=rect.left+element.clientLeft,rect.bottom=rect.top+element.clientHeight,rect.right=rect.left+element.clientWidth,rect.width=element.clientWidth,rect.height=element.clientHeight,rect.x=rect.left,rect.y=rect.top,rect}(clippingParent,strategy):rectToClientRect(function getDocumentRect(element){var _element$ownerDocumen,html=getDocumentElement(element),winScroll=getWindowScroll(element),body=null==(_element$ownerDocumen=element.ownerDocument)?void 0:_element$ownerDocumen.body,width=math_max(html.scrollWidth,html.clientWidth,body?body.scrollWidth:0,body?body.clientWidth:0),height=math_max(html.scrollHeight,html.clientHeight,body?body.scrollHeight:0,body?body.clientHeight:0),x=-winScroll.scrollLeft+getWindowScrollBarX(element),y=-winScroll.scrollTop;return"rtl"===getComputedStyle(body||html).direction&&(x+=math_max(html.clientWidth,body?body.clientWidth:0)-width),{width,height,x,y}}(getDocumentElement(element)))}function getClippingRect(element,boundary,rootBoundary,strategy){var mainClippingParents="clippingParents"===boundary?function getClippingParents(element){var clippingParents=listScrollParents(getParentNode(element)),clipperElement=["absolute","fixed"].indexOf(getComputedStyle(element).position)>=0&&isHTMLElement(element)?getOffsetParent(element):element;return isElement(clipperElement)?clippingParents.filter((function(clippingParent){return isElement(clippingParent)&&contains(clippingParent,clipperElement)&&"body"!==getNodeName(clippingParent)})):[]}(element):[].concat(boundary),clippingParents=[].concat(mainClippingParents,[rootBoundary]),firstClippingParent=clippingParents[0],clippingRect=clippingParents.reduce((function(accRect,clippingParent){var rect=getClientRectFromMixedType(element,clippingParent,strategy);return accRect.top=math_max(rect.top,accRect.top),accRect.right=math_min(rect.right,accRect.right),accRect.bottom=math_min(rect.bottom,accRect.bottom),accRect.left=math_max(rect.left,accRect.left),accRect}),getClientRectFromMixedType(element,firstClippingParent,strategy));return clippingRect.width=clippingRect.right-clippingRect.left,clippingRect.height=clippingRect.bottom-clippingRect.top,clippingRect.x=clippingRect.left,clippingRect.y=clippingRect.top,clippingRect}function mergePaddingObject(paddingObject){return Object.assign({},{top:0,right:0,bottom:0,left:0},paddingObject)}function expandToHashMap(value,keys){return keys.reduce((function(hashMap,key){return hashMap[key]=value,hashMap}),{})}function detectOverflow(state,options){void 0===options&&(options={});var _options=options,_options$placement=_options.placement,placement=void 0===_options$placement?state.placement:_options$placement,_options$strategy=_options.strategy,strategy=void 0===_options$strategy?state.strategy:_options$strategy,_options$boundary=_options.boundary,boundary=void 0===_options$boundary?clippingParents:_options$boundary,_options$rootBoundary=_options.rootBoundary,rootBoundary=void 0===_options$rootBoundary?viewport:_options$rootBoundary,_options$elementConte=_options.elementContext,elementContext=void 0===_options$elementConte?popper:_options$elementConte,_options$altBoundary=_options.altBoundary,altBoundary=void 0!==_options$altBoundary&&_options$altBoundary,_options$padding=_options.padding,padding=void 0===_options$padding?0:_options$padding,paddingObject=mergePaddingObject("number"!=typeof padding?padding:expandToHashMap(padding,basePlacements)),altContext=elementContext===popper?reference:popper,popperRect=state.rects.popper,element=state.elements[altBoundary?altContext:elementContext],clippingClientRect=getClippingRect(isElement(element)?element:element.contextElement||getDocumentElement(state.elements.popper),boundary,rootBoundary,strategy),referenceClientRect=getBoundingClientRect(state.elements.reference),popperOffsets=computeOffsets({reference:referenceClientRect,element:popperRect,strategy:"absolute",placement}),popperClientRect=rectToClientRect(Object.assign({},popperRect,popperOffsets)),elementClientRect=elementContext===popper?popperClientRect:referenceClientRect,overflowOffsets={top:clippingClientRect.top-elementClientRect.top+paddingObject.top,bottom:elementClientRect.bottom-clippingClientRect.bottom+paddingObject.bottom,left:clippingClientRect.left-elementClientRect.left+paddingObject.left,right:elementClientRect.right-clippingClientRect.right+paddingObject.right},offsetData=state.modifiersData.offset;if(elementContext===popper&&offsetData){var offset=offsetData[placement];Object.keys(overflowOffsets).forEach((function(key){var multiply=[right,bottom].indexOf(key)>=0?1:-1,axis=[enums_top,bottom].indexOf(key)>=0?"y":"x";overflowOffsets[key]+=offset[axis]*multiply}))}return overflowOffsets}function within(min,value,max){return math_max(min,math_min(value,max))}const modifiers_preventOverflow={name:"preventOverflow",enabled:!0,phase:"main",fn:function preventOverflow(_ref){var state=_ref.state,options=_ref.options,name=_ref.name,_options$mainAxis=options.mainAxis,checkMainAxis=void 0===_options$mainAxis||_options$mainAxis,_options$altAxis=options.altAxis,checkAltAxis=void 0!==_options$altAxis&&_options$altAxis,boundary=options.boundary,rootBoundary=options.rootBoundary,altBoundary=options.altBoundary,padding=options.padding,_options$tether=options.tether,tether=void 0===_options$tether||_options$tether,_options$tetherOffset=options.tetherOffset,tetherOffset=void 0===_options$tetherOffset?0:_options$tetherOffset,overflow=detectOverflow(state,{boundary,rootBoundary,padding,altBoundary}),basePlacement=getBasePlacement(state.placement),variation=getVariation(state.placement),isBasePlacement=!variation,mainAxis=getMainAxisFromPlacement(basePlacement),altAxis=function getAltAxis(axis){return"x"===axis?"y":"x"}(mainAxis),popperOffsets=state.modifiersData.popperOffsets,referenceRect=state.rects.reference,popperRect=state.rects.popper,tetherOffsetValue="function"==typeof tetherOffset?tetherOffset(Object.assign({},state.rects,{placement:state.placement})):tetherOffset,normalizedTetherOffsetValue="number"==typeof tetherOffsetValue?{mainAxis:tetherOffsetValue,altAxis:tetherOffsetValue}:Object.assign({mainAxis:0,altAxis:0},tetherOffsetValue),offsetModifierState=state.modifiersData.offset?state.modifiersData.offset[state.placement]:null,data={x:0,y:0};if(popperOffsets){if(checkMainAxis){var _offsetModifierState$,mainSide="y"===mainAxis?enums_top:left,altSide="y"===mainAxis?bottom:right,len="y"===mainAxis?"height":"width",offset=popperOffsets[mainAxis],min=offset+overflow[mainSide],max=offset-overflow[altSide],additive=tether?-popperRect[len]/2:0,minLen=variation===start?referenceRect[len]:popperRect[len],maxLen=variation===start?-popperRect[len]:-referenceRect[len],arrowElement=state.elements.arrow,arrowRect=tether&&arrowElement?getLayoutRect(arrowElement):{width:0,height:0},arrowPaddingObject=state.modifiersData["arrow#persistent"]?state.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},arrowPaddingMin=arrowPaddingObject[mainSide],arrowPaddingMax=arrowPaddingObject[altSide],arrowLen=within(0,referenceRect[len],arrowRect[len]),minOffset=isBasePlacement?referenceRect[len]/2-additive-arrowLen-arrowPaddingMin-normalizedTetherOffsetValue.mainAxis:minLen-arrowLen-arrowPaddingMin-normalizedTetherOffsetValue.mainAxis,maxOffset=isBasePlacement?-referenceRect[len]/2+additive+arrowLen+arrowPaddingMax+normalizedTetherOffsetValue.mainAxis:maxLen+arrowLen+arrowPaddingMax+normalizedTetherOffsetValue.mainAxis,arrowOffsetParent=state.elements.arrow&&getOffsetParent(state.elements.arrow),clientOffset=arrowOffsetParent?"y"===mainAxis?arrowOffsetParent.clientTop||0:arrowOffsetParent.clientLeft||0:0,offsetModifierValue=null!=(_offsetModifierState$=null==offsetModifierState?void 0:offsetModifierState[mainAxis])?_offsetModifierState$:0,tetherMax=offset+maxOffset-offsetModifierValue,preventedOffset=within(tether?math_min(min,offset+minOffset-offsetModifierValue-clientOffset):min,offset,tether?math_max(max,tetherMax):max);popperOffsets[mainAxis]=preventedOffset,data[mainAxis]=preventedOffset-offset}if(checkAltAxis){var _offsetModifierState$2,_mainSide="x"===mainAxis?enums_top:left,_altSide="x"===mainAxis?bottom:right,_offset=popperOffsets[altAxis],_len="y"===altAxis?"height":"width",_min=_offset+overflow[_mainSide],_max=_offset-overflow[_altSide],isOriginSide=-1!==[enums_top,left].indexOf(basePlacement),_offsetModifierValue=null!=(_offsetModifierState$2=null==offsetModifierState?void 0:offsetModifierState[altAxis])?_offsetModifierState$2:0,_tetherMin=isOriginSide?_min:_offset-referenceRect[_len]-popperRect[_len]-_offsetModifierValue+normalizedTetherOffsetValue.altAxis,_tetherMax=isOriginSide?_offset+referenceRect[_len]+popperRect[_len]-_offsetModifierValue-normalizedTetherOffsetValue.altAxis:_max,_preventedOffset=tether&&isOriginSide?function withinMaxClamp(min,value,max){var v=within(min,value,max);return v>max?max:v}(_tetherMin,_offset,_tetherMax):within(tether?_tetherMin:_min,_offset,tether?_tetherMax:_max);popperOffsets[altAxis]=_preventedOffset,data[altAxis]=_preventedOffset-_offset}state.modifiersData[name]=data}},requiresIfExists:["offset"]};const modifiers_arrow={name:"arrow",enabled:!0,phase:"main",fn:function arrow(_ref){var _state$modifiersData$,state=_ref.state,name=_ref.name,options=_ref.options,arrowElement=state.elements.arrow,popperOffsets=state.modifiersData.popperOffsets,basePlacement=getBasePlacement(state.placement),axis=getMainAxisFromPlacement(basePlacement),len=[left,right].indexOf(basePlacement)>=0?"height":"width";if(arrowElement&&popperOffsets){var paddingObject=function toPaddingObject(padding,state){return mergePaddingObject("number"!=typeof(padding="function"==typeof padding?padding(Object.assign({},state.rects,{placement:state.placement})):padding)?padding:expandToHashMap(padding,basePlacements))}(options.padding,state),arrowRect=getLayoutRect(arrowElement),minProp="y"===axis?enums_top:left,maxProp="y"===axis?bottom:right,endDiff=state.rects.reference[len]+state.rects.reference[axis]-popperOffsets[axis]-state.rects.popper[len],startDiff=popperOffsets[axis]-state.rects.reference[axis],arrowOffsetParent=getOffsetParent(arrowElement),clientSize=arrowOffsetParent?"y"===axis?arrowOffsetParent.clientHeight||0:arrowOffsetParent.clientWidth||0:0,centerToReference=endDiff/2-startDiff/2,min=paddingObject[minProp],max=clientSize-arrowRect[len]-paddingObject[maxProp],center=clientSize/2-arrowRect[len]/2+centerToReference,offset=within(min,center,max),axisProp=axis;state.modifiersData[name]=((_state$modifiersData$={})[axisProp]=offset,_state$modifiersData$.centerOffset=offset-center,_state$modifiersData$)}},effect:function arrow_effect(_ref2){var state=_ref2.state,_options$element=_ref2.options.element,arrowElement=void 0===_options$element?"[data-popper-arrow]":_options$element;null!=arrowElement&&("string"!=typeof arrowElement||(arrowElement=state.elements.popper.querySelector(arrowElement)))&&contains(state.elements.popper,arrowElement)&&(state.elements.arrow=arrowElement)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function getSideOffsets(overflow,rect,preventedOffsets){return void 0===preventedOffsets&&(preventedOffsets={x:0,y:0}),{top:overflow.top-rect.height-preventedOffsets.y,right:overflow.right-rect.width+preventedOffsets.x,bottom:overflow.bottom-rect.height+preventedOffsets.y,left:overflow.left-rect.width-preventedOffsets.x}}function isAnySideFullyClipped(overflow){return[enums_top,right,bottom,left].some((function(side){return overflow[side]>=0}))}var popper_createPopper=popperGenerator({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function fn(){},effect:function effect(_ref){var state=_ref.state,instance=_ref.instance,options=_ref.options,_options$scroll=options.scroll,scroll=void 0===_options$scroll||_options$scroll,_options$resize=options.resize,resize=void 0===_options$resize||_options$resize,window=getWindow(state.elements.popper),scrollParents=[].concat(state.scrollParents.reference,state.scrollParents.popper);return scroll&&scrollParents.forEach((function(scrollParent){scrollParent.addEventListener("scroll",instance.update,passive)})),resize&&window.addEventListener("resize",instance.update,passive),function(){scroll&&scrollParents.forEach((function(scrollParent){scrollParent.removeEventListener("scroll",instance.update,passive)})),resize&&window.removeEventListener("resize",instance.update,passive)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function popperOffsets(_ref){var state=_ref.state,name=_ref.name;state.modifiersData[name]=computeOffsets({reference:state.rects.reference,element:state.rects.popper,strategy:"absolute",placement:state.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function computeStyles(_ref5){var state=_ref5.state,options=_ref5.options,_options$gpuAccelerat=options.gpuAcceleration,gpuAcceleration=void 0===_options$gpuAccelerat||_options$gpuAccelerat,_options$adaptive=options.adaptive,adaptive=void 0===_options$adaptive||_options$adaptive,_options$roundOffsets=options.roundOffsets,roundOffsets=void 0===_options$roundOffsets||_options$roundOffsets,commonStyles={placement:getBasePlacement(state.placement),variation:getVariation(state.placement),popper:state.elements.popper,popperRect:state.rects.popper,gpuAcceleration,isFixed:"fixed"===state.options.strategy};null!=state.modifiersData.popperOffsets&&(state.styles.popper=Object.assign({},state.styles.popper,mapToStyles(Object.assign({},commonStyles,{offsets:state.modifiersData.popperOffsets,position:state.options.strategy,adaptive,roundOffsets})))),null!=state.modifiersData.arrow&&(state.styles.arrow=Object.assign({},state.styles.arrow,mapToStyles(Object.assign({},commonStyles,{offsets:state.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets})))),state.attributes.popper=Object.assign({},state.attributes.popper,{"data-popper-placement":state.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function applyStyles(_ref){var state=_ref.state;Object.keys(state.elements).forEach((function(name){var style=state.styles[name]||{},attributes=state.attributes[name]||{},element=state.elements[name];isHTMLElement(element)&&getNodeName(element)&&(Object.assign(element.style,style),Object.keys(attributes).forEach((function(name){var value=attributes[name];!1===value?element.removeAttribute(name):element.setAttribute(name,!0===value?"":value)})))}))},effect:function applyStyles_effect(_ref2){var state=_ref2.state,initialStyles={popper:{position:state.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(state.elements.popper.style,initialStyles.popper),state.styles=initialStyles,state.elements.arrow&&Object.assign(state.elements.arrow.style,initialStyles.arrow),function(){Object.keys(state.elements).forEach((function(name){var element=state.elements[name],attributes=state.attributes[name]||{},style=Object.keys(state.styles.hasOwnProperty(name)?state.styles[name]:initialStyles[name]).reduce((function(style,property){return style[property]="",style}),{});isHTMLElement(element)&&getNodeName(element)&&(Object.assign(element.style,style),Object.keys(attributes).forEach((function(attribute){element.removeAttribute(attribute)})))}))}},requires:["computeStyles"]},modifiers_offset,{name:"flip",enabled:!0,phase:"main",fn:function flip(_ref){var state=_ref.state,options=_ref.options,name=_ref.name;if(!state.modifiersData[name]._skip){for(var _options$mainAxis=options.mainAxis,checkMainAxis=void 0===_options$mainAxis||_options$mainAxis,_options$altAxis=options.altAxis,checkAltAxis=void 0===_options$altAxis||_options$altAxis,specifiedFallbackPlacements=options.fallbackPlacements,padding=options.padding,boundary=options.boundary,rootBoundary=options.rootBoundary,altBoundary=options.altBoundary,_options$flipVariatio=options.flipVariations,flipVariations=void 0===_options$flipVariatio||_options$flipVariatio,allowedAutoPlacements=options.allowedAutoPlacements,preferredPlacement=state.options.placement,basePlacement=getBasePlacement(preferredPlacement),fallbackPlacements=specifiedFallbackPlacements||(basePlacement===preferredPlacement||!flipVariations?[getOppositePlacement(preferredPlacement)]:function getExpandedFallbackPlacements(placement){if(getBasePlacement(placement)===auto)return[];var oppositePlacement=getOppositePlacement(placement);return[getOppositeVariationPlacement(placement),oppositePlacement,getOppositeVariationPlacement(oppositePlacement)]}(preferredPlacement)),placements=[preferredPlacement].concat(fallbackPlacements).reduce((function(acc,placement){return acc.concat(getBasePlacement(placement)===auto?function computeAutoPlacement(state,options){void 0===options&&(options={});var _options=options,placement=_options.placement,boundary=_options.boundary,rootBoundary=_options.rootBoundary,padding=_options.padding,flipVariations=_options.flipVariations,_options$allowedAutoP=_options.allowedAutoPlacements,allowedAutoPlacements=void 0===_options$allowedAutoP?enums_placements:_options$allowedAutoP,variation=getVariation(placement),placements=variation?flipVariations?variationPlacements:variationPlacements.filter((function(placement){return getVariation(placement)===variation})):basePlacements,allowedPlacements=placements.filter((function(placement){return allowedAutoPlacements.indexOf(placement)>=0}));0===allowedPlacements.length&&(allowedPlacements=placements);var overflows=allowedPlacements.reduce((function(acc,placement){return acc[placement]=detectOverflow(state,{placement,boundary,rootBoundary,padding})[getBasePlacement(placement)],acc}),{});return Object.keys(overflows).sort((function(a,b){return overflows[a]-overflows[b]}))}(state,{placement,boundary,rootBoundary,padding,flipVariations,allowedAutoPlacements}):placement)}),[]),referenceRect=state.rects.reference,popperRect=state.rects.popper,checksMap=new Map,makeFallbackChecks=!0,firstFittingPlacement=placements[0],i=0;i<placements.length;i++){var placement=placements[i],_basePlacement=getBasePlacement(placement),isStartVariation=getVariation(placement)===start,isVertical=[enums_top,bottom].indexOf(_basePlacement)>=0,len=isVertical?"width":"height",overflow=detectOverflow(state,{placement,boundary,rootBoundary,altBoundary,padding}),mainVariationSide=isVertical?isStartVariation?right:left:isStartVariation?bottom:enums_top;referenceRect[len]>popperRect[len]&&(mainVariationSide=getOppositePlacement(mainVariationSide));var altVariationSide=getOppositePlacement(mainVariationSide),checks=[];if(checkMainAxis&&checks.push(overflow[_basePlacement]<=0),checkAltAxis&&checks.push(overflow[mainVariationSide]<=0,overflow[altVariationSide]<=0),checks.every((function(check){return check}))){firstFittingPlacement=placement,makeFallbackChecks=!1;break}checksMap.set(placement,checks)}if(makeFallbackChecks)for(var _loop=function _loop(_i){var fittingPlacement=placements.find((function(placement){var checks=checksMap.get(placement);if(checks)return checks.slice(0,_i).every((function(check){return check}))}));if(fittingPlacement)return firstFittingPlacement=fittingPlacement,"break"},_i=flipVariations?3:1;_i>0;_i--){if("break"===_loop(_i))break}state.placement!==firstFittingPlacement&&(state.modifiersData[name]._skip=!0,state.placement=firstFittingPlacement,state.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},modifiers_preventOverflow,modifiers_arrow,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function hide(_ref){var state=_ref.state,name=_ref.name,referenceRect=state.rects.reference,popperRect=state.rects.popper,preventedOffsets=state.modifiersData.preventOverflow,referenceOverflow=detectOverflow(state,{elementContext:"reference"}),popperAltOverflow=detectOverflow(state,{altBoundary:!0}),referenceClippingOffsets=getSideOffsets(referenceOverflow,referenceRect),popperEscapeOffsets=getSideOffsets(popperAltOverflow,popperRect,preventedOffsets),isReferenceHidden=isAnySideFullyClipped(referenceClippingOffsets),hasPopperEscaped=isAnySideFullyClipped(popperEscapeOffsets);state.modifiersData[name]={referenceClippingOffsets,popperEscapeOffsets,isReferenceHidden,hasPopperEscaped},state.attributes.popper=Object.assign({},state.attributes.popper,{"data-popper-reference-hidden":isReferenceHidden,"data-popper-escaped":hasPopperEscaped})}}]}),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),fromEvent=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js"),takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),timer=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/timer.js"),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs");const _c0=["popperViewRef"],_c1=["*","*"];function NgxPopperjsContentComponent_div_2_Template(rf,ctx){if(1&rf&&(core["ɵɵelementStart"](0,"div",5),core["ɵɵprojection"](1),core["ɵɵelementEnd"]()),2&rf){const ctx_r0=core["ɵɵnextContext"]();core["ɵɵproperty"]("innerHTML",ctx_r0.text,core["ɵɵsanitizeHtml"])}}function NgxPopperjsContentComponent_div_3_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"div",6),core["ɵɵprojection"](1,1),core["ɵɵelementEnd"]())}var NgxPopperjsPlacements,NgxPopperjsTriggers;!function(NgxPopperjsPlacements){NgxPopperjsPlacements.TOP="top",NgxPopperjsPlacements.BOTTOM="bottom",NgxPopperjsPlacements.LEFT="left",NgxPopperjsPlacements.RIGHT="right",NgxPopperjsPlacements.TOPSTART="top-start",NgxPopperjsPlacements.BOTTOMSTART="bottom-start",NgxPopperjsPlacements.LEFTSTART="left-start",NgxPopperjsPlacements.RIGHTSTART="right-start",NgxPopperjsPlacements.TOPEND="top-end",NgxPopperjsPlacements.BOTTOMEND="bottom-end",NgxPopperjsPlacements.LEFTEND="left-end",NgxPopperjsPlacements.RIGHTEND="right-end",NgxPopperjsPlacements.AUTO="auto",NgxPopperjsPlacements.AUTOSTART="auto-start",NgxPopperjsPlacements.AUTOEND="auto-end"}(NgxPopperjsPlacements||(NgxPopperjsPlacements={})),function(NgxPopperjsTriggers){NgxPopperjsTriggers.click="click",NgxPopperjsTriggers.hover="hover",NgxPopperjsTriggers.mousedown="mousedown",NgxPopperjsTriggers.none="none"}(NgxPopperjsTriggers||(NgxPopperjsTriggers={}));class NgxPopperjsContentComponent{constructor(elRef,_viewRef,_changeDetectorRef){this.elRef=elRef,this._viewRef=_viewRef,this._changeDetectorRef=_changeDetectorRef,this.arrowColor=null,this.id="ngx_poppperjs_"+ ++NgxPopperjsContentComponent.nextId,this.isMouseOver=!1,this.onHidden=new core.EventEmitter,this.popperOptions={disableAnimation:!1,disableDefaultStyling:!1,placement:NgxPopperjsPlacements.AUTO,boundariesElement:"",trigger:NgxPopperjsTriggers.hover,positionFixed:!1,appendToBody:!1,popperModifiers:[]},this._baseModifiers=[{name:"offset",enabled:!0,options:{offset:[0,8]}},{name:"arrow",enabled:!0,options:{element:".ngxp__arrow",padding:3},requires:["arrow"]}],this._destroy$=new Subject.x,this._styleId=`${this.id}_style`,this._toggleVisibility(!1)}clean(){this.toggleVisibility(!1),this.popperInstance&&this.popperInstance.destroy()}extractAppliedClassListExpr(classList=[]){return(Array.isArray(classList)?classList:"string"==typeof classList?classList.replace(/ /,"").split(","):[]).reduce(((acc,klass)=>(acc[klass]=!0,acc)),{})}hide(){this.popperInstance&&this.popperInstance.destroy(),this.toggleVisibility(!1),this.onHidden.emit()}ngOnDestroy(){this._destroy$.next(),this.clean(),this.popperOptions.appendTo&&this.elRef&&this.elRef.nativeElement&&this.elRef.nativeElement.parentNode&&(this._viewRef.detach(),this.elRef.nativeElement.parentNode.removeChild(this.elRef.nativeElement))}onDocumentResize(){this.update()}onMouseOver(){this.isMouseOver=!0}show(){if(!this.referenceObject)return;const appendToParent=this.popperOptions.appendTo&&document.querySelector(this.popperOptions.appendTo);appendToParent&&this.elRef.nativeElement.parentNode!==appendToParent&&(this.elRef.nativeElement.parentNode&&this.elRef.nativeElement.parentNode.removeChild(this.elRef.nativeElement),appendToParent.appendChild(this.elRef.nativeElement));const popperOptions={strategy:this.popperOptions.positionFixed?"fixed":"absolute",placement:this.popperOptions.placement,modifiers:this._baseModifiers};this.onUpdate&&(popperOptions.onFirstUpdate=this.onUpdate);const boundariesElement=this.popperOptions.boundariesElement&&document.querySelector(this.popperOptions.boundariesElement);if(popperOptions.modifiers&&boundariesElement&&popperOptions.modifiers.push({name:"preventOverflow",enabled:this.popperOptions.preventOverflow,options:{boundary:boundariesElement}}),popperOptions.modifiers){const preventOverflowModifier=popperOptions.modifiers.find((v=>"preventOverflow"===v.name));if(preventOverflowModifier&&!preventOverflowModifier.enabled){const hideModifier=popperOptions.modifiers.find((v=>"preventOverflow"===v.name));hideModifier&&(hideModifier.enabled=!1)}}this._determineArrowColor(),popperOptions.modifiers=popperOptions.modifiers.concat(this.popperOptions.popperModifiers),window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{this.popperInstance=popper_createPopper(this.referenceObject,this.popperViewRef.nativeElement,popperOptions)}))})),this.toggleVisibility(!0),(0,fromEvent.R)(document,"resize").pipe((0,takeUntil.R)(this._destroy$)).subscribe({next:()=>this.onDocumentResize()})}showOnLeave(){this.isMouseOver=!1,(this.popperOptions.trigger===NgxPopperjsTriggers.hover||this.popperOptions.hideOnMouseLeave)&&this.hide()}toggleVisibility(state){this._toggleVisibility(state),this._changeDetectorRef.destroyed||this._changeDetectorRef.detectChanges()}update(){this.popperInstance&&this.popperInstance.update()}_createArrowSelector(){return`div#${this.id}.ngxp__container > .ngxp__arrow.ngxp__force-arrow`}_determineArrowColor(){if(!this.popperOptions.styles||this.arrowColor)return!1;const ruleValue=this.popperOptions.styles["background-color"]||this.popperOptions.styles.backgroundColor;if(this.arrowColor===ruleValue)return!1;this.arrowColor=ruleValue;let $style=document.querySelector(`#${this._styleId}`);const styleContent=this.arrowColor?`${this._createArrowSelector()}:before { background-color: ${this.arrowColor}; }`:"";$style||($style=document.createElement("style"),$style.id=this._styleId,$style.setAttribute("type","text/css"),document.head.appendChild($style)),$style.styleSheet?$style.styleSheet.cssText=styleContent:$style.innerHTML=styleContent}_toggleVisibility(state){this.displayType=["none","block"][+state],this.opacity=+state,this.ariaHidden=`${!state}`,this.state=state}}NgxPopperjsContentComponent.nextId=0,NgxPopperjsContentComponent.ɵfac=function NgxPopperjsContentComponent_Factory(t){return new(t||NgxPopperjsContentComponent)(core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](core.ViewContainerRef),core["ɵɵdirectiveInject"](core.ChangeDetectorRef))},NgxPopperjsContentComponent.ɵcmp=core["ɵɵdefineComponent"]({type:NgxPopperjsContentComponent,selectors:[["popper-content"]],viewQuery:function NgxPopperjsContentComponent_Query(rf,ctx){if(1&rf&&core["ɵɵviewQuery"](_c0,7),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.popperViewRef=_t.first)}},hostBindings:function NgxPopperjsContentComponent_HostBindings(rf,ctx){1&rf&&core["ɵɵlistener"]("mouseover",(function NgxPopperjsContentComponent_mouseover_HostBindingHandler(){return ctx.onMouseOver()}))("mouseleave",(function NgxPopperjsContentComponent_mouseleave_HostBindingHandler(){return ctx.showOnLeave()}))},exportAs:["ngxPopperjsContent"],ngContentSelectors:_c1,decls:5,vars:19,consts:[["popperViewRef",""],[3,"ngStyle","ngClass"],["class","ngxp__inner",3,"innerHTML",4,"ngIf"],["class","ngxp__inner",4,"ngIf"],["data-popper-arrow","",1,"ngxp__arrow",3,"ngClass"],[1,"ngxp__inner",3,"innerHTML"],[1,"ngxp__inner"]],template:function NgxPopperjsContentComponent_Template(rf,ctx){1&rf&&(core["ɵɵprojectionDef"](_c1),core["ɵɵelementStart"](0,"div",1,0),core["ɵɵtemplate"](2,NgxPopperjsContentComponent_div_2_Template,2,1,"div",2)(3,NgxPopperjsContentComponent_div_3_Template,2,0,"div",3),core["ɵɵelement"](4,"div",4),core["ɵɵelementEnd"]()),2&rf&&(core["ɵɵstyleProp"]("display",ctx.displayType)("opacity",ctx.opacity),core["ɵɵclassProp"]("ngxp__container",!ctx.popperOptions.disableDefaultStyling)("ngxp__animation",!ctx.popperOptions.disableAnimation),core["ɵɵproperty"]("ngStyle",ctx.popperOptions.styles)("ngClass",ctx.extractAppliedClassListExpr(ctx.popperOptions.applyClass)),core["ɵɵattribute"]("id",ctx.id)("aria-hidden",ctx.ariaHidden)("aria-describedby",ctx.popperOptions.ariaDescribe||null)("role",ctx.popperOptions.ariaRole),core["ɵɵadvance"](2),core["ɵɵproperty"]("ngIf",ctx.text),core["ɵɵadvance"](),core["ɵɵproperty"]("ngIf",!ctx.text),core["ɵɵadvance"](),core["ɵɵclassProp"]("ngxp__force-arrow",ctx.arrowColor),core["ɵɵproperty"]("ngClass",ctx.extractAppliedClassListExpr(ctx.popperOptions.applyArrowClass)))},dependencies:[common.NgClass,common.NgIf,common.NgStyle],styles:['popper-content{position:relative;display:block}.ngxp__container{display:none;position:absolute;border-radius:3px;border:1px solid grey;box-shadow:0 0 2px #00000080;padding:10px}.ngxp__container.ngxp__animation{animation:ngxp-fadeIn .15s ease-out}.ngxp__container>.ngxp__arrow,.ngxp__container>.ngxp__arrow:before{position:absolute;width:10px;height:10px;z-index:-1}.ngxp__container>.ngxp__arrow:before{transform:rotate(45deg);content:"";background-color:#fff;top:0;left:0}.ngxp__container[data-popper-placement^=top]>.ngxp__arrow{bottom:-4px}.ngxp__container[data-popper-placement^=bottom]>.ngxp__arrow{top:-4px}.ngxp__container[data-popper-placement^=left]>.ngxp__arrow{right:-4px}.ngxp__container[data-popper-placement^=right]>.ngxp__arrow{left:-4px}@keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{display:block;opacity:1}}\n'],encapsulation:2,changeDetection:0}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgxPopperjsContentComponent,[{type:core.Component,args:[{selector:"popper-content",encapsulation:core.ViewEncapsulation.None,changeDetection:core.ChangeDetectionStrategy.OnPush,exportAs:"ngxPopperjsContent",template:'<div #popperViewRef\r\n     [attr.id]="id"\r\n     [class.ngxp__container]="!popperOptions.disableDefaultStyling"\r\n     [class.ngxp__animation]="!popperOptions.disableAnimation"\r\n     [style.display]="displayType"\r\n     [style.opacity]="opacity"\r\n     [ngStyle]="popperOptions.styles"\r\n     [ngClass]="extractAppliedClassListExpr(popperOptions.applyClass)"\r\n     attr.aria-hidden="{{ariaHidden}}"\r\n     [attr.aria-describedby]="popperOptions.ariaDescribe || null"\r\n     attr.role="{{popperOptions.ariaRole}}">\r\n    <div *ngIf="text"\r\n         class="ngxp__inner"\r\n         [innerHTML]="text">\r\n        <ng-content></ng-content>\r\n    </div>\r\n    <div *ngIf="!text"\r\n         class="ngxp__inner">\r\n        <ng-content></ng-content>\r\n    </div>\r\n    <div class="ngxp__arrow"\r\n         data-popper-arrow\r\n         [class.ngxp__force-arrow]="arrowColor"\r\n         [ngClass]="extractAppliedClassListExpr(popperOptions.applyArrowClass)"></div>\r\n\r\n</div>\r\n',styles:['popper-content{position:relative;display:block}.ngxp__container{display:none;position:absolute;border-radius:3px;border:1px solid grey;box-shadow:0 0 2px #00000080;padding:10px}.ngxp__container.ngxp__animation{animation:ngxp-fadeIn .15s ease-out}.ngxp__container>.ngxp__arrow,.ngxp__container>.ngxp__arrow:before{position:absolute;width:10px;height:10px;z-index:-1}.ngxp__container>.ngxp__arrow:before{transform:rotate(45deg);content:"";background-color:#fff;top:0;left:0}.ngxp__container[data-popper-placement^=top]>.ngxp__arrow{bottom:-4px}.ngxp__container[data-popper-placement^=bottom]>.ngxp__arrow{top:-4px}.ngxp__container[data-popper-placement^=left]>.ngxp__arrow{right:-4px}.ngxp__container[data-popper-placement^=right]>.ngxp__arrow{left:-4px}@keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{display:block;opacity:1}}\n']}]}],(function(){return[{type:core.ElementRef},{type:core.ViewContainerRef},{type:core.ChangeDetectorRef}]}),{popperViewRef:[{type:core.ViewChild,args:["popperViewRef",{static:!0}]}],onMouseOver:[{type:core.HostListener,args:["mouseover"]}],showOnLeave:[{type:core.HostListener,args:["mouseleave"]}]});const NGX_POPPERJS_DEFAULTS=new core.InjectionToken("NGX_POPPERJS_DEFAULTS");class NgxPopperjsUtils{static coerceBooleanProperty(value){return null!=value&&"false"!=`${value}`}}class NgxPopperjsDirective{constructor(_changeDetectorRef,_elementRef,_vcr,_popperDefaults={}){this._changeDetectorRef=_changeDetectorRef,this._elementRef=_elementRef,this._vcr=_vcr,this._popperDefaults=_popperDefaults,this.hideTimeout=0,this.popperOnHidden=new core.EventEmitter,this.popperOnShown=new core.EventEmitter,this.popperOnUpdate=new core.EventEmitter,this.timeoutAfterShow=0,this._destroy$=new Subject.x,this._globalEventListenersCtrl$=new Subject.x,this._popperContentClass=NgxPopperjsContentComponent,this._scheduledHideTimeoutCtrl$=new Subject.x,this._scheduledShowTimeoutCtrl$=new Subject.x,this._shown=!1,NgxPopperjsDirective.baseOptions={...NgxPopperjsDirective.baseOptions,...this._popperDefaults}}set applyClass(newValue){newValue!==this._applyClass&&(this._applyClass=newValue,this._checkExisting("applyClass",newValue))}get applyClass(){return this._applyClass}set content(newValue){newValue!==this._content&&(this._content=newValue,this._popperContent&&("string"==typeof newValue?this._popperContent.text=newValue:this._popperContent=newValue))}get content(){return this._content}set disabled(newValue){newValue!==this._disabled&&(this._disabled=!!newValue,this._shown&&this.hide())}get disabled(){return this._disabled}set placement(newValue){this._popperPlacement=newValue,this._checkExisting("placement",newValue)}get placement(){return this._popperPlacement}set popperApplyArrowClass(newValue){if(newValue!==this._popperApplyArrowClass&&(this._popperApplyArrowClass=newValue,this._popperContent)){if(this._popperContent.popperOptions.applyArrowClass=newValue,!this._shown)return;this._popperContent.popperInstance.setOptions(this._popperContent.popperOptions)}}get popperApplyArrowClass(){return this._popperApplyArrowClass}set preventOverflow(newValue){this._popperPreventOverflow=NgxPopperjsUtils.coerceBooleanProperty(newValue),this._checkExisting("preventOverflow",this._popperPreventOverflow)}get preventOverflow(){return this._popperPreventOverflow}static assignDefined(target,...sources){for(const source of sources)for(const key of Object.keys(source)){const val=source[key];void 0!==val&&(target[key]=val)}return target}applyTriggerListeners(){switch(this.showTrigger){case NgxPopperjsTriggers.click:this._addListener("click",this.toggle.bind(this));break;case NgxPopperjsTriggers.mousedown:this._addListener("mousedown",this.toggle.bind(this));break;case NgxPopperjsTriggers.hover:this._addListener("mouseenter",this.scheduledShow.bind(this,this.showDelay)),["touchend","touchcancel","mouseleave"].forEach((eventName=>{this._addListener(eventName,this.scheduledHide.bind(this,null,this.hideTimeout))}))}this.showTrigger!==NgxPopperjsTriggers.hover&&this.hideOnMouseLeave&&["touchend","touchcancel","mouseleave"].forEach((eventName=>{this._addListener(eventName,this.scheduledHide.bind(this,null,this.hideTimeout))}))}getRefElement(){return this.targetElement||this._elementRef.nativeElement}hide(){this.disabled||(this._shown?(this._shown=!1,this._popperContentRef?this._popperContentRef.instance.hide():this._popperContent.hide(),this.popperOnHidden.emit(this),this._globalEventListenersCtrl$.next()):this._scheduledShowTimeoutCtrl$.next())}hideOnClickOutsideHandler($event){this.disabled||!this.hideOnClickOutside||$event.target===this._popperContent.elRef.nativeElement||this._popperContent.elRef.nativeElement.contains($event.target)||this.scheduledHide($event,this.hideTimeout)}hideOnScrollHandler($event){!this.disabled&&this.hideOnScroll&&this.scheduledHide($event,this.hideTimeout)}ngOnDestroy(){this._destroy$.next(),this._popperContent&&this._popperContent.clean()}ngOnInit(){this.hideOnClickOutside=void 0===this.hideOnClickOutside?this.closeOnClickOutside:this.hideOnClickOutside,"string"==typeof this.content?(this._popperContent=this._constructContent(),this._popperContent.text=this.content):void 0===this.content?(this._popperContent=this._constructContent(),this._popperContent.text=""):this._popperContent=this.content;const popperRef=this._popperContent;popperRef.referenceObject=this.getRefElement(),this._setContentProperties(popperRef),this._setDefaults(),this.applyTriggerListeners(),this.showOnStart&&this.scheduledShow()}scheduledHide($event=null,delay=this.hideTimeout){this.disabled||(this._scheduledShowTimeoutCtrl$.next(),(0,timer.H)(delay).pipe((0,takeUntil.R)(this._scheduledHideTimeoutCtrl$),(0,takeUntil.R)(this._destroy$)).subscribe({next:()=>{const toElement=$event?$event.toElement:null,popperContentView=!!this._popperContent.popperViewRef&&this._popperContent.popperViewRef.nativeElement;!popperContentView||popperContentView===toElement||popperContentView.contains(toElement)||this.content&&this.content.isMouseOver||(this.hide(),this._applyChanges())}}))}scheduledShow(delay=this.showDelay){this.disabled||(this._scheduledHideTimeoutCtrl$.next(),(0,timer.H)(delay).pipe((0,takeUntil.R)(this._scheduledShowTimeoutCtrl$),(0,takeUntil.R)(this._destroy$)).subscribe({next:()=>{this.show(),this._applyChanges()}}))}show(){if(this._shown)return void this._scheduledHideTimeoutCtrl$.next();this._shown=!0;const popperRef=this._popperContent,element=this.getRefElement();popperRef.referenceObject!==element&&(popperRef.referenceObject=element),this._setContentProperties(popperRef),popperRef.show(),this.popperOnShown.emit(this),this.timeoutAfterShow>0&&this.scheduledHide(null,this.timeoutAfterShow),(0,fromEvent.R)(document,"click").pipe((0,takeUntil.R)(this._globalEventListenersCtrl$),(0,takeUntil.R)(this._destroy$)).subscribe({next:e=>this.hideOnClickOutsideHandler(e)}),(0,fromEvent.R)(this._getScrollParent(this.getRefElement()),"scroll").pipe((0,takeUntil.R)(this._globalEventListenersCtrl$),(0,takeUntil.R)(this._destroy$)).subscribe({next:e=>{this.hideOnScrollHandler(e)}})}toggle(){this.disabled||(this._shown?this.scheduledHide(null,this.hideTimeout):this.scheduledShow())}_addListener(eventName,cb){(0,fromEvent.R)(this._elementRef.nativeElement,eventName).pipe((0,takeUntil.R)(this._destroy$)).subscribe({next:cb})}_applyChanges(){this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges()}_checkExisting(key,newValue){if(this._popperContent){if(this._popperContent.popperOptions[key]=newValue,!this._shown)return;this._popperContent.popperInstance.setOptions(this._popperContent.popperOptions)}}_constructContent(){return this._popperContentRef=this._vcr.createComponent(this._popperContentClass),this._popperContentRef.instance}_getScrollParent(node){const overflowY=node instanceof HTMLElement&&window.getComputedStyle(node).overflowY;return node?"visible"!==overflowY&&"hidden"!==overflowY&&node.scrollHeight>node.clientHeight?node:this._getScrollParent(node.parentNode)||document:null}_onPopperUpdate(event){this.popperOnUpdate.emit(event)}_setContentProperties(popperRef){popperRef.popperOptions=NgxPopperjsDirective.assignDefined(popperRef.popperOptions,NgxPopperjsDirective.baseOptions,{showDelay:this.showDelay,disableAnimation:this.disableAnimation,disableDefaultStyling:this.disableStyle,placement:this.placement,boundariesElement:this.boundariesElement,trigger:this.showTrigger,positionFixed:this.positionFixed,popperModifiers:this.popperModifiers,ariaDescribe:this.ariaDescribe,ariaRole:this.ariaRole,applyClass:this.applyClass,applyArrowClass:this.popperApplyArrowClass,hideOnMouseLeave:this.hideOnMouseLeave,styles:this.styles,appendTo:this.popperAppendTo,preventOverflow:this.preventOverflow}),popperRef.onUpdate=this._onPopperUpdate.bind(this),popperRef.onHidden.pipe((0,takeUntil.R)(this._destroy$)).subscribe(this.hide.bind(this))}_setDefaults(){["showDelay","hideOnScroll","hideOnMouseLeave","hideOnClickOutside","ariaRole","ariaDescribe"].forEach((key=>{this[key]=void 0===this[key]?NgxPopperjsDirective.baseOptions[key]:this[key]})),this.showTrigger=this.showTrigger||NgxPopperjsDirective.baseOptions.trigger,this.styles=void 0===this.styles?{...NgxPopperjsDirective.baseOptions.styles}:this.styles}}NgxPopperjsDirective.baseOptions={showDelay:0,placement:NgxPopperjsPlacements.AUTO,hideOnClickOutside:!0,hideOnMouseLeave:!1,hideOnScroll:!1,appendTo:void 0,ariaRole:"popper",ariaDescribe:"",styles:{},trigger:NgxPopperjsTriggers.click},NgxPopperjsDirective.ɵfac=function NgxPopperjsDirective_Factory(t){return new(t||NgxPopperjsDirective)(core["ɵɵdirectiveInject"](core.ChangeDetectorRef),core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](core.ViewContainerRef),core["ɵɵdirectiveInject"](NGX_POPPERJS_DEFAULTS))},NgxPopperjsDirective.ɵdir=core["ɵɵdefineDirective"]({type:NgxPopperjsDirective,selectors:[["","popper",""]],inputs:{applyClass:[core["ɵɵInputFlags"].None,"popperApplyClass","applyClass"],ariaDescribe:[core["ɵɵInputFlags"].None,"popperAriaDescribeBy","ariaDescribe"],ariaRole:[core["ɵɵInputFlags"].None,"popperAriaRole","ariaRole"],boundariesElement:[core["ɵɵInputFlags"].None,"popperBoundaries","boundariesElement"],closeOnClickOutside:[core["ɵɵInputFlags"].None,"popperCloseOnClickOutside","closeOnClickOutside"],content:[core["ɵɵInputFlags"].None,"popper","content"],disableAnimation:[core["ɵɵInputFlags"].None,"popperDisableAnimation","disableAnimation"],disabled:[core["ɵɵInputFlags"].None,"popperDisabled","disabled"],disableStyle:[core["ɵɵInputFlags"].None,"popperDisableStyle","disableStyle"],hideOnClickOutside:[core["ɵɵInputFlags"].None,"popperHideOnClickOutside","hideOnClickOutside"],hideOnMouseLeave:[core["ɵɵInputFlags"].None,"popperHideOnMouseLeave","hideOnMouseLeave"],hideOnScroll:[core["ɵɵInputFlags"].None,"popperHideOnScroll","hideOnScroll"],hideTimeout:[core["ɵɵInputFlags"].None,"popperTimeout","hideTimeout"],placement:[core["ɵɵInputFlags"].None,"popperPlacement","placement"],popperAppendTo:"popperAppendTo",popperApplyArrowClass:"popperApplyArrowClass",popperModifiers:"popperModifiers",positionFixed:[core["ɵɵInputFlags"].None,"popperPositionFixed","positionFixed"],preventOverflow:[core["ɵɵInputFlags"].None,"popperPreventOverflow","preventOverflow"],showDelay:[core["ɵɵInputFlags"].None,"popperDelay","showDelay"],showOnStart:[core["ɵɵInputFlags"].None,"popperShowOnStart","showOnStart"],showTrigger:[core["ɵɵInputFlags"].None,"popperTrigger","showTrigger"],styles:[core["ɵɵInputFlags"].None,"popperStyles","styles"],targetElement:[core["ɵɵInputFlags"].None,"popperTarget","targetElement"],timeoutAfterShow:[core["ɵɵInputFlags"].None,"popperTimeoutAfterShow","timeoutAfterShow"]},outputs:{popperOnHidden:"popperOnHidden",popperOnShown:"popperOnShown",popperOnUpdate:"popperOnUpdate"},exportAs:["popper"]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgxPopperjsDirective,[{type:core.Directive,args:[{selector:"[popper]",exportAs:"popper"}]}],(function(){return[{type:core.ChangeDetectorRef},{type:core.ElementRef},{type:core.ViewContainerRef},{type:void 0,decorators:[{type:core.Inject,args:[NGX_POPPERJS_DEFAULTS]}]}]}),{applyClass:[{type:core.Input,args:["popperApplyClass"]}],ariaDescribe:[{type:core.Input,args:["popperAriaDescribeBy"]}],ariaRole:[{type:core.Input,args:["popperAriaRole"]}],boundariesElement:[{type:core.Input,args:["popperBoundaries"]}],closeOnClickOutside:[{type:core.Input,args:["popperCloseOnClickOutside"]}],content:[{type:core.Input,args:["popper"]}],disableAnimation:[{type:core.Input,args:["popperDisableAnimation"]}],disabled:[{type:core.Input,args:["popperDisabled"]}],disableStyle:[{type:core.Input,args:["popperDisableStyle"]}],hideOnClickOutside:[{type:core.Input,args:["popperHideOnClickOutside"]}],hideOnMouseLeave:[{type:core.Input,args:["popperHideOnMouseLeave"]}],hideOnScroll:[{type:core.Input,args:["popperHideOnScroll"]}],hideTimeout:[{type:core.Input,args:["popperTimeout"]}],placement:[{type:core.Input,args:["popperPlacement"]}],popperAppendTo:[{type:core.Input}],popperApplyArrowClass:[{type:core.Input}],popperModifiers:[{type:core.Input}],popperOnHidden:[{type:core.Output}],popperOnShown:[{type:core.Output}],popperOnUpdate:[{type:core.Output}],positionFixed:[{type:core.Input,args:["popperPositionFixed"]}],preventOverflow:[{type:core.Input,args:["popperPreventOverflow"]}],showDelay:[{type:core.Input,args:["popperDelay"]}],showOnStart:[{type:core.Input,args:["popperShowOnStart"]}],showTrigger:[{type:core.Input,args:["popperTrigger"]}],styles:[{type:core.Input,args:["popperStyles"]}],targetElement:[{type:core.Input,args:["popperTarget"]}],timeoutAfterShow:[{type:core.Input,args:["popperTimeoutAfterShow"]}]});class NgxPopperjsLooseDirective extends NgxPopperjsDirective{constructor(changeDetectorRef,elementRef,vcr,popperDefaults={}){super(changeDetectorRef,elementRef,vcr,popperDefaults)}set popperLoose(newValue){this.content=newValue}set popperLoosePlacement(newValue){this.placement=newValue}set popperLooseTrigger(newValue){this.showTrigger=newValue}}function provideNgxPopperjsOptions(config={}){return[{provide:NGX_POPPERJS_DEFAULTS,useValue:config}]}NgxPopperjsLooseDirective.ɵfac=function NgxPopperjsLooseDirective_Factory(t){return new(t||NgxPopperjsLooseDirective)(core["ɵɵdirectiveInject"](core.ChangeDetectorRef),core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](core.ViewContainerRef),core["ɵɵdirectiveInject"](NGX_POPPERJS_DEFAULTS))},NgxPopperjsLooseDirective.ɵdir=core["ɵɵdefineDirective"]({type:NgxPopperjsLooseDirective,selectors:[["","popperLoose",""]],inputs:{popperLoose:"popperLoose",popperLoosePlacement:"popperLoosePlacement",popperLooseTrigger:"popperLooseTrigger"},exportAs:["popperLoose"],features:[core["ɵɵInheritDefinitionFeature"]]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgxPopperjsLooseDirective,[{type:core.Directive,args:[{selector:"[popperLoose]",exportAs:"popperLoose"}]}],(function(){return[{type:core.ChangeDetectorRef},{type:core.ElementRef},{type:core.ViewContainerRef},{type:void 0,decorators:[{type:core.Inject,args:[NGX_POPPERJS_DEFAULTS]}]}]}),{popperLoose:[{type:core.Input}],popperLoosePlacement:[{type:core.Input}],popperLooseTrigger:[{type:core.Input}]});class NgxPopperjsModule{static forRoot(popperBaseOptions){return{ngModule:NgxPopperjsModule,providers:[provideNgxPopperjsOptions(popperBaseOptions)]}}}NgxPopperjsModule.ɵfac=function NgxPopperjsModule_Factory(t){return new(t||NgxPopperjsModule)},NgxPopperjsModule.ɵmod=core["ɵɵdefineNgModule"]({type:NgxPopperjsModule,declarations:[NgxPopperjsContentComponent,NgxPopperjsDirective,NgxPopperjsLooseDirective],imports:[common.CommonModule],exports:[NgxPopperjsContentComponent,NgxPopperjsDirective,NgxPopperjsLooseDirective]}),NgxPopperjsModule.ɵinj=core["ɵɵdefineInjector"]({providers:[provideNgxPopperjsOptions()],imports:[common.CommonModule]}),("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](NgxPopperjsModule,[{type:core.NgModule,args:[{imports:[common.CommonModule],declarations:[NgxPopperjsContentComponent,NgxPopperjsDirective,NgxPopperjsLooseDirective],exports:[NgxPopperjsContentComponent,NgxPopperjsDirective,NgxPopperjsLooseDirective],providers:[provideNgxPopperjsOptions()]}]}],null,null)},"./node_modules/ngxtension/fesm2022/ngxtension-derived-async.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{u:()=>derivedAsync});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");var Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),isObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isObservable.js"),mergeAll=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeAll.js"),concatAll=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/concatAll.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),innerFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js"),lift=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),OperatorSubscriber=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js");function exhaustMap(project,resultSelector){return resultSelector?function(source){return source.pipe(exhaustMap((function(a,i){return(0,innerFrom.Xf)(project(a,i)).pipe((0,map.U)((function(b,ii){return resultSelector(a,b,i,ii)})))})))}:(0,lift.e)((function(source,subscriber){var index=0,innerSub=null,isComplete=!1;source.subscribe((0,OperatorSubscriber.x)(subscriber,(function(outerValue){innerSub||(innerSub=(0,OperatorSubscriber.x)(subscriber,void 0,(function(){innerSub=null,isComplete&&subscriber.complete()})),(0,innerFrom.Xf)(project(outerValue,index++)).subscribe(innerSub))}),(function(){isComplete=!0,!innerSub&&subscriber.complete()})))}))}var identity=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/identity.js");function exhaustAll(){return exhaustMap(identity.y)}var switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");function switchAll(){return(0,switchMap.w)(identity.y)}function derivedAsync(computation,options={}){return function assertInjector(fn,injector,runner){!injector&&(0,core.assertInInjectionContext)(fn);const assertedInjector=injector??(0,core.inject)(core.Injector);return runner?(0,core.runInInjectionContext)(assertedInjector,runner):assertedInjector}(derivedAsync,options?.injector,(()=>{const destroyRef=(0,core.inject)(core.DestroyRef),sourceEvent$=new Subject.x,sourceResult=function createFlattenObservable(source,behavior){const KEY_OPERATOR_MAP={merge:mergeAll.J,concat:concatAll.u,exhaust:exhaustAll,switch:switchAll};return source.pipe(KEY_OPERATOR_MAP[behavior]())}(sourceEvent$,options?.behavior??"switch").subscribe({next:value=>sourceValue.set({kind:1,value}),error:error=>sourceValue.set({kind:2,error})});let sourceValue;if(destroyRef.onDestroy((()=>sourceResult.unsubscribe())),options?.requireSync&&void 0===options?.initialValue){const initialCmp=computation(void 0);if(isPromise(initialCmp))throw new Error(REQUIRE_SYNC_PROMISE_MESSAGE);sourceValue=(0,core.signal)({kind:0}),(0,isObservable.b)(initialCmp)?sourceEvent$.next(initialCmp):sourceValue.set({kind:1,value:initialCmp})}else sourceValue=(0,core.signal)({kind:1,value:options?.initialValue});if(options?.requireSync&&0===sourceValue().kind)throw new Error(REQUIRE_SYNC_ERROR_MESSAGE);let skipFirstComputation=!0===options?.requireSync;return(0,core.effect)((()=>{const currentValue=(0,core.untracked)((()=>{const currentSourceValue=sourceValue();return 1===currentSourceValue.kind?currentSourceValue.value:void 0})),newSource=computation(currentValue);skipFirstComputation?skipFirstComputation=!1:(0,isObservable.b)(newSource)||isPromise(newSource)?(0,core.untracked)((()=>sourceEvent$.next(newSource))):(0,core.untracked)((()=>sourceValue.set({kind:1,value:newSource})))})),(0,core.computed)((()=>{const state=sourceValue();switch(state.kind){case 1:return state.value;case 2:throw state.error;case 0:return;default:throw new Error("Unknown state")}}),{equal:options?.equal})}))}const REQUIRE_SYNC_PROMISE_MESSAGE="Promises cannot be used with requireSync. Pass an initialValue or set requireSync to false.",REQUIRE_SYNC_ERROR_MESSAGE="The observable passed to derivedAsync() did not emit synchronously. Pass an initialValue or set requireSync to false.";function isPromise(value){return value&&"function"==typeof value.then}},"./node_modules/p-finally/index.js":module=>{"use strict";module.exports=(promise,onFinally)=>(onFinally=onFinally||(()=>{}),promise.then((val=>new Promise((resolve=>{resolve(onFinally())})).then((()=>val))),(err=>new Promise((resolve=>{resolve(onFinally())})).then((()=>{throw err})))))},"./node_modules/p-queue/dist/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var _asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/asyncToGenerator.js").default;const EventEmitter=__webpack_require__("./node_modules/eventemitter3/index.js"),p_timeout_1=__webpack_require__("./node_modules/p-timeout/index.js"),priority_queue_1=__webpack_require__("./node_modules/p-queue/dist/priority-queue.js"),empty=()=>{},timeoutError=new p_timeout_1.TimeoutError;exports.Z=class PQueue extends EventEmitter{constructor(options){var _a,_b,_c,_d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=empty,this._resolveIdle=empty,!("number"==typeof(options=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:priority_queue_1.default},options)).intervalCap&&options.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(_b=null===(_a=options.intervalCap)||void 0===_a?void 0:_a.toString())&&void 0!==_b?_b:""}\` (${typeof options.intervalCap})`);if(void 0===options.interval||!(Number.isFinite(options.interval)&&options.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(_d=null===(_c=options.interval)||void 0===_c?void 0:_c.toString())&&void 0!==_d?_d:""}\` (${typeof options.interval})`);this._carryoverConcurrencyCount=options.carryoverConcurrencyCount,this._isIntervalIgnored=options.intervalCap===1/0||0===options.interval,this._intervalCap=options.intervalCap,this._interval=options.interval,this._queue=new options.queueClass,this._queueClass=options.queueClass,this.concurrency=options.concurrency,this._timeout=options.timeout,this._throwOnTimeout=!0===options.throwOnTimeout,this._isPaused=!1===options.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=empty,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=empty,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const now=Date.now();if(void 0===this._intervalId){const delay=this._intervalEnd-now;if(!(delay<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),delay)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const canInitializeInterval=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const job=this._queue.dequeue();return!!job&&(this.emit("active"),job(),canInitializeInterval&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(newConcurrency){if(!("number"==typeof newConcurrency&&newConcurrency>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${newConcurrency}\` (${typeof newConcurrency})`);this._concurrency=newConcurrency,this._processQueue()}add(fn,options={}){var _this=this;return _asyncToGenerator((function*(){return new Promise(((resolve,reject)=>{const run=function(){var _ref=_asyncToGenerator((function*(){_this._pendingCount++,_this._intervalCount++;try{const operation=void 0===_this._timeout&&void 0===options.timeout?fn():p_timeout_1.default(Promise.resolve(fn()),void 0===options.timeout?_this._timeout:options.timeout,(()=>{(void 0===options.throwOnTimeout?_this._throwOnTimeout:options.throwOnTimeout)&&reject(timeoutError)}));resolve(yield operation)}catch(error){reject(error)}_this._next()}));return function run(){return _ref.apply(this,arguments)}}();_this._queue.enqueue(run,options),_this._tryToStartAnother(),_this.emit("add")}))}))()}addAll(functions,options){var _this2=this;return _asyncToGenerator((function*(){return Promise.all(functions.map(function(){var _ref2=_asyncToGenerator((function*(function_){return _this2.add(function_,options)}));return function(_x){return _ref2.apply(this,arguments)}}()))}))()}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}onEmpty(){var _this3=this;return _asyncToGenerator((function*(){if(0!==_this3._queue.size)return new Promise((resolve=>{const existingResolve=_this3._resolveEmpty;_this3._resolveEmpty=()=>{existingResolve(),resolve()}}))}))()}onIdle(){var _this4=this;return _asyncToGenerator((function*(){if(0!==_this4._pendingCount||0!==_this4._queue.size)return new Promise((resolve=>{const existingResolve=_this4._resolveIdle;_this4._resolveIdle=()=>{existingResolve(),resolve()}}))}))()}get size(){return this._queue.size}sizeBy(options){return this._queue.filter(options).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(milliseconds){this._timeout=milliseconds}}},"./node_modules/p-queue/dist/lower-bound.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function lowerBound(array,value,comparator){let first=0,count=array.length;for(;count>0;){const step=count/2|0;let it=first+step;comparator(array[it],value)<=0?(first=++it,count-=step+1):count=step}return first}},"./node_modules/p-queue/dist/priority-queue.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const lower_bound_1=__webpack_require__("./node_modules/p-queue/dist/lower-bound.js");exports.default=class PriorityQueue{constructor(){this._queue=[]}enqueue(run,options){const element={priority:(options=Object.assign({priority:0},options)).priority,run};if(this.size&&this._queue[this.size-1].priority>=options.priority)return void this._queue.push(element);const index=lower_bound_1.default(this._queue,element,((a,b)=>b.priority-a.priority));this._queue.splice(index,0,element)}dequeue(){const item=this._queue.shift();return null==item?void 0:item.run}filter(options){return this._queue.filter((element=>element.priority===options.priority)).map((element=>element.run))}get size(){return this._queue.length}}},"./node_modules/p-retry/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var _asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/asyncToGenerator.js").default;const retry=__webpack_require__("./node_modules/retry/index.js"),networkErrorMsgs=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class AbortError extends Error{constructor(message){super(),message instanceof Error?(this.originalError=message,({message}=message)):(this.originalError=new Error(message),this.originalError.stack=this.stack),this.name="AbortError",this.message=message}}const pRetry=(input,options)=>new Promise(((resolve,reject)=>{options={onFailedAttempt:()=>{},retries:10,...options};const operation=retry.operation(options);operation.attempt(function(){var _ref=_asyncToGenerator((function*(attemptNumber){try{resolve(yield input(attemptNumber))}catch(error){if(!(error instanceof Error))return void reject(new TypeError(`Non-error was thrown: "${error}". You should only throw errors.`));if(error instanceof AbortError)operation.stop(),reject(error.originalError);else if(error instanceof TypeError&&(errorMessage=error.message,!networkErrorMsgs.includes(errorMessage)))operation.stop(),reject(error);else{((error,attemptNumber,options)=>{const retriesLeft=options.retries-(attemptNumber-1);error.attemptNumber=attemptNumber,error.retriesLeft=retriesLeft})(error,attemptNumber,options);try{yield options.onFailedAttempt(error)}catch(error){return void reject(error)}operation.retry(error)||reject(operation.mainError())}}var errorMessage}));return function(_x){return _ref.apply(this,arguments)}}())}));module.exports=pRetry,module.exports.default=pRetry,module.exports.AbortError=AbortError},"./node_modules/p-timeout/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const pFinally=__webpack_require__("./node_modules/p-finally/index.js");class TimeoutError extends Error{constructor(message){super(message),this.name="TimeoutError"}}const pTimeout=(promise,milliseconds,fallback)=>new Promise(((resolve,reject)=>{if("number"!=typeof milliseconds||milliseconds<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(milliseconds===1/0)return void resolve(promise);const timer=setTimeout((()=>{if("function"==typeof fallback){try{resolve(fallback())}catch(error){reject(error)}return}const timeoutError=fallback instanceof Error?fallback:new TimeoutError("string"==typeof fallback?fallback:`Promise timed out after ${milliseconds} milliseconds`);"function"==typeof promise.cancel&&promise.cancel(),reject(timeoutError)}),milliseconds);pFinally(promise.then(resolve,reject),(()=>{clearTimeout(timer)}))}));module.exports=pTimeout,module.exports.default=pTimeout,module.exports.TimeoutError=TimeoutError},"./node_modules/retry/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/retry/lib/retry.js")},"./node_modules/retry/lib/retry.js":(__unused_webpack_module,exports,__webpack_require__)=>{var RetryOperation=__webpack_require__("./node_modules/retry/lib/retry_operation.js");exports.operation=function(options){var timeouts=exports.timeouts(options);return new RetryOperation(timeouts,{forever:options&&(options.forever||options.retries===1/0),unref:options&&options.unref,maxRetryTime:options&&options.maxRetryTime})},exports.timeouts=function(options){if(options instanceof Array)return[].concat(options);var opts={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var key in options)opts[key]=options[key];if(opts.minTimeout>opts.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var timeouts=[],i=0;i<opts.retries;i++)timeouts.push(this.createTimeout(i,opts));return options&&options.forever&&!timeouts.length&&timeouts.push(this.createTimeout(i,opts)),timeouts.sort((function(a,b){return a-b})),timeouts},exports.createTimeout=function(attempt,opts){var random=opts.randomize?Math.random()+1:1,timeout=Math.round(random*Math.max(opts.minTimeout,1)*Math.pow(opts.factor,attempt));return timeout=Math.min(timeout,opts.maxTimeout)},exports.wrap=function(obj,options,methods){if(options instanceof Array&&(methods=options,options=null),!methods)for(var key in methods=[],obj)"function"==typeof obj[key]&&methods.push(key);for(var i=0;i<methods.length;i++){var method=methods[i],original=obj[method];obj[method]=function retryWrapper(original){var op=exports.operation(options),args=Array.prototype.slice.call(arguments,1),callback=args.pop();args.push((function(err){op.retry(err)||(err&&(arguments[0]=op.mainError()),callback.apply(this,arguments))})),op.attempt((function(){original.apply(obj,args)}))}.bind(obj,original),obj[method].options=options}}},"./node_modules/retry/lib/retry_operation.js":module=>{function RetryOperation(timeouts,options){"boolean"==typeof options&&(options={forever:options}),this._originalTimeouts=JSON.parse(JSON.stringify(timeouts)),this._timeouts=timeouts,this._options=options||{},this._maxRetryTime=options&&options.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}module.exports=RetryOperation,RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},RetryOperation.prototype.retry=function(err){if(this._timeout&&clearTimeout(this._timeout),!err)return!1;var currentTime=(new Date).getTime();if(err&&currentTime-this._operationStart>=this._maxRetryTime)return this._errors.push(err),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(err);var timeout=this._timeouts.shift();if(void 0===timeout){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),timeout=this._cachedTimeouts.slice(-1)}var self=this;return this._timer=setTimeout((function(){self._attempts++,self._operationTimeoutCb&&(self._timeout=setTimeout((function(){self._operationTimeoutCb(self._attempts)}),self._operationTimeout),self._options.unref&&self._timeout.unref()),self._fn(self._attempts)}),timeout),this._options.unref&&this._timer.unref(),!0},RetryOperation.prototype.attempt=function(fn,timeoutOps){this._fn=fn,timeoutOps&&(timeoutOps.timeout&&(this._operationTimeout=timeoutOps.timeout),timeoutOps.cb&&(this._operationTimeoutCb=timeoutOps.cb));var self=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){self._operationTimeoutCb()}),self._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},RetryOperation.prototype.try=function(fn){console.log("Using RetryOperation.try() is deprecated"),this.attempt(fn)},RetryOperation.prototype.start=function(fn){console.log("Using RetryOperation.start() is deprecated"),this.attempt(fn)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var counts={},mainError=null,mainErrorCount=0,i=0;i<this._errors.length;i++){var error=this._errors[i],message=error.message,count=(counts[message]||0)+1;counts[message]=count,count>=mainErrorCount&&(mainError=error,mainErrorCount=count)}return mainError}},"./node_modules/rxjs/dist/esm5/internal/observable/dom/fetch.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{U:()=>fromFetch});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/tslib/tslib.es6.js"),_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),_Observable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),_observable_innerFrom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js");function fromFetch(input,initWithSelector){void 0===initWithSelector&&(initWithSelector={});var selector=initWithSelector.selector,init=(0,tslib__WEBPACK_IMPORTED_MODULE_0__._T)(initWithSelector,["selector"]);return new _Observable__WEBPACK_IMPORTED_MODULE_1__.y((function(subscriber){var controller=new AbortController,signal=controller.signal,abortable=!0,outerSignal=init.signal;if(outerSignal)if(outerSignal.aborted)controller.abort();else{var outerSignalHandler_1=function(){signal.aborted||controller.abort()};outerSignal.addEventListener("abort",outerSignalHandler_1),subscriber.add((function(){return outerSignal.removeEventListener("abort",outerSignalHandler_1)}))}var perSubscriberInit=(0,tslib__WEBPACK_IMPORTED_MODULE_0__.pi)((0,tslib__WEBPACK_IMPORTED_MODULE_0__.pi)({},init),{signal}),handleError=function(err){abortable=!1,subscriber.error(err)};return fetch(input,perSubscriberInit).then((function(response){selector?(0,_observable_innerFrom__WEBPACK_IMPORTED_MODULE_2__.Xf)(selector(response)).subscribe((0,_operators_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_3__.x)(subscriber,void 0,(function(){abortable=!1,subscriber.complete()}),handleError)):(abortable=!1,subscriber.next(response),subscriber.complete())})).catch(handleError),function(){abortable&&controller.abort()}}))}},"./node_modules/rxjs/dist/esm5/internal/operators/throttleTime.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{p:()=>throttleTime});var scheduler_async=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/async.js"),lift=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),OperatorSubscriber=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),innerFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js");var timer=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/timer.js");function throttleTime(duration,scheduler,config){void 0===scheduler&&(scheduler=scheduler_async.z);var duration$=(0,timer.H)(duration,scheduler);return function throttle(durationSelector,config){return(0,lift.e)((function(source,subscriber){var _a=null!=config?config:{},_b=_a.leading,leading=void 0===_b||_b,_c=_a.trailing,trailing=void 0!==_c&&_c,hasValue=!1,sendValue=null,throttled=null,isComplete=!1,endThrottling=function(){null==throttled||throttled.unsubscribe(),throttled=null,trailing&&(send(),isComplete&&subscriber.complete())},cleanupThrottling=function(){throttled=null,isComplete&&subscriber.complete()},startThrottle=function(value){return throttled=(0,innerFrom.Xf)(durationSelector(value)).subscribe((0,OperatorSubscriber.x)(subscriber,endThrottling,cleanupThrottling))},send=function(){if(hasValue){hasValue=!1;var value=sendValue;sendValue=null,subscriber.next(value),!isComplete&&startThrottle(value)}};source.subscribe((0,OperatorSubscriber.x)(subscriber,(function(value){hasValue=!0,sendValue=value,(!throttled||throttled.closed)&&(leading?send():startThrottle(value))}),(function(){isComplete=!0,(!(trailing&&hasValue&&throttled)||throttled.closed)&&subscriber.complete()})))}))}((function(){return duration$}),config)}},"./node_modules/zod-to-json-schema/dist/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Y_:()=>zodToJsonSchema_zodToJsonSchema});const ignoreOverride=Symbol("Let zodToJsonSchema decide on which parser to use"),defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email",base64Strategy:"contentEncoding:base64"},getRefs=options=>{const _options=(options=>"string"==typeof options?{...defaultOptions,name:options}:{...defaultOptions,...options})(options),currentPath=void 0!==_options.name?[..._options.basePath,_options.definitionPath,_options.name]:_options.basePath;return{..._options,currentPath,propertyPath:void 0,seen:new Map(Object.entries(_options.definitions).map((([name,def])=>[def._def,{def:def._def,path:[..._options.basePath,_options.definitionPath,name],jsonSchema:void 0}])))}};var lib=__webpack_require__("./node_modules/zod/lib/index.mjs");function addErrorMessage(res,key,errorMessage,refs){refs?.errorMessages&&errorMessage&&(res.errorMessage={...res.errorMessage,[key]:errorMessage})}function setResponseValueAndErrors(res,key,value,errorMessage,refs){res[key]=value,addErrorMessage(res,key,errorMessage,refs)}function parseDateDef(def,refs,overrideDateStrategy){const strategy=overrideDateStrategy??refs.dateStrategy;if(Array.isArray(strategy))return{anyOf:strategy.map(((item,i)=>parseDateDef(def,refs,item)))};switch(strategy){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return integerDateParser(def,refs)}}const integerDateParser=(def,refs)=>{const res={type:"integer",format:"unix-time"};if("openApi3"===refs.target)return res;for(const check of def.checks)switch(check.kind){case"min":setResponseValueAndErrors(res,"minimum",check.value,check.message,refs);break;case"max":setResponseValueAndErrors(res,"maximum",check.value,check.message,refs)}return res};const zodPatterns={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$",base64:"^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$",nanoid:"^[a-zA-Z0-9_-]{21}$"};function parseStringDef(def,refs){const res={type:"string"};function processPattern(value){return"escape"===refs.patternStrategy?escapeNonAlphaNumeric(value):value}if(def.checks)for(const check of def.checks)switch(check.kind){case"min":setResponseValueAndErrors(res,"minLength","number"==typeof res.minLength?Math.max(res.minLength,check.value):check.value,check.message,refs);break;case"max":setResponseValueAndErrors(res,"maxLength","number"==typeof res.maxLength?Math.min(res.maxLength,check.value):check.value,check.message,refs);break;case"email":switch(refs.emailStrategy){case"format:email":addFormat(res,"email",check.message,refs);break;case"format:idn-email":addFormat(res,"idn-email",check.message,refs);break;case"pattern:zod":addPattern(res,zodPatterns.email,check.message,refs)}break;case"url":addFormat(res,"uri",check.message,refs);break;case"uuid":addFormat(res,"uuid",check.message,refs);break;case"regex":addPattern(res,check.regex.source,check.message,refs);break;case"cuid":addPattern(res,zodPatterns.cuid,check.message,refs);break;case"cuid2":addPattern(res,zodPatterns.cuid2,check.message,refs);break;case"startsWith":addPattern(res,"^"+processPattern(check.value),check.message,refs);break;case"endsWith":addPattern(res,processPattern(check.value)+"$",check.message,refs);break;case"datetime":addFormat(res,"date-time",check.message,refs);break;case"date":addFormat(res,"date",check.message,refs);break;case"time":addFormat(res,"time",check.message,refs);break;case"duration":addFormat(res,"duration",check.message,refs);break;case"length":setResponseValueAndErrors(res,"minLength","number"==typeof res.minLength?Math.max(res.minLength,check.value):check.value,check.message,refs),setResponseValueAndErrors(res,"maxLength","number"==typeof res.maxLength?Math.min(res.maxLength,check.value):check.value,check.message,refs);break;case"includes":addPattern(res,processPattern(check.value),check.message,refs);break;case"ip":"v6"!==check.version&&addFormat(res,"ipv4",check.message,refs),"v4"!==check.version&&addFormat(res,"ipv6",check.message,refs);break;case"emoji":addPattern(res,zodPatterns.emoji,check.message,refs);break;case"ulid":addPattern(res,zodPatterns.ulid,check.message,refs);break;case"base64":switch(refs.base64Strategy){case"format:binary":addFormat(res,"binary",check.message,refs);break;case"contentEncoding:base64":setResponseValueAndErrors(res,"contentEncoding","base64",check.message,refs);break;case"pattern:zod":addPattern(res,zodPatterns.base64,check.message,refs)}break;case"nanoid":addPattern(res,zodPatterns.nanoid,check.message,refs)}return res}const escapeNonAlphaNumeric=value=>Array.from(value).map((c=>/[a-zA-Z0-9]/.test(c)?c:`\\${c}`)).join(""),addFormat=(schema,value,message,refs)=>{schema.format||schema.anyOf?.some((x=>x.format))?(schema.anyOf||(schema.anyOf=[]),schema.format&&(schema.anyOf.push({format:schema.format,...schema.errorMessage&&refs.errorMessages&&{errorMessage:{format:schema.errorMessage.format}}}),delete schema.format,schema.errorMessage&&(delete schema.errorMessage.format,0===Object.keys(schema.errorMessage).length&&delete schema.errorMessage)),schema.anyOf.push({format:value,...message&&refs.errorMessages&&{errorMessage:{format:message}}})):setResponseValueAndErrors(schema,"format",value,message,refs)},addPattern=(schema,value,message,refs)=>{schema.pattern||schema.allOf?.some((x=>x.pattern))?(schema.allOf||(schema.allOf=[]),schema.pattern&&(schema.allOf.push({pattern:schema.pattern,...schema.errorMessage&&refs.errorMessages&&{errorMessage:{pattern:schema.errorMessage.pattern}}}),delete schema.pattern,schema.errorMessage&&(delete schema.errorMessage.pattern,0===Object.keys(schema.errorMessage).length&&delete schema.errorMessage)),schema.allOf.push({pattern:value,...message&&refs.errorMessages&&{errorMessage:{pattern:message}}})):setResponseValueAndErrors(schema,"pattern",value,message,refs)};function parseRecordDef(def,refs){if("openApi3"===refs.target&&def.keyType?._def.typeName===lib.pA.ZodEnum)return{type:"object",required:def.keyType._def.values,properties:def.keyType._def.values.reduce(((acc,key)=>({...acc,[key]:parseDef_parseDef(def.valueType._def,{...refs,currentPath:[...refs.currentPath,"properties",key]})??{}})),{}),additionalProperties:!1};const schema={type:"object",additionalProperties:parseDef_parseDef(def.valueType._def,{...refs,currentPath:[...refs.currentPath,"additionalProperties"]})??{}};if("openApi3"===refs.target)return schema;if(def.keyType?._def.typeName===lib.pA.ZodString&&def.keyType._def.checks?.length){const keyType=Object.entries(parseStringDef(def.keyType._def,refs)).reduce(((acc,[key,value])=>"type"===key?acc:{...acc,[key]:value}),{});return{...schema,propertyNames:keyType}}return def.keyType?._def.typeName===lib.pA.ZodEnum?{...schema,propertyNames:{enum:def.keyType._def.values}}:schema}const primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};const asAnyOf=(def,refs)=>{const anyOf=(def.options instanceof Map?Array.from(def.options.values()):def.options).map(((x,i)=>parseDef_parseDef(x._def,{...refs,currentPath:[...refs.currentPath,"anyOf",`${i}`]}))).filter((x=>!!x&&(!refs.strictUnions||"object"==typeof x&&Object.keys(x).length>0)));return anyOf.length?{anyOf}:void 0};function decideAdditionalProperties(def,refs){return"strict"===refs.removeAdditionalStrategy?"ZodNever"===def.catchall._def.typeName?"strict"!==def.unknownKeys:parseDef_parseDef(def.catchall._def,{...refs,currentPath:[...refs.currentPath,"additionalProperties"]})??!0:"ZodNever"===def.catchall._def.typeName?"passthrough"===def.unknownKeys:parseDef_parseDef(def.catchall._def,{...refs,currentPath:[...refs.currentPath,"additionalProperties"]})??!0}function parseDef_parseDef(def,refs,forceResolution=!1){const seenItem=refs.seen.get(def);if(refs.override){const overrideResult=refs.override?.(def,refs,seenItem,forceResolution);if(overrideResult!==ignoreOverride)return overrideResult}if(seenItem&&!forceResolution){const seenSchema=get$ref(seenItem,refs);if(void 0!==seenSchema)return seenSchema}const newItem={def,path:refs.currentPath,jsonSchema:void 0};refs.seen.set(def,newItem);const jsonSchema=selectParser(def,def.typeName,refs);return jsonSchema&&addMeta(def,refs,jsonSchema),newItem.jsonSchema=jsonSchema,jsonSchema}const get$ref=(item,refs)=>{switch(refs.$refStrategy){case"root":return{$ref:item.path.join("/")};case"relative":return{$ref:getRelativePath(refs.currentPath,item.path)};case"none":case"seen":return item.path.length<refs.currentPath.length&&item.path.every(((value,index)=>refs.currentPath[index]===value))?(console.warn(`Recursive reference detected at ${refs.currentPath.join("/")}! Defaulting to any`),{}):"seen"===refs.$refStrategy?{}:void 0}},getRelativePath=(pathA,pathB)=>{let i=0;for(;i<pathA.length&&i<pathB.length&&pathA[i]===pathB[i];i++);return[(pathA.length-i).toString(),...pathB.slice(i)].join("/")},selectParser=(def,typeName,refs)=>{switch(typeName){case lib.pA.ZodString:return parseStringDef(def,refs);case lib.pA.ZodNumber:return function parseNumberDef(def,refs){const res={type:"number"};if(!def.checks)return res;for(const check of def.checks)switch(check.kind){case"int":res.type="integer",addErrorMessage(res,"type",check.message,refs);break;case"min":"jsonSchema7"===refs.target?check.inclusive?setResponseValueAndErrors(res,"minimum",check.value,check.message,refs):setResponseValueAndErrors(res,"exclusiveMinimum",check.value,check.message,refs):(check.inclusive||(res.exclusiveMinimum=!0),setResponseValueAndErrors(res,"minimum",check.value,check.message,refs));break;case"max":"jsonSchema7"===refs.target?check.inclusive?setResponseValueAndErrors(res,"maximum",check.value,check.message,refs):setResponseValueAndErrors(res,"exclusiveMaximum",check.value,check.message,refs):(check.inclusive||(res.exclusiveMaximum=!0),setResponseValueAndErrors(res,"maximum",check.value,check.message,refs));break;case"multipleOf":setResponseValueAndErrors(res,"multipleOf",check.value,check.message,refs)}return res}(def,refs);case lib.pA.ZodObject:return function parseObjectDef(def,refs){const result={type:"object",...Object.entries(def.shape()).reduce(((acc,[propName,propDef])=>{if(void 0===propDef||void 0===propDef._def)return acc;const parsedDef=parseDef_parseDef(propDef._def,{...refs,currentPath:[...refs.currentPath,"properties",propName],propertyPath:[...refs.currentPath,"properties",propName]});return void 0===parsedDef?acc:{properties:{...acc.properties,[propName]:parsedDef},required:propDef.isOptional()?acc.required:[...acc.required,propName]}}),{properties:{},required:[]}),additionalProperties:decideAdditionalProperties(def,refs)};return result.required.length||delete result.required,result}(def,refs);case lib.pA.ZodBigInt:return function parseBigintDef(def,refs){const res={type:"integer",format:"int64"};if(!def.checks)return res;for(const check of def.checks)switch(check.kind){case"min":"jsonSchema7"===refs.target?check.inclusive?setResponseValueAndErrors(res,"minimum",check.value,check.message,refs):setResponseValueAndErrors(res,"exclusiveMinimum",check.value,check.message,refs):(check.inclusive||(res.exclusiveMinimum=!0),setResponseValueAndErrors(res,"minimum",check.value,check.message,refs));break;case"max":"jsonSchema7"===refs.target?check.inclusive?setResponseValueAndErrors(res,"maximum",check.value,check.message,refs):setResponseValueAndErrors(res,"exclusiveMaximum",check.value,check.message,refs):(check.inclusive||(res.exclusiveMaximum=!0),setResponseValueAndErrors(res,"maximum",check.value,check.message,refs));break;case"multipleOf":setResponseValueAndErrors(res,"multipleOf",check.value,check.message,refs)}return res}(def,refs);case lib.pA.ZodBoolean:return{type:"boolean"};case lib.pA.ZodDate:return parseDateDef(def,refs);case lib.pA.ZodUndefined:return{not:{}};case lib.pA.ZodNull:return function parseNullDef(refs){return"openApi3"===refs.target?{enum:["null"],nullable:!0}:{type:"null"}}(refs);case lib.pA.ZodArray:return function parseArrayDef(def,refs){const res={type:"array"};return def.type?._def?.typeName!==lib.pA.ZodAny&&(res.items=parseDef_parseDef(def.type._def,{...refs,currentPath:[...refs.currentPath,"items"]})),def.minLength&&setResponseValueAndErrors(res,"minItems",def.minLength.value,def.minLength.message,refs),def.maxLength&&setResponseValueAndErrors(res,"maxItems",def.maxLength.value,def.maxLength.message,refs),def.exactLength&&(setResponseValueAndErrors(res,"minItems",def.exactLength.value,def.exactLength.message,refs),setResponseValueAndErrors(res,"maxItems",def.exactLength.value,def.exactLength.message,refs)),res}(def,refs);case lib.pA.ZodUnion:case lib.pA.ZodDiscriminatedUnion:return function parseUnionDef(def,refs){if("openApi3"===refs.target)return asAnyOf(def,refs);const options=def.options instanceof Map?Array.from(def.options.values()):def.options;if(options.every((x=>x._def.typeName in primitiveMappings&&(!x._def.checks||!x._def.checks.length)))){const types=options.reduce(((types,x)=>{const type=primitiveMappings[x._def.typeName];return type&&!types.includes(type)?[...types,type]:types}),[]);return{type:types.length>1?types:types[0]}}if(options.every((x=>"ZodLiteral"===x._def.typeName&&!x.description))){const types=options.reduce(((acc,x)=>{const type=typeof x._def.value;switch(type){case"string":case"number":case"boolean":return[...acc,type];case"bigint":return[...acc,"integer"];case"object":if(null===x._def.value)return[...acc,"null"];default:return acc}}),[]);if(types.length===options.length){const uniqueTypes=types.filter(((x,i,a)=>a.indexOf(x)===i));return{type:uniqueTypes.length>1?uniqueTypes:uniqueTypes[0],enum:options.reduce(((acc,x)=>acc.includes(x._def.value)?acc:[...acc,x._def.value]),[])}}}else if(options.every((x=>"ZodEnum"===x._def.typeName)))return{type:"string",enum:options.reduce(((acc,x)=>[...acc,...x._def.values.filter((x=>!acc.includes(x)))]),[])};return asAnyOf(def,refs)}(def,refs);case lib.pA.ZodIntersection:return function parseIntersectionDef(def,refs){const allOf=[parseDef_parseDef(def.left._def,{...refs,currentPath:[...refs.currentPath,"allOf","0"]}),parseDef_parseDef(def.right._def,{...refs,currentPath:[...refs.currentPath,"allOf","1"]})].filter((x=>!!x));let unevaluatedProperties="jsonSchema2019-09"===refs.target?{unevaluatedProperties:!1}:void 0;const mergedAllOf=[];return allOf.forEach((schema=>{if("type"in(type=schema)&&"string"===type.type||!("allOf"in type)){let nestedSchema=schema;if("additionalProperties"in schema&&!1===schema.additionalProperties){const{additionalProperties,...rest}=schema;nestedSchema=rest}else unevaluatedProperties=void 0;mergedAllOf.push(nestedSchema)}else mergedAllOf.push(...schema.allOf),void 0===schema.unevaluatedProperties&&(unevaluatedProperties=void 0);var type})),mergedAllOf.length?{allOf:mergedAllOf,...unevaluatedProperties}:void 0}(def,refs);case lib.pA.ZodTuple:return function parseTupleDef(def,refs){return def.rest?{type:"array",minItems:def.items.length,items:def.items.map(((x,i)=>parseDef_parseDef(x._def,{...refs,currentPath:[...refs.currentPath,"items",`${i}`]}))).reduce(((acc,x)=>void 0===x?acc:[...acc,x]),[]),additionalItems:parseDef_parseDef(def.rest._def,{...refs,currentPath:[...refs.currentPath,"additionalItems"]})}:{type:"array",minItems:def.items.length,maxItems:def.items.length,items:def.items.map(((x,i)=>parseDef_parseDef(x._def,{...refs,currentPath:[...refs.currentPath,"items",`${i}`]}))).reduce(((acc,x)=>void 0===x?acc:[...acc,x]),[])}}(def,refs);case lib.pA.ZodRecord:return parseRecordDef(def,refs);case lib.pA.ZodLiteral:return function parseLiteralDef(def,refs){const parsedType=typeof def.value;return"bigint"!==parsedType&&"number"!==parsedType&&"boolean"!==parsedType&&"string"!==parsedType?{type:Array.isArray(def.value)?"array":"object"}:"openApi3"===refs.target?{type:"bigint"===parsedType?"integer":parsedType,enum:[def.value]}:{type:"bigint"===parsedType?"integer":parsedType,const:def.value}}(def,refs);case lib.pA.ZodEnum:return function parseEnumDef(def){return{type:"string",enum:def.values}}(def);case lib.pA.ZodNativeEnum:return function parseNativeEnumDef(def){const object=def.values,actualValues=Object.keys(def.values).filter((key=>"number"!=typeof object[object[key]])).map((key=>object[key])),parsedTypes=Array.from(new Set(actualValues.map((values=>typeof values))));return{type:1===parsedTypes.length?"string"===parsedTypes[0]?"string":"number":["string","number"],enum:actualValues}}(def);case lib.pA.ZodNullable:return function parseNullableDef(def,refs){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(def.innerType._def.typeName)&&(!def.innerType._def.checks||!def.innerType._def.checks.length))return"openApi3"===refs.target?{type:primitiveMappings[def.innerType._def.typeName],nullable:!0}:{type:[primitiveMappings[def.innerType._def.typeName],"null"]};if("openApi3"===refs.target){const base=parseDef_parseDef(def.innerType._def,{...refs,currentPath:[...refs.currentPath]});return base&&"$ref"in base?{allOf:[base],nullable:!0}:base&&{...base,nullable:!0}}const base=parseDef_parseDef(def.innerType._def,{...refs,currentPath:[...refs.currentPath,"anyOf","0"]});return base&&{anyOf:[base,{type:"null"}]}}(def,refs);case lib.pA.ZodOptional:return((def,refs)=>{if(refs.currentPath.toString()===refs.propertyPath?.toString())return parseDef_parseDef(def.innerType._def,refs);const innerSchema=parseDef_parseDef(def.innerType._def,{...refs,currentPath:[...refs.currentPath,"anyOf","1"]});return innerSchema?{anyOf:[{not:{}},innerSchema]}:{}})(def,refs);case lib.pA.ZodMap:return function parseMapDef(def,refs){return"record"===refs.mapStrategy?parseRecordDef(def,refs):{type:"array",maxItems:125,items:{type:"array",items:[parseDef_parseDef(def.keyType._def,{...refs,currentPath:[...refs.currentPath,"items","items","0"]})||{},parseDef_parseDef(def.valueType._def,{...refs,currentPath:[...refs.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(def,refs);case lib.pA.ZodSet:return function parseSetDef(def,refs){const schema={type:"array",uniqueItems:!0,items:parseDef_parseDef(def.valueType._def,{...refs,currentPath:[...refs.currentPath,"items"]})};return def.minSize&&setResponseValueAndErrors(schema,"minItems",def.minSize.value,def.minSize.message,refs),def.maxSize&&setResponseValueAndErrors(schema,"maxItems",def.maxSize.value,def.maxSize.message,refs),schema}(def,refs);case lib.pA.ZodLazy:return parseDef_parseDef(def.getter()._def,refs);case lib.pA.ZodPromise:return function parsePromiseDef(def,refs){return parseDef_parseDef(def.type._def,refs)}(def,refs);case lib.pA.ZodNaN:case lib.pA.ZodNever:return{not:{}};case lib.pA.ZodEffects:return function parseEffectsDef(_def,refs){return"input"===refs.effectStrategy?parseDef_parseDef(_def.schema._def,refs):{}}(def,refs);case lib.pA.ZodAny:case lib.pA.ZodUnknown:return{};case lib.pA.ZodDefault:return function parseDefaultDef(_def,refs){return{...parseDef_parseDef(_def.innerType._def,refs),default:_def.defaultValue()}}(def,refs);case lib.pA.ZodBranded:return function parseBrandedDef(_def,refs){return parseDef_parseDef(_def.type._def,refs)}(def,refs);case lib.pA.ZodReadonly:case lib.pA.ZodCatch:return((def,refs)=>parseDef_parseDef(def.innerType._def,refs))(def,refs);case lib.pA.ZodPipeline:return((def,refs)=>{if("input"===refs.pipeStrategy)return parseDef_parseDef(def.in._def,refs);if("output"===refs.pipeStrategy)return parseDef_parseDef(def.out._def,refs);const a=parseDef_parseDef(def.in._def,{...refs,currentPath:[...refs.currentPath,"allOf","0"]});return{allOf:[a,parseDef_parseDef(def.out._def,{...refs,currentPath:[...refs.currentPath,"allOf",a?"1":"0"]})].filter((x=>void 0!==x))}})(def,refs);case lib.pA.ZodFunction:case lib.pA.ZodVoid:case lib.pA.ZodSymbol:default:return}},addMeta=(def,refs,jsonSchema)=>(def.description&&(jsonSchema.description=def.description,refs.markdownDescription&&(jsonSchema.markdownDescription=def.description)),jsonSchema),zodToJsonSchema_zodToJsonSchema=(schema,options)=>{const refs=getRefs(options),definitions="object"==typeof options&&options.definitions?Object.entries(options.definitions).reduce(((acc,[name,schema])=>({...acc,[name]:parseDef_parseDef(schema._def,{...refs,currentPath:[...refs.basePath,refs.definitionPath,name]},!0)??{}})),{}):void 0,name="string"==typeof options?options:options?.name,main=parseDef_parseDef(schema._def,void 0===name?refs:{...refs,currentPath:[...refs.basePath,refs.definitionPath,name]},!1)??{},combined=void 0===name?definitions?{...main,[refs.definitionPath]:definitions}:main:{$ref:[..."relative"===refs.$refStrategy?[]:refs.basePath,refs.definitionPath,name].join("/"),[refs.definitionPath]:{...definitions,[name]:main}};return"jsonSchema7"===refs.target?combined.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===refs.target&&(combined.$schema="https://json-schema.org/draft/2019-09/schema#"),combined}},"./node_modules/zod/lib/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{pA:()=>ZodFirstPartyTypeKind,z:()=>z});var util,objectUtil,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");!function(util){util.assertEqual=val=>val,util.assertIs=function assertIs(_arg){},util.assertNever=function assertNever(_x){throw new Error},util.arrayToEnum=items=>{const obj={};for(const item of items)obj[item]=item;return obj},util.getValidEnumValues=obj=>{const validKeys=util.objectKeys(obj).filter((k=>"number"!=typeof obj[obj[k]])),filtered={};for(const k of validKeys)filtered[k]=obj[k];return util.objectValues(filtered)},util.objectValues=obj=>util.objectKeys(obj).map((function(e){return obj[e]})),util.objectKeys="function"==typeof Object.keys?obj=>Object.keys(obj):object=>{const keys=[];for(const key in object)Object.prototype.hasOwnProperty.call(object,key)&&keys.push(key);return keys},util.find=(arr,checker)=>{for(const item of arr)if(checker(item))return item},util.isInteger="function"==typeof Number.isInteger?val=>Number.isInteger(val):val=>"number"==typeof val&&isFinite(val)&&Math.floor(val)===val,util.joinValues=function joinValues(array,separator=" | "){return array.map((val=>"string"==typeof val?`'${val}'`:val)).join(separator)},util.jsonStringifyReplacer=(_,value)=>"bigint"==typeof value?value.toString():value}(util||(util={})),function(objectUtil){objectUtil.mergeShapes=(first,second)=>({...first,...second})}(objectUtil||(objectUtil={}));const ZodParsedType=util.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=data=>{switch(typeof data){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(data)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(data)?ZodParsedType.array:null===data?ZodParsedType.null:data.then&&"function"==typeof data.then&&data.catch&&"function"==typeof data.catch?ZodParsedType.promise:"undefined"!=typeof Map&&data instanceof Map?ZodParsedType.map:"undefined"!=typeof Set&&data instanceof Set?ZodParsedType.set:"undefined"!=typeof Date&&data instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ZodError extends Error{constructor(issues){super(),this.issues=[],this.addIssue=sub=>{this.issues=[...this.issues,sub]},this.addIssues=(subs=[])=>{this.issues=[...this.issues,...subs]};const actualProto=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,actualProto):this.__proto__=actualProto,this.name="ZodError",this.issues=issues}get errors(){return this.issues}format(_mapper){const mapper=_mapper||function(issue){return issue.message},fieldErrors={_errors:[]},processError=error=>{for(const issue of error.issues)if("invalid_union"===issue.code)issue.unionErrors.map(processError);else if("invalid_return_type"===issue.code)processError(issue.returnTypeError);else if("invalid_arguments"===issue.code)processError(issue.argumentsError);else if(0===issue.path.length)fieldErrors._errors.push(mapper(issue));else{let curr=fieldErrors,i=0;for(;i<issue.path.length;){const el=issue.path[i];i===issue.path.length-1?(curr[el]=curr[el]||{_errors:[]},curr[el]._errors.push(mapper(issue))):curr[el]=curr[el]||{_errors:[]},curr=curr[el],i++}}};return processError(this),fieldErrors}static assert(value){if(!(value instanceof ZodError))throw new Error(`Not a ZodError: ${value}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(mapper=(issue=>issue.message)){const fieldErrors={},formErrors=[];for(const sub of this.issues)sub.path.length>0?(fieldErrors[sub.path[0]]=fieldErrors[sub.path[0]]||[],fieldErrors[sub.path[0]].push(mapper(sub))):formErrors.push(mapper(sub));return{formErrors,fieldErrors}}get formErrors(){return this.flatten()}}ZodError.create=issues=>new ZodError(issues);const errorMap=(issue,_ctx)=>{let message;switch(issue.code){case ZodIssueCode.invalid_type:message=issue.received===ZodParsedType.undefined?"Required":`Expected ${issue.expected}, received ${issue.received}`;break;case ZodIssueCode.invalid_literal:message=`Invalid literal value, expected ${JSON.stringify(issue.expected,util.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:message=`Unrecognized key(s) in object: ${util.joinValues(issue.keys,", ")}`;break;case ZodIssueCode.invalid_union:message="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:message=`Invalid discriminator value. Expected ${util.joinValues(issue.options)}`;break;case ZodIssueCode.invalid_enum_value:message=`Invalid enum value. Expected ${util.joinValues(issue.options)}, received '${issue.received}'`;break;case ZodIssueCode.invalid_arguments:message="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:message="Invalid function return type";break;case ZodIssueCode.invalid_date:message="Invalid date";break;case ZodIssueCode.invalid_string:"object"==typeof issue.validation?"includes"in issue.validation?(message=`Invalid input: must include "${issue.validation.includes}"`,"number"==typeof issue.validation.position&&(message=`${message} at one or more positions greater than or equal to ${issue.validation.position}`)):"startsWith"in issue.validation?message=`Invalid input: must start with "${issue.validation.startsWith}"`:"endsWith"in issue.validation?message=`Invalid input: must end with "${issue.validation.endsWith}"`:util.assertNever(issue.validation):message="regex"!==issue.validation?`Invalid ${issue.validation}`:"Invalid";break;case ZodIssueCode.too_small:message="array"===issue.type?`Array must contain ${issue.exact?"exactly":issue.inclusive?"at least":"more than"} ${issue.minimum} element(s)`:"string"===issue.type?`String must contain ${issue.exact?"exactly":issue.inclusive?"at least":"over"} ${issue.minimum} character(s)`:"number"===issue.type?`Number must be ${issue.exact?"exactly equal to ":issue.inclusive?"greater than or equal to ":"greater than "}${issue.minimum}`:"date"===issue.type?`Date must be ${issue.exact?"exactly equal to ":issue.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(issue.minimum))}`:"Invalid input";break;case ZodIssueCode.too_big:message="array"===issue.type?`Array must contain ${issue.exact?"exactly":issue.inclusive?"at most":"less than"} ${issue.maximum} element(s)`:"string"===issue.type?`String must contain ${issue.exact?"exactly":issue.inclusive?"at most":"under"} ${issue.maximum} character(s)`:"number"===issue.type?`Number must be ${issue.exact?"exactly":issue.inclusive?"less than or equal to":"less than"} ${issue.maximum}`:"bigint"===issue.type?`BigInt must be ${issue.exact?"exactly":issue.inclusive?"less than or equal to":"less than"} ${issue.maximum}`:"date"===issue.type?`Date must be ${issue.exact?"exactly":issue.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(issue.maximum))}`:"Invalid input";break;case ZodIssueCode.custom:message="Invalid input";break;case ZodIssueCode.invalid_intersection_types:message="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:message=`Number must be a multiple of ${issue.multipleOf}`;break;case ZodIssueCode.not_finite:message="Number must be finite";break;default:message=_ctx.defaultError,util.assertNever(issue)}return{message}};let overrideErrorMap=errorMap;function getErrorMap(){return overrideErrorMap}const makeIssue=params=>{const{data,path,errorMaps,issueData}=params,fullPath=[...path,...issueData.path||[]],fullIssue={...issueData,path:fullPath};if(void 0!==issueData.message)return{...issueData,path:fullPath,message:issueData.message};let errorMessage="";const maps=errorMaps.filter((m=>!!m)).slice().reverse();for(const map of maps)errorMessage=map(fullIssue,{data,defaultError:errorMessage}).message;return{...issueData,path:fullPath,message:errorMessage}};function addIssueToContext(ctx,issueData){const overrideMap=getErrorMap(),issue=makeIssue({issueData,data:ctx.data,path:ctx.path,errorMaps:[ctx.common.contextualErrorMap,ctx.schemaErrorMap,overrideMap,overrideMap===errorMap?void 0:errorMap].filter((x=>!!x))});ctx.common.issues.push(issue)}class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(status,results){const arrayValue=[];for(const s of results){if("aborted"===s.status)return INVALID;"dirty"===s.status&&status.dirty(),arrayValue.push(s.value)}return{status:status.value,value:arrayValue}}static mergeObjectAsync(status,pairs){return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){const syncPairs=[];for(const pair of pairs){const key=yield pair.key,value=yield pair.value;syncPairs.push({key,value})}return ParseStatus.mergeObjectSync(status,syncPairs)}))()}static mergeObjectSync(status,pairs){const finalObject={};for(const pair of pairs){const{key,value}=pair;if("aborted"===key.status)return INVALID;if("aborted"===value.status)return INVALID;"dirty"===key.status&&status.dirty(),"dirty"===value.status&&status.dirty(),"__proto__"===key.value||void 0===value.value&&!pair.alwaysSet||(finalObject[key.value]=value.value)}return{status:status.value,value:finalObject}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=value=>({status:"dirty",value}),OK=value=>({status:"valid",value}),isAborted=x=>"aborted"===x.status,isDirty=x=>"dirty"===x.status,isValid=x=>"valid"===x.status,isAsync=x=>"undefined"!=typeof Promise&&x instanceof Promise;function __classPrivateFieldGet(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)}function __classPrivateFieldSet(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value}var errorUtil,_ZodEnum_cache,_ZodNativeEnum_cache;"function"==typeof SuppressedError&&SuppressedError,function(errorUtil){errorUtil.errToObj=message=>"string"==typeof message?{message}:message||{},errorUtil.toString=message=>"string"==typeof message?message:null==message?void 0:message.message}(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(parent,value,path,key){this._cachedPath=[],this.parent=parent,this.data=value,this._path=path,this._key=key}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(ctx,result)=>{if(isValid(result))return{success:!0,data:result.value};if(!ctx.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const error=new ZodError(ctx.common.issues);return this._error=error,this._error}}};function processCreateParams(params){if(!params)return{};const{errorMap,invalid_type_error,required_error,description}=params;if(errorMap&&(invalid_type_error||required_error))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(errorMap)return{errorMap,description};return{errorMap:(iss,ctx)=>{var _a,_b;const{message}=params;return"invalid_enum_value"===iss.code?{message:null!=message?message:ctx.defaultError}:void 0===ctx.data?{message:null!==(_a=null!=message?message:required_error)&&void 0!==_a?_a:ctx.defaultError}:"invalid_type"!==iss.code?{message:ctx.defaultError}:{message:null!==(_b=null!=message?message:invalid_type_error)&&void 0!==_b?_b:ctx.defaultError}},description}}class ZodType{constructor(def){this.spa=this.safeParseAsync,this._def=def,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(input){return getParsedType(input.data)}_getOrReturnCtx(input,ctx){return ctx||{common:input.parent.common,data:input.data,parsedType:getParsedType(input.data),schemaErrorMap:this._def.errorMap,path:input.path,parent:input.parent}}_processInputParams(input){return{status:new ParseStatus,ctx:{common:input.parent.common,data:input.data,parsedType:getParsedType(input.data),schemaErrorMap:this._def.errorMap,path:input.path,parent:input.parent}}}_parseSync(input){const result=this._parse(input);if(isAsync(result))throw new Error("Synchronous parse encountered promise.");return result}_parseAsync(input){const result=this._parse(input);return Promise.resolve(result)}parse(data,params){const result=this.safeParse(data,params);if(result.success)return result.data;throw result.error}safeParse(data,params){var _a;const ctx={common:{issues:[],async:null!==(_a=null==params?void 0:params.async)&&void 0!==_a&&_a,contextualErrorMap:null==params?void 0:params.errorMap},path:(null==params?void 0:params.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data,parsedType:getParsedType(data)},result=this._parseSync({data,path:ctx.path,parent:ctx});return handleResult(ctx,result)}parseAsync(data,params){var _this=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){const result=yield _this.safeParseAsync(data,params);if(result.success)return result.data;throw result.error}))()}safeParseAsync(data,params){var _this2=this;return(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){const ctx={common:{issues:[],contextualErrorMap:null==params?void 0:params.errorMap,async:!0},path:(null==params?void 0:params.path)||[],schemaErrorMap:_this2._def.errorMap,parent:null,data,parsedType:getParsedType(data)},maybeAsyncResult=_this2._parse({data,path:ctx.path,parent:ctx}),result=yield isAsync(maybeAsyncResult)?maybeAsyncResult:Promise.resolve(maybeAsyncResult);return handleResult(ctx,result)}))()}refine(check,message){const getIssueProperties=val=>"string"==typeof message||void 0===message?{message}:"function"==typeof message?message(val):message;return this._refinement(((val,ctx)=>{const result=check(val),setError=()=>ctx.addIssue({code:ZodIssueCode.custom,...getIssueProperties(val)});return"undefined"!=typeof Promise&&result instanceof Promise?result.then((data=>!!data||(setError(),!1))):!!result||(setError(),!1)}))}refinement(check,refinementData){return this._refinement(((val,ctx)=>!!check(val)||(ctx.addIssue("function"==typeof refinementData?refinementData(val,ctx):refinementData),!1)))}_refinement(refinement){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement}})}superRefine(refinement){return this._refinement(refinement)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(option){return ZodUnion.create([this,option],this._def)}and(incoming){return ZodIntersection.create(this,incoming,this._def)}transform(transform){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform}})}default(def){const defaultValueFunc="function"==typeof def?def:()=>def;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:defaultValueFunc,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(def){const catchValueFunc="function"==typeof def?def:()=>def;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:catchValueFunc,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(description){return new(0,this.constructor)({...this._def,description})}pipe(target){return ZodPipeline.create(this,target)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[0-9a-z]+$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,nanoidRegex=/^[a-z0-9_-]{21}$/i,durationRegex=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let emojiRegex;const ipv4Regex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64Regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dateRegexSource="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dateRegex=new RegExp(`^${dateRegexSource}$`);function timeRegexSource(args){let regex="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return args.precision?regex=`${regex}\\.\\d{${args.precision}}`:null==args.precision&&(regex=`${regex}(\\.\\d+)?`),regex}function datetimeRegex(args){let regex=`${dateRegexSource}T${timeRegexSource(args)}`;const opts=[];return opts.push(args.local?"Z?":"Z"),args.offset&&opts.push("([+-]\\d{2}:?\\d{2})"),regex=`${regex}(${opts.join("|")})`,new RegExp(`^${regex}$`)}class ZodString extends ZodType{_parse(input){this._def.coerce&&(input.data=String(input.data));if(this._getType(input)!==ZodParsedType.string){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:ctx.parsedType}),INVALID}const status=new ParseStatus;let ctx;for(const check of this._def.checks)if("min"===check.kind)input.data.length<check.value&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:check.value,type:"string",inclusive:!0,exact:!1,message:check.message}),status.dirty());else if("max"===check.kind)input.data.length>check.value&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:check.value,type:"string",inclusive:!0,exact:!1,message:check.message}),status.dirty());else if("length"===check.kind){const tooBig=input.data.length>check.value,tooSmall=input.data.length<check.value;(tooBig||tooSmall)&&(ctx=this._getOrReturnCtx(input,ctx),tooBig?addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:check.value,type:"string",inclusive:!0,exact:!0,message:check.message}):tooSmall&&addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:check.value,type:"string",inclusive:!0,exact:!0,message:check.message}),status.dirty())}else if("email"===check.kind)emailRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"email",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty());else if("emoji"===check.kind)emojiRegex||(emojiRegex=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),emojiRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"emoji",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty());else if("uuid"===check.kind)uuidRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"uuid",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty());else if("nanoid"===check.kind)nanoidRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"nanoid",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty());else if("cuid"===check.kind)cuidRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"cuid",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty());else if("cuid2"===check.kind)cuid2Regex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty());else if("ulid"===check.kind)ulidRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"ulid",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty());else if("url"===check.kind)try{new URL(input.data)}catch(_a){ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"url",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty()}else if("regex"===check.kind){check.regex.lastIndex=0;check.regex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"regex",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty())}else if("trim"===check.kind)input.data=input.data.trim();else if("includes"===check.kind)input.data.includes(check.value,check.position)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:{includes:check.value,position:check.position},message:check.message}),status.dirty());else if("toLowerCase"===check.kind)input.data=input.data.toLowerCase();else if("toUpperCase"===check.kind)input.data=input.data.toUpperCase();else if("startsWith"===check.kind)input.data.startsWith(check.value)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:{startsWith:check.value},message:check.message}),status.dirty());else if("endsWith"===check.kind)input.data.endsWith(check.value)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:{endsWith:check.value},message:check.message}),status.dirty());else if("datetime"===check.kind){datetimeRegex(check).test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:"datetime",message:check.message}),status.dirty())}else if("date"===check.kind){dateRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:"date",message:check.message}),status.dirty())}else if("time"===check.kind){new RegExp(`^${timeRegexSource(check)}$`).test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:"time",message:check.message}),status.dirty())}else"duration"===check.kind?durationRegex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"duration",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty()):"ip"===check.kind?(ip=input.data,("v4"!==(version=check.version)&&version||!ipv4Regex.test(ip))&&("v6"!==version&&version||!ipv6Regex.test(ip))&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"ip",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty())):"base64"===check.kind?base64Regex.test(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"base64",code:ZodIssueCode.invalid_string,message:check.message}),status.dirty()):util.assertNever(check);var ip,version;return{status:status.value,value:input.data}}_regex(regex,validation,message){return this.refinement((data=>regex.test(data)),{validation,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(message)})}_addCheck(check){return new ZodString({...this._def,checks:[...this._def.checks,check]})}email(message){return this._addCheck({kind:"email",...errorUtil.errToObj(message)})}url(message){return this._addCheck({kind:"url",...errorUtil.errToObj(message)})}emoji(message){return this._addCheck({kind:"emoji",...errorUtil.errToObj(message)})}uuid(message){return this._addCheck({kind:"uuid",...errorUtil.errToObj(message)})}nanoid(message){return this._addCheck({kind:"nanoid",...errorUtil.errToObj(message)})}cuid(message){return this._addCheck({kind:"cuid",...errorUtil.errToObj(message)})}cuid2(message){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(message)})}ulid(message){return this._addCheck({kind:"ulid",...errorUtil.errToObj(message)})}base64(message){return this._addCheck({kind:"base64",...errorUtil.errToObj(message)})}ip(options){return this._addCheck({kind:"ip",...errorUtil.errToObj(options)})}datetime(options){var _a,_b;return"string"==typeof options?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:options}):this._addCheck({kind:"datetime",precision:void 0===(null==options?void 0:options.precision)?null:null==options?void 0:options.precision,offset:null!==(_a=null==options?void 0:options.offset)&&void 0!==_a&&_a,local:null!==(_b=null==options?void 0:options.local)&&void 0!==_b&&_b,...errorUtil.errToObj(null==options?void 0:options.message)})}date(message){return this._addCheck({kind:"date",message})}time(options){return"string"==typeof options?this._addCheck({kind:"time",precision:null,message:options}):this._addCheck({kind:"time",precision:void 0===(null==options?void 0:options.precision)?null:null==options?void 0:options.precision,...errorUtil.errToObj(null==options?void 0:options.message)})}duration(message){return this._addCheck({kind:"duration",...errorUtil.errToObj(message)})}regex(regex,message){return this._addCheck({kind:"regex",regex,...errorUtil.errToObj(message)})}includes(value,options){return this._addCheck({kind:"includes",value,position:null==options?void 0:options.position,...errorUtil.errToObj(null==options?void 0:options.message)})}startsWith(value,message){return this._addCheck({kind:"startsWith",value,...errorUtil.errToObj(message)})}endsWith(value,message){return this._addCheck({kind:"endsWith",value,...errorUtil.errToObj(message)})}min(minLength,message){return this._addCheck({kind:"min",value:minLength,...errorUtil.errToObj(message)})}max(maxLength,message){return this._addCheck({kind:"max",value:maxLength,...errorUtil.errToObj(message)})}length(len,message){return this._addCheck({kind:"length",value:len,...errorUtil.errToObj(message)})}nonempty(message){return this.min(1,errorUtil.errToObj(message))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((ch=>"datetime"===ch.kind))}get isDate(){return!!this._def.checks.find((ch=>"date"===ch.kind))}get isTime(){return!!this._def.checks.find((ch=>"time"===ch.kind))}get isDuration(){return!!this._def.checks.find((ch=>"duration"===ch.kind))}get isEmail(){return!!this._def.checks.find((ch=>"email"===ch.kind))}get isURL(){return!!this._def.checks.find((ch=>"url"===ch.kind))}get isEmoji(){return!!this._def.checks.find((ch=>"emoji"===ch.kind))}get isUUID(){return!!this._def.checks.find((ch=>"uuid"===ch.kind))}get isNANOID(){return!!this._def.checks.find((ch=>"nanoid"===ch.kind))}get isCUID(){return!!this._def.checks.find((ch=>"cuid"===ch.kind))}get isCUID2(){return!!this._def.checks.find((ch=>"cuid2"===ch.kind))}get isULID(){return!!this._def.checks.find((ch=>"ulid"===ch.kind))}get isIP(){return!!this._def.checks.find((ch=>"ip"===ch.kind))}get isBase64(){return!!this._def.checks.find((ch=>"base64"===ch.kind))}get minLength(){let min=null;for(const ch of this._def.checks)"min"===ch.kind&&(null===min||ch.value>min)&&(min=ch.value);return min}get maxLength(){let max=null;for(const ch of this._def.checks)"max"===ch.kind&&(null===max||ch.value<max)&&(max=ch.value);return max}}function floatSafeRemainder(val,step){const valDecCount=(val.toString().split(".")[1]||"").length,stepDecCount=(step.toString().split(".")[1]||"").length,decCount=valDecCount>stepDecCount?valDecCount:stepDecCount;return parseInt(val.toFixed(decCount).replace(".",""))%parseInt(step.toFixed(decCount).replace(".",""))/Math.pow(10,decCount)}ZodString.create=params=>{var _a;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:null!==(_a=null==params?void 0:params.coerce)&&void 0!==_a&&_a,...processCreateParams(params)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(input){this._def.coerce&&(input.data=Number(input.data));if(this._getType(input)!==ZodParsedType.number){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:ctx.parsedType}),INVALID}let ctx;const status=new ParseStatus;for(const check of this._def.checks)if("int"===check.kind)util.isInteger(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:check.message}),status.dirty());else if("min"===check.kind){(check.inclusive?input.data<check.value:input.data<=check.value)&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:check.value,type:"number",inclusive:check.inclusive,exact:!1,message:check.message}),status.dirty())}else if("max"===check.kind){(check.inclusive?input.data>check.value:input.data>=check.value)&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:check.value,type:"number",inclusive:check.inclusive,exact:!1,message:check.message}),status.dirty())}else"multipleOf"===check.kind?0!==floatSafeRemainder(input.data,check.value)&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.not_multiple_of,multipleOf:check.value,message:check.message}),status.dirty()):"finite"===check.kind?Number.isFinite(input.data)||(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.not_finite,message:check.message}),status.dirty()):util.assertNever(check);return{status:status.value,value:input.data}}gte(value,message){return this.setLimit("min",value,!0,errorUtil.toString(message))}gt(value,message){return this.setLimit("min",value,!1,errorUtil.toString(message))}lte(value,message){return this.setLimit("max",value,!0,errorUtil.toString(message))}lt(value,message){return this.setLimit("max",value,!1,errorUtil.toString(message))}setLimit(kind,value,inclusive,message){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind,value,inclusive,message:errorUtil.toString(message)}]})}_addCheck(check){return new ZodNumber({...this._def,checks:[...this._def.checks,check]})}int(message){return this._addCheck({kind:"int",message:errorUtil.toString(message)})}positive(message){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(message)})}negative(message){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(message)})}nonpositive(message){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(message)})}nonnegative(message){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(message)})}multipleOf(value,message){return this._addCheck({kind:"multipleOf",value,message:errorUtil.toString(message)})}finite(message){return this._addCheck({kind:"finite",message:errorUtil.toString(message)})}safe(message){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(message)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(message)})}get minValue(){let min=null;for(const ch of this._def.checks)"min"===ch.kind&&(null===min||ch.value>min)&&(min=ch.value);return min}get maxValue(){let max=null;for(const ch of this._def.checks)"max"===ch.kind&&(null===max||ch.value<max)&&(max=ch.value);return max}get isInt(){return!!this._def.checks.find((ch=>"int"===ch.kind||"multipleOf"===ch.kind&&util.isInteger(ch.value)))}get isFinite(){let max=null,min=null;for(const ch of this._def.checks){if("finite"===ch.kind||"int"===ch.kind||"multipleOf"===ch.kind)return!0;"min"===ch.kind?(null===min||ch.value>min)&&(min=ch.value):"max"===ch.kind&&(null===max||ch.value<max)&&(max=ch.value)}return Number.isFinite(min)&&Number.isFinite(max)}}ZodNumber.create=params=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:(null==params?void 0:params.coerce)||!1,...processCreateParams(params)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(input){this._def.coerce&&(input.data=BigInt(input.data));if(this._getType(input)!==ZodParsedType.bigint){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:ctx.parsedType}),INVALID}let ctx;const status=new ParseStatus;for(const check of this._def.checks)if("min"===check.kind){(check.inclusive?input.data<check.value:input.data<=check.value)&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,type:"bigint",minimum:check.value,inclusive:check.inclusive,message:check.message}),status.dirty())}else if("max"===check.kind){(check.inclusive?input.data>check.value:input.data>=check.value)&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,type:"bigint",maximum:check.value,inclusive:check.inclusive,message:check.message}),status.dirty())}else"multipleOf"===check.kind?input.data%check.value!==BigInt(0)&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.not_multiple_of,multipleOf:check.value,message:check.message}),status.dirty()):util.assertNever(check);return{status:status.value,value:input.data}}gte(value,message){return this.setLimit("min",value,!0,errorUtil.toString(message))}gt(value,message){return this.setLimit("min",value,!1,errorUtil.toString(message))}lte(value,message){return this.setLimit("max",value,!0,errorUtil.toString(message))}lt(value,message){return this.setLimit("max",value,!1,errorUtil.toString(message))}setLimit(kind,value,inclusive,message){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind,value,inclusive,message:errorUtil.toString(message)}]})}_addCheck(check){return new ZodBigInt({...this._def,checks:[...this._def.checks,check]})}positive(message){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(message)})}negative(message){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(message)})}nonpositive(message){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(message)})}nonnegative(message){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(message)})}multipleOf(value,message){return this._addCheck({kind:"multipleOf",value,message:errorUtil.toString(message)})}get minValue(){let min=null;for(const ch of this._def.checks)"min"===ch.kind&&(null===min||ch.value>min)&&(min=ch.value);return min}get maxValue(){let max=null;for(const ch of this._def.checks)"max"===ch.kind&&(null===max||ch.value<max)&&(max=ch.value);return max}}ZodBigInt.create=params=>{var _a;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:null!==(_a=null==params?void 0:params.coerce)&&void 0!==_a&&_a,...processCreateParams(params)})};class ZodBoolean extends ZodType{_parse(input){this._def.coerce&&(input.data=Boolean(input.data));if(this._getType(input)!==ZodParsedType.boolean){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodBoolean.create=params=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:(null==params?void 0:params.coerce)||!1,...processCreateParams(params)});class ZodDate extends ZodType{_parse(input){this._def.coerce&&(input.data=new Date(input.data));if(this._getType(input)!==ZodParsedType.date){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:ctx.parsedType}),INVALID}if(isNaN(input.data.getTime())){return addIssueToContext(this._getOrReturnCtx(input),{code:ZodIssueCode.invalid_date}),INVALID}const status=new ParseStatus;let ctx;for(const check of this._def.checks)"min"===check.kind?input.data.getTime()<check.value&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,message:check.message,inclusive:!0,exact:!1,minimum:check.value,type:"date"}),status.dirty()):"max"===check.kind?input.data.getTime()>check.value&&(ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,message:check.message,inclusive:!0,exact:!1,maximum:check.value,type:"date"}),status.dirty()):util.assertNever(check);return{status:status.value,value:new Date(input.data.getTime())}}_addCheck(check){return new ZodDate({...this._def,checks:[...this._def.checks,check]})}min(minDate,message){return this._addCheck({kind:"min",value:minDate.getTime(),message:errorUtil.toString(message)})}max(maxDate,message){return this._addCheck({kind:"max",value:maxDate.getTime(),message:errorUtil.toString(message)})}get minDate(){let min=null;for(const ch of this._def.checks)"min"===ch.kind&&(null===min||ch.value>min)&&(min=ch.value);return null!=min?new Date(min):null}get maxDate(){let max=null;for(const ch of this._def.checks)"max"===ch.kind&&(null===max||ch.value<max)&&(max=ch.value);return null!=max?new Date(max):null}}ZodDate.create=params=>new ZodDate({checks:[],coerce:(null==params?void 0:params.coerce)||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(params)});class ZodSymbol extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.symbol){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodSymbol.create=params=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(params)});class ZodUndefined extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.undefined){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodUndefined.create=params=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(params)});class ZodNull extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.null){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodNull.create=params=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(params)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(input){return OK(input.data)}}ZodAny.create=params=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(params)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(input){return OK(input.data)}}ZodUnknown.create=params=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(params)});class ZodNever extends ZodType{_parse(input){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:ctx.parsedType}),INVALID}}ZodNever.create=params=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(params)});class ZodVoid extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.undefined){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodVoid.create=params=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(params)});class ZodArray extends ZodType{_parse(input){const{ctx,status}=this._processInputParams(input),def=this._def;if(ctx.parsedType!==ZodParsedType.array)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:ctx.parsedType}),INVALID;if(null!==def.exactLength){const tooBig=ctx.data.length>def.exactLength.value,tooSmall=ctx.data.length<def.exactLength.value;(tooBig||tooSmall)&&(addIssueToContext(ctx,{code:tooBig?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:tooSmall?def.exactLength.value:void 0,maximum:tooBig?def.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:def.exactLength.message}),status.dirty())}if(null!==def.minLength&&ctx.data.length<def.minLength.value&&(addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:def.minLength.value,type:"array",inclusive:!0,exact:!1,message:def.minLength.message}),status.dirty()),null!==def.maxLength&&ctx.data.length>def.maxLength.value&&(addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:def.maxLength.value,type:"array",inclusive:!0,exact:!1,message:def.maxLength.message}),status.dirty()),ctx.common.async)return Promise.all([...ctx.data].map(((item,i)=>def.type._parseAsync(new ParseInputLazyPath(ctx,item,ctx.path,i))))).then((result=>ParseStatus.mergeArray(status,result)));const result=[...ctx.data].map(((item,i)=>def.type._parseSync(new ParseInputLazyPath(ctx,item,ctx.path,i))));return ParseStatus.mergeArray(status,result)}get element(){return this._def.type}min(minLength,message){return new ZodArray({...this._def,minLength:{value:minLength,message:errorUtil.toString(message)}})}max(maxLength,message){return new ZodArray({...this._def,maxLength:{value:maxLength,message:errorUtil.toString(message)}})}length(len,message){return new ZodArray({...this._def,exactLength:{value:len,message:errorUtil.toString(message)}})}nonempty(message){return this.min(1,message)}}function deepPartialify(schema){if(schema instanceof ZodObject){const newShape={};for(const key in schema.shape){const fieldSchema=schema.shape[key];newShape[key]=ZodOptional.create(deepPartialify(fieldSchema))}return new ZodObject({...schema._def,shape:()=>newShape})}return schema instanceof ZodArray?new ZodArray({...schema._def,type:deepPartialify(schema.element)}):schema instanceof ZodOptional?ZodOptional.create(deepPartialify(schema.unwrap())):schema instanceof ZodNullable?ZodNullable.create(deepPartialify(schema.unwrap())):schema instanceof ZodTuple?ZodTuple.create(schema.items.map((item=>deepPartialify(item)))):schema}ZodArray.create=(schema,params)=>new ZodArray({type:schema,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(params)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const shape=this._def.shape(),keys=util.objectKeys(shape);return this._cached={shape,keys}}_parse(input){if(this._getType(input)!==ZodParsedType.object){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:ctx.parsedType}),INVALID}const{status,ctx}=this._processInputParams(input),{shape,keys:shapeKeys}=this._getCached(),extraKeys=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(const key in ctx.data)shapeKeys.includes(key)||extraKeys.push(key);const pairs=[];for(const key of shapeKeys){const keyValidator=shape[key],value=ctx.data[key];pairs.push({key:{status:"valid",value:key},value:keyValidator._parse(new ParseInputLazyPath(ctx,value,ctx.path,key)),alwaysSet:key in ctx.data})}if(this._def.catchall instanceof ZodNever){const unknownKeys=this._def.unknownKeys;if("passthrough"===unknownKeys)for(const key of extraKeys)pairs.push({key:{status:"valid",value:key},value:{status:"valid",value:ctx.data[key]}});else if("strict"===unknownKeys)extraKeys.length>0&&(addIssueToContext(ctx,{code:ZodIssueCode.unrecognized_keys,keys:extraKeys}),status.dirty());else if("strip"!==unknownKeys)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const catchall=this._def.catchall;for(const key of extraKeys){const value=ctx.data[key];pairs.push({key:{status:"valid",value:key},value:catchall._parse(new ParseInputLazyPath(ctx,value,ctx.path,key)),alwaysSet:key in ctx.data})}}return ctx.common.async?Promise.resolve().then((0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){const syncPairs=[];for(const pair of pairs){const key=yield pair.key,value=yield pair.value;syncPairs.push({key,value,alwaysSet:pair.alwaysSet})}return syncPairs}))).then((syncPairs=>ParseStatus.mergeObjectSync(status,syncPairs))):ParseStatus.mergeObjectSync(status,pairs)}get shape(){return this._def.shape()}strict(message){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==message?{errorMap:(issue,ctx)=>{var _a,_b,_c,_d;const defaultError=null!==(_c=null===(_b=(_a=this._def).errorMap)||void 0===_b?void 0:_b.call(_a,issue,ctx).message)&&void 0!==_c?_c:ctx.defaultError;return"unrecognized_keys"===issue.code?{message:null!==(_d=errorUtil.errToObj(message).message)&&void 0!==_d?_d:defaultError}:{message:defaultError}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(augmentation){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...augmentation})})}merge(merging){return new ZodObject({unknownKeys:merging._def.unknownKeys,catchall:merging._def.catchall,shape:()=>({...this._def.shape(),...merging._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(key,schema){return this.augment({[key]:schema})}catchall(index){return new ZodObject({...this._def,catchall:index})}pick(mask){const shape={};return util.objectKeys(mask).forEach((key=>{mask[key]&&this.shape[key]&&(shape[key]=this.shape[key])})),new ZodObject({...this._def,shape:()=>shape})}omit(mask){const shape={};return util.objectKeys(this.shape).forEach((key=>{mask[key]||(shape[key]=this.shape[key])})),new ZodObject({...this._def,shape:()=>shape})}deepPartial(){return deepPartialify(this)}partial(mask){const newShape={};return util.objectKeys(this.shape).forEach((key=>{const fieldSchema=this.shape[key];mask&&!mask[key]?newShape[key]=fieldSchema:newShape[key]=fieldSchema.optional()})),new ZodObject({...this._def,shape:()=>newShape})}required(mask){const newShape={};return util.objectKeys(this.shape).forEach((key=>{if(mask&&!mask[key])newShape[key]=this.shape[key];else{let newField=this.shape[key];for(;newField instanceof ZodOptional;)newField=newField._def.innerType;newShape[key]=newField}})),new ZodObject({...this._def,shape:()=>newShape})}keyof(){return createZodEnum(util.objectKeys(this.shape))}}ZodObject.create=(shape,params)=>new ZodObject({shape:()=>shape,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(params)}),ZodObject.strictCreate=(shape,params)=>new ZodObject({shape:()=>shape,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(params)}),ZodObject.lazycreate=(shape,params)=>new ZodObject({shape,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(params)});class ZodUnion extends ZodType{_parse(input){const{ctx}=this._processInputParams(input),options=this._def.options;if(ctx.common.async)return Promise.all(options.map(function(){var _ref2=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(option){const childCtx={...ctx,common:{...ctx.common,issues:[]},parent:null};return{result:yield option._parseAsync({data:ctx.data,path:ctx.path,parent:childCtx}),ctx:childCtx}}));return function(_x2){return _ref2.apply(this,arguments)}}())).then((function handleResults(results){for(const result of results)if("valid"===result.result.status)return result.result;for(const result of results)if("dirty"===result.result.status)return ctx.common.issues.push(...result.ctx.common.issues),result.result;const unionErrors=results.map((result=>new ZodError(result.ctx.common.issues)));return addIssueToContext(ctx,{code:ZodIssueCode.invalid_union,unionErrors}),INVALID}));{let dirty;const issues=[];for(const option of options){const childCtx={...ctx,common:{...ctx.common,issues:[]},parent:null},result=option._parseSync({data:ctx.data,path:ctx.path,parent:childCtx});if("valid"===result.status)return result;"dirty"!==result.status||dirty||(dirty={result,ctx:childCtx}),childCtx.common.issues.length&&issues.push(childCtx.common.issues)}if(dirty)return ctx.common.issues.push(...dirty.ctx.common.issues),dirty.result;const unionErrors=issues.map((issues=>new ZodError(issues)));return addIssueToContext(ctx,{code:ZodIssueCode.invalid_union,unionErrors}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(types,params)=>new ZodUnion({options:types,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(params)});const getDiscriminator=type=>type instanceof ZodLazy?getDiscriminator(type.schema):type instanceof ZodEffects?getDiscriminator(type.innerType()):type instanceof ZodLiteral?[type.value]:type instanceof ZodEnum?type.options:type instanceof ZodNativeEnum?util.objectValues(type.enum):type instanceof ZodDefault?getDiscriminator(type._def.innerType):type instanceof ZodUndefined?[void 0]:type instanceof ZodNull?[null]:type instanceof ZodOptional?[void 0,...getDiscriminator(type.unwrap())]:type instanceof ZodNullable?[null,...getDiscriminator(type.unwrap())]:type instanceof ZodBranded||type instanceof ZodReadonly?getDiscriminator(type.unwrap()):type instanceof ZodCatch?getDiscriminator(type._def.innerType):[];class ZodDiscriminatedUnion extends ZodType{_parse(input){const{ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.object)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:ctx.parsedType}),INVALID;const discriminator=this.discriminator,discriminatorValue=ctx.data[discriminator],option=this.optionsMap.get(discriminatorValue);return option?ctx.common.async?option._parseAsync({data:ctx.data,path:ctx.path,parent:ctx}):option._parseSync({data:ctx.data,path:ctx.path,parent:ctx}):(addIssueToContext(ctx,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[discriminator]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(discriminator,options,params){const optionsMap=new Map;for(const type of options){const discriminatorValues=getDiscriminator(type.shape[discriminator]);if(!discriminatorValues.length)throw new Error(`A discriminator value for key \`${discriminator}\` could not be extracted from all schema options`);for(const value of discriminatorValues){if(optionsMap.has(value))throw new Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);optionsMap.set(value,type)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator,options,optionsMap,...processCreateParams(params)})}}function mergeValues(a,b){const aType=getParsedType(a),bType=getParsedType(b);if(a===b)return{valid:!0,data:a};if(aType===ZodParsedType.object&&bType===ZodParsedType.object){const bKeys=util.objectKeys(b),sharedKeys=util.objectKeys(a).filter((key=>-1!==bKeys.indexOf(key))),newObj={...a,...b};for(const key of sharedKeys){const sharedValue=mergeValues(a[key],b[key]);if(!sharedValue.valid)return{valid:!1};newObj[key]=sharedValue.data}return{valid:!0,data:newObj}}if(aType===ZodParsedType.array&&bType===ZodParsedType.array){if(a.length!==b.length)return{valid:!1};const newArray=[];for(let index=0;index<a.length;index++){const sharedValue=mergeValues(a[index],b[index]);if(!sharedValue.valid)return{valid:!1};newArray.push(sharedValue.data)}return{valid:!0,data:newArray}}return aType===ZodParsedType.date&&bType===ZodParsedType.date&&+a==+b?{valid:!0,data:a}:{valid:!1}}class ZodIntersection extends ZodType{_parse(input){const{status,ctx}=this._processInputParams(input),handleParsed=(parsedLeft,parsedRight)=>{if(isAborted(parsedLeft)||isAborted(parsedRight))return INVALID;const merged=mergeValues(parsedLeft.value,parsedRight.value);return merged.valid?((isDirty(parsedLeft)||isDirty(parsedRight))&&status.dirty(),{status:status.value,value:merged.data}):(addIssueToContext(ctx,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return ctx.common.async?Promise.all([this._def.left._parseAsync({data:ctx.data,path:ctx.path,parent:ctx}),this._def.right._parseAsync({data:ctx.data,path:ctx.path,parent:ctx})]).then((([left,right])=>handleParsed(left,right))):handleParsed(this._def.left._parseSync({data:ctx.data,path:ctx.path,parent:ctx}),this._def.right._parseSync({data:ctx.data,path:ctx.path,parent:ctx}))}}ZodIntersection.create=(left,right,params)=>new ZodIntersection({left,right,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(params)});class ZodTuple extends ZodType{_parse(input){const{status,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.array)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:ctx.parsedType}),INVALID;if(ctx.data.length<this._def.items.length)return addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&ctx.data.length>this._def.items.length&&(addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),status.dirty());const items=[...ctx.data].map(((item,itemIndex)=>{const schema=this._def.items[itemIndex]||this._def.rest;return schema?schema._parse(new ParseInputLazyPath(ctx,item,ctx.path,itemIndex)):null})).filter((x=>!!x));return ctx.common.async?Promise.all(items).then((results=>ParseStatus.mergeArray(status,results))):ParseStatus.mergeArray(status,items)}get items(){return this._def.items}rest(rest){return new ZodTuple({...this._def,rest})}}ZodTuple.create=(schemas,params)=>{if(!Array.isArray(schemas))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:schemas,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(params)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(input){const{status,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.object)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:ctx.parsedType}),INVALID;const pairs=[],keyType=this._def.keyType,valueType=this._def.valueType;for(const key in ctx.data)pairs.push({key:keyType._parse(new ParseInputLazyPath(ctx,key,ctx.path,key)),value:valueType._parse(new ParseInputLazyPath(ctx,ctx.data[key],ctx.path,key)),alwaysSet:key in ctx.data});return ctx.common.async?ParseStatus.mergeObjectAsync(status,pairs):ParseStatus.mergeObjectSync(status,pairs)}get element(){return this._def.valueType}static create(first,second,third){return new ZodRecord(second instanceof ZodType?{keyType:first,valueType:second,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(third)}:{keyType:ZodString.create(),valueType:first,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(second)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(input){const{status,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.map)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:ctx.parsedType}),INVALID;const keyType=this._def.keyType,valueType=this._def.valueType,pairs=[...ctx.data.entries()].map((([key,value],index)=>({key:keyType._parse(new ParseInputLazyPath(ctx,key,ctx.path,[index,"key"])),value:valueType._parse(new ParseInputLazyPath(ctx,value,ctx.path,[index,"value"]))})));if(ctx.common.async){const finalMap=new Map;return Promise.resolve().then((0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){for(const pair of pairs){const key=yield pair.key,value=yield pair.value;if("aborted"===key.status||"aborted"===value.status)return INVALID;"dirty"!==key.status&&"dirty"!==value.status||status.dirty(),finalMap.set(key.value,value.value)}return{status:status.value,value:finalMap}})))}{const finalMap=new Map;for(const pair of pairs){const key=pair.key,value=pair.value;if("aborted"===key.status||"aborted"===value.status)return INVALID;"dirty"!==key.status&&"dirty"!==value.status||status.dirty(),finalMap.set(key.value,value.value)}return{status:status.value,value:finalMap}}}}ZodMap.create=(keyType,valueType,params)=>new ZodMap({valueType,keyType,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(params)});class ZodSet extends ZodType{_parse(input){const{status,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.set)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:ctx.parsedType}),INVALID;const def=this._def;null!==def.minSize&&ctx.data.size<def.minSize.value&&(addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:def.minSize.value,type:"set",inclusive:!0,exact:!1,message:def.minSize.message}),status.dirty()),null!==def.maxSize&&ctx.data.size>def.maxSize.value&&(addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:def.maxSize.value,type:"set",inclusive:!0,exact:!1,message:def.maxSize.message}),status.dirty());const valueType=this._def.valueType;function finalizeSet(elements){const parsedSet=new Set;for(const element of elements){if("aborted"===element.status)return INVALID;"dirty"===element.status&&status.dirty(),parsedSet.add(element.value)}return{status:status.value,value:parsedSet}}const elements=[...ctx.data.values()].map(((item,i)=>valueType._parse(new ParseInputLazyPath(ctx,item,ctx.path,i))));return ctx.common.async?Promise.all(elements).then((elements=>finalizeSet(elements))):finalizeSet(elements)}min(minSize,message){return new ZodSet({...this._def,minSize:{value:minSize,message:errorUtil.toString(message)}})}max(maxSize,message){return new ZodSet({...this._def,maxSize:{value:maxSize,message:errorUtil.toString(message)}})}size(size,message){return this.min(size,message).max(size,message)}nonempty(message){return this.min(1,message)}}ZodSet.create=(valueType,params)=>new ZodSet({valueType,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(params)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(input){const{ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.function)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:ctx.parsedType}),INVALID;function makeArgsIssue(args,error){return makeIssue({data:args,path:ctx.path,errorMaps:[ctx.common.contextualErrorMap,ctx.schemaErrorMap,getErrorMap(),errorMap].filter((x=>!!x)),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:error}})}function makeReturnsIssue(returns,error){return makeIssue({data:returns,path:ctx.path,errorMaps:[ctx.common.contextualErrorMap,ctx.schemaErrorMap,getErrorMap(),errorMap].filter((x=>!!x)),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:error}})}const params={errorMap:ctx.common.contextualErrorMap},fn=ctx.data;if(this._def.returns instanceof ZodPromise){const me=this;return OK((0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(...args){const error=new ZodError([]),parsedArgs=yield me._def.args.parseAsync(args,params).catch((e=>{throw error.addIssue(makeArgsIssue(args,e)),error})),result=yield Reflect.apply(fn,this,parsedArgs);return yield me._def.returns._def.type.parseAsync(result,params).catch((e=>{throw error.addIssue(makeReturnsIssue(result,e)),error}))})))}{const me=this;return OK((function(...args){const parsedArgs=me._def.args.safeParse(args,params);if(!parsedArgs.success)throw new ZodError([makeArgsIssue(args,parsedArgs.error)]);const result=Reflect.apply(fn,this,parsedArgs.data),parsedReturns=me._def.returns.safeParse(result,params);if(!parsedReturns.success)throw new ZodError([makeReturnsIssue(result,parsedReturns.error)]);return parsedReturns.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...items){return new ZodFunction({...this._def,args:ZodTuple.create(items).rest(ZodUnknown.create())})}returns(returnType){return new ZodFunction({...this._def,returns:returnType})}implement(func){return this.parse(func)}strictImplement(func){return this.parse(func)}static create(args,returns,params){return new ZodFunction({args:args||ZodTuple.create([]).rest(ZodUnknown.create()),returns:returns||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(params)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(input){const{ctx}=this._processInputParams(input);return this._def.getter()._parse({data:ctx.data,path:ctx.path,parent:ctx})}}ZodLazy.create=(getter,params)=>new ZodLazy({getter,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(params)});class ZodLiteral extends ZodType{_parse(input){if(input.data!==this._def.value){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{received:ctx.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:input.data}}get value(){return this._def.value}}function createZodEnum(values,params){return new ZodEnum({values,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(params)})}ZodLiteral.create=(value,params)=>new ZodLiteral({value,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(params)});class ZodEnum extends ZodType{constructor(){super(...arguments),_ZodEnum_cache.set(this,void 0)}_parse(input){if("string"!=typeof input.data){const ctx=this._getOrReturnCtx(input),expectedValues=this._def.values;return addIssueToContext(ctx,{expected:util.joinValues(expectedValues),received:ctx.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodEnum_cache,"f")||__classPrivateFieldSet(this,_ZodEnum_cache,new Set(this._def.values),"f"),!__classPrivateFieldGet(this,_ZodEnum_cache,"f").has(input.data)){const ctx=this._getOrReturnCtx(input),expectedValues=this._def.values;return addIssueToContext(ctx,{received:ctx.data,code:ZodIssueCode.invalid_enum_value,options:expectedValues}),INVALID}return OK(input.data)}get options(){return this._def.values}get enum(){const enumValues={};for(const val of this._def.values)enumValues[val]=val;return enumValues}get Values(){const enumValues={};for(const val of this._def.values)enumValues[val]=val;return enumValues}get Enum(){const enumValues={};for(const val of this._def.values)enumValues[val]=val;return enumValues}extract(values,newDef=this._def){return ZodEnum.create(values,{...this._def,...newDef})}exclude(values,newDef=this._def){return ZodEnum.create(this.options.filter((opt=>!values.includes(opt))),{...this._def,...newDef})}}_ZodEnum_cache=new WeakMap,ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{constructor(){super(...arguments),_ZodNativeEnum_cache.set(this,void 0)}_parse(input){const nativeEnumValues=util.getValidEnumValues(this._def.values),ctx=this._getOrReturnCtx(input);if(ctx.parsedType!==ZodParsedType.string&&ctx.parsedType!==ZodParsedType.number){const expectedValues=util.objectValues(nativeEnumValues);return addIssueToContext(ctx,{expected:util.joinValues(expectedValues),received:ctx.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodNativeEnum_cache,"f")||__classPrivateFieldSet(this,_ZodNativeEnum_cache,new Set(util.getValidEnumValues(this._def.values)),"f"),!__classPrivateFieldGet(this,_ZodNativeEnum_cache,"f").has(input.data)){const expectedValues=util.objectValues(nativeEnumValues);return addIssueToContext(ctx,{received:ctx.data,code:ZodIssueCode.invalid_enum_value,options:expectedValues}),INVALID}return OK(input.data)}get enum(){return this._def.values}}_ZodNativeEnum_cache=new WeakMap,ZodNativeEnum.create=(values,params)=>new ZodNativeEnum({values,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(params)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(input){const{ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.promise&&!1===ctx.common.async)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:ctx.parsedType}),INVALID;const promisified=ctx.parsedType===ZodParsedType.promise?ctx.data:Promise.resolve(ctx.data);return OK(promisified.then((data=>this._def.type.parseAsync(data,{path:ctx.path,errorMap:ctx.common.contextualErrorMap}))))}}ZodPromise.create=(schema,params)=>new ZodPromise({type:schema,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(params)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(input){var _this3=this;const{status,ctx}=this._processInputParams(input),effect=this._def.effect||null,checkCtx={addIssue:arg=>{addIssueToContext(ctx,arg),arg.fatal?status.abort():status.dirty()},get path(){return ctx.path}};if(checkCtx.addIssue=checkCtx.addIssue.bind(checkCtx),"preprocess"===effect.type){const processed=effect.transform(ctx.data,checkCtx);if(ctx.common.async)return Promise.resolve(processed).then(function(){var _ref5=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(processed){if("aborted"===status.value)return INVALID;const result=yield _this3._def.schema._parseAsync({data:processed,path:ctx.path,parent:ctx});return"aborted"===result.status?INVALID:"dirty"===result.status||"dirty"===status.value?DIRTY(result.value):result}));return function(_x3){return _ref5.apply(this,arguments)}}());{if("aborted"===status.value)return INVALID;const result=this._def.schema._parseSync({data:processed,path:ctx.path,parent:ctx});return"aborted"===result.status?INVALID:"dirty"===result.status||"dirty"===status.value?DIRTY(result.value):result}}if("refinement"===effect.type){const executeRefinement=acc=>{const result=effect.refinement(acc,checkCtx);if(ctx.common.async)return Promise.resolve(result);if(result instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return acc};if(!1===ctx.common.async){const inner=this._def.schema._parseSync({data:ctx.data,path:ctx.path,parent:ctx});return"aborted"===inner.status?INVALID:("dirty"===inner.status&&status.dirty(),executeRefinement(inner.value),{status:status.value,value:inner.value})}return this._def.schema._parseAsync({data:ctx.data,path:ctx.path,parent:ctx}).then((inner=>"aborted"===inner.status?INVALID:("dirty"===inner.status&&status.dirty(),executeRefinement(inner.value).then((()=>({status:status.value,value:inner.value}))))))}if("transform"===effect.type){if(!1===ctx.common.async){const base=this._def.schema._parseSync({data:ctx.data,path:ctx.path,parent:ctx});if(!isValid(base))return base;const result=effect.transform(base.value,checkCtx);if(result instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:status.value,value:result}}return this._def.schema._parseAsync({data:ctx.data,path:ctx.path,parent:ctx}).then((base=>isValid(base)?Promise.resolve(effect.transform(base.value,checkCtx)).then((result=>({status:status.value,value:result}))):base))}util.assertNever(effect)}}ZodEffects.create=(schema,effect,params)=>new ZodEffects({schema,typeName:ZodFirstPartyTypeKind.ZodEffects,effect,...processCreateParams(params)}),ZodEffects.createWithPreprocess=(preprocess,schema,params)=>new ZodEffects({schema,effect:{type:"preprocess",transform:preprocess},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(params)});class ZodOptional extends ZodType{_parse(input){return this._getType(input)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(input)}unwrap(){return this._def.innerType}}ZodOptional.create=(type,params)=>new ZodOptional({innerType:type,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(params)});class ZodNullable extends ZodType{_parse(input){return this._getType(input)===ZodParsedType.null?OK(null):this._def.innerType._parse(input)}unwrap(){return this._def.innerType}}ZodNullable.create=(type,params)=>new ZodNullable({innerType:type,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(params)});class ZodDefault extends ZodType{_parse(input){const{ctx}=this._processInputParams(input);let data=ctx.data;return ctx.parsedType===ZodParsedType.undefined&&(data=this._def.defaultValue()),this._def.innerType._parse({data,path:ctx.path,parent:ctx})}removeDefault(){return this._def.innerType}}ZodDefault.create=(type,params)=>new ZodDefault({innerType:type,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:"function"==typeof params.default?params.default:()=>params.default,...processCreateParams(params)});class ZodCatch extends ZodType{_parse(input){const{ctx}=this._processInputParams(input),newCtx={...ctx,common:{...ctx.common,issues:[]}},result=this._def.innerType._parse({data:newCtx.data,path:newCtx.path,parent:{...newCtx}});return isAsync(result)?result.then((result=>({status:"valid",value:"valid"===result.status?result.value:this._def.catchValue({get error(){return new ZodError(newCtx.common.issues)},input:newCtx.data})}))):{status:"valid",value:"valid"===result.status?result.value:this._def.catchValue({get error(){return new ZodError(newCtx.common.issues)},input:newCtx.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(type,params)=>new ZodCatch({innerType:type,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:"function"==typeof params.catch?params.catch:()=>params.catch,...processCreateParams(params)});class ZodNaN extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.nan){const ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:ctx.parsedType}),INVALID}return{status:"valid",value:input.data}}}ZodNaN.create=params=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(params)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(input){const{ctx}=this._processInputParams(input),data=ctx.data;return this._def.type._parse({data,path:ctx.path,parent:ctx})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(input){var _this4=this;const{status,ctx}=this._processInputParams(input);if(ctx.common.async){const handleAsync=function(){var _ref6=(0,_home_runner_work_ocap_ocap_node_modules_angular_devkit_build_angular_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((function*(){const inResult=yield _this4._def.in._parseAsync({data:ctx.data,path:ctx.path,parent:ctx});return"aborted"===inResult.status?INVALID:"dirty"===inResult.status?(status.dirty(),DIRTY(inResult.value)):_this4._def.out._parseAsync({data:inResult.value,path:ctx.path,parent:ctx})}));return function handleAsync(){return _ref6.apply(this,arguments)}}();return handleAsync()}{const inResult=this._def.in._parseSync({data:ctx.data,path:ctx.path,parent:ctx});return"aborted"===inResult.status?INVALID:"dirty"===inResult.status?(status.dirty(),{status:"dirty",value:inResult.value}):this._def.out._parseSync({data:inResult.value,path:ctx.path,parent:ctx})}}static create(a,b){return new ZodPipeline({in:a,out:b,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(input){const result=this._def.innerType._parse(input),freeze=data=>(isValid(data)&&(data.value=Object.freeze(data.value)),data);return isAsync(result)?result.then((data=>freeze(data))):freeze(result)}unwrap(){return this._def.innerType}}function custom(check,params={},fatal){return check?ZodAny.create().superRefine(((data,ctx)=>{var _a,_b;if(!check(data)){const p="function"==typeof params?params(data):"string"==typeof params?{message:params}:params,_fatal=null===(_b=null!==(_a=p.fatal)&&void 0!==_a?_a:fatal)||void 0===_b||_b,p2="string"==typeof p?{message:p}:p;ctx.addIssue({code:"custom",...p2,fatal:_fatal})}})):ZodAny.create()}ZodReadonly.create=(type,params)=>new ZodReadonly({innerType:type,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(params)});const late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;!function(ZodFirstPartyTypeKind){ZodFirstPartyTypeKind.ZodString="ZodString",ZodFirstPartyTypeKind.ZodNumber="ZodNumber",ZodFirstPartyTypeKind.ZodNaN="ZodNaN",ZodFirstPartyTypeKind.ZodBigInt="ZodBigInt",ZodFirstPartyTypeKind.ZodBoolean="ZodBoolean",ZodFirstPartyTypeKind.ZodDate="ZodDate",ZodFirstPartyTypeKind.ZodSymbol="ZodSymbol",ZodFirstPartyTypeKind.ZodUndefined="ZodUndefined",ZodFirstPartyTypeKind.ZodNull="ZodNull",ZodFirstPartyTypeKind.ZodAny="ZodAny",ZodFirstPartyTypeKind.ZodUnknown="ZodUnknown",ZodFirstPartyTypeKind.ZodNever="ZodNever",ZodFirstPartyTypeKind.ZodVoid="ZodVoid",ZodFirstPartyTypeKind.ZodArray="ZodArray",ZodFirstPartyTypeKind.ZodObject="ZodObject",ZodFirstPartyTypeKind.ZodUnion="ZodUnion",ZodFirstPartyTypeKind.ZodDiscriminatedUnion="ZodDiscriminatedUnion",ZodFirstPartyTypeKind.ZodIntersection="ZodIntersection",ZodFirstPartyTypeKind.ZodTuple="ZodTuple",ZodFirstPartyTypeKind.ZodRecord="ZodRecord",ZodFirstPartyTypeKind.ZodMap="ZodMap",ZodFirstPartyTypeKind.ZodSet="ZodSet",ZodFirstPartyTypeKind.ZodFunction="ZodFunction",ZodFirstPartyTypeKind.ZodLazy="ZodLazy",ZodFirstPartyTypeKind.ZodLiteral="ZodLiteral",ZodFirstPartyTypeKind.ZodEnum="ZodEnum",ZodFirstPartyTypeKind.ZodEffects="ZodEffects",ZodFirstPartyTypeKind.ZodNativeEnum="ZodNativeEnum",ZodFirstPartyTypeKind.ZodOptional="ZodOptional",ZodFirstPartyTypeKind.ZodNullable="ZodNullable",ZodFirstPartyTypeKind.ZodDefault="ZodDefault",ZodFirstPartyTypeKind.ZodCatch="ZodCatch",ZodFirstPartyTypeKind.ZodPromise="ZodPromise",ZodFirstPartyTypeKind.ZodBranded="ZodBranded",ZodFirstPartyTypeKind.ZodPipeline="ZodPipeline",ZodFirstPartyTypeKind.ZodReadonly="ZodReadonly"}(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,coerce={string:arg=>ZodString.create({...arg,coerce:!0}),number:arg=>ZodNumber.create({...arg,coerce:!0}),boolean:arg=>ZodBoolean.create({...arg,coerce:!0}),bigint:arg=>ZodBigInt.create({...arg,coerce:!0}),date:arg=>ZodDate.create({...arg,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:function setErrorMap(map){overrideErrorMap=map},getErrorMap,makeIssue,EMPTY_PATH:[],addIssueToContext,ParseStatus,INVALID,DIRTY,OK,isAborted,isDirty,isValid,isAsync,get util(){return util},get objectUtil(){return objectUtil},ZodParsedType,getParsedType,ZodType,datetimeRegex,ZodString,ZodNumber,ZodBigInt,ZodBoolean,ZodDate,ZodSymbol,ZodUndefined,ZodNull,ZodAny,ZodUnknown,ZodNever,ZodVoid,ZodArray,ZodObject,ZodUnion,ZodDiscriminatedUnion,ZodIntersection,ZodTuple,ZodRecord,ZodMap,ZodSet,ZodFunction,ZodLazy,ZodLiteral,ZodEnum,ZodNativeEnum,ZodPromise,ZodEffects,ZodTransformer:ZodEffects,ZodOptional,ZodNullable,ZodDefault,ZodCatch,ZodNaN,BRAND,ZodBranded,ZodPipeline,ZodReadonly,custom,Schema:ZodType,ZodSchema:ZodType,late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:(cls,params={message:`Input not instance of ${cls.name}`})=>custom((data=>data instanceof cls),params),intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean:()=>booleanType().optional(),onumber:()=>numberType().optional(),optional:optionalType,ostring:()=>stringType().optional(),pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER,ZodIssueCode,quotelessJson:obj=>JSON.stringify(obj,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError})}}]);